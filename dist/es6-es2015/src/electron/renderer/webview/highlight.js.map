{"version":3,"file":"highlight.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/webview/highlight.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\nimport * as crypto from \"crypto\";\nimport * as debounce from \"debounce\";\nimport { ipcRenderer } from \"electron\";\n\nimport {\n    IEventPayload_R2_EVENT_HIGHLIGHT_CLICK, R2_EVENT_HIGHLIGHT_CLICK,\n} from \"../../common/events\";\nimport {\n    HighlightDrawTypeStrikethrough, HighlightDrawTypeUnderline, IColor, IHighlight,\n    IHighlightDefinition,\n} from \"../../common/highlight\";\nimport { isPaginated } from \"../../common/readium-css-inject\";\nimport { ISelectionInfo } from \"../../common/selection\";\nimport { IRectSimple, getClientRectsNoOverlap_ } from \"../common/rect-utils\";\nimport { getScrollingElement, isVerticalWritingMode, isTwoPageSpread } from \"./readium-css\";\nimport { convertRangeInfo } from \"./selection\";\nimport { ReadiumElectronWebviewWindow } from \"./state\";\n\nimport { ID_HIGHLIGHTS_CONTAINER, CLASS_HIGHLIGHT_AREA, CLASS_HIGHLIGHT_CONTAINER, CLASS_HIGHLIGHT_CURSOR1, CLASS_HIGHLIGHT_CURSOR2, CLASS_HIGHLIGHT_COMMON, CLASS_HIGHLIGHT_BOUNDING_AREA, CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN, CLASS_HIGHLIGHT_MARGIN, CLASS_HIGHLIGHT_HOVER } from \"../../common/styles\";\n\nimport { isRTL } from \"./readium-css\";\n\nconst IS_DEV = (process.env.NODE_ENV === \"development\" || process.env.NODE_ENV === \"dev\");\n\n// const DEBUG_VISUALS = false; // IS_DEV;\n\n// const USE_SVG = false;\n\nconst DEFAULT_BACKGROUND_COLOR: IColor = {\n    blue: 0,\n    green: 0,\n    red: 255,\n};\n\nconst _highlights: IHighlight[] = [];\n\nlet _drawMargin: boolean | string[] = false;\nconst drawMargin = (h: IHighlight) => {\n    if (Array.isArray(_drawMargin)) {\n        if (h.group) {\n            return _drawMargin.includes(h.group);\n        }\n        return false;\n    }\n    return _drawMargin;\n};\nexport const setDrawMargin = (win: ReadiumElectronWebviewWindow, drawMargin: boolean | string[]) => {\n    _drawMargin = drawMargin;\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- _drawMargin: \" + JSON.stringify(_drawMargin, null, 4));\n    }\n    recreateAllHighlightsRaw(win);\n};\n\n// interface IAreaWithActiveFlag extends Element {\n//     active: boolean | undefined;\n// }\n\ninterface IWithRect {\n    rect: IRectSimple;\n    scale: number;\n    // xOffset: number;\n    // yOffset: number;\n}\ninterface IHTMLDivElementWithRect extends HTMLDivElement, IWithRect {\n}\n\n// const SVG_XML_NAMESPACE = \"http://www.w3.org/2000/svg\";\n// interface ISVGRectElementWithRect extends SVGRectElement, IWithRect {\n// }\n// interface ISVGLineElementWithRect extends SVGLineElement, IWithRect {\n// }\n\n// interface IDocumentBody extends HTMLElement {\n//     _CachedBoundingClientRect: DOMRect | undefined;\n//     _CachedMargins: IRect | undefined;\n// }\nexport function getBoundingClientRectOfDocumentBody(win: ReadiumElectronWebviewWindow): DOMRect {\n    // TODO: does this need to be cached? (performance, notably during mouse hover)\n    return win.document.body.getBoundingClientRect();\n\n    // if (!(win.document.body as IDocumentBody)._CachedBoundingClientRect) {\n    //     (win.document.body as IDocumentBody)._CachedBoundingClientRect = win.document.body.getBoundingClientRect();\n    // }\n    // console.log(\"_CachedBoundingClientRect\",\n    //     JSON.stringify((win.document.body as IDocumentBody)._CachedBoundingClientRect));\n    // return (win.document.body as IDocumentBody)._CachedBoundingClientRect as DOMRect;\n}\n// export function invalidateBoundingClientRectOfDocumentBody(win: ReadiumElectronWebviewWindow) {\n//     (win.document.body as IDocumentBody)._CachedBoundingClientRect = undefined;\n// }\n// function getBodyMargin(win: ReadiumElectronWebviewWindow): IRect {\n//     const bodyStyle = win.getComputedStyle(win.document.body);\n//     if (!(win.document.body as IDocumentBody)._CachedMargins) {\n//         (win.document.body as IDocumentBody)._CachedMargins = {\n//             bottom: parseInt(bodyStyle.marginBottom, 10),\n//             height: 0,\n//             left: parseInt(bodyStyle.marginLeft, 10),\n//             right: parseInt(bodyStyle.marginRight, 10),\n//             top: parseInt(bodyStyle.marginTop, 10),\n//             width: 0,\n//         };\n//     }\n//     console.log(\"_CachedMargins\",\n//         JSON.stringify((win.document.body as IDocumentBody)._CachedMargins));\n//     return (win.document.body as IDocumentBody)._CachedMargins as IRect;\n// }\n\nfunction processMouseEvent(win: ReadiumElectronWebviewWindow, ev: MouseEvent) {\n\n    // const highlightsContainer = documant.getElementById(`${ID_HIGHLIGHTS_CONTAINER}`);\n    if (!_highlightsContainer) {\n        return;\n    }\n\n    const isMouseMove = ev.type === \"mousemove\";\n    if (isMouseMove) {\n        // no hit testing during user selection drag\n        if (ev.buttons > 0) {\n            return;\n        }\n\n        if (!_highlights.length) {\n            return;\n        }\n    }\n\n    const documant = win.document;\n    const scrollElement = getScrollingElement(documant);\n\n    // relative to fixed window top-left corner\n    // (unlike pageX/Y which is relative to top-left rendered content area, subject to scrolling)\n    const x = ev.clientX;\n    const y = ev.clientY;\n\n    const paginated = isPaginated(documant);\n\n    // COSTLY! TODO: cache DOMRect\n    const bodyRect = getBoundingClientRectOfDocumentBody(win);\n\n    const xOffset = paginated ? (-scrollElement.scrollLeft) : bodyRect.left;\n    const yOffset = paginated ? (-scrollElement.scrollTop) : bodyRect.top;\n\n    const testHit = (highlightFragment: Element) => {\n        const withRect = (highlightFragment as unknown) as IWithRect;\n        // console.log(`RECT: ${withRect.rect.left} | ${withRect.rect.top} // ${withRect.rect.width} | ${withRect.rect.height}`);\n\n        const left = withRect.rect.left + xOffset; // (paginated ? withRect.xOffset : xOffset);\n        const top = withRect.rect.top + yOffset; // (paginated ? withRect.yOffset : yOffset);\n        if (x >= left &&\n            x < (left + withRect.rect.width) &&\n            y >= top &&\n            y < (top + withRect.rect.height)\n            ) {\n\n            return true;\n        }\n        return false;\n    };\n\n    // const useSVG = !(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS) && USE_SVG;\n\n    let changeCursor = false;\n    let foundHighlight: IHighlight | undefined;\n    let foundElement: IHTMLDivElementWithRect | undefined;\n    // for (const highlight of _highlights) {\n    for (let i = _highlights.length - 1; i >= 0; i--) {\n        const highlight = _highlights[i];\n\n        let highlightParent = documant.getElementById(`${highlight.id}`);\n        if (!highlightParent) { // ??!!\n            highlightParent = _highlightsContainer.querySelector(`#${highlight.id}`); // .${CLASS_HIGHLIGHT_CONTAINER}\n        }\n        if (!highlightParent) { // what?\n            continue;\n        }\n\n        let hit = false;\n        let highlightFragment = highlightParent.firstElementChild;\n        while (highlightFragment) {\n            // if (useSVG && highlightFragment.namespaceURI === SVG_XML_NAMESPACE) {\n            //     let svgRect = highlightFragment.firstElementChild;\n            //     while (svgRect) {\n            //         if (testHit(svgRect)) {\n            //             changeCursor = true;\n            //             hit = true;\n            //             break;\n            //         }\n            //         svgRect = svgRect.nextElementSibling;\n            //     }\n            //     if (hit) {\n            //         break;\n            //     }\n            // } else\n            if (highlightFragment.classList.contains(CLASS_HIGHLIGHT_AREA)) {\n\n                if (testHit(highlightFragment)) {\n                    changeCursor = true;\n                    hit = true;\n                    break;\n                }\n            } else if (highlightFragment.classList.contains(CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN)) {\n\n                if (testHit(highlightFragment)) {\n                    changeCursor = true;\n                    hit = true;\n                    break;\n                }\n            }\n            highlightFragment = highlightFragment.nextElementSibling;\n        }\n\n        if (hit) {\n            foundHighlight = highlight;\n            foundElement = highlightParent as IHTMLDivElementWithRect;\n            break;\n        }\n    }\n\n    if (!foundHighlight || !foundElement) {\n\n        documant.documentElement.classList.remove(CLASS_HIGHLIGHT_CURSOR1);\n        documant.documentElement.classList.remove(CLASS_HIGHLIGHT_CURSOR2);\n\n        let highlightContainer = _highlightsContainer.firstElementChild;\n        while (highlightContainer) {\n            highlightContainer.classList.remove(CLASS_HIGHLIGHT_HOVER);\n\n            // const id = highlightContainer.id || highlightContainer.getAttribute(\"id\");\n            // const highlight = id ? _highlights.find((h) => h.id === id) : undefined;\n            // const drawUnderline = highlight?.drawType === HighlightDrawTypeUnderline;\n            // const drawStrikeThrough = highlight?.drawType === HighlightDrawTypeStrikethrough;\n            // const doDrawMargin = highlight ? drawMargin(highlight) : false;\n\n            // if ((DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS)) {\n            //     let highlightContainerChild = highlightContainer.firstElementChild;\n            //     while (highlightContainerChild) {\n\n            //         if (highlightContainerChild.classList.contains(CLASS_HIGHLIGHT_BOUNDING_AREA)\n            //             && (highlightContainerChild as unknown as IAreaWithActiveFlag).active) {\n\n            //             (highlightContainerChild as unknown as IAreaWithActiveFlag).active = false;\n\n            //             (highlightContainerChild as HTMLElement).style.setProperty(\"outline\", \"none\", \"important\");\n\n            //             (highlightContainerChild as HTMLElement).style.setProperty(\n            //                 \"background-color\",\n            //                 \"transparent\",\n            //                 \"important\");\n            //         }\n            //         highlightContainerChild = highlightContainerChild.nextElementSibling;\n            //     }\n            // }\n\n            highlightContainer = highlightContainer.nextElementSibling;\n        }\n\n        return;\n    }\n\n    if (foundHighlight.pointerInteraction) {\n\n        if (isMouseMove) {\n            const doDrawMargin = drawMargin(foundHighlight);\n\n            foundElement.classList.add(CLASS_HIGHLIGHT_HOVER);\n\n            if (changeCursor) {\n                documant.documentElement.classList.add(doDrawMargin ? CLASS_HIGHLIGHT_CURSOR1 : CLASS_HIGHLIGHT_CURSOR2);\n            }\n\n        } else if (ev.type === \"mouseup\" || ev.type === \"click\") {\n            ev.preventDefault();\n            ev.stopPropagation();\n\n            const payload: IEventPayload_R2_EVENT_HIGHLIGHT_CLICK = {\n                highlight: foundHighlight,\n                event: {\n                    type: ev.type,\n                    button: ev.button,\n                    alt: ev.altKey,\n                    shift: ev.shiftKey,\n                    ctrl: ev.ctrlKey,\n                    meta: ev.metaKey,\n                    x: ev.clientX,\n                    y: ev.clientY,\n                },\n            };\n            ipcRenderer.sendToHost(R2_EVENT_HIGHLIGHT_CLICK, payload);\n        }\n    }\n}\n\nlet lastMouseDownX = -1;\nlet lastMouseDownY = -1;\nlet bodyEventListenersSet = false;\nlet _highlightsContainer: HTMLElement | null;\nfunction ensureHighlightsContainer(win: ReadiumElectronWebviewWindow): HTMLElement {\n    const documant = win.document;\n\n    if (!_highlightsContainer) {\n\n        // Note that legacy ResizeSensor sets body position to \"relative\" (default static).\n        // Also note that ReadiumCSS default to (via stylesheet :root):\n        // documant.documentElement.style.position = \"relative\";\n        // see styles.js (static CSS injection):\n        // documant.documentElement.style.setProperty(\"height\", \"100vh\", \"important\");\n        // documant.body.style.position = \"relative\";\n        // documant.body.style.setProperty(\"position\", \"relative\", \"important\");\n        // documant.body.style.height = \"inherit\";\n        // https://github.com/edrlab/thorium-reader/issues/1658\n\n        if (!bodyEventListenersSet) {\n            bodyEventListenersSet = true;\n\n            // reminder: mouseenter/mouseleave do not bubble, so no event delegation\n            // documant.body.addEventListener(\"click\", (ev: MouseEvent) => {\n            //     processMouseEvent(win, ev);\n            // }, false);\n            documant.body.addEventListener(\"mousedown\", (ev: MouseEvent) => {\n                lastMouseDownX = ev.clientX;\n                lastMouseDownY = ev.clientY;\n            }, false);\n            documant.body.addEventListener(\"mouseup\", (ev: MouseEvent) => {\n                if ((Math.abs(lastMouseDownX - ev.clientX) < 3) &&\n                    (Math.abs(lastMouseDownY - ev.clientY) < 3)) {\n                    processMouseEvent(win, ev);\n                }\n            }, false);\n            documant.body.addEventListener(\"mousemove\", (ev: MouseEvent) => {\n                processMouseEvent(win, ev);\n            }, false);\n        }\n\n        _highlightsContainer = documant.createElement(\"div\");\n        _highlightsContainer.setAttribute(\"id\", ID_HIGHLIGHTS_CONTAINER);\n        _highlightsContainer.setAttribute(\"class\", CLASS_HIGHLIGHT_COMMON);\n        _highlightsContainer.setAttribute(\"style\",\n            \"width: auto !important; \" +\n            \"height: auto !important; \");\n        documant.body.append(_highlightsContainer);\n    }\n    return _highlightsContainer;\n}\n\nexport function hideAllhighlights(_documant: Document) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- hideAllhighlights: \" + _highlights.length);\n    }\n\n    if (_highlightsContainer) {\n        _highlightsContainer.remove();\n        _highlightsContainer = null;\n        // ensureHighlightsContainer(documant); LAZY\n    }\n}\n\nexport function destroyAllhighlights(documant: Document) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- destroyAllhighlights: \" + _highlights.length);\n    }\n    hideAllhighlights(documant);\n    _highlights.splice(0, _highlights.length);\n}\n\nexport function destroyHighlight(documant: Document, id: string) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- destroyHighlight: \" + id + \" ... \" + _highlights.length);\n    }\n    let i = -1;\n    const highlight = _highlights.find((h, j) => {\n        i = j;\n        return h.id === id;\n    });\n    if (highlight && i >= 0 && i < _highlights.length) {\n        _highlights.splice(i, 1);\n    }\n\n    const highlightContainer = documant.getElementById(id);\n    if (highlightContainer) {\n        highlightContainer.remove();\n    }\n}\n\nexport function destroyHighlightsGroup(documant: Document, group: string) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- destroyHighlightsGroup: \" + group + \" ... \" + _highlights.length);\n    }\n    while (true) {\n        let i = -1;\n        const highlight = _highlights.find((h, j) => {\n            i = j;\n            return h.group === group;\n        });\n        if (highlight) {\n            if (i >= 0 && i < _highlights.length) {\n                _highlights.splice(i, 1);\n            }\n\n            const highlightContainer = documant.getElementById(highlight.id);\n            if (highlightContainer) {\n                highlightContainer.remove();\n            }\n        } else {\n            break;\n        }\n    }\n}\n\nexport function recreateAllHighlightsRaw(win: ReadiumElectronWebviewWindow, highlights?: IHighlight[]) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- recreateAllHighlightsRaw: \" + _highlights.length + \" ==> \" + highlights?.length);\n    }\n\n    const documant = win.document;\n\n    if (highlights?.length) {\n        if (_highlights.length) {\n            if (IS_DEV) {\n                console.log(\"--HIGH WEBVIEW-- recreateAllHighlightsRaw DESTROY OLD BEFORE RESTORE BACKUP: \" + _highlights.length + \" ==> \" + highlights.length);\n            }\n            destroyAllhighlights(documant);\n        }\n        if (IS_DEV) {\n            console.log(\"--HIGH WEBVIEW-- recreateAllHighlightsRaw RESTORE BACKUP: \" + _highlights.length + \" ==> \" + highlights.length);\n        }\n        _highlights.push(...highlights);\n    }\n\n    if (!_highlights.length) {\n        return;\n    }\n\n    if (!documant.body) {\n        if (IS_DEV) {\n            console.log(\"--HIGH WEBVIEW-- NO BODY?! (retrying...): \" + _highlights.length);\n        }\n        recreateAllHighlightsDebounced(win);\n        return;\n    }\n\n    hideAllhighlights(documant);\n\n    const bodyRect = getBoundingClientRectOfDocumentBody(win);\n    const bodyComputedStyle = win.getComputedStyle(documant.body);\n\n    const docFrag = documant.createDocumentFragment();\n    for (const highlight of _highlights) {\n        const div = createHighlightDom(win, highlight, bodyRect, bodyComputedStyle);\n        if (div) {\n            docFrag.append(div);\n        }\n    }\n\n    const highlightsContainer = ensureHighlightsContainer(win);\n    highlightsContainer.append(docFrag);\n}\n\nexport const recreateAllHighlightsDebounced = debounce((win: ReadiumElectronWebviewWindow) => {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- recreateAllHighlightsDebounced: \" + _highlights.length);\n    }\n    recreateAllHighlightsRaw(win);\n}, 500);\n\nexport function recreateAllHighlights(win: ReadiumElectronWebviewWindow) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- recreateAllHighlights: \" + _highlights.length);\n    }\n    hideAllhighlights(win.document);\n    recreateAllHighlightsDebounced(win);\n}\n\nexport function createHighlights(\n    win: ReadiumElectronWebviewWindow,\n    highDefs: IHighlightDefinition[],\n    pointerInteraction: boolean): Array<IHighlight | null> {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- createHighlights: \" + highDefs.length + \" ... \" + _highlights.length);\n    }\n\n    const documant = win.document;\n    const highlights: Array<IHighlight | null> = [];\n\n    const bodyRect = getBoundingClientRectOfDocumentBody(win);\n    const bodyComputedStyle = win.getComputedStyle(documant.body);\n\n    const docFrag = documant.createDocumentFragment();\n    for (const highDef of highDefs) {\n        if (!highDef.selectionInfo && !highDef.range) {\n            highlights.push(null);\n            continue;\n        }\n        const [high, div] = createHighlight(\n            win,\n            highDef.selectionInfo,\n            highDef.range,\n            highDef.color,\n            pointerInteraction,\n            highDef.drawType,\n            highDef.expand,\n            highDef.group,\n            bodyRect,\n            bodyComputedStyle);\n        highlights.push(high);\n\n        if (div) {\n            docFrag.append(div);\n        }\n    }\n\n    const highlightsContainer = ensureHighlightsContainer(win);\n    highlightsContainer.append(docFrag);\n\n    return highlights;\n}\n\nconst computeCFI = (node: Node): string | undefined => {\n\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        if (node.parentNode) {\n            return computeCFI(node.parentNode);\n        }\n        return undefined;\n    }\n\n    let cfi = \"\";\n\n    let currentElement = node as Element;\n    while (currentElement.parentNode && currentElement.parentNode.nodeType === Node.ELEMENT_NODE) {\n        const currentElementParentChildren = (currentElement.parentNode as Element).children;\n        let currentElementIndex = -1;\n        for (let i = 0; i < currentElementParentChildren.length; i++) {\n            if (currentElement === currentElementParentChildren[i]) {\n                currentElementIndex = i;\n                break;\n            }\n        }\n        if (currentElementIndex >= 0) {\n            const cfiIndex = (currentElementIndex + 1) * 2;\n            cfi = cfiIndex +\n                (currentElement.id ? (\"[\" + currentElement.id + \"]\") : \"\") +\n                (cfi.length ? (\"/\" + cfi) : \"\");\n        }\n        currentElement = currentElement.parentNode as Element;\n    }\n\n    return \"/\" + cfi;\n};\n\nexport function createHighlight(\n    win: ReadiumElectronWebviewWindow,\n    selectionInfo: ISelectionInfo | undefined,\n    range: Range | undefined,\n    color: IColor | undefined,\n    pointerInteraction: boolean,\n    drawType: number | undefined,\n    expand: number | undefined,\n    group: string | undefined,\n    bodyRect: DOMRect,\n    bodyComputedStyle: CSSStyleDeclaration): [IHighlight, HTMLDivElement | null] {\n\n    // tslint:disable-next-line:no-string-literal\n    // console.log(\"Chromium: \" + process.versions[\"chrome\"]);\n\n    const uniqueStr = selectionInfo ? `${selectionInfo.rangeInfo.startContainerElementCssSelector}${selectionInfo.rangeInfo.startContainerChildTextNodeIndex}${selectionInfo.rangeInfo.startOffset}${selectionInfo.rangeInfo.endContainerElementCssSelector}${selectionInfo.rangeInfo.endContainerChildTextNodeIndex}${selectionInfo.rangeInfo.endOffset}` : range ? `${range.startOffset}-${range.endOffset}-${computeCFI(range.startContainer)}-${computeCFI(range.endContainer)}` : \"_RANGE_\"; // ${selectionInfo.rangeInfo.cfi} useless\n\n    // console.log(\"RANGE uniqueStr: \" + uniqueStr + \" (( \" + range?.toString());\n\n    // const unique = Buffer.from(JSON.stringify(selectionInfo.rangeInfo, null, \"\")).toString(\"base64\");\n    // const unique = Buffer.from(uniqueStr).toString(\"base64\");\n    // const id = \"R2_HIGHLIGHT_\" + unique.replace(/\\+/, \"_\").replace(/=/, \"-\").replace(/\\//, \".\");\n    const checkSum = crypto.createHash(\"sha1\"); // sha256 slow\n    checkSum.update(uniqueStr);\n    const shaHex = checkSum.digest(\"hex\");\n    const idBase = \"R2_HIGHLIGHT_\" + shaHex;\n    let id = idBase;\n    let idIdx = 0;\n    while (\n        _highlights.find((h) => h.id === id) ||\n        win.document.getElementById(id)) {\n\n        if (IS_DEV) {\n            console.log(\"HIGHLIGHT ID already exists, increment: \" + uniqueStr + \" ==> \" + id);\n        }\n        id = `${idBase}_${idIdx++}`;\n    }\n\n    const highlight: IHighlight = {\n        color: color ? color : DEFAULT_BACKGROUND_COLOR,\n        drawType,\n        expand,\n        id,\n        pointerInteraction,\n        selectionInfo,\n        range,\n        group,\n    };\n    _highlights.push(highlight);\n\n    const div = createHighlightDom(win, highlight, bodyRect, bodyComputedStyle);\n    return [highlight, div];\n}\n\nfunction createHighlightDom(\n    win: ReadiumElectronWebviewWindow,\n    highlight: IHighlight,\n    bodyRect: DOMRect,\n    bodyComputedStyle: CSSStyleDeclaration): HTMLDivElement | null {\n\n    const documant = win.document;\n    const scrollElement = getScrollingElement(documant);\n\n    const range = highlight.selectionInfo ? convertRangeInfo(documant, highlight.selectionInfo.rangeInfo) : highlight.range;\n    if (!range) {\n        return null;\n    }\n\n    const drawUnderline = highlight.drawType === HighlightDrawTypeUnderline; // && !(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS);\n    const drawStrikeThrough = highlight.drawType === HighlightDrawTypeStrikethrough; // && !(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS);\n\n    const paginated = isPaginated(documant);\n    const paginatedTwo = paginated && isTwoPageSpread();\n\n    const rtl = isRTL();\n    const vertical = isVerticalWritingMode();\n\n    const doDrawMargin = drawMargin(highlight);\n\n    // checkRangeFix(documant);\n\n    // const highlightsContainer = ensureHighlightsContainer(win);\n\n    const highlightParent = documant.createElement(\"div\") as IHTMLDivElementWithRect;\n    highlightParent.setAttribute(\"id\", highlight.id);\n    highlightParent.setAttribute(\"class\", `${CLASS_HIGHLIGHT_CONTAINER} ${CLASS_HIGHLIGHT_COMMON}`);\n    highlightParent.setAttribute(\"data-type\", `${highlight.drawType}`);\n    if (highlight.group) {\n        highlightParent.setAttribute(\"data-group\", highlight.group);\n    }\n    if (doDrawMargin) {\n        // highlightParent.setAttribute(\"data-margin\", \"true\");\n        highlightParent.classList.add(CLASS_HIGHLIGHT_MARGIN);\n    }\n\n    const styleAttr = win.document.documentElement.getAttribute(\"style\");\n    const isNight = styleAttr ? styleAttr.indexOf(\"readium-night-on\") > 0 : false;\n    // const isSepia = styleAttr ? styleAttr.indexOf(\"readium-sepia-on\") > 0 : false;\n\n    highlightParent.style.setProperty(\n        \"mix-blend-mode\",\n        isNight ? \"hard-light\" : \"multiply\",\n        \"important\");\n\n    // const docStyle = (documant.defaultView as Window).getComputedStyle(documant.documentElement);\n    // const bodyStyle = (documant.defaultView as Window).getComputedStyle(documant.body);\n    // const marginLeft = bodyStyle.getPropertyValue(\"margin-left\");\n    // console.log(\"marginLeft: \" + marginLeft);\n    // const marginTop = bodyStyle.getPropertyValue(\"margin-top\");\n    // console.log(\"marginTop: \" + marginTop);\n\n    // console.log(\"==== bodyRect:\");\n    // console.log(\"width: \" + bodyRect.width);\n    // console.log(\"height: \" + bodyRect.height);\n    // console.log(\"top: \" + bodyRect.top);\n    // console.log(\"bottom: \" + bodyRect.bottom);\n    // console.log(\"left: \" + bodyRect.left);\n    // console.log(\"right: \" + bodyRect.right);\n\n    // const xOffset = paginated ? (bodyRect.left - parseInt(marginLeft, 10)) : bodyRect.left;\n    // const yOffset = paginated ? (bodyRect.top - parseInt(marginTop, 10)) : bodyRect.top;\n\n    const xOffset = paginated ? (-scrollElement.scrollLeft) : bodyRect.left;\n    const yOffset = paginated ? (-scrollElement.scrollTop) : bodyRect.top;\n\n    const scale = 1 / ((win.READIUM2 && win.READIUM2.isFixedLayout) ? win.READIUM2.fxlViewportScale : 1);\n    // const scale = 1;\n\n    // console.log(\"scrollElement.scrollLeft: \" + scrollElement.scrollLeft);\n    // console.log(\"scrollElement.scrollTop: \" + scrollElement.scrollTop);\n\n    // const useSVG = !(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS) && USE_SVG;\n\n    // TODO isVerticalWritingMode()?\n    const doNotMergeHorizontallyAlignedRects = drawUnderline || drawStrikeThrough;\n\n    const expand = highlight.expand ? highlight.expand : 0;\n\n    const rangeClientRects = range.getClientRects();\n    const clientRects =\n        // (DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS) ?\n        // rangeClientRects :\n        getClientRectsNoOverlap_(rangeClientRects, doNotMergeHorizontallyAlignedRects, expand);\n\n    // let highlightAreaSVGDocFrag: DocumentFragment | undefined;\n    // const roundedCorner = 3;\n\n    const underlineThickness = 3;\n    const strikeThroughLineThickness = 4;\n\n    const rangeBoundingClientRect = range.getBoundingClientRect();\n\n    const bodyWidth = parseInt(bodyComputedStyle.width, 10);\n\n    const paginatedWidth = scrollElement.clientWidth / (paginatedTwo ? 2 : 1);\n\n    const paginatedOffset = (paginatedWidth - bodyWidth) / 2 + parseInt(bodyComputedStyle.paddingLeft, 10);\n\n    for (const clientRect of clientRects) {\n\n        // if (useSVG) {\n        //     const borderThickness = 0;\n\n        //     if (!highlightAreaSVGDocFrag) {\n        //         highlightAreaSVGDocFrag = documant.createDocumentFragment();\n        //     }\n\n        //     if (drawUnderline) {\n        //         // TODO isVerticalWritingMode()\n\n        //         const highlightAreaSVGLine = documant.createElementNS(SVG_XML_NAMESPACE, \"line\") as ISVGLineElementWithRect;\n        //         highlightAreaSVGLine.setAttribute(\"class\", CLASS_HIGHLIGHT_AREA);\n\n        //         highlightAreaSVGLine.setAttribute(\"style\",\n        //             \"stroke-linecap: round !important; \" +\n        //             `stroke-width: ${underlineThickness * scale} !important; ` +\n        //             `stroke: rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important;`);\n        //         highlightAreaSVGLine.scale = scale;\n        //         // highlightAreaSVGLine.xOffset = xOffset;\n        //         // highlightAreaSVGLine.yOffset = yOffset;\n        //         highlightAreaSVGLine.rect = {\n        //             height: clientRect.height,\n        //             left: clientRect.left - xOffset,\n        //             top: clientRect.top - yOffset,\n        //             width: clientRect.width,\n        //         };\n        //         const lineOffset = (highlightAreaSVGLine.rect.width > roundedCorner) ? roundedCorner : 0;\n        //         highlightAreaSVGLine.setAttribute(\"x1\", `${(highlightAreaSVGLine.rect.left + lineOffset) * scale}`);\n        //         highlightAreaSVGLine.setAttribute(\"x2\", `${(highlightAreaSVGLine.rect.left + highlightAreaSVGLine.rect.width - lineOffset) * scale}`);\n        //         const y = (highlightAreaSVGLine.rect.top + highlightAreaSVGLine.rect.height - (underlineThickness / 2)) * scale;\n        //         highlightAreaSVGLine.setAttribute(\"y1\", `${y}`);\n        //         highlightAreaSVGLine.setAttribute(\"y2\", `${y}`);\n\n        //         highlightAreaSVGLine.setAttribute(\"height\", `${highlightAreaSVGLine.rect.height * scale}`);\n        //         highlightAreaSVGLine.setAttribute(\"width\", `${highlightAreaSVGLine.rect.width * scale}`);\n\n        //         highlightAreaSVGDocFrag.appendChild(highlightAreaSVGLine);\n        //     } else if (drawStrikeThrough) {\n        //         const highlightAreaSVGLine = documant.createElementNS(SVG_XML_NAMESPACE, \"line\") as ISVGLineElementWithRect;\n        //         highlightAreaSVGLine.setAttribute(\"class\", CLASS_HIGHLIGHT_AREA);\n\n        //         highlightAreaSVGLine.setAttribute(\"style\",\n        //             \"stroke-linecap: butt !important; \" +\n        //             `stroke-width: ${strikeThroughLineThickness * scale} !important; ` +\n        //             `stroke: rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important;`);\n        //             // stroke-dasharray: ${lineThickness * 2},${lineThickness * 2};\n\n        //         highlightAreaSVGLine.scale = scale;\n        //         // highlightAreaSVGLine.xOffset = xOffset;\n        //         // highlightAreaSVGLine.yOffset = yOffset;\n        //         highlightAreaSVGLine.rect = {\n        //             height: clientRect.height,\n        //             left: clientRect.left - xOffset,\n        //             top: clientRect.top - yOffset,\n        //             width: clientRect.width,\n        //         };\n        //         highlightAreaSVGLine.setAttribute(\"x1\", `${highlightAreaSVGLine.rect.left * scale}`);\n        //         highlightAreaSVGLine.setAttribute(\"x2\", `${(highlightAreaSVGLine.rect.left + highlightAreaSVGLine.rect.width) * scale}`);\n\n        //         const lineOffset = highlightAreaSVGLine.rect.height / 2;\n        //         const y = (highlightAreaSVGLine.rect.top + lineOffset) * scale;\n        //         highlightAreaSVGLine.setAttribute(\"y1\", `${y}`);\n        //         highlightAreaSVGLine.setAttribute(\"y2\", `${y}`);\n\n        //         highlightAreaSVGLine.setAttribute(\"height\", `${highlightAreaSVGLine.rect.height * scale}`);\n        //         highlightAreaSVGLine.setAttribute(\"width\", `${highlightAreaSVGLine.rect.width * scale}`);\n\n        //         highlightAreaSVGDocFrag.appendChild(highlightAreaSVGLine);\n        //     } else {\n\n        //         const highlightAreaSVGRect =\n        //             documant.createElementNS(SVG_XML_NAMESPACE, \"rect\") as ISVGRectElementWithRect;\n        //         highlightAreaSVGRect.setAttribute(\"class\", CLASS_HIGHLIGHT_AREA);\n\n        //         highlightAreaSVGRect.setAttribute(\"style\",\n        //             `fill: rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important; ` +\n        //             \"stroke-width: 0;\");\n\n        //         // stroke-width: ${borderThickness}; stroke: rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important; stroke-opacity: ${DEFAULT_BACKGROUND_COLOR_OPACITY} !important\n\n        //         highlightAreaSVGRect.scale = scale;\n        //         // highlightAreaSVGRect.xOffset = xOffset;\n        //         // highlightAreaSVGRect.yOffset = yOffset;\n        //         highlightAreaSVGRect.rect = {\n        //             height: clientRect.height,\n        //             left: clientRect.left - xOffset,\n        //             top: clientRect.top - yOffset,\n        //             width: clientRect.width,\n        //         };\n        //         highlightAreaSVGRect.setAttribute(\"rx\", `${roundedCorner * scale}`);\n        //         highlightAreaSVGRect.setAttribute(\"ry\", `${roundedCorner * scale}`);\n        //         highlightAreaSVGRect.setAttribute(\"x\", `${(highlightAreaSVGRect.rect.left - borderThickness) * scale}`);\n        //         highlightAreaSVGRect.setAttribute(\"y\", `${(highlightAreaSVGRect.rect.top - borderThickness) * scale}`);\n        //         highlightAreaSVGRect.setAttribute(\"height\", `${(highlightAreaSVGRect.rect.height + (borderThickness * 2)) * scale}`);\n        //         highlightAreaSVGRect.setAttribute(\"width\", `${(highlightAreaSVGRect.rect.width + (borderThickness * 2)) * scale}`);\n\n        //         highlightAreaSVGDocFrag.appendChild(highlightAreaSVGRect);\n        //     }\n        // } else\n        {\n            if (drawStrikeThrough) {\n\n                const highlightAreaLine = documant.createElement(\"div\") as IHTMLDivElementWithRect;\n                highlightAreaLine.setAttribute(\"class\", `${CLASS_HIGHLIGHT_AREA} ${CLASS_HIGHLIGHT_COMMON}`);\n                highlightAreaLine.setAttribute(\"style\",\n                    `background-color: rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important;`,\n                );\n\n                highlightAreaLine.scale = scale;\n                // highlightAreaLine.xOffset = xOffset;\n                // highlightAreaLine.yOffset = yOffset;\n\n                highlightAreaLine.rect = {\n                    height: clientRect.height,\n                    left: clientRect.left - xOffset,\n                    top: clientRect.top - yOffset,\n                    width: clientRect.width,\n                };\n\n                highlightAreaLine.style.setProperty(\"width\", `${(vertical ? strikeThroughLineThickness : highlightAreaLine.rect.width) * scale}px`, \"important\");\n                highlightAreaLine.style.setProperty(\"height\", `${(vertical ? highlightAreaLine.rect.height : strikeThroughLineThickness) * scale}px`, \"important\");\n                highlightAreaLine.style.setProperty(\"min-width\", highlightAreaLine.style.width, \"important\");\n                highlightAreaLine.style.setProperty(\"min-height\", highlightAreaLine.style.height, \"important\");\n                highlightAreaLine.style.setProperty(\"left\", `${(vertical ? (highlightAreaLine.rect.left + (highlightAreaLine.rect.width / 2) - (strikeThroughLineThickness / 2)) : highlightAreaLine.rect.left) * scale}px`, \"important\");\n                highlightAreaLine.style.setProperty(\"top\", `${(vertical ? highlightAreaLine.rect.top : (highlightAreaLine.rect.top + (highlightAreaLine.rect.height / 2) - (strikeThroughLineThickness / 2))) * scale}px`, \"important\");\n\n                highlightParent.append(highlightAreaLine);\n            } else {\n\n                const highlightArea = documant.createElement(\"div\") as IHTMLDivElementWithRect;\n                highlightArea.setAttribute(\"class\", `${CLASS_HIGHLIGHT_AREA} ${CLASS_HIGHLIGHT_COMMON}`);\n                let extra = \"\";\n                // if ((DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS)) {\n                //     const rgb = Math.round(0xffffff * Math.random());\n                //     // tslint:disable-next-line:no-bitwise\n                //     const r = rgb >> 16;\n                //     // tslint:disable-next-line:no-bitwise\n                //     const g = rgb >> 8 & 255;\n                //     // tslint:disable-next-line:no-bitwise\n                //     const b = rgb & 255;\n                //     extra = `outline-color: rgb(${r}, ${g}, ${b}); outline-style: solid; outline-width: 1px; outline-offset: -1px;`;\n                //     // box-shadow: inset 0 0 0 1px #600;\n                // } else\n                if (drawUnderline) {\n                    const side = isVerticalWritingMode() ? \"left\" : \"bottom\"; // isRTL()?\n                    extra = `border-${side}: ${underlineThickness * scale}px solid ` +\n                        `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important`;\n                }\n                highlightArea.setAttribute(\"style\",\n                    (drawUnderline ?\n                    \"\" : // background-color: transparent !important\n                    ( // `border-radius: ${roundedCorner}px !important; ` +\n                    \"background-color: \" +\n                        `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important;`\n                    )\n                    ) + ` ${extra}`);\n\n                highlightArea.scale = scale;\n                // highlightArea.xOffset = xOffset;\n                // highlightArea.yOffset = yOffset;\n\n                highlightArea.rect = {\n                    height: clientRect.height,\n                    left: clientRect.left - xOffset,\n                    top: clientRect.top - yOffset,\n                    width: clientRect.width,\n                };\n\n                highlightArea.style.setProperty(\"width\", `${highlightArea.rect.width * scale}px`, \"important\");\n                highlightArea.style.setProperty(\"height\", `${highlightArea.rect.height * scale}px`, \"important\");\n                highlightArea.style.setProperty(\"min-width\", highlightArea.style.width, \"important\");\n                highlightArea.style.setProperty(\"min-height\", highlightArea.style.height, \"important\");\n                highlightArea.style.setProperty(\"left\", `${highlightArea.rect.left * scale}px`, \"important\");\n                highlightArea.style.setProperty(\"top\", `${highlightArea.rect.top * scale}px`, \"important\");\n\n                highlightParent.append(highlightArea);\n            }\n        }\n    }\n\n    if (doDrawMargin && highlight.pointerInteraction) {\n        const MARGIN_MARKER_THICKNESS = 18 / (win.READIUM2.isFixedLayout ? scale : 1);\n        const MARGIN_MARKER_OFFSET = 4 / (win.READIUM2.isFixedLayout ? scale : 1);\n\n        const highlightBoundingMargin = documant.createElement(\"div\") as IHTMLDivElementWithRect;\n        highlightBoundingMargin.setAttribute(\"class\", `${CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN} ${CLASS_HIGHLIGHT_COMMON}`);\n\n        const round = MARGIN_MARKER_THICKNESS / 1.5;\n        highlightBoundingMargin.setAttribute(\"style\",\n            // `border-radius: ${round}px;` +\n            `border-top-left-radius: ${vertical ? round : rtl ? 0 : round}px;` +\n            `border-top-right-radius: ${vertical ? round : !rtl ? 0 : round}px;` +\n            `border-bottom-right-radius: ${vertical ? 0 : !rtl ? 0 :round}px;` +\n            `border-bottom-left-radius: ${vertical ? 0 : rtl ? 0 :round}px;` +\n            \"background-color: \" +\n            `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important;`,\n        );\n\n        highlightBoundingMargin.scale = scale;\n        // highlightBoundingMargin.xOffset = xOffset;\n        // highlightBoundingMargin.yOffset = yOffset;\n\n        const paginatedOffset_ = paginatedOffset - MARGIN_MARKER_OFFSET - MARGIN_MARKER_THICKNESS;\n\n        highlightBoundingMargin.rect = {\n            left:\n                // ----\n                vertical ?\n                (rangeBoundingClientRect.left - xOffset) :\n                // ----\n                paginated ?\n                (\n                    (rtl\n                    ?\n                    paginatedWidth - MARGIN_MARKER_THICKNESS // - MARGIN_MARKER_OFFSET\n                    :\n                    0 // MARGIN_MARKER_OFFSET\n                    )\n                    +\n                    (rtl\n                    ?\n                    -1 * paginatedOffset_\n                    :\n                    paginatedOffset_\n                    )\n                    +\n                    Math.floor((rangeBoundingClientRect.left - xOffset) / paginatedWidth) * paginatedWidth\n                )\n                :\n                // ---- scroll\n                (rtl\n                ?\n                MARGIN_MARKER_OFFSET + bodyRect.width - parseInt(bodyComputedStyle.paddingRight, 10)\n                :\n                win.READIUM2.isFixedLayout\n                ?\n                MARGIN_MARKER_OFFSET\n                :\n                parseInt(bodyComputedStyle.paddingLeft, 10) - MARGIN_MARKER_THICKNESS - MARGIN_MARKER_OFFSET\n                ),\n            top:\n            vertical\n            ?\n            parseInt(bodyComputedStyle.paddingTop, 10) - MARGIN_MARKER_THICKNESS - MARGIN_MARKER_OFFSET\n            :\n            (rangeBoundingClientRect.top - yOffset),\n            width: vertical ? rangeBoundingClientRect.width : MARGIN_MARKER_THICKNESS,\n            height: vertical ? MARGIN_MARKER_THICKNESS : rangeBoundingClientRect.height,\n        };\n\n        highlightBoundingMargin.style.setProperty(\"width\", `${highlightBoundingMargin.rect.width * scale}px`, \"important\");\n        highlightBoundingMargin.style.setProperty(\"height\", `${highlightBoundingMargin.rect.height * scale}px`, \"important\");\n        highlightBoundingMargin.style.setProperty(\"min-width\", highlightBoundingMargin.style.width, \"important\");\n        highlightBoundingMargin.style.setProperty(\"min-height\", highlightBoundingMargin.style.height, \"important\");\n        highlightBoundingMargin.style.setProperty(\"left\", `${highlightBoundingMargin.rect.left * scale}px`, \"important\");\n        highlightBoundingMargin.style.setProperty(\"top\", `${highlightBoundingMargin.rect.top * scale}px`, \"important\");\n        highlightParent.append(highlightBoundingMargin);\n    }\n\n    // if (useSVG && highlightAreaSVGDocFrag) {\n    //     // const highlightAreaSVGG = documant.createElementNS(SVG_XML_NAMESPACE, \"g\");\n    //     // highlightAreaSVGG.appendChild(highlightAreaSVGDocFrag);\n    //     const highlightAreaSVG = documant.createElementNS(SVG_XML_NAMESPACE, \"svg\");\n    //     highlightAreaSVG.setAttribute(\"class\", CLASS_HIGHLIGHT_COMMON);\n    //     // highlightAreaSVG.setAttribute(\"pointer-events\", \"none\");\n    //     highlightAreaSVG.style.setProperty(\"position\", paginated ? \"fixed\" : \"absolute\", \"important\");\n    //     highlightAreaSVG.append(highlightAreaSVGDocFrag);\n    //     highlightParent.append(highlightAreaSVG);\n    // }\n\n    const highlightBounding = documant.createElement(\"div\") as IHTMLDivElementWithRect;\n    highlightBounding.setAttribute(\"class\", `${CLASS_HIGHLIGHT_BOUNDING_AREA} ${CLASS_HIGHLIGHT_COMMON}`);\n\n    // if ((DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS)) {\n    //     highlightBounding.setAttribute(\"style\",\n    //         \"outline-color: magenta !important; \" +\n    //         \"outline-style: solid !important; \" +\n    //         \"outline-width: 1px !important; \" +\n    //         \"outline-offset: -1px !important;\");\n    // }\n\n    highlightBounding.scale = scale;\n    // highlightBounding.xOffset = xOffset;\n    // highlightBounding.yOffset = yOffset;\n\n    // highlightBounding.rect = {\n    //     height: rangeBoundingClientRect.height + expand * 2,\n    //     left: rangeBoundingClientRect.left - xOffset - expand,\n    //     top: rangeBoundingClientRect.top - yOffset - expand,\n    //     width: rangeBoundingClientRect.width + expand * 2,\n    // };\n\n    const leftBase = rangeBoundingClientRect.left - xOffset - expand;\n    const leftOff = (paginatedWidth - bodyWidth) / 2;\n    highlightBounding.rect = {\n        left:\n            paginated\n            ?\n            rtl\n            ?\n            leftBase - leftOff - paginatedWidth\n            :\n            leftBase - leftOff\n            :\n            leftBase,\n        top: rangeBoundingClientRect.top - yOffset - expand,\n        width: rangeBoundingClientRect.width + expand * 2,\n        height: rangeBoundingClientRect.height + expand * 2,\n    };\n\n    highlightBounding.style.setProperty(\"width\", `${highlightBounding.rect.width * scale}px`, \"important\");\n    highlightBounding.style.setProperty(\"height\", `${highlightBounding.rect.height * scale}px`, \"important\");\n    highlightBounding.style.setProperty(\"min-width\", highlightBounding.style.width, \"important\");\n    highlightBounding.style.setProperty(\"min-height\", highlightBounding.style.height, \"important\");\n    highlightBounding.style.setProperty(\"left\", `${highlightBounding.rect.left * scale}px`, \"important\");\n    highlightBounding.style.setProperty(\"top\", `${highlightBounding.rect.top * scale}px`, \"important\");\n    highlightParent.append(highlightBounding);\n\n\n    // highlightsContainer.append(highlightParent);\n    return highlightParent;\n}\n"]}