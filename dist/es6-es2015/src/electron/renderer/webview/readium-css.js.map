{"version":3,"file":"readium-css.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/webview/readium-css.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\nimport * as debounce from \"debounce\";\nimport { IEventPayload_R2_EVENT_READIUMCSS } from \"../../common/events\";\nimport {\n    isDocRTL, isDocVertical, isPaginated, readiumCSSSet,\n} from \"../../common/readium-css-inject\";\nimport { FOOTNOTE_FORCE_SHOW, ROOT_CLASS_NO_FOOTNOTES } from \"../../common/styles\";\nimport { ReadiumElectronWebviewWindow } from \"./state\";\n\nimport {\n    POPOUTIMAGE_CONTAINER_ID, R2_MO_CLASS_PAUSED, R2_MO_CLASS_PLAYING, TTS_CLASS_PAUSED, TTS_CLASS_PLAYING,\n} from \"../../common/styles\";\n\nconst win = global.window as ReadiumElectronWebviewWindow;\n\nconst IS_DEV = (process.env.NODE_ENV === \"development\" || process.env.NODE_ENV === \"dev\");\n\nexport const clearImageZoomOutlineDebounced = debounce(() => {\n    if (win.document.documentElement.classList.contains(R2_MO_CLASS_PAUSED) ||\n        win.document.documentElement.classList.contains(R2_MO_CLASS_PLAYING) ||\n        win.READIUM2.ttsClickEnabled ||\n        win.document.documentElement.classList.contains(TTS_CLASS_PAUSED) ||\n        win.document.documentElement.classList.contains(TTS_CLASS_PLAYING)) {\n        clearImageZoomOutline();\n    }\n}, 200);\nexport const clearImageZoomOutline = () => {\n    const imgs = win.document.querySelectorAll(`img[data-${POPOUTIMAGE_CONTAINER_ID}]`);\n    imgs.forEach((img) => {\n        img.removeAttribute(`data-${POPOUTIMAGE_CONTAINER_ID}`);\n    });\n    const images = win.document.querySelectorAll(`image[data-${POPOUTIMAGE_CONTAINER_ID}]`);\n    images.forEach((img) => {\n        img.removeAttribute(`data-${POPOUTIMAGE_CONTAINER_ID}`);\n    });\n    const svgs = win.document.querySelectorAll(`svg[data-${POPOUTIMAGE_CONTAINER_ID}]`);\n    svgs.forEach((svg) => {\n        svg.removeAttribute(`data-${POPOUTIMAGE_CONTAINER_ID}`);\n    });\n};\n\nexport const getScrollingElement = (documant: Document): Element => {\n    if (documant.scrollingElement) {\n        return documant.scrollingElement;\n    }\n    return documant.body;\n\n    // console.log(process.versions);\n    // --\n    // electron: '1.8.8'\n    // chrome: '59.0.3071.115'\n    // ---\n    // electron: '4.1.3'\n    // chrome: '69.0.3497.128'\n    // ===\n    // const isBody = win.document.scrollingElement === win.document.body;\n    // console.log(isBody); // Electron V1: true, V4: false\n    // const isHTML = win.document.scrollingElement === win.document.documentElement;\n    // console.log(isHTML); // Electron V1: false, V4: true\n};\n\nconst calculateDocumentColumnizedWidthAdjustedForTwoPageSpread = (): number => {\n\n    if (!win || !win.document || !win.document.body || !win.document.documentElement) {\n        return 0;\n    }\n    const scrollElement = getScrollingElement(win.document);\n\n    let w = scrollElement.scrollWidth;\n    const noChange = !isPaginated(win.document) || !isTwoPageSpread() ||\n        isVerticalWritingMode(); // TODO: VWM?\n    if (!noChange) {\n        const columnizedDocWidth = w;\n        // console.log(`columnizedDocWidth: ${columnizedDocWidth}`);\n\n        const twoColWidth = win.document.documentElement.offsetWidth;\n        // console.log(`twoColWidth: ${twoColWidth}`);\n\n        const nSpreads = columnizedDocWidth / twoColWidth;\n        // console.log(`nSpreads: ${nSpreads}`);\n\n        const nWholeSpread = Math.floor(nSpreads);\n        // console.log(`nWholeSpread: ${nWholeSpread}`);\n\n        const fractionalSpread = nSpreads - nWholeSpread;\n        // console.log(`fractionalSpread: ${fractionalSpread}`);\n\n        if (fractionalSpread > 0 && (Math.round(fractionalSpread * 10) / 10) <= 0.5) {\n            w = twoColWidth * Math.ceil(nSpreads);\n            // tslint:disable-next-line\n            // console.log(`wDIFF: ${scrollElement.scrollWidth} => ${w} (${w - scrollElement.scrollWidth} -- ${twoColWidth / 2})`);\n        }\n    }\n    return w;\n};\n\nexport const calculateMaxScrollShift = ():\n    { maxScrollShift: number, maxScrollShiftAdjusted: number } => {\n\n    if (!win || !win.document || !win.document.body || !win.document.documentElement) {\n        return { maxScrollShift: 0, maxScrollShiftAdjusted: 0 };\n    }\n\n    const isPaged = isPaginated(win.document);\n\n    const scrollElement = getScrollingElement(win.document);\n\n    const vwm = isVerticalWritingMode();\n\n    const maxScrollShift = isPaged ?\n        ((vwm ?\n            (scrollElement.scrollHeight - win.document.documentElement.offsetHeight) :\n            (scrollElement.scrollWidth - win.document.documentElement.offsetWidth))) :\n        ((vwm ?\n            (scrollElement.scrollWidth - win.document.documentElement.clientWidth) :\n            (scrollElement.scrollHeight - win.document.documentElement.clientHeight)));\n\n    const maxScrollShiftAdjusted = isPaged ?\n        ((vwm ?\n            maxScrollShift :\n            (calculateDocumentColumnizedWidthAdjustedForTwoPageSpread() - win.document.documentElement.offsetWidth))) :\n        ((vwm ?\n            maxScrollShift :\n            maxScrollShift));\n\n    return { maxScrollShift, maxScrollShiftAdjusted };\n};\n\nexport const isTwoPageSpread = (): boolean => {\n\n    if (!win || !win.document || !win.document.documentElement) {\n        return false;\n    }\n\n    // const bodyStyle = win.getComputedStyle(win.document.body);\n    const docStyle = win.getComputedStyle(win.document.documentElement);\n\n    let docColumnCount: number | undefined;\n    // let docColumnGap: number | undefined;\n    if (docStyle) {\n        docColumnCount = parseInt(docStyle.getPropertyValue(\"column-count\"), 10);\n        // docColumnGap = parseInt(docStyle.getPropertyValue(\"column-gap\"), 10);\n    }\n\n    return docColumnCount === 2;\n};\n\nexport const calculateTotalColumns = (): number => {\n    if (!win || !win.document || !win.document.body || !isPaginated(win.document)) {\n        return 0;\n    }\n\n    const scrollElement = getScrollingElement(win.document);\n\n    let totalColumns = 0;\n    if (isVerticalWritingMode()) {\n        totalColumns = Math.ceil(win.document.body.offsetWidth / scrollElement.scrollWidth);\n    } else {\n        totalColumns = Math.ceil(win.document.body.offsetHeight / scrollElement.scrollHeight);\n    }\n    return totalColumns;\n};\nexport function calculateColumnDimension(): number {\n    if (!win.document || !win.document.documentElement || !win.document.body || !isPaginated(win.document)) {\n        return 0;\n    }\n\n    // win.document.body.offsetWidth + left/right margins === win.document.documentElement.offsetWidth\n    // margins non-zero in single page view\n\n    const isTwoPage = isTwoPageSpread();\n\n    let columnDimension = 0;\n    if (isVerticalWritingMode()) {\n        columnDimension = win.document.documentElement.offsetHeight;\n    } else {\n        columnDimension = (win.document.documentElement.offsetWidth * (isTwoPage ? 0.5 : 1));\n    }\n    return columnDimension;\n}\n\nlet _isVerticalWritingMode = false;\nexport function isVerticalWritingMode(): boolean {\n    return _isVerticalWritingMode;\n}\n\nlet _isRTL = false;\nexport function isRTL(): boolean {\n    return _isRTL;\n}\n\n// TODO? page-progression-direction\n// tslint:disable-next-line:max-line-length\n// https://github.com/readium/readium-css/blob/develop/docs/CSS16-internationalization.md\n// tslint:disable-next-line:max-line-length\n// https://github.com/readium/readium-css/blob/develop/docs/CSS12-user_prefs.md#user-settings-can-be-language-specific\nexport function computeVerticalRTL() {\n\n    if (!win.document || !win.document.documentElement) {\n        return;\n    }\n\n    let rtl = isDocRTL(win.document);\n    let vertical = isDocVertical(win.document);\n\n    const htmlStyle = win.getComputedStyle(win.document.documentElement);\n    if (htmlStyle) {\n        let prop = htmlStyle.getPropertyValue(\"writing-mode\");\n        if (!prop) {\n            prop = htmlStyle.getPropertyValue(\"-epub-writing-mode\");\n        }\n        if (prop && prop.indexOf(\"vertical\") >= 0) {\n            vertical = true;\n        }\n        if (prop && prop.indexOf(\"-rl\") > 0) {\n            rtl = true;\n        }\n        if (!rtl) {\n            prop = htmlStyle.getPropertyValue(\"direction\");\n            if (prop && prop.indexOf(\"rtl\") >= 0) {\n                rtl = true;\n            }\n        }\n    }\n    if ((!vertical || !rtl) && win.document.body) {\n        const bodyStyle = win.getComputedStyle(win.document.body);\n        if (bodyStyle) {\n            let prop: string;\n            if (!vertical) {\n                prop = bodyStyle.getPropertyValue(\"writing-mode\");\n                if (!prop) {\n                    prop = bodyStyle.getPropertyValue(\"-epub-writing-mode\");\n                }\n                if (prop && prop.indexOf(\"vertical\") >= 0) {\n                    vertical = true;\n                }\n                if (prop && prop.indexOf(\"-rl\") > 0) {\n                    rtl = true;\n                }\n            }\n            if (!rtl) {\n                prop = bodyStyle.getPropertyValue(\"direction\");\n                if (prop && prop.indexOf(\"rtl\") >= 0) {\n                    rtl = true;\n                }\n            }\n        }\n    }\n\n    _isVerticalWritingMode = vertical;\n    _isRTL = rtl;\n}\n\nexport function checkHiddenFootNotes(documant: Document) {\n    if (documant.documentElement.classList.contains(ROOT_CLASS_NO_FOOTNOTES)) {\n        return;\n    }\n\n    if (!documant.querySelectorAll) { // TODO: polyfill querySelector[All]() ?\n        return; // when streamer-injected\n    }\n\n    const aNodeList = documant.querySelectorAll(\"a[href]\");\n\n    documant.querySelectorAll(\"aside\").forEach((aside) => {\n        let id = aside.getAttribute(\"id\");\n        if (!id) {\n            return;\n        }\n        id = \"#\" + id;\n\n        let epubType = aside.getAttribute(\"epub:type\");\n        if (!epubType) {\n            epubType = aside.getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\");\n            if (!epubType) {\n                epubType = aside.getAttribute(\"role\");\n            }\n        }\n        if (!epubType) {\n            return;\n        }\n\n        epubType = epubType.trim().replace(/\\s\\s+/g, \" \"); // whitespace collapse\n\n        const isPotentiallyHiddenNote =\n            epubType.indexOf(\"note\") >= 0 // this covers all of below (and more!) ... TODO: smarter regexp?\n            // epubType.indexOf(\"footnote\") >= 0 ||\n            // epubType.indexOf(\"endnote\") >= 0 ||\n            // epubType.indexOf(\"rearnote\") >= 0 ||\n\n            // epubType.indexOf(\"doc-note\") >= 0\n            // epubType.indexOf(\"doc-footnote\") >= 0 ||\n            // epubType.indexOf(\"doc-endnote\") >= 0 ||\n            // epubType.indexOf(\"doc-rearnote\") >= 0 ||\n        ;\n\n        if (!isPotentiallyHiddenNote) {\n            return;\n        }\n\n        let found = false;\n        // tslint:disable-next-line:prefer-for-of\n        for (let i = 0; i < aNodeList.length; i++) {\n            const aNode = aNodeList[i];\n            const href = aNode.getAttribute(\"href\");\n            if (!href) {\n                continue;\n            }\n            // try {\n            //     const hash = new URL(href).hash; // includes #\n            //     if (hash === id) {\n            //         found = true;\n            //         break;\n            //     }\n            // } catch (err) {\n            //     debug(href);\n            //     debug(err);\n            //     continue;\n            // }\n            const iHash = href.indexOf(\"#\");\n            if (iHash < 0) { // includes \"#ID\" (as opposed to \"file.xhtml#ID\")\n                continue;\n            }\n\n            // TODO? (edge case) link to external HTML document fragment (not this \"documant\")\n            // with _exact_ same #ID => leaves note content hidden instead of forcing it to show!\n            // e.g. win.location.herf == chapter1.html\n            //      a@href == chapter2.html#id1\n            //      ==> aside#id1 in chapter1.html remains hidden\n            //          even though it may in fact not be linked from chapter1.html\n\n            // href.substring(0, iHash)\n            if (href.substring(iHash) === id) { // TODO: does not account for ?query-params\n                found = true;\n                break;\n            }\n        }\n        if (!found) {\n            aside.classList.add(FOOTNOTE_FORCE_SHOW);\n        }\n    });\n}\n\nexport const readiumCSS = (documant: Document, messageJson: IEventPayload_R2_EVENT_READIUMCSS) => {\n\n    if (IS_DEV) {\n        console.log(\"_____ readiumCssJson.urlRoot (readiumCSS()): \", messageJson.urlRoot);\n    }\n\n    readiumCSSSet(documant, messageJson, _isVerticalWritingMode, _isRTL);\n\n    if ((messageJson && messageJson.setCSS && !messageJson.setCSS.noFootnotes)) {\n        checkHiddenFootNotes(documant);\n    }\n};\n\n// // // https://javascript.info/size-and-scroll\n// export function debugCSSMetrics() {\n\n//     if (!win || !win.document || !win.document.documentElement || !win.document.body) {\n//         return;\n//     }\n\n//     // offsetW/H: excludes margin, includes border, scrollbar, padding.\n//     // clientW/H: excludes margin, border, scrollbar, includes padding.\n//     // scrollW/H: like client, but includes hidden (overflow) areas\n\n//     const bodyStyle = win.getComputedStyle(win.document.body);\n//     const docStyle = win.getComputedStyle(win.document.documentElement);\n\n//     console.log(\"--- XXXXX ---\");\n//     console.log(\"webview.innerWidth: \" + win.innerWidth);\n//     console.log(\"document.offsetWidth: \" + win.document.documentElement.offsetWidth);\n//     console.log(\"document.clientWidth: \" + win.document.documentElement.clientWidth);\n//     console.log(\"document.scrollWidth: \" + win.document.documentElement.scrollWidth);\n//     console.log(\"document.scrollLeft: \" + win.document.documentElement.scrollLeft);\n//     if (docStyle) {\n//         let propVal = docStyle.getPropertyValue(\"padding-left\");\n//         const docPaddingLeft = parseInt(propVal, 10);\n//         console.log(\"document.paddingLeft: \" + docPaddingLeft + \" // \" + propVal);\n\n//         propVal = docStyle.getPropertyValue(\"padding-right\");\n//         const docPaddingRight = parseInt(propVal, 10);\n//         console.log(\"document.paddingRight: \" + docPaddingRight + \" // \" + propVal);\n\n//         propVal = docStyle.getPropertyValue(\"margin-left\");\n//         const docMarginLeft = parseInt(propVal, 10);\n//         console.log(\"document.marginLeft: \" + docMarginLeft + \" // \" + propVal);\n\n//         propVal = docStyle.getPropertyValue(\"margin-right\");\n//         const docMarginRight = parseInt(propVal, 10);\n//         console.log(\"document.marginRight: \" + docMarginRight + \" // \" + propVal);\n\n//         const docTotalWidth = win.document.documentElement.offsetWidth + docMarginLeft + docMarginRight;\n//         console.log(\"document.offsetWidth + margins: \" + docTotalWidth);\n//     }\n//     console.log(\"body.offsetWidth: \" + win.document.body.offsetWidth);\n//     console.log(\"body.clientWidth: \" + win.document.body.clientWidth);\n//     console.log(\"body.scrollWidth: \" + win.document.body.scrollWidth);\n//     console.log(\"body.scrollLeft: \" + win.document.body.scrollLeft);\n//     if (bodyStyle) {\n//         let propVal = bodyStyle.getPropertyValue(\"padding-left\");\n//         const bodyPaddingLeft = parseInt(bodyStyle.getPropertyValue(\"padding-left\"), 10);\n//         console.log(\"body.paddingLeft: \" + bodyPaddingLeft + \" // \" + propVal);\n\n//         propVal = bodyStyle.getPropertyValue(\"padding-right\");\n//         const bodyPaddingRight = parseInt(propVal, 10);\n//         console.log(\"body.paddingRight: \" + bodyPaddingRight + \" // \" + propVal);\n\n//         propVal = bodyStyle.getPropertyValue(\"margin-left\");\n//         const bodyMarginLeft = parseInt(propVal, 10);\n//         console.log(\"body.marginLeft: \" + bodyMarginLeft + \" // \" + propVal);\n\n//         propVal = bodyStyle.getPropertyValue(\"margin-right\");\n//         const bodyMarginRight = parseInt(propVal, 10);\n//         console.log(\"body.marginRight: \" + bodyMarginRight + \" // \" + propVal);\n\n//         const bodyTotalWidth = win.document.body.offsetWidth + bodyMarginLeft + bodyMarginRight;\n//         console.log(\"body.offsetWidth + margins: \" + bodyTotalWidth);\n\n//         console.log(\"--- X factor: \" + (win.document.documentElement.offsetWidth / bodyTotalWidth));\n//     }\n//     console.log(\"--- YYYYY ---\");\n//     console.log(\"webview.innerHeight: \" + win.innerHeight);\n//     console.log(\"document.offsetHeight: \" + win.document.documentElement.offsetHeight);\n//     console.log(\"document.clientHeight: \" + win.document.documentElement.clientHeight);\n//     console.log(\"document.scrollHeight: \" + win.document.documentElement.scrollHeight);\n//     console.log(\"document.scrollTop: \" + win.document.documentElement.scrollTop);\n//     if (docStyle) {\n//         let propVal = docStyle.getPropertyValue(\"padding-top\");\n//         const docPaddingTop = parseInt(propVal, 10);\n//         console.log(\"document.paddingTop: \" + docPaddingTop + \" // \" + propVal);\n\n//         propVal = docStyle.getPropertyValue(\"padding-bottom\");\n//         const docPaddingBottom = parseInt(propVal, 10);\n//         console.log(\"document.paddingBottom: \" + docPaddingBottom + \" // \" + propVal);\n\n//         propVal = docStyle.getPropertyValue(\"margin-top\");\n//         const docMarginTop = parseInt(propVal, 10);\n//         console.log(\"document.marginTop: \" + docMarginTop + \" // \" + propVal);\n\n//         propVal = docStyle.getPropertyValue(\"margin-bottom\");\n//         const docMarginBottom = parseInt(propVal, 10);\n//         console.log(\"document.marginBottom: \" + docMarginBottom + \" // \" + propVal);\n\n//         const docTotalHeight = win.document.documentElement.offsetHeight + docMarginTop + docMarginBottom;\n//         console.log(\"document.offsetHeight + margins: \" + docTotalHeight);\n//     }\n//     console.log(\"body.offsetHeight: \" + win.document.body.offsetHeight);\n//     console.log(\"body.clientHeight: \" + win.document.body.clientHeight);\n//     console.log(\"body.scrollHeight: \" + win.document.body.scrollHeight);\n//     console.log(\"body.scrollTop: \" + win.document.body.scrollTop);\n//     if (bodyStyle) {\n//         let propVal = bodyStyle.getPropertyValue(\"padding-top\");\n//         const bodyPaddingTop = parseInt(propVal, 10);\n//         console.log(\"body.paddingTop: \" + bodyPaddingTop);\n\n//         propVal = bodyStyle.getPropertyValue(\"padding-bottom\");\n//         const bodyPaddingBottom = parseInt(propVal, 10);\n//         console.log(\"body.paddingBottom: \" + bodyPaddingBottom);\n\n//         propVal = bodyStyle.getPropertyValue(\"margin-top\");\n//         const bodyMarginTop = parseInt(propVal, 10);\n//         console.log(\"body.marginTop: \" + bodyMarginTop);\n\n//         propVal = bodyStyle.getPropertyValue(\"margin-bottom\");\n//         const bodyMarginBottom = parseInt(propVal, 10);\n//         console.log(\"body.marginBottom: \" + bodyMarginBottom);\n\n//         const bodyTotalHeight = win.document.body.offsetHeight + bodyMarginTop + bodyMarginBottom;\n//         console.log(\"body.offsetHeight + margins: \" + bodyTotalHeight);\n\n//         console.log(\"--- Y factor: \" + (win.document.documentElement.offsetHeight / bodyTotalHeight));\n//     }\n//     console.log(\"---\");\n// }\n"]}