{"version":3,"file":"preload.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/webview/preload.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\nconst IS_DEV = (process.env.NODE_ENV === \"development\" || process.env.NODE_ENV === \"dev\");\n\n// import { consoleRedirect } from \"../common/console-redirect\";\nif (IS_DEV) {\n    // tslint:disable-next-line:no-var-requires\n    const cr = require(\"../common/console-redirect\");\n    // const releaseConsoleRedirect =\n    cr.consoleRedirect(\"r2:navigator#electron/renderer/webview/preload\", process.stdout, process.stderr, true);\n}\n\nimport ResizeSensor = require(\"css-element-queries/src/ResizeSensor\");\n// import ResizeSensor = require(\"resize-sensor/ResizeSensor\");\n\nimport { LocatorLocations } from \"@r2-shared-js/models/locator\";\nimport { debounce } from \"debounce\";\nimport * as debug_ from \"debug\";\nimport { ipcRenderer } from \"electron\";\n\nimport {\n    IEventPayload_R2_EVENT_LINK,\n    IEventPayload_R2_EVENT_PAGE_TURN,\n    IEventPayload_R2_EVENT_READING_LOCATION,\n    IEventPayload_R2_EVENT_READING_LOCATION_PAGINATION_INFO,\n    IEventPayload_R2_EVENT_READIUMCSS,\n    IEventPayload_R2_EVENT_SCROLLTO,\n    IEventPayload_R2_EVENT_WEBVIEW_READY,\n    R2_EVENT_DEBUG_VISUALS,\n    R2_EVENT_LINK,\n    R2_EVENT_PAGE_TURN,\n    R2_EVENT_PAGE_TURN_RES,\n    R2_EVENT_READING_LOCATION,\n    R2_EVENT_SCROLLTO,\n    R2_EVENT_WEBVIEW_READY,\n} from \"../../common/events\";\nimport {\n    configureFixedLayout,\n    injectDefaultCSS,\n    injectReadPosCSS,\n    isPaginated,\n} from \"../../common/readium-css-inject\";\nimport {\n    readPosCssStylesAttr1,\n    readPosCssStylesAttr2,\n    readPosCssStylesAttr3,\n    readPosCssStylesAttr4,\n} from \"../../common/styles\";\n// import { READIUM2_ELECTRON_HTTP_PROTOCOL } from \"../../common/sessions\";\nimport { IPropertyAnimationState, animateProperty } from \"../common/animateProperty\";\nimport { uniqueCssSelector } from \"../common/cssselector2\";\nimport { easings } from \"../common/easings\";\nimport { getURLQueryParams } from \"../common/querystring\";\nimport {\n    URL_PARAM_CSS,\n    URL_PARAM_DEBUG_VISUALS,\n    URL_PARAM_EPUBREADINGSYSTEM,\n    URL_PARAM_GOTO,\n    URL_PARAM_PREVIOUS,\n} from \"../common/url-params\";\nimport { INameVersion, setWindowNavigatorEpubReadingSystem } from \"./epubReadingSystem\";\nimport {\n    calculateColumnDimension,\n    calculateMaxScrollShift,\n    calculateTotalColumns,\n    computeVerticalRTL,\n    isRTL,\n    isTwoPageSpread,\n    isVerticalWritingMode,\n    readiumCSS,\n} from \"./readium-css\";\nimport { IElectronWebviewTagWindow } from \"./state\";\n\nconst debug = debug_(\"r2:navigator#electron/renderer/webview/preload\");\n\n// webFrame.registerURLSchemeAsSecure(READIUM2_ELECTRON_HTTP_PROTOCOL);\n// webFrame.registerURLSchemeAsBypassingCSP(READIUM2_ELECTRON_HTTP_PROTOCOL);\n// webFrame.registerURLSchemeAsPrivileged(READIUM2_ELECTRON_HTTP_PROTOCOL, {\n//     allowServiceWorkers: false,\n//     bypassCSP: false,\n//     corsEnabled: false,\n//     secure: true,\n//     supportFetchAPI: false,\n// });\n\nconst win = (global as any).window as IElectronWebviewTagWindow;\nwin.READIUM2 = {\n    DEBUG_VISUALS: false,\n    fxlViewportHeight: 0,\n    fxlViewportWidth: 0,\n    hashElement: null,\n    isFixedLayout: false,\n    locationHashOverride: undefined,\n    locationHashOverrideInfo: {\n        cfi: undefined,\n        cssSelector: undefined,\n        paginationInfo: undefined,\n        position: undefined,\n        progression: undefined,\n    },\n    readyEventSent: false,\n    readyPassDone: false,\n    urlQueryParams: undefined,\n};\n\nwin.READIUM2.urlQueryParams = win.location.search ? getURLQueryParams(win.location.search) : undefined;\n\nif (win.READIUM2.urlQueryParams) {\n    let readiumEpubReadingSystemJson: INameVersion | undefined;\n\n    // tslint:disable-next-line:no-string-literal\n    const base64EpubReadingSystem = win.READIUM2.urlQueryParams[URL_PARAM_EPUBREADINGSYSTEM];\n    if (base64EpubReadingSystem) {\n        try {\n            const str = new Buffer(base64EpubReadingSystem, \"base64\").toString(\"utf8\");\n            readiumEpubReadingSystemJson = JSON.parse(str);\n        } catch (err) {\n            debug(err);\n        }\n    }\n\n    if (readiumEpubReadingSystemJson) {\n        setWindowNavigatorEpubReadingSystem(win, readiumEpubReadingSystemJson);\n    }\n\n    win.READIUM2.DEBUG_VISUALS = win.READIUM2.urlQueryParams[URL_PARAM_DEBUG_VISUALS] === \"true\";\n}\n\nif (IS_DEV) {\n    ipcRenderer.on(R2_EVENT_DEBUG_VISUALS, (_event: any, payload: string) => {\n        win.READIUM2.DEBUG_VISUALS = payload === \"true\";\n\n        if (!win.READIUM2.DEBUG_VISUALS) {\n            const existings = document.querySelectorAll(\n                // tslint:disable-next-line:max-line-length\n                `*[${readPosCssStylesAttr1}], *[${readPosCssStylesAttr2}], *[${readPosCssStylesAttr3}], *[${readPosCssStylesAttr4}]`);\n            existings.forEach((existing) => {\n                existing.removeAttribute(`${readPosCssStylesAttr1}`);\n                existing.removeAttribute(`${readPosCssStylesAttr2}`);\n                existing.removeAttribute(`${readPosCssStylesAttr3}`);\n                existing.removeAttribute(`${readPosCssStylesAttr4}`);\n            });\n        }\n    });\n}\n\nipcRenderer.on(R2_EVENT_SCROLLTO, (_event: any, payload: IEventPayload_R2_EVENT_SCROLLTO) => {\n\n    if (!win.READIUM2.urlQueryParams) {\n        win.READIUM2.urlQueryParams = {};\n    }\n    if (payload.previous) {\n        // tslint:disable-next-line:no-string-literal\n        win.READIUM2.urlQueryParams[URL_PARAM_PREVIOUS] = \"true\";\n    } else {\n        // tslint:disable-next-line:no-string-literal\n        if (typeof win.READIUM2.urlQueryParams[URL_PARAM_PREVIOUS] !== \"undefined\") {\n            // tslint:disable-next-line:no-string-literal\n            delete win.READIUM2.urlQueryParams[URL_PARAM_PREVIOUS];\n        }\n    }\n    if (payload.goto) {\n        // tslint:disable-next-line:no-string-literal\n        win.READIUM2.urlQueryParams[URL_PARAM_GOTO] = payload.goto; // decodeURIComponent\n    } else {\n        // tslint:disable-next-line:no-string-literal\n        if (typeof win.READIUM2.urlQueryParams[URL_PARAM_GOTO] !== \"undefined\") {\n            // tslint:disable-next-line:no-string-literal\n            delete win.READIUM2.urlQueryParams[URL_PARAM_GOTO];\n        }\n    }\n\n    let delayScrollIntoView = false;\n    if (payload.hash) {\n        win.READIUM2.hashElement = win.document.getElementById(payload.hash);\n        if (win.READIUM2.DEBUG_VISUALS) {\n            if (win.READIUM2.hashElement) {\n                // const existings = document.querySelectorAll(`*[${readPosCssStylesAttr1}]`);\n                // existings.forEach((existing) => {\n                //     existing.removeAttribute(`${readPosCssStylesAttr1}`);\n                // });\n                win.READIUM2.hashElement.setAttribute(readPosCssStylesAttr1, \"R2_EVENT_SCROLLTO hashElement\");\n            }\n        }\n\n        win.location.href = \"#\" + payload.hash;\n        delayScrollIntoView = true;\n\n        // unfortunately, does not sync CSS :target pseudo-class :(\n        // win.history.replaceState({}, undefined, \"#\" + payload.hash);\n    } else {\n        win.READIUM2.hashElement = null;\n    }\n\n    win.READIUM2.readyEventSent = false;\n    win.READIUM2.locationHashOverride = undefined;\n    win.READIUM2.locationHashOverrideInfo = {\n        cfi: undefined,\n        cssSelector: undefined,\n        paginationInfo: undefined,\n        position: undefined,\n        progression: undefined,\n    };\n\n    if (delayScrollIntoView) {\n        setTimeout(() => {\n            scrollToHashRaw();\n        }, 100);\n    } else {\n        scrollToHashRaw();\n    }\n\n    // const payload: IEventPayload_R2_EVENT_WEBVIEW_READY = {\n    //     href: win.location.href,\n    // };\n    // ipcRenderer.sendToHost(R2_EVENT_WEBVIEW_READY, payload);\n    // notifyReadingLocationDebounced();\n});\n\nlet _lastAnimState: IPropertyAnimationState | undefined;\n\nipcRenderer.on(R2_EVENT_PAGE_TURN, (_event: any, payload: IEventPayload_R2_EVENT_PAGE_TURN) => {\n    if (win.READIUM2.isFixedLayout || !win.document.body) {\n        ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n        return;\n    }\n\n    if (!win.document || !win.document.documentElement) {\n        return;\n    }\n\n    const isPaged = isPaginated(win.document);\n\n    const maxScrollShift = calculateMaxScrollShift();\n\n    const goPREVIOUS = payload.go === \"PREVIOUS\"; // any other value is NEXT\n\n    if (!goPREVIOUS) { // goPREVIOUS && isRTL() || !goPREVIOUS && !isRTL()) { // right\n        if (isPaged) {\n            if (isVerticalWritingMode() && (Math.abs(win.document.body.scrollTop) < maxScrollShift) ||\n                !isVerticalWritingMode() && (Math.abs(win.document.body.scrollLeft) < maxScrollShift)) { // not at end\n                if (_lastAnimState && _lastAnimState.animating) {\n                    win.cancelAnimationFrame(_lastAnimState.id);\n                    _lastAnimState.object[_lastAnimState.property] = _lastAnimState.destVal;\n                }\n                const newVal = isVerticalWritingMode() ?\n                    (win.document.body.scrollTop + win.document.documentElement.offsetHeight) :\n                        (win.document.body.scrollLeft + (isRTL() ? -1 : 1) * win.document.documentElement.offsetWidth);\n\n                _lastAnimState = animateProperty(\n                    win.cancelAnimationFrame,\n                    undefined,\n                    // (cancelled: boolean) => {\n                    //     debug(cancelled);\n                    // },\n                    isVerticalWritingMode() ? \"scrollTop\" : \"scrollLeft\",\n                    300,\n                    win.document.body,\n                    newVal,\n                    win.requestAnimationFrame,\n                    easings.easeInOutQuad,\n                );\n                return;\n            }\n        } else {\n            if (isVerticalWritingMode() && (Math.abs(win.document.body.scrollLeft) < maxScrollShift) ||\n                !isVerticalWritingMode() && (Math.abs(win.document.body.scrollTop) < maxScrollShift)) {\n                if (_lastAnimState && _lastAnimState.animating) {\n                    win.cancelAnimationFrame(_lastAnimState.id);\n                    _lastAnimState.object[_lastAnimState.property] = _lastAnimState.destVal;\n                }\n                const newVal = isVerticalWritingMode() ?\n                    (win.document.body.scrollLeft + (isRTL() ? -1 : 1) * win.document.documentElement.clientWidth) :\n                    (win.document.body.scrollTop + win.document.documentElement.clientHeight);\n\n                _lastAnimState = animateProperty(\n                    win.cancelAnimationFrame,\n                    undefined,\n                    // (cancelled: boolean) => {\n                    //     debug(cancelled);\n                    // },\n                    isVerticalWritingMode() ? \"scrollLeft\" : \"scrollTop\",\n                    300,\n                    win.document.body,\n                    newVal,\n                    win.requestAnimationFrame,\n                    easings.easeInOutQuad,\n                );\n                return;\n            }\n        }\n    } else if (goPREVIOUS) { //  && !isRTL() || !goPREVIOUS && isRTL()) { // left\n        if (isPaged) {\n            if (isVerticalWritingMode() && (Math.abs(win.document.body.scrollTop) > 0) ||\n                !isVerticalWritingMode() && (Math.abs(win.document.body.scrollLeft) > 0)) { // not at begin\n                if (_lastAnimState && _lastAnimState.animating) {\n                    win.cancelAnimationFrame(_lastAnimState.id);\n                    _lastAnimState.object[_lastAnimState.property] = _lastAnimState.destVal;\n                }\n                const newVal = isVerticalWritingMode() ?\n                    (win.document.body.scrollTop - win.document.documentElement.offsetHeight) :\n                    (win.document.body.scrollLeft - (isRTL() ? -1 : 1) * win.document.documentElement.offsetWidth);\n\n                _lastAnimState = animateProperty(\n                    win.cancelAnimationFrame,\n                    undefined,\n                    // (cancelled: boolean) => {\n                    //     debug(cancelled);\n                    // },\n                    isVerticalWritingMode() ? \"scrollTop\" : \"scrollLeft\",\n                    300,\n                    win.document.body,\n                    newVal,\n                    win.requestAnimationFrame,\n                    easings.easeInOutQuad,\n                );\n                return;\n            }\n        } else {\n            if (isVerticalWritingMode() && (Math.abs(win.document.body.scrollLeft) > 0) ||\n                !isVerticalWritingMode() && (Math.abs(win.document.body.scrollTop) > 0)) {\n                if (_lastAnimState && _lastAnimState.animating) {\n                    win.cancelAnimationFrame(_lastAnimState.id);\n                    _lastAnimState.object[_lastAnimState.property] = _lastAnimState.destVal;\n                }\n                const newVal = isVerticalWritingMode() ?\n                    (win.document.body.scrollLeft - (isRTL() ? -1 : 1) * win.document.documentElement.clientWidth) :\n                    (win.document.body.scrollTop - win.document.documentElement.clientHeight);\n\n                _lastAnimState = animateProperty(\n                    win.cancelAnimationFrame,\n                    undefined,\n                    // (cancelled: boolean) => {\n                    //     debug(cancelled);\n                    // },\n                    isVerticalWritingMode() ? \"scrollLeft\" : \"scrollTop\",\n                    300,\n                    win.document.body,\n                    newVal,\n                    win.requestAnimationFrame,\n                    easings.easeInOutQuad,\n                );\n                return;\n            }\n        }\n    }\n\n    ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n});\n\n// window load event, after DOMContentLoaded\nconst checkReadyPass = () => {\n    if (win.READIUM2.readyPassDone) {\n        return;\n    }\n    win.READIUM2.readyPassDone = true;\n\n    // assumes debounced from outside (Electron's webview object embedded in original renderer process HTML)\n    win.addEventListener(\"resize\", () => {\n        const wh = configureFixedLayout(win.document, win.READIUM2.isFixedLayout,\n            win.READIUM2.fxlViewportWidth, win.READIUM2.fxlViewportHeight,\n            win.innerWidth, win.innerHeight);\n        if (wh) {\n            win.READIUM2.fxlViewportWidth = wh.width;\n            win.READIUM2.fxlViewportHeight = wh.height;\n        }\n\n        scrollToHashRaw();\n        // scrollToHash(); // debounced\n    });\n\n    // const docElement = win.document.documentElement;\n    // let skipFirstResize = docElement.getAttribute(\"data-readiumcss\") || false;\n    // let skipFirstScroll = skipFirstResize;\n\n    setTimeout(() => {\n        // if (!win.READIUM2.isFixedLayout) {\n        //     scrollToHashRaw();\n        // }\n\n        win.addEventListener(\"scroll\", (_ev: Event) => {\n\n            if (_ignoreScrollEvent) {\n                _ignoreScrollEvent = false;\n                return;\n            }\n            // if (skipFirstScroll) {\n            //     skipFirstScroll = false;\n            //     return;\n            // }\n\n            if (!win.document || !win.document.documentElement) {\n                return;\n            }\n\n            const x = (isRTL() ? win.document.documentElement.offsetWidth - 1 : 0);\n            processXYDebounced(x, 0);\n        });\n\n    }, 800);\n\n    const useResizeSensor = !win.READIUM2.isFixedLayout;\n    if (useResizeSensor && win.document.body) {\n\n        setTimeout(() => {\n            window.requestAnimationFrame((_timestamp) => {\n                // tslint:disable-next-line:no-unused-expression\n                new ResizeSensor(win.document.body, () => {\n\n                    debug(\"ResizeSensor\");\n                    scrollToHashDebounced();\n                });\n            });\n        }, 2000);\n    }\n\n    if (win.document.body) {\n        win.document.body.addEventListener(\"click\", (ev: MouseEvent) => {\n\n            // relative to fixed window top-left corner\n            // (unlike pageX/Y which is relative to top-left rendered content area, subject to scrolling)\n            const x = ev.clientX;\n            const y = ev.clientY;\n\n            processXYDebounced(x, y);\n        });\n    }\n};\n\nconst notifyReady = () => {\n    if (win.READIUM2.readyEventSent) {\n        return;\n    }\n    win.READIUM2.readyEventSent = true;\n\n    const payload: IEventPayload_R2_EVENT_WEBVIEW_READY = {\n        href: win.location.href,\n    };\n    ipcRenderer.sendToHost(R2_EVENT_WEBVIEW_READY, payload);\n};\n\nfunction scrollElementIntoView(element: Element) {\n\n    if (win.READIUM2.DEBUG_VISUALS) {\n        const existings = document.querySelectorAll(`*[${readPosCssStylesAttr3}]`);\n        existings.forEach((existing) => {\n            existing.removeAttribute(`${readPosCssStylesAttr3}`);\n        });\n        element.setAttribute(readPosCssStylesAttr3, \"scrollElementIntoView\");\n    }\n\n    const isPaged = isPaginated(win.document);\n    if (isPaged) {\n        scrollIntoView(element as HTMLElement);\n    } else {\n        element.scrollIntoView({\n            // TypeScript lib.dom.d.ts difference in 3.2.1\n            // ScrollBehavior = \"auto\" | \"instant\" | \"smooth\" VS ScrollBehavior = \"auto\" | \"smooth\"\n            behavior: \"auto\",\n            // ScrollLogicalPosition = \"start\" | \"center\" | \"end\" | \"nearest\"\n            block: \"start\",\n            // ScrollLogicalPosition = \"start\" | \"center\" | \"end\" | \"nearest\"\n            inline: \"start\",\n        } as ScrollIntoViewOptions);\n    }\n}\n\n// TODO: vertical writing mode\nfunction scrollIntoView(element: HTMLElement) {\n\n    if (!win.document || !win.document.documentElement || !win.document.body || !isPaginated(win.document)) {\n        return;\n    }\n\n    const rect = element.getBoundingClientRect();\n\n    const columnDimension = calculateColumnDimension();\n\n    const isTwoPage = isTwoPageSpread();\n\n    const fullOffset = (isRTL() ? ((columnDimension * (isTwoPage ? 2 : 1)) - rect.left) : rect.left) +\n        ((isRTL() ? -1 : 1) * win.document.body.scrollLeft);\n\n    const columnIndex = Math.floor(fullOffset / columnDimension); // 0-based index\n\n    const spreadIndex = isTwoPage ? Math.floor(columnIndex / 2) : columnIndex; // 0-based index\n\n    win.document.body.scrollLeft = (isRTL() ? -1 : 1) *\n        (spreadIndex * (columnDimension * (isTwoPage ? 2 : 1)));\n}\n\n// let scrollToHashRawFirstCall = true;\nconst scrollToHashRaw = () => {\n    // let first = false;\n    // if (scrollToHashRawFirstCall) {\n    //     scrollToHashRawFirstCall = false;\n    //     first = true;\n    // }\n\n    if (!win.document || !win.document.documentElement) {\n        return;\n    }\n\n    const isPaged = isPaginated(win.document);\n\n    if (win.READIUM2.locationHashOverride) {\n        if (win.READIUM2.locationHashOverride === win.document.body) {\n            return;\n        }\n\n        notifyReady();\n\n        _ignoreScrollEvent = true;\n        scrollElementIntoView(win.READIUM2.locationHashOverride);\n\n        notifyReadingLocationDebounced();\n        return;\n    } else if (win.READIUM2.hashElement) {\n        win.READIUM2.locationHashOverride = win.READIUM2.hashElement;\n\n        notifyReady();\n\n        // if (!first) {\n        _ignoreScrollEvent = true;\n        scrollElementIntoView(win.READIUM2.hashElement);\n        // }\n\n        // win.READIUM2.hashElement.classList.add(\"readium2-hash\");\n        // setTimeout(() => {\n        //     if (win.READIUM2.hashElement) {\n        //         win.READIUM2.hashElement.classList.remove(\"readium2-hash\");\n        //     }\n        // }, 1000);\n\n        notifyReadingLocationDebounced();\n        return;\n    } else {\n        if (win.document.body) {\n\n            if (win.READIUM2.urlQueryParams) {\n                // tslint:disable-next-line:no-string-literal\n                const previous = win.READIUM2.urlQueryParams[URL_PARAM_PREVIOUS];\n                const isPreviousNavDirection = previous === \"true\";\n                if (isPreviousNavDirection) {\n                    const maxScrollShift = calculateMaxScrollShift();\n\n                    _ignoreScrollEvent = true;\n                    if (isPaged) {\n                        if (isVerticalWritingMode()) {\n                            win.document.body.scrollLeft = 0;\n                            win.document.body.scrollTop = maxScrollShift;\n                        } else {\n                            win.document.body.scrollLeft = (isRTL() ? -1 : 1) * maxScrollShift;\n                            win.document.body.scrollTop = 0;\n                        }\n                    } else {\n                        if (isVerticalWritingMode()) {\n                            win.document.body.scrollLeft = (isRTL() ? -1 : 1) * maxScrollShift;\n                            win.document.body.scrollTop = 0;\n                        } else {\n                            win.document.body.scrollLeft = 0;\n                            win.document.body.scrollTop = maxScrollShift;\n                        }\n                    }\n\n                    win.READIUM2.locationHashOverride = undefined;\n                    win.READIUM2.locationHashOverrideInfo = {\n                        cfi: undefined,\n                        cssSelector: undefined,\n                        paginationInfo: undefined,\n                        position: undefined,\n                        progression: undefined,\n                    };\n\n                    // relative to fixed window top-left corner\n                    const y = (isPaged ?\n                        (isVerticalWritingMode() ?\n                            win.document.documentElement.offsetWidth :\n                            win.document.documentElement.offsetHeight) :\n                        (isVerticalWritingMode() ?\n                            win.document.documentElement.clientWidth :\n                            win.document.documentElement.clientHeight))\n                    - 1;\n                    processXYRaw(0, y);\n\n                    notifyReady();\n                    if (!win.READIUM2.locationHashOverride) { // already in processXYRaw()\n                        notifyReadingLocationDebounced();\n                    }\n                    return;\n                }\n\n                // tslint:disable-next-line:no-string-literal\n                const gto = win.READIUM2.urlQueryParams[URL_PARAM_GOTO];\n                let gotoCssSelector: string | undefined;\n                if (gto) {\n                    // decodeURIComponent\n                    const s = new Buffer(gto, \"base64\").toString(\"utf8\");\n                    const js = JSON.parse(s);\n                    gotoCssSelector = (js as LocatorLocations).cssSelector;\n                    // TODO: CFI, etc.?\n                }\n                if (gotoCssSelector) {\n                    gotoCssSelector = gotoCssSelector.replace(/\\+/g, \" \");\n                    let selected: Element | null = null;\n                    try {\n                        selected = document.querySelector(gotoCssSelector);\n                    } catch (err) {\n                        debug(err);\n                    }\n                    if (selected) {\n\n                        win.READIUM2.locationHashOverride = selected;\n                        win.READIUM2.locationHashOverrideInfo = {\n                            cfi: undefined,\n                            cssSelector: gotoCssSelector,\n                            paginationInfo: undefined,\n                            position: undefined,\n                            progression: undefined,\n                        };\n\n                        notifyReady();\n\n                        _ignoreScrollEvent = true;\n                        scrollElementIntoView(selected);\n\n                        notifyReadingLocationDebounced();\n                        return;\n                    }\n                }\n            }\n\n            win.READIUM2.locationHashOverride = win.document.body;\n            win.READIUM2.locationHashOverrideInfo = {\n                cfi: undefined,\n                cssSelector: undefined,\n                paginationInfo: undefined,\n                position: undefined,\n                progression: undefined,\n            };\n\n            _ignoreScrollEvent = true;\n            win.document.body.scrollLeft = 0;\n            win.document.body.scrollTop = 0;\n        }\n    }\n\n    notifyReady();\n    notifyReadingLocationDebounced();\n};\n\nconst scrollToHashDebounced = debounce(() => {\n    scrollToHashRaw();\n}, 500);\n\nlet _ignoreScrollEvent = false;\n\n// function testReadiumCSS(readiumcssJson: IEventPayload_R2_EVENT_READIUMCSS | undefined) {\n//     const oldHTML = win.document.documentElement.outerHTML;\n//     const iBody = oldHTML.indexOf(\"<body\");\n//     debug(oldHTML.substr(0, iBody + 100));\n\n//     let newHTML: string | undefined;\n//     try {\n//         newHTML = transformHTML(oldHTML, readiumcssJson, \"application/xhtml+xml\");\n//     } catch (err) {\n//         debug(err);\n//         return;\n//     }\n\n//     const iBody_ = newHTML.indexOf(\"<body\");\n//     debug(newHTML.substr(0, iBody_ + 100));\n// }\n\nwin.addEventListener(\"DOMContentLoaded\", () => {\n\n    // const linkUri = new URI(win.location.href);\n\n    if (win.location.hash && win.location.hash.length > 1) {\n        win.READIUM2.hashElement = win.document.getElementById(win.location.hash.substr(1));\n        if (win.READIUM2.DEBUG_VISUALS) {\n            if (win.READIUM2.hashElement) {\n                // const existings = document.querySelectorAll(`*[${readPosCssStylesAttr1}]`);\n                // existings.forEach((existing) => {\n                //     existing.removeAttribute(`${readPosCssStylesAttr1}`);\n                // });\n                win.READIUM2.hashElement.setAttribute(readPosCssStylesAttr1, \"DOMContentLoaded hashElement\");\n            }\n        }\n    }\n\n    win.READIUM2.locationHashOverride = undefined;\n    win.READIUM2.readyPassDone = false;\n    win.READIUM2.readyEventSent = false;\n\n    let readiumcssJson: IEventPayload_R2_EVENT_READIUMCSS | undefined;\n    if (win.READIUM2.urlQueryParams) {\n        // tslint:disable-next-line:no-string-literal\n        const base64ReadiumCSS = win.READIUM2.urlQueryParams[URL_PARAM_CSS];\n        if (base64ReadiumCSS) {\n            let str: string | undefined;\n            try {\n                str = new Buffer(base64ReadiumCSS, \"base64\").toString(\"utf8\");\n                readiumcssJson = JSON.parse(str);\n            } catch (err) {\n                debug(\"################## READIUM CSS PARSE ERROR?!\");\n                debug(base64ReadiumCSS);\n                debug(err);\n                debug(str);\n            }\n        }\n    }\n\n    if (readiumcssJson) {\n        win.READIUM2.isFixedLayout = (typeof readiumcssJson.isFixedLayout !== \"undefined\") ?\n            readiumcssJson.isFixedLayout : false;\n    }\n\n    // testReadiumCSS(readiumcssJson);\n\n    const wh = configureFixedLayout(win.document, win.READIUM2.isFixedLayout,\n        win.READIUM2.fxlViewportWidth, win.READIUM2.fxlViewportHeight,\n        win.innerWidth, win.innerHeight);\n    if (wh) {\n        win.READIUM2.fxlViewportWidth = wh.width;\n        win.READIUM2.fxlViewportHeight = wh.height;\n    }\n    if (win.READIUM2.isFixedLayout) {\n        notifyReady();\n    }\n\n    const alreadedInjected = win.document.documentElement.hasAttribute(\"data-readiumcss\");\n    if (alreadedInjected) {\n        debug(\">>>>>1 ReadiumCSS already injected by streamer\");\n        console.log(\">>>>>2 ReadiumCSS already injected by streamer\");\n    }\n\n    if (!alreadedInjected) {\n        injectDefaultCSS(win.document);\n        if (IS_DEV) { // win.READIUM2.DEBUG_VISUALS\n            injectReadPosCSS(win.document);\n        }\n    }\n\n    // // DEBUG\n    // win.document.body.addEventListener(\"focus\", (ev: any) => {\n    //     debug(\"focus:\");\n    //     debug(ev.target);\n    // }, true);\n    // win.document.body.addEventListener(\"focusin\", (ev: any) => {\n    //     debug(\"focusin:\");\n    //     debug(ev.target);\n    // });\n    // // DEBUG\n\n    win.document.body.addEventListener(\"focusin\", (ev: any) => {\n\n        if (!win.document || !win.document.documentElement) {\n            return;\n        }\n\n        const isPaged = isPaginated(win.document);\n        if (isPaged) {\n            setTimeout(() => {\n                win.READIUM2.locationHashOverride = ev.target;\n                if (win.READIUM2.locationHashOverride) {\n                    scrollElementIntoView(win.READIUM2.locationHashOverride);\n                }\n            }, 30);\n        }\n    });\n\n    win.document.addEventListener(\"click\", (e) => {\n        const href = (e.target as any).href;\n        if (!href) {\n            return;\n        }\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        const payload: IEventPayload_R2_EVENT_LINK = {\n            url: href,\n        };\n        ipcRenderer.sendToHost(R2_EVENT_LINK, payload);\n        return false;\n    }, true);\n\n    // injectResizeSensor();\n\n    computeVerticalRTL();\n    if (readiumcssJson) {\n        // ReadiumCSS already injected at the streamer level?\n        if (isVerticalWritingMode() || // force update, because needs getComputedStyle()\n            !alreadedInjected) {\n\n            debug(\">>>>>> ReadiumCSS inject again\");\n            readiumCSS(win.document, readiumcssJson);\n        }\n    }\n});\n\n// after DOMContentLoaded\nwin.addEventListener(\"load\", () => {\n    // computeVerticalRTL();\n\n    if (!win.READIUM2.isFixedLayout) {\n        scrollToHashRaw();\n    }\n    checkReadyPass();\n});\n\n// // does not occur when re-using same webview (src=\"href\")\n// win.addEventListener(\"unload\", () => {\n// });\n\n// relative to fixed window top-left corner\nconst processXYRaw = (x: number, y: number) => {\n\n    // const elems = document.elementsFromPoint(x, y);\n\n    // let element: Element | undefined = elems && elems.length ? elems[0] : undefined;\n    let element: Element | undefined;\n\n    // if ((document as any).caretPositionFromPoint) {\n    //     const range = (document as any).caretPositionFromPoint(x, y);\n    //     const node = range.offsetNode;\n    //     const offset = range.offset;\n    // } else if (document.caretRangeFromPoint) {\n    // }\n\n    // let textNode: Node | undefined;\n    // let textNodeOffset = 0;\n\n    const range = document.caretRangeFromPoint(x, y);\n    if (range) {\n        const node = range.startContainer;\n        // const offset = range.startOffset;\n\n        if (node) {\n            if (node.nodeType === Node.ELEMENT_NODE) {\n                element = node as Element;\n            } else if (node.nodeType === Node.TEXT_NODE) {\n                // textNode = node;\n                // textNodeOffset = offset;\n                if (node.parentNode && node.parentNode.nodeType === Node.ELEMENT_NODE) {\n                    element = node.parentNode as Element;\n                }\n            }\n        }\n    }\n\n    if (element) {\n        win.READIUM2.locationHashOverride = element;\n        notifyReadingLocationDebounced();\n\n        if (win.READIUM2.DEBUG_VISUALS) {\n            const existings = document.querySelectorAll(`*[${readPosCssStylesAttr2}]`);\n            existings.forEach((existing) => {\n                existing.removeAttribute(`${readPosCssStylesAttr2}`);\n            });\n            element.setAttribute(readPosCssStylesAttr2, \"processXYRaw\");\n        }\n    }\n};\nconst processXYDebounced = debounce((x: number, y: number) => {\n    processXYRaw(x, y);\n}, 300);\n\ninterface IProgressionData {\n    percentRatio: number;\n    paginationInfo: IEventPayload_R2_EVENT_READING_LOCATION_PAGINATION_INFO | undefined;\n}\nexport const computeProgressionData = (): IProgressionData => {\n\n    const isPaged = isPaginated(win.document);\n\n    const isTwoPage = isTwoPageSpread();\n\n    const maxScrollShift = calculateMaxScrollShift();\n\n    const totalColumns = calculateTotalColumns();\n\n    let progressionRatio = 0;\n\n    // zero-based index: 0 <= currentColumn < totalColumns\n    let currentColumn = 0;\n    let spreadIndex = 0;\n\n    if (isPaged) {\n        if (maxScrollShift <= 0) {\n            progressionRatio = 0;\n        } else {\n            if (isVerticalWritingMode()) {\n                progressionRatio = win.document.body.scrollTop / maxScrollShift;\n            } else {\n                progressionRatio = ((isRTL() ? -1 : 1) * win.document.body.scrollLeft) / maxScrollShift;\n            }\n        }\n\n        // because maxScrollShift excludes whole viewport width of content (0%-100% scroll but minus last page/spread)\n        const adjustedTotalColumns = (totalColumns - (isTwoPage ? 2 : 1));\n\n        currentColumn = adjustedTotalColumns * progressionRatio;\n\n        currentColumn = Math.round(currentColumn);\n    } else {\n        if (maxScrollShift <= 0) {\n            progressionRatio = 0;\n        } else {\n            if (isVerticalWritingMode()) {\n                progressionRatio = ((isRTL() ? -1 : 1) * win.document.body.scrollLeft) / maxScrollShift;\n            } else {\n                progressionRatio = win.document.body.scrollTop / maxScrollShift;\n            }\n        }\n    }\n\n    if (win.READIUM2.locationHashOverride) {\n        const element = win.READIUM2.locationHashOverride as HTMLElement;\n\n        // imprecise\n        // const offsetTop = computeOffsetTop(element);\n\n        const rect = element.getBoundingClientRect();\n        let offset = 0;\n\n        if (isPaged) {\n            const columnDimension = calculateColumnDimension();\n\n            if (isVerticalWritingMode()) {\n                offset = (currentColumn * win.document.body.scrollWidth) + rect.left +\n                    (rect.top >= columnDimension ? win.document.body.scrollWidth : 0);\n            } else {\n                offset = (currentColumn * win.document.body.scrollHeight) + rect.top +\n                        (((isRTL() ?\n                            (win.document.documentElement.clientWidth - (rect.left + rect.width)) :\n                            rect.left) >= columnDimension) ? win.document.body.scrollHeight : 0);\n            }\n\n            // includes whitespace beyond bottom/end of document, to fill the unnocupied remainder of the column\n            progressionRatio = offset /\n                ((isVerticalWritingMode() ? win.document.body.scrollWidth : win.document.body.scrollHeight) *\n                    totalColumns);\n\n            currentColumn = totalColumns * progressionRatio;\n\n            currentColumn = Math.floor(currentColumn);\n        } else {\n            if (isVerticalWritingMode()) {\n                offset = ((isRTL() ? -1 : 1) * win.document.body.scrollLeft) + rect.left + (isRTL() ? rect.width : 0);\n            } else {\n                offset = win.document.body.scrollTop + rect.top;\n            }\n\n            progressionRatio = offset /\n                (isVerticalWritingMode() ? win.document.body.scrollWidth : win.document.body.scrollHeight);\n        }\n    }\n\n    if (isPaged) {\n        spreadIndex = isTwoPage ? Math.floor(currentColumn / 2) : currentColumn;\n    }\n\n    return {\n        paginationInfo: isPaged ? {\n            currentColumn,\n            isTwoPageSpread: isTwoPage,\n            spreadIndex,\n            totalColumns,\n        } : undefined,\n        percentRatio: progressionRatio,\n    };\n};\n\nexport const computeCFI = (node: Node): string | undefined => {\n\n    // TODO: handle character position inside text node\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        return undefined;\n    }\n\n    let cfi = \"\";\n\n    let currentElement = node as Element;\n    while (currentElement.parentNode && currentElement.parentNode.nodeType === Node.ELEMENT_NODE) {\n        const currentElementChildren = (currentElement.parentNode as Element).children;\n        let currentElementIndex = -1;\n        for (let i = 0; i < currentElementChildren.length; i++) {\n            if (currentElement === currentElementChildren[i]) {\n                currentElementIndex = i;\n                break;\n            }\n        }\n        if (currentElementIndex >= 0) {\n            const cfiIndex = (currentElementIndex + 1) * 2;\n            cfi = cfiIndex +\n                (currentElement.id ? (\"[\" + currentElement.id + \"]\") : \"\") +\n                (cfi.length ? (\"/\" + cfi) : \"\");\n        }\n        currentElement = currentElement.parentNode as Element;\n    }\n\n    return \"/\" + cfi;\n};\n\nconst notifyReadingLocationRaw = () => {\n    if (!win.READIUM2.locationHashOverride) {\n        return;\n    }\n\n    // win.READIUM2.locationHashOverride.nodeType === ELEMENT_NODE\n\n    let progressionData: IProgressionData | undefined;\n\n    const cssSelector = uniqueCssSelector(win.READIUM2.locationHashOverride, win.document);\n    const cfi = computeCFI(win.READIUM2.locationHashOverride);\n    let progression = 0;\n    if (win.READIUM2.isFixedLayout) {\n        progression = 1;\n    } else {\n        progressionData = computeProgressionData();\n        progression = progressionData.percentRatio;\n    }\n\n    const pinfo = (progressionData && progressionData.paginationInfo) ?\n        progressionData.paginationInfo : undefined;\n\n    win.READIUM2.locationHashOverrideInfo = {\n        cfi,\n        cssSelector,\n        paginationInfo: pinfo,\n        position: undefined, // calculated in host index.js renderer, where publication object is available\n        progression,\n    };\n    const payload: IEventPayload_R2_EVENT_READING_LOCATION = win.READIUM2.locationHashOverrideInfo;\n    ipcRenderer.sendToHost(R2_EVENT_READING_LOCATION, payload);\n\n    if (win.READIUM2.DEBUG_VISUALS) {\n        const existings = document.querySelectorAll(`*[${readPosCssStylesAttr4}]`);\n        existings.forEach((existing) => {\n            existing.removeAttribute(`${readPosCssStylesAttr4}`);\n        });\n        win.READIUM2.locationHashOverride.setAttribute(readPosCssStylesAttr4, \"notifyReadingLocationRaw\");\n    }\n\n    debug(\"|||||||||||||| notifyReadingLocation: \", JSON.stringify(payload));\n};\nconst notifyReadingLocationDebounced = debounce(() => {\n    notifyReadingLocationRaw();\n}, 500);\n"]}