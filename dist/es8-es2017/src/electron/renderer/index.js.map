{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/electron/renderer/index.ts"],"names":[],"mappings":"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","sourcesContent":["import SystemFonts = require(\"system-font-families\");\r\n\r\nimport debounce = require(\"debounce\");\r\nimport URI = require(\"urijs\");\r\n\r\nimport { encodeURIComponent_RFC3986 } from \"@r2-streamer-js/_utils/http/UrlUtils\";\r\nimport { initGlobals } from \"@r2-streamer-js/init-globals\";\r\nimport { IStringMap } from \"@r2-streamer-js/models/metadata-multilang\";\r\nimport { Publication } from \"@r2-streamer-js/models/publication\";\r\nimport { Link } from \"@r2-streamer-js/models/publication-link\";\r\nimport { shell } from \"electron\";\r\nimport { ipcRenderer } from \"electron\";\r\nimport { JSON as TAJSON } from \"ta-json\";\r\n\r\nimport {\r\n    R2_EVENT_LCP_LSD_RENEW,\r\n    R2_EVENT_LCP_LSD_RENEW_RES,\r\n    R2_EVENT_LCP_LSD_RETURN,\r\n    R2_EVENT_LCP_LSD_RETURN_RES,\r\n    R2_EVENT_LINK,\r\n    R2_EVENT_PAGE_TURN,\r\n    R2_EVENT_PAGE_TURN_RES,\r\n    R2_EVENT_READING_LOCATION,\r\n    R2_EVENT_READIUMCSS,\r\n    R2_EVENT_SCROLLTO,\r\n    R2_EVENT_TRY_LCP_PASS,\r\n    R2_EVENT_TRY_LCP_PASS_RES,\r\n    R2_EVENT_WEBVIEW_READY,\r\n} from \"../common/events\";\r\nimport { R2_SESSION_WEBVIEW } from \"../common/sessions\";\r\nimport { IStore } from \"../common/store\";\r\nimport { StoreElectron } from \"../common/store-electron\";\r\nimport { getURLQueryParams } from \"./common/querystring\";\r\nimport {\r\n    IRiotOptsLinkList,\r\n    IRiotOptsLinkListItem,\r\n    IRiotTagLinkList,\r\n    riotMountLinkList,\r\n} from \"./riots/linklist/index_\";\r\nimport {\r\n    IRiotOptsLinkListGroup,\r\n    IRiotOptsLinkListGroupItem,\r\n    IRiotTagLinkListGroup,\r\n    riotMountLinkListGroup,\r\n} from \"./riots/linklistgroup/index_\";\r\nimport {\r\n    IRiotOptsLinkTree,\r\n    IRiotOptsLinkTreeItem,\r\n    IRiotTagLinkTree,\r\n    riotMountLinkTree,\r\n} from \"./riots/linktree/index_\";\r\nimport {\r\n    IRiotOptsMenuSelect,\r\n    IRiotOptsMenuSelectItem,\r\n    IRiotTagMenuSelect,\r\n    riotMountMenuSelect,\r\n} from \"./riots/menuselect/index_\";\r\n\r\nconst electronStore: IStore = new StoreElectron(\"readium2-navigator\", {\r\n    basicLinkTitles: true,\r\n    styling: {\r\n        align: \"left\",\r\n        colCount: \"auto\",\r\n        dark: false,\r\n        font: \"DEFAULT\",\r\n        fontSize: \"100%\",\r\n        invert: false,\r\n        lineHeight: \"1.5\",\r\n        night: false,\r\n        paged: false,\r\n        readiumcss: false,\r\n        sepia: false,\r\n    },\r\n});\r\n\r\nconst electronStoreLCP: IStore = new StoreElectron(\"readium2-navigator-lcp\", {});\r\n\r\n// console.log(window.location);\r\n// console.log(document.baseURI);\r\n// console.log(document.URL);\r\n\r\ninitGlobals();\r\n\r\nconst queryParams = getURLQueryParams();\r\n\r\n// import * as path from \"path\";\r\n// import { setLcpNativePluginPath } from \"@r2-streamer-js/parser/epub/lcp\";\r\n// // tslint:disable-next-line:no-string-literal\r\n// const lcpPluginBase64 = queryParams[\"lcpPlugin\"];\r\n// if (lcpPluginBase64) {\r\n//     const lcpPlugin = window.atob(lcpPluginBase64);\r\n//     setLcpNativePluginPath(lcpPlugin);\r\n// } else {\r\n//     setLcpNativePluginPath(path.join(process.cwd(), \"LCP\", \"lcp.node\"));\r\n// }\r\n\r\n// tslint:disable-next-line:no-string-literal\r\nconst publicationJsonUrl = queryParams[\"pub\"];\r\n\r\nconst pathBase64 = publicationJsonUrl.replace(/.*\\/pub\\/(.*)\\/manifest.json/, \"$1\");\r\n\r\nconst pathDecoded = window.atob(pathBase64);\r\n\r\nconst pathFileName = pathDecoded.substr(\r\n    pathDecoded.replace(/\\\\/g, \"/\").lastIndexOf(\"/\") + 1,\r\n    pathDecoded.length - 1);\r\n\r\n// tslint:disable-next-line:no-string-literal\r\nconst lcpHint = queryParams[\"lcpHint\"];\r\n\r\nelectronStore.onChanged(\"styling.night\", (newValue: any, oldValue: any) => {\r\n    if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n        return;\r\n    }\r\n\r\n    const nightSwitch = document.getElementById(\"night_switch-input\") as HTMLInputElement;\r\n    nightSwitch.checked = newValue;\r\n\r\n    if (newValue) {\r\n        document.body.classList.add(\"mdc-theme--dark\");\r\n    } else {\r\n        document.body.classList.remove(\"mdc-theme--dark\");\r\n    }\r\n\r\n    readiumCssOnOff();\r\n});\r\n\r\nelectronStore.onChanged(\"styling.align\", (newValue: any, oldValue: any) => {\r\n    if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n        return;\r\n    }\r\n\r\n    const nightSwitch = document.getElementById(\"justify_switch-input\") as HTMLInputElement;\r\n    nightSwitch.checked = (newValue === \"justify\");\r\n\r\n    readiumCssOnOff();\r\n});\r\n\r\nelectronStore.onChanged(\"styling.paged\", (newValue: any, oldValue: any) => {\r\n    if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n        return;\r\n    }\r\n\r\n    const paginateSwitch = document.getElementById(\"paginate_switch-input\") as HTMLInputElement;\r\n    paginateSwitch.checked = newValue;\r\n\r\n    readiumCssOnOff();\r\n});\r\n\r\nconst computeReadiumCssJsonMessage = (): string => {\r\n\r\n    const on = electronStore.get(\"styling.readiumcss\");\r\n    if (on) {\r\n        const align = electronStore.get(\"styling.align\");\r\n        const colCount = electronStore.get(\"styling.colCount\");\r\n        const dark = electronStore.get(\"styling.dark\");\r\n        const font = electronStore.get(\"styling.font\");\r\n        const fontSize = electronStore.get(\"styling.fontSize\");\r\n        const lineHeight = electronStore.get(\"styling.lineHeight\");\r\n        const invert = electronStore.get(\"styling.invert\");\r\n        const night = electronStore.get(\"styling.night\");\r\n        const paged = electronStore.get(\"styling.paged\");\r\n        const sepia = electronStore.get(\"styling.sepia\");\r\n        const cssJson = {\r\n            align,\r\n            colCount,\r\n            dark,\r\n            font,\r\n            fontSize,\r\n            invert,\r\n            lineHeight,\r\n            night,\r\n            paged,\r\n            sepia,\r\n        };\r\n        const jsonMsg = { injectCSS: \"yes\", setCSS: cssJson };\r\n        return JSON.stringify(jsonMsg, null, 0);\r\n    } else {\r\n        const jsonMsg = { injectCSS: \"rollback\", setCSS: \"rollback\" };\r\n        return JSON.stringify(jsonMsg, null, 0);\r\n    }\r\n};\r\n\r\nconst readiumCssOnOff = debounce(() => {\r\n\r\n    const str = computeReadiumCssJsonMessage();\r\n    (_webview1 as any).send(R2_EVENT_READIUMCSS, str); // .getWebContents()\r\n    (_webview2 as any).send(R2_EVENT_READIUMCSS, str); // .getWebContents()\r\n}, 500);\r\n\r\n// super hacky, but necessary :(\r\n// https://github.com/material-components/material-components-web/issues/1017#issuecomment-340068426\r\nfunction ensureSliderLayout() {\r\n    setTimeout(() => {\r\n        const fontSizeSelector = document.getElementById(\"fontSizeSelector\") as HTMLElement;\r\n        (fontSizeSelector as any).mdcSlider.layout();\r\n\r\n        const lineHeightSelector = document.getElementById(\"lineHeightSelector\") as HTMLElement;\r\n        (lineHeightSelector as any).mdcSlider.layout();\r\n    }, 100);\r\n}\r\n\r\nelectronStore.onChanged(\"styling.readiumcss\", (newValue: any, oldValue: any) => {\r\n    if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n        return;\r\n    }\r\n    const stylingWrapper = document.getElementById(\"stylingWrapper\") as HTMLElement;\r\n    stylingWrapper.style.display = newValue ? \"block\" : \"none\";\r\n    if (newValue) {\r\n        ensureSliderLayout();\r\n    }\r\n\r\n    const readiumcssSwitch = document.getElementById(\"readiumcss_switch-input\") as HTMLInputElement;\r\n    readiumcssSwitch.checked = newValue;\r\n\r\n    readiumCssOnOff();\r\n\r\n    const justifySwitch = document.getElementById(\"justify_switch-input\") as HTMLInputElement;\r\n    justifySwitch.disabled = !newValue;\r\n\r\n    const paginateSwitch = document.getElementById(\"paginate_switch-input\") as HTMLInputElement;\r\n    paginateSwitch.disabled = !newValue;\r\n\r\n    const nightSwitch = document.getElementById(\"night_switch-input\") as HTMLInputElement;\r\n    nightSwitch.disabled = !newValue;\r\n    if (!newValue) {\r\n        electronStore.set(\"styling.night\", false);\r\n    }\r\n});\r\n\r\nelectronStore.onChanged(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\r\n    if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n        return;\r\n    }\r\n    const basicSwitch = document.getElementById(\"nav_basic_switch-input\") as HTMLInputElement;\r\n    basicSwitch.checked = !newValue;\r\n});\r\n\r\nlet snackBar: any;\r\nlet drawer: any;\r\n\r\nwindow.onerror = (err) => {\r\n    console.log(\"Error\", err);\r\n};\r\n\r\nconst unhideWebView = (forced: boolean) => {\r\n    if (_viewHideInterval) {\r\n        clearInterval(_viewHideInterval);\r\n        _viewHideInterval = undefined;\r\n    }\r\n    const hidePanel = document.getElementById(\"reader_chrome_HIDE\") as HTMLElement;\r\n    if (hidePanel.style.display === \"none\") {\r\n        return;\r\n    }\r\n    if (forced) {\r\n        console.log(\"unhideWebView FORCED\");\r\n    }\r\n    if (hidePanel) {\r\n        hidePanel.style.display = \"none\";\r\n    }\r\n};\r\n\r\nipcRenderer.on(R2_EVENT_LINK, (_event: any, href: string) => {\r\n    console.log(\"R2_EVENT_LINK\");\r\n    console.log(href);\r\n    handleLink(href, undefined, false);\r\n});\r\n\r\nipcRenderer.on(R2_EVENT_TRY_LCP_PASS_RES, (_event: any, okay: boolean, msg: string, passSha256Hex: string) => {\r\n\r\n    if (!okay) {\r\n        setTimeout(() => {\r\n            showLcpDialog(msg);\r\n        }, 500);\r\n\r\n        return;\r\n    }\r\n\r\n    const lcpStore = electronStoreLCP.get(\"lcp\");\r\n    if (!lcpStore) {\r\n        const lcpObj: any = {};\r\n        const pubLcpObj: any = lcpObj[pathDecoded] = {};\r\n        pubLcpObj.sha = passSha256Hex;\r\n\r\n        electronStoreLCP.set(\"lcp\", lcpObj);\r\n    } else {\r\n        const pubLcpStore = lcpStore[pathDecoded];\r\n        if (pubLcpStore) {\r\n            pubLcpStore.sha = passSha256Hex;\r\n        } else {\r\n            lcpStore[pathDecoded] = {\r\n                sha: passSha256Hex,\r\n            };\r\n        }\r\n        electronStoreLCP.set(\"lcp\", lcpStore);\r\n    }\r\n\r\n    startNavigatorExperiment();\r\n});\r\n\r\nlet lcpDialog: any;\r\n\r\nfunction showLcpDialog(message?: string) {\r\n\r\n    // dialog.lastFocusedTarget = evt.target;\r\n\r\n    const lcpPassHint = document.getElementById(\"lcpPassHint\") as HTMLElement;\r\n    lcpPassHint.textContent = lcpHint;\r\n\r\n    if (message) {\r\n        const lcpPassMessage = document.getElementById(\"lcpPassMessage\") as HTMLElement;\r\n        lcpPassMessage.textContent = message;\r\n    }\r\n\r\n    lcpDialog.show();\r\n    setTimeout(() => {\r\n        const lcpPassInput = document.getElementById(\"lcpPassInput\") as HTMLElement;\r\n        lcpPassInput.focus();\r\n        setTimeout(() => {\r\n            lcpPassInput.classList.add(\"no-focus-outline\");\r\n        }, 500);\r\n    }, 800);\r\n}\r\n\r\nfunction installKeyboardMouseFocusHandler() {\r\n    let dateLastKeyboardEvent = new Date();\r\n    let dateLastMouseEvent = new Date();\r\n\r\n    // // DEBUG\r\n    // document.body.addEventListener(\"focus\", (ev: any) => {\r\n    //     console.log(\"focus:\");\r\n    //     console.log(ev.target);\r\n    //     if (ev.target.tagName.toLowerCase() === \"webview\") {\r\n    //         console.log(\"preventing...\");\r\n    //         ev.preventDefault();\r\n    //         ev.stopPropagation();\r\n    //     }\r\n    // }, true);\r\n    // document.body.addEventListener(\"focusin\", (ev: any) => {\r\n    //     console.log(\"focusin:\");\r\n    //     console.log(ev.target);\r\n    //     if (ev.target.tagName.toLowerCase() === \"webview\") {\r\n    //         console.log(\"preventing...\");\r\n    //         ev.preventDefault();\r\n    //         ev.stopPropagation();\r\n    //     }\r\n    // });\r\n    // // DEBUG\r\n\r\n    document.body.addEventListener(\"focusin\", debounce((ev: any) => {\r\n        const focusWasTriggeredByMouse = dateLastMouseEvent > dateLastKeyboardEvent;\r\n        if (focusWasTriggeredByMouse) {\r\n            if (ev.target && ev.target.classList) {\r\n                ev.target.classList.add(\"no-focus-outline\");\r\n            }\r\n        }\r\n    }, 500));\r\n    document.body.addEventListener(\"focusout\", (ev: any) => {\r\n        if (ev.target && ev.target.classList) {\r\n            ev.target.classList.remove(\"no-focus-outline\");\r\n        }\r\n    });\r\n    document.body.addEventListener(\"mousedown\", () => {\r\n        dateLastMouseEvent = new Date();\r\n    });\r\n    document.body.addEventListener(\"keydown\", () => {\r\n        dateLastKeyboardEvent = new Date();\r\n    });\r\n}\r\n\r\nconst initLineHeightSelector = () => {\r\n\r\n    const lineHeightSelector = document.getElementById(\"lineHeightSelector\") as HTMLElement;\r\n    const slider = new (window as any).mdc.slider.MDCSlider(lineHeightSelector);\r\n    (lineHeightSelector as any).mdcSlider = slider;\r\n    // const step = lineHeightSelector.getAttribute(\"data-step\") as string;\r\n    // console.log(\"step: \" + step);\r\n    // slider.step = parseFloat(step);\r\n    // console.log(\"slider.step: \" + slider.step);\r\n\r\n    slider.disabled = !electronStore.get(\"styling.readiumcss\");\r\n    const val = electronStore.get(\"styling.lineHeight\");\r\n    if (val) {\r\n        slider.value = parseFloat(val) * 100;\r\n    } else {\r\n        slider.value = 1.5 * 100;\r\n    }\r\n\r\n    // console.log(slider.min);\r\n    // console.log(slider.max);\r\n    // console.log(slider.value);\r\n    // console.log(slider.step);\r\n\r\n    electronStore.onChanged(\"styling.readiumcss\", (newValue: any, oldValue: any) => {\r\n        if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n            return;\r\n        }\r\n        slider.disabled = !newValue;\r\n    });\r\n\r\n    // slider.listen(\"MDCSlider:input\", (event: any) => {\r\n    //     console.log(event.detail.value);\r\n    // });\r\n    slider.listen(\"MDCSlider:change\", (event: any) => {\r\n        electronStore.set(\"styling.lineHeight\",\r\n            \"\" + (event.detail.value / 100));\r\n    });\r\n\r\n    electronStore.onChanged(\"styling.lineHeight\", (newValue: any, oldValue: any) => {\r\n        if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        slider.value = parseFloat(newValue) * 100;\r\n\r\n        readiumCssOnOff();\r\n    });\r\n};\r\n\r\nconst initFontSizeSelector = () => {\r\n\r\n    const fontSizeSelector = document.getElementById(\"fontSizeSelector\") as HTMLElement;\r\n    const slider = new (window as any).mdc.slider.MDCSlider(fontSizeSelector);\r\n    (fontSizeSelector as any).mdcSlider = slider;\r\n\r\n    // const drawerElement = document.getElementById(\"drawer\") as HTMLElement;\r\n    // const funcClose = () => {\r\n    //     drawerElement.removeEventListener(\"MDCTemporaryDrawer:close\", funcClose);\r\n    //     console.log(\"MDCTemporaryDrawer:close\");\r\n\r\n    //     const funcOpen = () => {\r\n    //         drawerElement.removeEventListener(\"MDCTemporaryDrawer:open\", funcOpen);\r\n    //         console.log(\"MDCTemporaryDrawer:open\");\r\n\r\n    //         setTimeout(() => {\r\n    //             console.log(\"SLIDER LAYOUT\");\r\n    //             slider.layout();\r\n    //         }, 1000);\r\n    //     };\r\n    //     drawerElement.addEventListener(\"MDCTemporaryDrawer:open\", funcOpen);\r\n    // };\r\n    // drawerElement.addEventListener(\"MDCTemporaryDrawer:close\", funcClose);\r\n\r\n    slider.disabled = !electronStore.get(\"styling.readiumcss\");\r\n    const val = electronStore.get(\"styling.fontSize\");\r\n    if (val) {\r\n        slider.value = parseInt(val.replace(\"%\", \"\"), 10);\r\n    } else {\r\n        slider.value = 100;\r\n    }\r\n\r\n    // console.log(slider.min);\r\n    // console.log(slider.max);\r\n    // console.log(slider.value);\r\n    // console.log(slider.step);\r\n\r\n    electronStore.onChanged(\"styling.readiumcss\", (newValue: any, oldValue: any) => {\r\n        if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n            return;\r\n        }\r\n        slider.disabled = !newValue;\r\n    });\r\n\r\n    // slider.listen(\"MDCSlider:input\", (event: any) => {\r\n    //     console.log(event.detail.value);\r\n    // });\r\n    slider.listen(\"MDCSlider:change\", (event: any) => {\r\n        // console.log(event.detail.value);\r\n        electronStore.set(\"styling.fontSize\", event.detail.value + \"%\");\r\n    });\r\n\r\n    electronStore.onChanged(\"styling.fontSize\", (newValue: any, oldValue: any) => {\r\n        if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        slider.value = parseInt(newValue.replace(\"%\", \"\"), 10);\r\n\r\n        readiumCssOnOff();\r\n    });\r\n};\r\n\r\nconst initFontSelector = () => {\r\n\r\n    const ID_PREFIX = \"fontselect_\";\r\n\r\n    const options: IRiotOptsMenuSelectItem[] =\r\n        [{\r\n            id: ID_PREFIX + \"DEFAULT\",\r\n            label: \"Default font\",\r\n        }, {\r\n            id: ID_PREFIX + \"OLD\",\r\n            label: \"Old Style\",\r\n            style: \"font-family: \\\"Iowan Old Style\\\", \\\"Sitka Text\\\", Palatino, \\\"Book Antiqua\\\", serif;\",\r\n        }, {\r\n            id: ID_PREFIX + \"MODERN\",\r\n            label: \"Modern\",\r\n            style: \"font-family: Athelas, Constantia, Georgia, serif;\",\r\n        }, {\r\n            id: ID_PREFIX + \"SANS\",\r\n            label: \"Sans\",\r\n            style: \"font-family: -apple-system, system-ui, BlinkMacSystemFont,\" +\r\n            \" \\\"Segoe UI\\\", Roboto, \\\"Helvetica Neue\\\", Arial, sans-serif;\",\r\n        }, {\r\n            id: ID_PREFIX + \"HUMAN\",\r\n            label: \"Humanist\",\r\n            style: \"font-family: Seravek, Calibri, Roboto, Arial, sans-serif;\",\r\n        }, {\r\n            id: ID_PREFIX + \"DYS\",\r\n            label: \"Readable (dys)\",\r\n            style: \"font-family: AccessibleDfa;\",\r\n        }, {\r\n            id: ID_PREFIX + \"MONO\",\r\n            label: \"Monospace\",\r\n            style: \"font-family: \\\"Andale Mono\\\", Consolas, monospace;\",\r\n        }];\r\n    let selectedID = ID_PREFIX + electronStore.get(\"styling.font\");\r\n    const foundItem = options.find((item) => {\r\n        return item.id === selectedID;\r\n    });\r\n    if (!foundItem) {\r\n        selectedID = options[0].id;\r\n    }\r\n    const opts: IRiotOptsMenuSelect = {\r\n        disabled: !electronStore.get(\"styling.readiumcss\"),\r\n        options,\r\n        selected: selectedID,\r\n    };\r\n    const tag = riotMountMenuSelect(\"#fontSelect\", opts)[0] as IRiotTagMenuSelect;\r\n\r\n    tag.on(\"selectionChanged\", (val: string) => {\r\n        // console.log(\"selectionChanged\");\r\n        // console.log(val);\r\n        // const element = tag.root.ownerDocument.getElementById(val) as HTMLElement;\r\n        //     console.log(element.textContent);\r\n        val = val.replace(ID_PREFIX, \"\");\r\n        // console.log(val);\r\n        electronStore.set(\"styling.font\", val);\r\n    });\r\n\r\n    electronStore.onChanged(\"styling.font\", (newValue: any, oldValue: any) => {\r\n        if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n            return;\r\n        }\r\n        // console.log(\"onDidChange\");\r\n        // console.log(newValue);\r\n        tag.setSelectedItem(ID_PREFIX + newValue);\r\n\r\n        readiumCssOnOff();\r\n    });\r\n\r\n    electronStore.onChanged(\"styling.readiumcss\", (newValue: any, oldValue: any) => {\r\n        if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n            return;\r\n        }\r\n        tag.setDisabled(!newValue);\r\n    });\r\n\r\n    setTimeout(async () => {\r\n\r\n        let _sysFonts: string[] = [];\r\n        const systemFonts = new SystemFonts.default();\r\n        // const sysFonts = systemFonts.getFontsSync();\r\n        try {\r\n            _sysFonts = await systemFonts.getFonts();\r\n            // console.log(_sysFonts);\r\n        } catch (err) {\r\n            console.log(err);\r\n        }\r\n        if (_sysFonts && _sysFonts.length) {\r\n            const arr = ((tag.opts as IRiotOptsMenuSelect).options as IRiotOptsMenuSelectItem[]);\r\n            const divider: IRiotOptsMenuSelectItem = {\r\n                id: ID_PREFIX + \"_\",\r\n                label: \"_\",\r\n            };\r\n            arr.push(divider);\r\n            _sysFonts.forEach((sysFont) => {\r\n                const option: IRiotOptsMenuSelectItem = {\r\n                    id: ID_PREFIX + sysFont, // .replace(/ /g, \"_\"),\r\n                    label: sysFont,\r\n                    style: \"font-family: \" + sysFont + \";\",\r\n                };\r\n                arr.push(option);\r\n            });\r\n            let newSelectedID = ID_PREFIX + electronStore.get(\"styling.font\");\r\n            const newFoundItem = options.find((item) => {\r\n                return item.id === newSelectedID;\r\n            });\r\n            if (!newFoundItem) {\r\n                newSelectedID = arr[0].id;\r\n            }\r\n            (tag.opts as IRiotOptsMenuSelect).selected = newSelectedID;\r\n            tag.update();\r\n        }\r\n    }, 100);\r\n};\r\n\r\n// window.addEventListener(\"load\", () => {\r\n// });\r\n\r\nwindow.addEventListener(\"DOMContentLoaded\", () => {\r\n\r\n    (window as any).mdc.menu.MDCSimpleMenuFoundation.numbers.TRANSITION_DURATION_MS = 200;\r\n\r\n    // TODO this seems to hijack MDC slider thumb change\r\n    window.document.addEventListener(\"keydown\", (ev: KeyboardEvent) => {\r\n        if (drawer.open) {\r\n            return;\r\n        }\r\n        if ((ev.target as any).mdcSlider) {\r\n            return;\r\n        }\r\n\r\n        if (ev.keyCode === 37) { // left\r\n            navLeftOrRight(true);\r\n        } else if (ev.keyCode === 39) { // right\r\n            navLeftOrRight(false);\r\n        }\r\n    });\r\n\r\n    setTimeout(() => {\r\n        // material-components-web\r\n        (window as any).mdc.autoInit();\r\n    }, 500);\r\n\r\n    window.document.title = \"Readium2 [ \" + pathFileName + \"]\";\r\n\r\n    const h1 = document.getElementById(\"pubTitle\") as HTMLElement;\r\n    h1.textContent = pathFileName;\r\n\r\n    installKeyboardMouseFocusHandler();\r\n\r\n    if (electronStore.get(\"styling.night\")) {\r\n        document.body.classList.add(\"mdc-theme--dark\");\r\n    } else {\r\n        document.body.classList.remove(\"mdc-theme--dark\");\r\n    }\r\n\r\n    const drawerElement = document.getElementById(\"drawer\") as HTMLElement;\r\n    drawer = new (window as any).mdc.drawer.MDCTemporaryDrawer(drawerElement);\r\n    (drawerElement as any).mdcTemporaryDrawer = drawer;\r\n    const drawerButton = document.getElementById(\"drawerButton\") as HTMLElement;\r\n    drawerButton.addEventListener(\"click\", () => {\r\n        drawer.open = true;\r\n    });\r\n    drawerElement.addEventListener(\"click\", (ev) => {\r\n        const allMenus = drawerElement.querySelectorAll(\".mdc-simple-menu\");\r\n        const openedMenus: Node[] = [];\r\n        allMenus.forEach((elem) => {\r\n            if ((elem as any).mdcSimpleMenu && (elem as any).mdcSimpleMenu.open) {\r\n                openedMenus.push(elem);\r\n            }\r\n        });\r\n\r\n        let needsToCloseMenus = true;\r\n        let currElem: Node | null = ev.target as Node;\r\n        while (currElem) {\r\n            if (openedMenus.indexOf(currElem) >= 0) {\r\n                needsToCloseMenus = false;\r\n                break;\r\n            }\r\n            currElem = currElem.parentNode;\r\n        }\r\n        if (needsToCloseMenus) {\r\n            // openedMenus.forEach((elem) => {\r\n            //     (elem as any).mdcSimpleMenu.open = false;\r\n            //     let ss = (elem.parentNode as HTMLElement).querySelector(\".mdc-select__selected-text\");\r\n            //     if (ss) {\r\n            //         (ss as HTMLElement).style.transform = \"initial\";\r\n            //         (ss as HTMLElement).style.opacity = \"1\";\r\n            //         (ss as HTMLElement).focus();\r\n            //     }\r\n            //     ss = (elem.parentNode as HTMLElement).querySelector(\".mdc-select__label\");\r\n            //     if (ss) {\r\n            //         (ss as HTMLElement).style.transform = \"initial\";\r\n            //         (ss as HTMLElement).style.opacity = \"1\";\r\n            //         (ss as HTMLElement).focus();\r\n            //     }\r\n            // });\r\n        } else {\r\n            // console.log(\"NOT CLOSING MENU\");\r\n        }\r\n    }, true);\r\n\r\n    initFontSelector();\r\n    initFontSizeSelector();\r\n    initLineHeightSelector();\r\n\r\n    const nightSwitch = document.getElementById(\"night_switch-input\") as HTMLInputElement;\r\n    nightSwitch.checked = electronStore.get(\"styling.night\");\r\n    nightSwitch.addEventListener(\"change\", (_event) => {\r\n        const checked = nightSwitch.checked;\r\n        electronStore.set(\"styling.night\", checked);\r\n    });\r\n    nightSwitch.disabled = !electronStore.get(\"styling.readiumcss\");\r\n\r\n    const justifySwitch = document.getElementById(\"justify_switch-input\") as HTMLInputElement;\r\n    justifySwitch.checked = electronStore.get(\"styling.align\") === \"justify\";\r\n    justifySwitch.addEventListener(\"change\", (_event) => {\r\n        const checked = justifySwitch.checked;\r\n        electronStore.set(\"styling.align\", checked ? \"justify\" : \"initial\");\r\n    });\r\n    justifySwitch.disabled = !electronStore.get(\"styling.readiumcss\");\r\n\r\n    const paginateSwitch = document.getElementById(\"paginate_switch-input\") as HTMLInputElement;\r\n    paginateSwitch.checked = electronStore.get(\"styling.paged\");\r\n    paginateSwitch.addEventListener(\"change\", (_event) => {\r\n        const checked = paginateSwitch.checked;\r\n        electronStore.set(\"styling.paged\", checked);\r\n    });\r\n    paginateSwitch.disabled = !electronStore.get(\"styling.readiumcss\");\r\n\r\n    const readiumcssSwitch = document.getElementById(\"readiumcss_switch-input\") as HTMLInputElement;\r\n    readiumcssSwitch.checked = electronStore.get(\"styling.readiumcss\");\r\n    const stylingWrapper = document.getElementById(\"stylingWrapper\") as HTMLElement;\r\n    stylingWrapper.style.display = readiumcssSwitch.checked ? \"block\" : \"none\";\r\n    if (readiumcssSwitch.checked) {\r\n        ensureSliderLayout();\r\n    }\r\n    readiumcssSwitch.addEventListener(\"change\", (_event) => {\r\n        const checked = readiumcssSwitch.checked;\r\n        electronStore.set(\"styling.readiumcss\", checked);\r\n    });\r\n\r\n    const basicSwitch = document.getElementById(\"nav_basic_switch-input\") as HTMLInputElement;\r\n    basicSwitch.checked = !electronStore.get(\"basicLinkTitles\");\r\n    basicSwitch.addEventListener(\"change\", (_event) => {\r\n        const checked = basicSwitch.checked;\r\n        electronStore.set(\"basicLinkTitles\", !checked);\r\n    });\r\n\r\n    const snackBarElem = document.getElementById(\"snackbar\") as HTMLElement;\r\n    snackBar = new (window as any).mdc.snackbar.MDCSnackbar(snackBarElem);\r\n    (snackBarElem as any).mdcSnackbar = snackBar;\r\n    snackBar.dismissesOnAction = true;\r\n\r\n    //     drawerElement.addEventListener(\"MDCTemporaryDrawer:open\", () => {\r\n    //         console.log(\"MDCTemporaryDrawer:open\");\r\n    //     });\r\n    //     drawerElement.addEventListener(\"MDCTemporaryDrawer:close\", () => {\r\n    //         console.log(\"MDCTemporaryDrawer:close\");\r\n    //     });\r\n\r\n    const menuFactory = (menuEl: HTMLElement) => {\r\n        const menu = new (window as any).mdc.menu.MDCSimpleMenu(menuEl);\r\n        (menuEl as any).mdcSimpleMenu = menu;\r\n        return menu;\r\n    };\r\n\r\n    const selectElement = document.getElementById(\"nav-select\") as HTMLElement;\r\n    const navSelector = new (window as any).mdc.select.MDCSelect(selectElement, undefined, menuFactory);\r\n    (selectElement as any).mdcSelect = navSelector;\r\n    navSelector.listen(\"MDCSelect:change\", (ev: any) => {\r\n        // console.log(\"MDCSelect:change\");\r\n        // console.log(ev);\r\n        // console.log(ev.detail.selectedOptions[0].textContent);\r\n        // console.log(ev.detail.selectedIndex);\r\n        // console.log(ev.detail.value);\r\n\r\n        const activePanel = document.querySelector(\".tabPanel.active\");\r\n        if (activePanel) {\r\n            activePanel.classList.remove(\"active\");\r\n        }\r\n        const newActivePanel = document.querySelector(\".tabPanel:nth-child(\" + (ev.detail.selectedIndex + 1) + \")\");\r\n        if (newActivePanel) {\r\n            newActivePanel.classList.add(\"active\");\r\n\r\n            const div = document.getElementById(\"reader_controls_STYLES\") as HTMLElement;\r\n            if (newActivePanel === div) {\r\n                ensureSliderLayout();\r\n            }\r\n        }\r\n    });\r\n\r\n    const diagElem = document.querySelector(\"#lcpDialog\");\r\n    const lcpPassInput = document.getElementById(\"lcpPassInput\") as HTMLInputElement;\r\n    lcpDialog = new (window as any).mdc.dialog.MDCDialog(diagElem);\r\n    (diagElem as any).mdcDialog = lcpDialog;\r\n    lcpDialog.listen(\"MDCDialog:accept\", () => {\r\n\r\n        const lcpPass = lcpPassInput.value;\r\n\r\n        ipcRenderer.send(R2_EVENT_TRY_LCP_PASS, pathDecoded, lcpPass, false);\r\n    });\r\n    lcpDialog.listen(\"MDCDialog:cancel\", () => {\r\n\r\n        setTimeout(() => {\r\n            showLcpDialog();\r\n        }, 10);\r\n    });\r\n    if (lcpPassInput) {\r\n        lcpPassInput.addEventListener(\"keyup\", (ev) => {\r\n            if (ev.keyCode === 13) {\r\n                ev.preventDefault();\r\n                const lcpDialogAcceptButton = document.getElementById(\"lcpDialogAcceptButton\") as HTMLElement;\r\n                lcpDialogAcceptButton.click();\r\n            }\r\n        });\r\n    }\r\n\r\n    if (lcpHint) {\r\n\r\n        let lcpPassSha256Hex: string | undefined;\r\n        const lcpStore = electronStoreLCP.get(\"lcp\");\r\n        if (lcpStore) {\r\n            const pubLcpStore = lcpStore[pathDecoded];\r\n            if (pubLcpStore && pubLcpStore.sha) {\r\n                lcpPassSha256Hex = pubLcpStore.sha;\r\n            }\r\n        }\r\n        if (lcpPassSha256Hex) {\r\n            ipcRenderer.send(R2_EVENT_TRY_LCP_PASS, pathDecoded, lcpPassSha256Hex, true);\r\n        } else {\r\n            showLcpDialog();\r\n        }\r\n    } else {\r\n        startNavigatorExperiment();\r\n    }\r\n\r\n    const buttonClearReadingLocations = document.getElementById(\"buttonClearReadingLocations\") as HTMLElement;\r\n    buttonClearReadingLocations.addEventListener(\"click\", () => {\r\n        electronStore.set(\"readingLocation\", {});\r\n\r\n        drawer.open = false;\r\n        setTimeout(() => {\r\n            const message = \"Reading locations reset.\";\r\n            const data = {\r\n                actionHandler: () => {\r\n                    // console.log(\"SnackBar OK\");\r\n                },\r\n                actionOnBottom: false,\r\n                actionText: \"OK\",\r\n                message,\r\n                multiline: false,\r\n                timeout: 2000,\r\n            };\r\n            snackBar.show(data);\r\n        }, 500);\r\n    });\r\n\r\n    const buttonClearSettings = document.getElementById(\"buttonClearSettings\") as HTMLElement;\r\n    buttonClearSettings.addEventListener(\"click\", () => {\r\n        // electronStore.clear();\r\n        // electronStore.store = electronStore.getDefaults();\r\n        electronStore.set(undefined, electronStore.getDefaults());\r\n\r\n        drawer.open = false;\r\n        setTimeout(() => {\r\n            const message = \"Settings reset.\";\r\n            const data = {\r\n                actionHandler: () => {\r\n                    // console.log(\"SnackBar OK\");\r\n                },\r\n                actionOnBottom: false,\r\n                actionText: \"OK\",\r\n                message,\r\n                multiline: false,\r\n                timeout: 2000,\r\n            };\r\n            snackBar.show(data);\r\n        }, 500);\r\n    });\r\n\r\n    const buttonClearSettingsStyle = document.getElementById(\"buttonClearSettingsStyle\") as HTMLElement;\r\n    buttonClearSettingsStyle.addEventListener(\"click\", () => {\r\n\r\n        electronStore.set(\"styling\", electronStore.getDefaults().styling);\r\n\r\n        drawer.open = false;\r\n        setTimeout(() => {\r\n            const message = \"Default styles.\";\r\n            const data = {\r\n                actionHandler: () => {\r\n                    // console.log(\"SnackBar OK\");\r\n                },\r\n                actionOnBottom: false,\r\n                actionText: \"OK\",\r\n                message,\r\n                multiline: false,\r\n                timeout: 2000,\r\n            };\r\n            snackBar.show(data);\r\n        }, 500);\r\n    });\r\n\r\n    const buttonOpenSettings = document.getElementById(\"buttonOpenSettings\") as HTMLElement;\r\n    buttonOpenSettings.addEventListener(\"click\", () => {\r\n        if ((electronStore as any).reveal) {\r\n            (electronStore as any).reveal();\r\n        }\r\n        if ((electronStoreLCP as any).reveal) {\r\n            (electronStoreLCP as any).reveal();\r\n        }\r\n    });\r\n\r\n    const buttonLSDRenew = document.getElementById(\"buttonLSDRenew\") as HTMLElement;\r\n    buttonLSDRenew.addEventListener(\"click\", () => {\r\n        ipcRenderer.send(R2_EVENT_LCP_LSD_RENEW, pathDecoded, \"\"); // no explicit end date\r\n    });\r\n\r\n    const buttonLSDReturn = document.getElementById(\"buttonLSDReturn\") as HTMLElement;\r\n    buttonLSDReturn.addEventListener(\"click\", () => {\r\n        ipcRenderer.send(R2_EVENT_LCP_LSD_RETURN, pathDecoded);\r\n    });\r\n\r\n    // const buttonDevTools = document.getElementById(\"buttonDevTools\") as HTMLElement;\r\n    //     buttonDevTools.addEventListener(\"click\", () => {\r\n    //         ipcRenderer.send(R2_EVENT_DEVTOOLS, \"test\");\r\n    //     });\r\n});\r\n\r\nipcRenderer.on(R2_EVENT_LCP_LSD_RENEW_RES, (_event: any, okay: boolean, msg: string) => {\r\n    console.log(\"R2_EVENT_LCP_LSD_RENEW_RES\");\r\n    console.log(okay);\r\n    console.log(msg);\r\n});\r\n\r\nipcRenderer.on(R2_EVENT_LCP_LSD_RETURN_RES, (_event: any, okay: boolean, msg: string) => {\r\n    console.log(\"R2_EVENT_LCP_LSD_RETURN_RES\");\r\n    console.log(okay);\r\n    console.log(msg);\r\n});\r\n\r\nconst saveReadingLocation = (doc: string, loc: string) => {\r\n    let obj = electronStore.get(\"readingLocation\");\r\n    if (!obj) {\r\n        obj = {};\r\n    }\r\n    obj[pathDecoded] = {\r\n        doc,\r\n        loc,\r\n    };\r\n    electronStore.set(\"readingLocation\", obj);\r\n};\r\n\r\n// CAN'T USE Electron.WebviewTag !! :(\r\n// https://github.com/electron/electron-typescript-definitions/pull/81\r\n// TypeScript compiler with strictFunctionTypes =>\r\n// node_modules/electron/electron.d.ts(5390,13):\r\n// error TS2430: Interface 'WebviewTag' incorrectly extends interface 'HTMLElement'.\r\nlet _webview1: HTMLElement; // Electron.WebviewTag;\r\nlet _webview2: HTMLElement; // Electron.WebviewTag;\r\n\r\nfunction createWebView(): HTMLElement { // Electron.WebviewTag\r\n    const wv = document.createElement(\"webview\") as HTMLElement;\r\n    wv.setAttribute(\"webpreferences\",\r\n        \"nodeIntegration=0, nodeIntegrationInWorker=0, sandbox=0, javascript=1, \" +\r\n        \"contextIsolation=0, webSecurity=1, allowRunningInsecureContent=0\");\r\n    wv.setAttribute(\"partition\", R2_SESSION_WEBVIEW);\r\n    wv.setAttribute(\"httpreferrer\", publicationJsonUrl);\r\n    wv.setAttribute(\"preload\", \"./webview/preload.js\");\r\n    wv.setAttribute(\"disableguestresize\", \"\");\r\n    setTimeout(() => {\r\n        wv.removeAttribute(\"tabindex\");\r\n    }, 500);\r\n\r\n    wv.addEventListener(\"dom-ready\", () => {\r\n        // wv.openDevTools();\r\n        (wv as any).clearHistory();\r\n    });\r\n\r\n    wv.addEventListener(\"ipc-message\", (event: any) => { // Electron.IpcMessageEvent\r\n        const webview = event.currentTarget as HTMLElement; // Electron.WebviewTag;\r\n        const activeWebView = getActiveWebView();\r\n        if (webview !== activeWebView) {\r\n            return;\r\n        }\r\n\r\n        if (event.channel === R2_EVENT_LINK) {\r\n            handleLink(event.args[0], undefined, false);\r\n        } else if (event.channel === R2_EVENT_WEBVIEW_READY) {\r\n            // const id = event.args[0];\r\n            unhideWebView(false);\r\n        } else if (event.channel === R2_EVENT_READING_LOCATION) {\r\n            const cssSelector = event.args[0];\r\n            if ((webview as any).READIUM2_LINK) {\r\n                saveReadingLocation((webview as any).READIUM2_LINK.Href, cssSelector);\r\n            }\r\n        } else if (event.channel === R2_EVENT_PAGE_TURN_RES) {\r\n            if (!_publication) {\r\n                return;\r\n            }\r\n            // const isRTL = _publication.Metadata &&\r\n            // _publication.Metadata.Direction &&\r\n            // _publication.Metadata.Direction.toLowerCase() === \"rtl\"; //  any other value is LTR\r\n\r\n            const messageString = event.args[0];\r\n            const messageJson = JSON.parse(messageString);\r\n            // const isRTL = messageJson.direction === \"RTL\"; //  any other value is LTR\r\n            const goPREVIOUS = messageJson.go === \"PREVIOUS\"; // any other value is NEXT\r\n\r\n            if (!(webview as any).READIUM2_LINK) {\r\n                console.log(\"WEBVIEW READIUM2_LINK ??!!\");\r\n                return;\r\n            }\r\n\r\n            let nextOrPreviousSpineItem: Link | undefined;\r\n            for (let i = 0; i < _publication.Spine.length; i++) {\r\n                if (_publication.Spine[i] === (webview as any).READIUM2_LINK) {\r\n                    if (goPREVIOUS && (i - 1) >= 0) {\r\n                        nextOrPreviousSpineItem = _publication.Spine[i - 1];\r\n                    } else if (!goPREVIOUS && (i + 1) < _publication.Spine.length) {\r\n                        nextOrPreviousSpineItem = _publication.Spine[i + 1];\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n            if (!nextOrPreviousSpineItem) {\r\n                return;\r\n            }\r\n            const linkHref = publicationJsonUrl + \"/../\" + nextOrPreviousSpineItem.Href;\r\n            handleLink(linkHref, goPREVIOUS, false);\r\n        } else {\r\n            console.log(\"webview1 ipc-message\");\r\n            console.log(event.channel);\r\n        }\r\n    });\r\n\r\n    return wv;\r\n}\r\n\r\nconst adjustResize = (webview: HTMLElement) => { // Electron.WebviewTag\r\n    const width = webview.clientWidth;\r\n    const height = webview.clientHeight;\r\n    const wc = (webview as any).getWebContents();\r\n    if (wc && width && height) {\r\n        wc.setSize({\r\n            normal: {\r\n                height,\r\n                width,\r\n            },\r\n        });\r\n    }\r\n};\r\n\r\nconst onResizeDebounced = debounce(() => {\r\n    adjustResize(_webview1);\r\n    adjustResize(_webview2);\r\n    setTimeout(() => {\r\n        unhideWebView(false);\r\n    }, 1000);\r\n}, 200);\r\n\r\nwindow.addEventListener(\"resize\", () => {\r\n    const hidePanel = document.getElementById(\"reader_chrome_HIDE\") as HTMLElement;\r\n    if (hidePanel.style.display !== \"block\") {\r\n        hidePanel.style.display = \"block\";\r\n        _viewHideInterval = setInterval(() => {\r\n            unhideWebView(true);\r\n        }, 5000);\r\n    }\r\n    onResizeDebounced();\r\n});\r\n\r\nexport function handleLink(href: string, previous: boolean | undefined, useGoto: boolean) {\r\n    const prefix = publicationJsonUrl.replace(\"manifest.json\", \"\");\r\n    if (href.startsWith(prefix)) {\r\n        if (drawer.open) {\r\n            drawer.open = false;\r\n            setTimeout(() => {\r\n                loadLink(href, previous, useGoto);\r\n            }, 200);\r\n        } else {\r\n            loadLink(href, previous, useGoto);\r\n        }\r\n    } else {\r\n        shell.openExternal(href);\r\n    }\r\n}\r\n\r\nlet _viewHideInterval: NodeJS.Timer | undefined;\r\n\r\nfunction loadLink(hrefFull: string, previous: boolean | undefined, useGoto: boolean) {\r\n\r\n    if (!_publication) {\r\n        return;\r\n    }\r\n\r\n    const rcssJsonstr = computeReadiumCssJsonMessage();\r\n    // const str = window.atob(base64);\r\n    const rcssJsonstrBase64 = window.btoa(rcssJsonstr);\r\n\r\n    const linkUri = new URI(hrefFull);\r\n    linkUri.search((data: any) => {\r\n        // overrides existing (leaves others intact)\r\n\r\n        if (typeof previous === \"undefined\") {\r\n            // erase unwanted forward of query param during linking\r\n            data.readiumprevious = undefined;\r\n            // delete data.readiumprevious;\r\n        } else {\r\n            data.readiumprevious = previous ? \"true\" : \"false\";\r\n        }\r\n\r\n        if (!useGoto) {\r\n            // erase unwanted forward of query param during linking\r\n            data.readiumgoto = undefined;\r\n            // delete data.readiumgoto;\r\n        }\r\n\r\n        data.readiumcss = rcssJsonstrBase64;\r\n    });\r\n    if (useGoto) {\r\n        linkUri.hash(\"\").normalizeHash();\r\n    }\r\n\r\n    const pubUri = new URI(publicationJsonUrl);\r\n\r\n    // \"/pub/BASE64_PATH/manifest.json\" ==> \"/pub/BASE64_PATH/\"\r\n    const pathPrefix = pubUri.path().replace(\"manifest.json\", \"\");\r\n\r\n    // \"/pub/BASE64_PATH/epub/chapter.html\" ==> \"epub/chapter.html\"\r\n    const linkPath = decodeURIComponent(linkUri.normalizePath().path().replace(pathPrefix, \"\"));\r\n\r\n    let pubLink = _publication.Spine.find((spineLink) => {\r\n        return spineLink.Href === linkPath;\r\n    });\r\n    if (!pubLink) {\r\n        pubLink = _publication.Resources.find((spineLink) => {\r\n            return spineLink.Href === linkPath;\r\n        });\r\n    }\r\n\r\n    if (!pubLink) {\r\n        console.log(\"FATAL WEBVIEW READIUM2_LINK ??!! \" + hrefFull + \" ==> \" + linkPath);\r\n        return;\r\n    }\r\n\r\n    const activeWebView = getActiveWebView();\r\n    const wv1AlreadyLoaded = (_webview1 as any).READIUM2_LINK === pubLink;\r\n    const wv2AlreadyLoaded = (_webview2 as any).READIUM2_LINK === pubLink;\r\n    if (wv1AlreadyLoaded || wv2AlreadyLoaded) {\r\n        const msgJson = {\r\n            goto: useGoto ? linkUri.search(\"readiumgoto\") : undefined,\r\n            hash: useGoto ? undefined : linkUri.fragment(),\r\n            previous,\r\n        };\r\n        const msgStr = JSON.stringify(msgJson);\r\n\r\n        console.log(\"ALREADY LOADED: \" + pubLink.Href);\r\n        console.log(msgStr);\r\n\r\n        const webviewToReuse = wv1AlreadyLoaded ? _webview1 : _webview2;\r\n        // const otherWebview = webviewToReuse === _webview2 ? _webview1 : _webview2;\r\n        if (webviewToReuse !== activeWebView) {\r\n\r\n            console.log(\"INTO VIEW ...\");\r\n\r\n            const slidingView = document.getElementById(\"sliding_viewport\") as HTMLElement;\r\n            let animate = true;\r\n            if (msgJson.goto || msgJson.hash) {\r\n                console.log(\"DISABLE ANIM\");\r\n                animate = false;\r\n            } else if (previous) {\r\n                if (!slidingView.classList.contains(\"shiftedLeft\")) {\r\n                    console.log(\"DISABLE ANIM\");\r\n                    animate = false;\r\n                }\r\n            }\r\n            if (animate) {\r\n                if (!slidingView.classList.contains(\"animated\")) {\r\n                    slidingView.classList.add(\"animated\");\r\n                }\r\n            } else {\r\n                if (slidingView.classList.contains(\"animated\")) {\r\n                    slidingView.classList.remove(\"animated\");\r\n                }\r\n            }\r\n            if (slidingView.classList.contains(\"shiftedLeft\")) {\r\n                slidingView.classList.remove(\"shiftedLeft\");\r\n\r\n                // if (_webview1.classList.contains(\"posRight\")) {\r\n                //     // activeWebView === _webview1;\r\n                // } else {\r\n                //     // activeWebView === _webview2;\r\n                // }\r\n            } else {\r\n                slidingView.classList.add(\"shiftedLeft\");\r\n\r\n                // if (_webview2.classList.contains(\"posRight\")) {\r\n                //     // activeWebView === _webview1;\r\n                // } else {\r\n                //     // activeWebView === _webview2;\r\n                // }\r\n            }\r\n        }\r\n\r\n        (webviewToReuse as any).send(R2_EVENT_SCROLLTO, msgStr); // .getWebContents()\r\n\r\n        return;\r\n    }\r\n\r\n    const hidePanel = document.getElementById(\"reader_chrome_HIDE\") as HTMLElement;\r\n    hidePanel.style.display = \"block\";\r\n    _viewHideInterval = setInterval(() => {\r\n        unhideWebView(true);\r\n    }, 5000);\r\n\r\n    const uriStr = linkUri.toString();\r\n    console.log(\"####### >>> ---\");\r\n    console.log((activeWebView as any).readiumwebviewid);\r\n    console.log(pubLink.Href);\r\n    console.log(linkUri.hash());\r\n    // tslint:disable-next-line:no-string-literal\r\n    console.log(linkUri.search(true)[\"readiumgoto\"]);\r\n    // tslint:disable-next-line:no-string-literal\r\n    console.log(linkUri.search(true)[\"readiumprevious\"]);\r\n    console.log(\"####### >>> ---\");\r\n    (activeWebView as any).READIUM2_LINK = pubLink;\r\n    activeWebView.setAttribute(\"src\", uriStr);\r\n    // wv.getWebContents().loadURL(uriStr, { extraHeaders: \"pragma: no-cache\\n\" });\r\n    // wv.loadURL(uriStr, { extraHeaders: \"pragma: no-cache\\n\" });\r\n\r\n    const enableOffScreenRenderPreload = false;\r\n    if (enableOffScreenRenderPreload) {\r\n        setTimeout(() => {\r\n            if (!_publication || !pubLink) {\r\n                return;\r\n            }\r\n\r\n            const otherWebview = activeWebView === _webview2 ? _webview1 : _webview2;\r\n\r\n            // let inSpine = true;\r\n            const index = _publication.Spine.indexOf(pubLink);\r\n            // if (!index) {\r\n            //     inSpine = false;\r\n            //     index = _publication.Resources.indexOf(pubLink);\r\n            // }\r\n            if (index >= 0 &&\r\n                previous && (index - 1) >= 0 ||\r\n                !previous && (index + 1) < _publication.Spine.length\r\n                // (index + 1) < (inSpine ? _publication.Spine.length : _publication.Resources.length)\r\n            ) {\r\n                const nextPubLink = _publication.Spine[previous ? (index - 1) : (index + 1)];\r\n                // (inSpine ? _publication.Spine[index + 1] : _publication.Resources[index + 1]);\r\n\r\n                if ((otherWebview as any).READIUM2_LINK !== nextPubLink) {\r\n                    const linkUriNext = new URI(publicationJsonUrl + \"/../\" + nextPubLink.Href);\r\n                    linkUriNext.normalizePath();\r\n                    linkUriNext.search((data: any) => {\r\n                        // overrides existing (leaves others intact)\r\n                        data.readiumcss = rcssJsonstrBase64;\r\n                    });\r\n                    const uriStrNext = linkUriNext.toString();\r\n\r\n                    console.log(\"####### ======\");\r\n                    console.log((otherWebview as any).readiumwebviewid);\r\n                    console.log(nextPubLink.Href);\r\n                    console.log(linkUriNext.hash());\r\n                    // tslint:disable-next-line:no-string-literal\r\n                    console.log(linkUriNext.search(true)[\"readiumgoto\"]);\r\n                    // tslint:disable-next-line:no-string-literal\r\n                    console.log(linkUriNext.search(true)[\"readiumprevious\"]);\r\n                    console.log(\"####### ======\");\r\n                    (otherWebview as any).READIUM2_LINK = nextPubLink;\r\n                    otherWebview.setAttribute(\"src\", uriStrNext);\r\n                }\r\n            }\r\n        }, 300);\r\n    }\r\n}\r\n\r\nconst getActiveWebView = (): HTMLElement => { // Electron.WebviewTag\r\n\r\n    let activeWebView: HTMLElement; // Electron.WebviewTag\r\n\r\n    const slidingViewport = document.getElementById(\"sliding_viewport\") as HTMLElement;\r\n    if (slidingViewport.classList.contains(\"shiftedLeft\")) {\r\n        if (_webview1.classList.contains(\"posRight\")) {\r\n            activeWebView = _webview1;\r\n        } else {\r\n            activeWebView = _webview2;\r\n        }\r\n    } else {\r\n        if (_webview2.classList.contains(\"posRight\")) {\r\n            activeWebView = _webview1;\r\n        } else {\r\n            activeWebView = _webview2;\r\n        }\r\n    }\r\n\r\n    return activeWebView;\r\n};\r\n\r\nlet _publication: Publication | undefined;\r\nlet _publicationJSON: any | undefined;\r\n\r\nfunction startNavigatorExperiment() {\r\n\r\n    const drawerButton = document.getElementById(\"drawerButton\") as HTMLElement;\r\n    drawerButton.focus();\r\n\r\n    _webview1 = createWebView();\r\n    (_webview1 as any).readiumwebviewid = 1;\r\n    _webview1.setAttribute(\"id\", \"webview1\");\r\n    _webview1.setAttribute(\"class\", \"full\");\r\n\r\n    _webview2 = createWebView();\r\n    (_webview2 as any).readiumwebviewid = 2;\r\n    _webview2.setAttribute(\"id\", \"webview2\");\r\n    _webview2.setAttribute(\"class\", \"full\");\r\n\r\n    const slidingViewport = document.getElementById(\"sliding_viewport\") as HTMLElement;\r\n    slidingViewport.appendChild(_webview1 as Node);\r\n    slidingViewport.appendChild(_webview2 as Node);\r\n\r\n    // tslint:disable-next-line:no-floating-promises\r\n    (async () => {\r\n\r\n        let response: Response;\r\n        try {\r\n            response = await fetch(publicationJsonUrl);\r\n        } catch (e) {\r\n            console.log(e);\r\n            return;\r\n        }\r\n        if (!response.ok) {\r\n            console.log(\"BAD RESPONSE?!\");\r\n        }\r\n        // response.headers.forEach((arg0: any, arg1: any) => {\r\n        //     console.log(arg0 + \" => \" + arg1);\r\n        // });\r\n\r\n        try {\r\n            _publicationJSON = await response.json();\r\n        } catch (e) {\r\n            console.log(e);\r\n        }\r\n        if (!_publicationJSON) {\r\n            return;\r\n        }\r\n        // const pubJson = global.JSON.parse(publicationStr);\r\n\r\n        _publication = TAJSON.deserialize<Publication>(_publicationJSON, Publication);\r\n\r\n        const isRTL = _publication.Metadata &&\r\n            _publication.Metadata.Direction &&\r\n            _publication.Metadata.Direction.toLowerCase() === \"rtl\"; //  any other value is LTR\r\n        if (isRTL) {\r\n            _webview1.classList.add(\"posRight\");\r\n        } else {\r\n            _webview2.classList.add(\"posRight\");\r\n        }\r\n\r\n        if (_publication.Metadata && _publication.Metadata.Title) {\r\n            let title: string | undefined;\r\n            if (typeof _publication.Metadata.Title === \"string\") {\r\n                title = _publication.Metadata.Title;\r\n            } else {\r\n                const keys = Object.keys(_publication.Metadata.Title as IStringMap);\r\n                if (keys && keys.length) {\r\n                    title = (_publication.Metadata.Title as IStringMap)[keys[0]];\r\n                }\r\n            }\r\n\r\n            if (title) {\r\n                const h1 = document.getElementById(\"pubTitle\") as HTMLElement;\r\n                h1.textContent = title;\r\n            }\r\n        }\r\n\r\n        const buttonNavLeft = document.getElementById(\"buttonNavLeft\") as HTMLElement;\r\n        buttonNavLeft.addEventListener(\"click\", (_event) => {\r\n            navLeftOrRight(true);\r\n        });\r\n\r\n        const buttonNavRight = document.getElementById(\"buttonNavRight\") as HTMLElement;\r\n        buttonNavRight.addEventListener(\"click\", (_event) => {\r\n            navLeftOrRight(false);\r\n        });\r\n\r\n        if (_publication.Spine && _publication.Spine.length) {\r\n\r\n            const opts: IRiotOptsLinkList = {\r\n                basic: true,\r\n                fixBasic: true, // always single-line list items (no title)\r\n                links: _publicationJSON.spine as IRiotOptsLinkListItem[],\r\n                url: publicationJsonUrl,\r\n            };\r\n            // const tag =\r\n            riotMountLinkList(\"#reader_controls_SPINE\", opts);\r\n        }\r\n\r\n        if (_publication.TOC && _publication.TOC.length) {\r\n\r\n            const opts: IRiotOptsLinkTree = {\r\n                basic: electronStore.get(\"basicLinkTitles\"),\r\n                links: _publicationJSON.toc as IRiotOptsLinkTreeItem[],\r\n                url: publicationJsonUrl,\r\n            };\r\n            const tag = riotMountLinkTree(\"#reader_controls_TOC\", opts)[0] as IRiotTagLinkTree;\r\n\r\n            electronStore.onChanged(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\r\n                if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n                    return;\r\n                }\r\n                tag.setBasic(newValue);\r\n            });\r\n        }\r\n        if (_publication.PageList && _publication.PageList.length) {\r\n\r\n            const opts: IRiotOptsLinkList = {\r\n                basic: electronStore.get(\"basicLinkTitles\"),\r\n                links: _publicationJSON[\"page-list\"] as IRiotOptsLinkListItem[],\r\n                url: publicationJsonUrl,\r\n            };\r\n            const tag = riotMountLinkList(\"#reader_controls_PAGELIST\", opts)[0] as IRiotTagLinkList;\r\n\r\n            electronStore.onChanged(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\r\n                if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n                    return;\r\n                }\r\n                tag.setBasic(newValue);\r\n            });\r\n        }\r\n\r\n        const landmarksData: IRiotOptsLinkListGroupItem[] = [];\r\n        if (_publication.Landmarks && _publication.Landmarks.length) {\r\n            landmarksData.push({\r\n                label: \"Main\",\r\n                links: _publicationJSON.landmarks as IRiotOptsLinkListItem[],\r\n            });\r\n        }\r\n        if (_publication.LOT && _publication.LOT.length) {\r\n            landmarksData.push({\r\n                label: \"Tables\",\r\n                links: _publicationJSON.lot as IRiotOptsLinkListItem[],\r\n            });\r\n        }\r\n        if (_publication.LOI && _publication.LOI.length) {\r\n            landmarksData.push({\r\n                label: \"Illustrations\",\r\n                links: _publicationJSON.loi as IRiotOptsLinkListItem[],\r\n            });\r\n        }\r\n        if (_publication.LOV && _publication.LOV.length) {\r\n            landmarksData.push({\r\n                label: \"Video\",\r\n                links: _publicationJSON.lov as IRiotOptsLinkListItem[],\r\n            });\r\n        }\r\n        if (_publication.LOA && _publication.LOA.length) {\r\n            landmarksData.push({\r\n                label: \"Audio\",\r\n                links: _publicationJSON.loa as IRiotOptsLinkListItem[],\r\n            });\r\n        }\r\n        if (landmarksData.length) {\r\n            const opts: IRiotOptsLinkListGroup = {\r\n                basic: electronStore.get(\"basicLinkTitles\"),\r\n                linksgroup: landmarksData,\r\n                url: publicationJsonUrl,\r\n            };\r\n            const tag = riotMountLinkListGroup(\"#reader_controls_LANDMARKS\", opts)[0] as IRiotTagLinkListGroup;\r\n\r\n            electronStore.onChanged(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\r\n                if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\r\n                    return;\r\n                }\r\n                tag.setBasic(newValue);\r\n            });\r\n        }\r\n\r\n        const readStore = electronStore.get(\"readingLocation\");\r\n        let linkToLoad: Link | undefined;\r\n        let linkToLoadGoto: string | undefined;\r\n        if (readStore) {\r\n            const obj = readStore[pathDecoded];\r\n            if (obj && obj.doc) {\r\n                if (_publication.Spine && _publication.Spine.length) {\r\n                    linkToLoad = _publication.Spine.find((spineLink) => {\r\n                        return spineLink.Href === obj.doc;\r\n                    });\r\n                    if (linkToLoad && obj.loc) {\r\n                        linkToLoadGoto = obj.loc;\r\n                    }\r\n                }\r\n                if (!linkToLoad &&\r\n                    _publication.Resources && _publication.Resources.length) {\r\n                    linkToLoad = _publication.Resources.find((resLink) => {\r\n                        return resLink.Href === obj.doc;\r\n                    });\r\n                    if (linkToLoad && obj.loc) {\r\n                        linkToLoadGoto = obj.loc;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (!linkToLoad) {\r\n            if (_publication.Spine && _publication.Spine.length) {\r\n                const firstLinear = _publication.Spine[0];\r\n                if (firstLinear) {\r\n                    linkToLoad = firstLinear;\r\n                }\r\n            }\r\n        }\r\n\r\n        setTimeout(() => {\r\n            drawer.open = true; // necessary otherwise focus steal for links in publication documents!\r\n            if (linkToLoad) {\r\n                const hrefToLoad = publicationJsonUrl + \"/../\" + linkToLoad.Href +\r\n                    (linkToLoadGoto ? (\"?readiumgoto=\" + encodeURIComponent_RFC3986(linkToLoadGoto)) : \"\");\r\n                handleLink(hrefToLoad, undefined, true);\r\n            }\r\n        }, 100);\r\n    })();\r\n}\r\n\r\nfunction navLeftOrRight(left: boolean) {\r\n    if (!_publication) {\r\n        return;\r\n    }\r\n    const activeWebView = getActiveWebView();\r\n    const isRTL = _publication.Metadata &&\r\n        _publication.Metadata.Direction &&\r\n        _publication.Metadata.Direction.toLowerCase() === \"rtl\"; //  any other value is LTR\r\n    const goPREVIOUS = left ? !isRTL : isRTL;\r\n    const messageJson = {\r\n        direction: isRTL ? \"RTL\" : \"LTR\",\r\n        go: goPREVIOUS ? \"PREVIOUS\" : \"NEXT\",\r\n    };\r\n    const messageStr = JSON.stringify(messageJson);\r\n    (activeWebView as any).send(R2_EVENT_PAGE_TURN, messageStr); // .getWebContents()\r\n}\r\n"]}