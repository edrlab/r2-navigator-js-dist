{"version":3,"file":"cssselector.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/common/cssselector.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\n// tslint:disable-next-line:max-line-length\n// https://github.com/fczbkk/css-selector-generator-benchmark/blob/master/README.md#chromiums-dompresentationutils\n\n// tslint:disable-next-line:max-line-length\n// https://chromium.googlesource.com/chromium/blink/+/master/Source/devtools/front_end/components/DOMPresentationUtils.js#259\nexport const fullQualifiedSelector = (node: Node, justSelector: boolean): string => {\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        const lowerCaseName = ((node as Element).localName && (node as Element).localName.toLowerCase())\n            || node.nodeName.toLowerCase();\n        return lowerCaseName;\n    }\n    return cssPath(node, justSelector);\n};\n\ninterface IDOMNodePathStep {\n    optimized: boolean;\n    value: string;\n}\n\n// tslint:disable-next-line:max-line-length\n// https://chromium.googlesource.com/chromium/blink/+/master/Source/devtools/front_end/components/DOMPresentationUtils.js#289\nconst cssPath = (node: Node, optimized: boolean): string => {\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        return \"\";\n    }\n\n    const steps = [];\n    let contextNode = node;\n    while (contextNode) {\n        const step = _cssPathStep(contextNode, !!optimized, contextNode === node);\n        if (!step) {\n            break; // Error - bail out early.\n        }\n        steps.push(step.value);\n        if (step.optimized) {\n            break;\n        }\n        contextNode = contextNode.parentNode as Node;\n    }\n    steps.reverse();\n    return steps.join(\" > \");\n};\n\n// tslint:disable-next-line:max-line-length\n// https://chromium.googlesource.com/chromium/blink/+/master/Source/devtools/front_end/components/DOMPresentationUtils.js#316\nconst _cssPathStep = (node: Node, optimized: boolean, isTargetNode: boolean): IDOMNodePathStep | undefined => {\n\n    const prefixedElementClassNames = (nd: Element): string[] => {\n        const classAttribute = nd.getAttribute(\"class\");\n        if (!classAttribute) {\n            return [];\n        }\n\n        return classAttribute.split(/\\s+/g).filter(Boolean).map((nm) => {\n            // The prefix is required to store \"__proto__\" in a object-based map.\n            return \"$\" + nm;\n        });\n    };\n\n    const idSelector = (idd: string): string => {\n        return \"#\" + escapeIdentifierIfNeeded(idd);\n    };\n\n    const escapeIdentifierIfNeeded = (ident: string): string => {\n        if (isCSSIdentifier(ident)) {\n            return ident;\n        }\n\n        const shouldEscapeFirst = /^(?:[0-9]|-[0-9-]?)/.test(ident);\n        const lastIndex = ident.length - 1;\n        return ident.replace(/./g, (c: string, ii: number) => {\n            return ((shouldEscapeFirst && ii === 0) || !isCSSIdentChar(c)) ? escapeAsciiChar(c, ii === lastIndex) : c;\n        });\n    };\n\n    const escapeAsciiChar = (c: string, isLast: boolean) => {\n        return \"\\\\\" + toHexByte(c) + (isLast ? \"\" : \" \");\n    };\n\n    const toHexByte = (c: string): string => {\n        let hexByte = c.charCodeAt(0).toString(16);\n        if (hexByte.length === 1) {\n            hexByte = \"0\" + hexByte;\n        }\n        return hexByte;\n    };\n\n    const isCSSIdentChar = (c: string): boolean => {\n        if (/[a-zA-Z0-9_-]/.test(c)) {\n            return true;\n        }\n        return c.charCodeAt(0) >= 0xA0;\n    };\n\n    const isCSSIdentifier = (value: string): boolean => {\n        return /^-?[a-zA-Z_][a-zA-Z0-9_-]*$/.test(value);\n    };\n\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        return undefined;\n    }\n    const lowerCaseName = ((node as Element).localName && (node as Element).localName.toLowerCase())\n        || node.nodeName.toLowerCase();\n\n    const element = node as Element;\n\n    const id = element.getAttribute(\"id\");\n\n    if (optimized) {\n        if (id) {\n            return {\n                optimized: true,\n                value: idSelector(id),\n            };\n        }\n        if (lowerCaseName === \"body\" || lowerCaseName === \"head\" || lowerCaseName === \"html\") {\n            return {\n                optimized: true,\n                value: lowerCaseName, // node.nodeNameInCorrectCase(),\n            };\n        }\n    }\n\n    const nodeName = lowerCaseName; // node.nodeNameInCorrectCase();\n    if (id) {\n        return {\n            optimized: true,\n            value: nodeName + idSelector(id),\n        };\n    }\n\n    const parent = node.parentNode;\n\n    if (!parent || parent.nodeType === Node.DOCUMENT_NODE) {\n        return {\n            optimized: true,\n            value: nodeName,\n        };\n    }\n\n    const prefixedOwnClassNamesArray_ = prefixedElementClassNames(element);\n    const prefixedOwnClassNamesArray: string[] = []; // .keySet()\n    prefixedOwnClassNamesArray_.forEach((arrItem) => {\n        if (prefixedOwnClassNamesArray.indexOf(arrItem) < 0) {\n            prefixedOwnClassNamesArray.push(arrItem);\n        }\n    });\n\n    let needsClassNames = false;\n    let needsNthChild = false;\n    let ownIndex = -1;\n    let elementIndex = -1;\n    const siblings = (parent as Element).children;\n\n    for (let i = 0; (ownIndex === -1 || !needsNthChild) && i < siblings.length; ++i) {\n        const sibling = siblings[i];\n        if (sibling.nodeType !== Node.ELEMENT_NODE) {\n            continue;\n        }\n        elementIndex += 1;\n        if (sibling === node) {\n            ownIndex = elementIndex;\n            continue;\n        }\n        if (needsNthChild) {\n            continue;\n        }\n\n        // sibling.nodeNameInCorrectCase()\n        const siblingName = (sibling.localName && sibling.localName.toLowerCase()) || sibling.nodeName.toLowerCase();\n        if (siblingName !== nodeName) {\n            continue;\n        }\n        needsClassNames = true;\n\n        const ownClassNames: string[] = [];\n        prefixedOwnClassNamesArray.forEach((arrItem) => {\n            ownClassNames.push(arrItem);\n        });\n        let ownClassNameCount = ownClassNames.length;\n\n        if (ownClassNameCount === 0) {\n            needsNthChild = true;\n            continue;\n        }\n        const siblingClassNamesArray_ = prefixedElementClassNames(sibling);\n        const siblingClassNamesArray: string[] = []; // .keySet()\n        siblingClassNamesArray_.forEach((arrItem) => {\n            if (siblingClassNamesArray.indexOf(arrItem) < 0) {\n                siblingClassNamesArray.push(arrItem);\n            }\n        });\n\n        for (const siblingClass of siblingClassNamesArray) {\n            const ind = ownClassNames.indexOf(siblingClass);\n            if (ind < 0) {\n                continue;\n            }\n\n            ownClassNames.splice(ind, 1); // delete ownClassNames[siblingClass];\n\n            if (!--ownClassNameCount) {\n                needsNthChild = true;\n                break;\n            }\n        }\n    }\n\n    let result = nodeName;\n    if (isTargetNode &&\n        nodeName === \"input\" &&\n        element.getAttribute(\"type\") &&\n        !element.getAttribute(\"id\") &&\n        !element.getAttribute(\"class\")) {\n        result += \"[type=\\\"\" + element.getAttribute(\"type\") + \"\\\"]\";\n    }\n    if (needsNthChild) {\n        result += \":nth-child(\" + (ownIndex + 1) + \")\";\n    } else if (needsClassNames) {\n        for (const prefixedName of prefixedOwnClassNamesArray) {\n            result += \".\" + escapeIdentifierIfNeeded(prefixedName.substr(1));\n        }\n    }\n\n    return {\n        optimized: false,\n        value: result,\n    };\n};\n\n// tslint:disable-next-line:max-line-length\n// https://chromium.googlesource.com/chromium/blink/+/master/Source/devtools/front_end/components/DOMPresentationUtils.js#270\n// const simpleSelector = (node: Node): string => {\n//     const lowerCaseName = (node.localName && node.localName.toLowerCase()) || node.nodeName.toLowerCase();\n//     if (node.nodeType !== Node.ELEMENT_NODE) {\n//         return lowerCaseName;\n//     }\n\n//     const element = node as Element;\n\n//     const id = element.getAttribute(\"id\");\n//     if (id) {\n//         return lowerCaseName + \"#\" + id;\n//     }\n\n//     const clazz = element.getAttribute(\"class\");\n//     if (clazz) {\n//         return (lowerCaseName === \"div\" ? \"\" : lowerCaseName) + \".\" + clazz.trim().replace(/\\s+/g, \".\");\n//     }\n\n//     const typez = element.getAttribute(\"type\");\n//     if (typez && lowerCaseName === \"input\") {\n//         return lowerCaseName + \"[type=\\\"\" + typez + \"\\\"]\";\n//     }\n\n//     return lowerCaseName;\n// };\n"]}