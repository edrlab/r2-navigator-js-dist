{"version":3,"file":"preload.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/webview/preload.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\nimport * as debounce from \"debounce\";\nimport * as debug_ from \"debug\";\nimport { ipcRenderer } from \"electron\";\nimport { isFocusable } from \"tabbable\";\n\nimport { LocatorLocations, LocatorText } from \"@r2-shared-js/models/locator\";\n\nimport { encodeURIComponent_RFC3986 } from \"@r2-utils-js/_utils/http/UrlUtils\";\n\nimport { READIUM2_ELECTRON_HTTP_PROTOCOL } from \"../../common/sessions\";\n\nimport {\n    IEventPayload_R2_EVENT_AUDIO_SOUNDTRACK, IEventPayload_R2_EVENT_CAPTIONS,\n    IEventPayload_R2_EVENT_CLIPBOARD_COPY, IEventPayload_R2_EVENT_DEBUG_VISUALS,\n    IEventPayload_R2_EVENT_FXL_CONFIGURE, IEventPayload_R2_EVENT_HIGHLIGHT_CREATE,\n    IEventPayload_R2_EVENT_HIGHLIGHT_REMOVE, IEventPayload_R2_EVENT_LINK,\n    IEventPayload_R2_EVENT_LOCATOR_VISIBLE, IEventPayload_R2_EVENT_MEDIA_OVERLAY_CLICK,\n    IEventPayload_R2_EVENT_MEDIA_OVERLAY_HIGHLIGHT, IEventPayload_R2_EVENT_MEDIA_OVERLAY_STARTSTOP,\n    IEventPayload_R2_EVENT_MEDIA_OVERLAY_STATE,\n    IEventPayload_R2_EVENT_PAGE_TURN, IEventPayload_R2_EVENT_READING_LOCATION,\n    IEventPayload_R2_EVENT_READIUMCSS, IEventPayload_R2_EVENT_SCROLLTO,\n    IEventPayload_R2_EVENT_SHIFT_VIEW_X, IEventPayload_R2_EVENT_TTS_CLICK_ENABLE,\n    IEventPayload_R2_EVENT_TTS_DO_NEXT_OR_PREVIOUS, IEventPayload_R2_EVENT_TTS_DO_PLAY,\n    IEventPayload_R2_EVENT_TTS_OVERLAY_ENABLE, IEventPayload_R2_EVENT_TTS_PLAYBACK_RATE,\n    IEventPayload_R2_EVENT_TTS_SENTENCE_DETECT_ENABLE, IEventPayload_R2_EVENT_TTS_VOICE,\n    IEventPayload_R2_EVENT_TTS_SKIP_ENABLE, R2_EVENT_TTS_SKIP_ENABLE,\n    IEventPayload_R2_EVENT_WEBVIEW_KEYDOWN, MediaOverlaysStateEnum, R2_EVENT_AUDIO_SOUNDTRACK, R2_EVENT_CAPTIONS,\n    R2_EVENT_CLIPBOARD_COPY, R2_EVENT_DEBUG_VISUALS, R2_EVENT_FXL_CONFIGURE,\n    R2_EVENT_HIGHLIGHT_CREATE, R2_EVENT_HIGHLIGHT_REMOVE, R2_EVENT_HIGHLIGHT_REMOVE_ALL,\n    R2_EVENT_KEYBOARD_FOCUS_REQUEST, R2_EVENT_LINK, R2_EVENT_LOCATOR_VISIBLE,\n    R2_EVENT_MEDIA_OVERLAY_CLICK, R2_EVENT_MEDIA_OVERLAY_HIGHLIGHT,\n    R2_EVENT_MEDIA_OVERLAY_STARTSTOP, R2_EVENT_MEDIA_OVERLAY_STATE, R2_EVENT_PAGE_TURN, R2_EVENT_PAGE_TURN_RES,\n    R2_EVENT_READING_LOCATION, R2_EVENT_READIUMCSS, R2_EVENT_SCROLLTO, R2_EVENT_SHIFT_VIEW_X,\n    R2_EVENT_SHOW, R2_EVENT_TTS_CLICK_ENABLE, R2_EVENT_TTS_DO_NEXT, R2_EVENT_TTS_DO_PAUSE,\n    R2_EVENT_TTS_DO_PLAY, R2_EVENT_TTS_DO_PREVIOUS, R2_EVENT_TTS_DO_RESUME, R2_EVENT_TTS_DO_STOP,\n    R2_EVENT_TTS_OVERLAY_ENABLE, R2_EVENT_TTS_PLAYBACK_RATE, R2_EVENT_TTS_SENTENCE_DETECT_ENABLE,\n    R2_EVENT_TTS_VOICE, R2_EVENT_WEBVIEW_KEYDOWN, R2_EVENT_WEBVIEW_KEYUP,\n} from \"../../common/events\";\nimport { IHighlightDefinition } from \"../../common/highlight\";\nimport { IPaginationInfo } from \"../../common/pagination\";\nimport {\n    appendCSSInline, configureFixedLayout, injectDefaultCSS, injectReadPosCSS, isPaginated,\n} from \"../../common/readium-css-inject\";\nimport { sameSelections } from \"../../common/selection\";\nimport {\n    CLASS_PAGINATED, CSS_CLASS_NO_FOCUS_OUTLINE, HIDE_CURSOR_CLASS, LINK_TARGET_CLASS, LINK_TARGET_ALT_CLASS,\n    POPOUTIMAGE_CONTAINER_ID, POPUP_DIALOG_CLASS, POPUP_DIALOG_CLASS_COLLAPSE,\n    R2_MO_CLASS_ACTIVE, R2_MO_CLASS_ACTIVE_PLAYBACK, R2_MO_CLASS_PAUSED, R2_MO_CLASS_PLAYING, R2_MO_CLASS_STOPPED, ROOT_CLASS_INVISIBLE_MASK,\n    ROOT_CLASS_INVISIBLE_MASK_REMOVED, ROOT_CLASS_KEYBOARD_INTERACT, ROOT_CLASS_MATHJAX,\n    ROOT_CLASS_NO_FOOTNOTES, ROOT_CLASS_REDUCE_MOTION, SKIP_LINK_ID, TTS_CLASS_PAUSED, TTS_CLASS_PLAYING, TTS_ID_SPEAKING_DOC_ELEMENT,\n    WebViewSlotEnum, ZERO_TRANSFORM_CLASS, readPosCssStylesAttr1, readPosCssStylesAttr2,\n    readPosCssStylesAttr3, readPosCssStylesAttr4,\n    ID_HIGHLIGHTS_CONTAINER,\n} from \"../../common/styles\";\nimport { IPropertyAnimationState, animateProperty } from \"../common/animateProperty\";\nimport { uniqueCssSelector, FRAG_ID_CSS_SELECTOR } from \"../common/cssselector2-3\";\nimport { normalizeText } from \"../common/dom-text-utils\";\nimport { easings } from \"../common/easings\";\nimport { closePopupDialogs, isPopupDialogOpen } from \"../common/popup-dialog\";\nimport { getURLQueryParams } from \"../common/querystring\";\nimport { IRect, getClientRectsNoOverlap_ } from \"../common/rect-utils\";\nimport {\n    URL_PARAM_CLIPBOARD_INTERCEPT, URL_PARAM_CSS, URL_PARAM_DEBUG_VISUALS,\n    URL_PARAM_EPUBREADINGSYSTEM, URL_PARAM_GOTO, URL_PARAM_GOTO_DOM_RANGE, URL_PARAM_PREVIOUS,\n    URL_PARAM_SECOND_WEBVIEW, URL_PARAM_WEBVIEW_SLOT,\n} from \"../common/url-params\";\nimport { setupAudioBook } from \"./audiobook\";\nimport { INameVersion, setWindowNavigatorEpubReadingSystem } from \"./epubReadingSystem\";\nimport {\n    CLASS_HIGHLIGHT_AREA, CLASS_HIGHLIGHT_BOUNDING_AREA, CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN, CLASS_HIGHLIGHT_CONTAINER,\n    createHighlights, destroyAllhighlights, destroyHighlight,\n    recreateAllHighlights, recreateAllHighlightsRaw,\n} from \"./highlight\";\nimport { popoutImage } from \"./popoutImages\";\nimport { popupFootNote } from \"./popupFootNotes\";\nimport {\n    ttsNext, ttsPause, ttsPlay, ttsPlaybackRate, ttsPrevious, ttsResume, ttsStop, ttsVoice,\n} from \"./readaloud\";\nimport {\n    calculateColumnDimension, calculateMaxScrollShift, calculateTotalColumns, checkHiddenFootNotes,\n    computeVerticalRTL, getScrollingElement, isRTL, isTwoPageSpread, isVerticalWritingMode,\n    readiumCSS, clearImageZoomOutlineDebounced, clearImageZoomOutline,\n} from \"./readium-css\";\nimport { clearCurrentSelection, convertRangeInfo, getCurrentSelectionInfo } from \"./selection\";\nimport { ReadiumElectronWebviewWindow } from \"./state\";\n\nconst IS_DEV = (process.env.NODE_ENV === \"development\" || process.env.NODE_ENV === \"dev\");\n\n// import { consoleRedirect } from \"../common/console-redirect\";\nif (IS_DEV) {\n    // tslint:disable-next-line:no-var-requires\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    const cr = require(\"../common/console-redirect\");\n    // const releaseConsoleRedirect =\n    cr.consoleRedirect(\"r2:navigator#electron/renderer/webview/preload\", process.stdout, process.stderr, true);\n}\n\n// import { ENABLE_WEBVIEW_RESIZE } from \"../common/webview-resize\";\n\n// import { registerProtocol } from \"@r2-navigator-js/electron/renderer/common/protocol\";\n// registerProtocol();\n\nconst debug = debug_(\"r2:navigator#electron/renderer/webview/preload\");\n\nconst INJECTED_LINK_TXT = \"__\";\n\nconst win = global.window as ReadiumElectronWebviewWindow;\n\nwin.READIUM2 = {\n    DEBUG_VISUALS: false,\n    // dialogs = [],\n    fxlViewportHeight: 0,\n    fxlViewportScale: 1,\n    fxlViewportWidth: 0,\n    fxlZoomPercent: 0,\n    hashElement: null,\n    isAudio: false,\n    ignorekeyDownUpEvents: false,\n    isClipboardIntercept: false,\n    isFixedLayout: false,\n    locationHashOverride: undefined,\n    locationHashOverrideInfo: {\n        audioPlaybackInfo: undefined,\n        docInfo: undefined,\n        epubPage: undefined,\n        epubPageID: undefined,\n        headings: undefined,\n        href: \"\",\n        locations: {\n            cfi: undefined,\n            cssSelector: undefined,\n            position: undefined,\n            progression: undefined,\n        },\n        paginationInfo: undefined,\n        secondWebViewHref: undefined,\n        selectionInfo: undefined,\n        selectionIsNew: undefined,\n        title: undefined,\n        userInteract: false,\n    },\n    ttsClickEnabled: false,\n    ttsOverlayEnabled: false,\n    ttsPlaybackRate: 1,\n    ttsSkippabilityEnabled: false,\n    ttsSentenceDetectionEnabled: true,\n    ttsVoice: null,\n    urlQueryParams: win.location.search ? getURLQueryParams(win.location.search) : undefined,\n    webViewSlot: WebViewSlotEnum.center,\n};\n\n// const _winAlert = win.alert;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nwin.alert = (...args: any[]) => {\n    console.log.apply(win, args);\n};\n// const _winConfirm = win.confirm;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nwin.confirm = (...args: any[]): boolean => {\n    console.log.apply(win, args);\n    return false;\n};\n// const _winPrompt = win.prompt;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nwin.prompt = (...args: any[]): string => {\n    console.log.apply(win, args);\n    return \"\";\n};\n\n// CSS pixel tolerance margin to detect \"end of document reached\" (during \"next\" page turn / scroll)\n// This CSS bug is hard to reproduce consistently, only in Windows it seems, maybe due to display DPI?\n// (I observed different outcomes with Virtual Machines in various resolutions, versus hardware laptop/tablet)\nconst CSS_PIXEL_TOLERANCE = 5;\n\n// setTimeout(() => {\n//     if (win.alert) {\n//         win.alert(\"win.alert!\");\n//     }\n//     if (win.confirm) {\n//         const ok = win.confirm(\"win.confirm?\");\n//         console.log(ok);\n//     }\n//     // NOT SUPPORTED: fatal error in console.\n//     if (win.prompt) {\n//         const str = win.prompt(\"win.prompt:\");\n//         console.log(str);\n//     }\n// }, 2000);\n\nconst TOUCH_SWIPE_DELTA_MIN = 80;\nconst TOUCH_SWIPE_LONG_PRESS_MAX_TIME = 500;\nconst TOUCH_SWIPE_MAX_TIME = 500;\nlet touchstartEvent: TouchEvent | undefined;\nlet touchEventEnd: TouchEvent | undefined;\nwin.document.addEventListener(\n    \"touchstart\",\n    (event: TouchEvent) => {\n        if (isPopupDialogOpen(win.document)) {\n            touchstartEvent = undefined;\n            touchEventEnd = undefined;\n            return;\n        }\n        if (event.changedTouches.length !== 1) {\n            return;\n        }\n        touchstartEvent = event;\n    },\n    true,\n);\nwin.document.addEventListener(\n    \"touchend\",\n    (event: TouchEvent) => {\n        if (isPopupDialogOpen(win.document)) {\n            touchstartEvent = undefined;\n            touchEventEnd = undefined;\n            return;\n        }\n        if (event.changedTouches.length !== 1) {\n            return;\n        }\n        if (!touchstartEvent) {\n            return;\n        }\n\n        const startTouch = touchstartEvent.changedTouches[0];\n        const endTouch = event.changedTouches[0];\n\n        if (!startTouch || !endTouch) {\n            return;\n        }\n\n        const deltaX =\n            (startTouch.clientX - endTouch.clientX) / win.devicePixelRatio;\n        const deltaY =\n            (startTouch.clientY - endTouch.clientY) / win.devicePixelRatio;\n\n        if (\n            Math.abs(deltaX) < TOUCH_SWIPE_DELTA_MIN &&\n            Math.abs(deltaY) < TOUCH_SWIPE_DELTA_MIN\n        ) {\n            if (touchEventEnd) {\n                touchstartEvent = undefined;\n                touchEventEnd = undefined;\n                return;\n            }\n\n            if (\n                event.timeStamp - touchstartEvent.timeStamp >\n                TOUCH_SWIPE_LONG_PRESS_MAX_TIME\n            ) {\n                touchstartEvent = undefined;\n                touchEventEnd = undefined;\n                return;\n            }\n\n            touchstartEvent = undefined;\n            touchEventEnd = event;\n            return;\n        }\n\n        touchEventEnd = undefined;\n\n        if (\n            event.timeStamp - touchstartEvent.timeStamp >\n            TOUCH_SWIPE_MAX_TIME\n        ) {\n            touchstartEvent = undefined;\n            return;\n        }\n\n        const slope =\n            (startTouch.clientY - endTouch.clientY) /\n            (startTouch.clientX - endTouch.clientX);\n        if (Math.abs(slope) > 0.5) {\n            touchstartEvent = undefined;\n            return;\n        }\n\n        const rtl = isRTL();\n        if (deltaX < 0) {\n            // navLeftOrRight(!rtl);\n            // navPreviousOrNext(rtl)\n            const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n                // direction: rtl ? \"RTL\" : \"LTR\",\n                go: rtl ? \"PREVIOUS\" : \"NEXT\",\n                nav: true,\n            };\n            ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n        } else {\n            // navLeftOrRight(rtl);\n            // navPreviousOrNext(!rtl)\n            const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n                // direction: rtl ? \"RTL\" : \"LTR\",\n                go: rtl ? \"NEXT\" : \"PREVIOUS\",\n                nav: true,\n            };\n            ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n        }\n\n        touchstartEvent = undefined;\n    },\n    true,\n);\n\nfunction keyDownUpEventHandler(ev: KeyboardEvent, keyDown: boolean) {\n    if (win.READIUM2.ignorekeyDownUpEvents) {\n        return;\n    }\n    const elementName = (ev.target && (ev.target as Element).nodeName) ?\n        (ev.target as Element).nodeName : \"\";\n    const elementAttributes: { [name: string]: string } = {};\n    if (ev.target && (ev.target as Element).attributes) {\n        // tslint:disable-next-line: prefer-for-of\n        for (let i = 0; i < (ev.target as Element).attributes.length; i++) {\n            const attr = (ev.target as Element).attributes[i];\n            elementAttributes[attr.name] = attr.value;\n        }\n    }\n    const payload: IEventPayload_R2_EVENT_WEBVIEW_KEYDOWN = { // same as IEventPayload_R2_EVENT_WEBVIEW_KEYUP\n        altKey: ev.altKey,\n        code: ev.code,\n        ctrlKey: ev.ctrlKey,\n        elementAttributes,\n        elementName,\n        key: ev.key,\n        metaKey: ev.metaKey,\n        shiftKey: ev.shiftKey,\n    };\n    ipcRenderer.sendToHost(keyDown ? R2_EVENT_WEBVIEW_KEYDOWN : R2_EVENT_WEBVIEW_KEYUP, payload);\n}\nwin.document.addEventListener(\"keydown\", (ev: KeyboardEvent) => {\n    keyDownUpEventHandler(ev, true);\n}, {\n    capture: true,\n    once: false,\n    passive: false,\n});\nwin.document.addEventListener(\"keyup\", (ev: KeyboardEvent) => {\n    keyDownUpEventHandler(ev, false);\n}, {\n    capture: true,\n    once: false,\n    passive: false,\n});\n\nwin.READIUM2.isAudio = win.location.protocol === \"data:\";\n\nif (win.READIUM2.urlQueryParams) {\n    let readiumEpubReadingSystemJson: INameVersion | undefined;\n\n    // tslint:disable-next-line:no-string-literal\n    const base64EpubReadingSystem = win.READIUM2.urlQueryParams[URL_PARAM_EPUBREADINGSYSTEM];\n    if (base64EpubReadingSystem) {\n        try {\n            const str = Buffer.from(base64EpubReadingSystem, \"base64\").toString(\"utf8\");\n            readiumEpubReadingSystemJson = JSON.parse(str);\n        } catch (err) {\n            debug(err);\n        }\n    }\n\n    if (readiumEpubReadingSystemJson) {\n        setWindowNavigatorEpubReadingSystem(win, readiumEpubReadingSystemJson);\n    }\n\n    win.READIUM2.DEBUG_VISUALS = win.READIUM2.urlQueryParams[URL_PARAM_DEBUG_VISUALS] === \"true\";\n\n    win.READIUM2.isClipboardIntercept = win.READIUM2.urlQueryParams[URL_PARAM_CLIPBOARD_INTERCEPT] === \"true\";\n\n    win.READIUM2.webViewSlot =\n        win.READIUM2.urlQueryParams[URL_PARAM_WEBVIEW_SLOT] === \"left\" ? WebViewSlotEnum.left :\n            (win.READIUM2.urlQueryParams[URL_PARAM_WEBVIEW_SLOT] === \"right\" ? WebViewSlotEnum.right :\n                WebViewSlotEnum.center);\n}\n\nif (IS_DEV) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_DEBUG_VISUALS, (_event: any, payload: IEventPayload_R2_EVENT_DEBUG_VISUALS) => {\n        win.READIUM2.DEBUG_VISUALS = payload.debugVisuals;\n\n        if (!payload.debugVisuals) {\n            const existings = win.document.querySelectorAll(\n                // tslint:disable-next-line:max-line-length\n                `*[${readPosCssStylesAttr1}], *[${readPosCssStylesAttr2}], *[${readPosCssStylesAttr3}], *[${readPosCssStylesAttr4}]`);\n            existings.forEach((existing) => {\n                existing.removeAttribute(`${readPosCssStylesAttr1}`);\n                existing.removeAttribute(`${readPosCssStylesAttr2}`);\n                existing.removeAttribute(`${readPosCssStylesAttr3}`);\n                existing.removeAttribute(`${readPosCssStylesAttr4}`);\n            });\n            // destroyAllhighlights(win.document);\n        }\n        if (payload.cssClass) {\n            if (_blacklistIdClassForCssSelectors.indexOf(payload.cssClass) < 0) {\n                _blacklistIdClassForCssSelectors.push(payload.cssClass.toLowerCase());\n            }\n\n            if (payload.debugVisuals && payload.cssStyles && payload.cssStyles.length) {\n                const idSuffix = `debug_for_class_${payload.cssClass}`;\n                appendCSSInline(win.document, idSuffix, payload.cssStyles);\n\n                if (payload.cssSelector) {\n                    const toHighlights = win.document.querySelectorAll(payload.cssSelector);\n                    toHighlights.forEach((toHighlight) => {\n                        const clazz = `${payload.cssClass}`;\n                        if (!toHighlight.classList.contains(clazz)) {\n                            toHighlight.classList.add(clazz);\n                        }\n                    });\n                }\n            } else {\n                // const existings = win.document.querySelectorAll(payload.cssSelector);\n                const existings = win.document.querySelectorAll(`.${payload.cssClass}`);\n                existings.forEach((existing) => {\n                    existing.classList.remove(`${payload.cssClass}`);\n                });\n            }\n        }\n    });\n}\n\nfunction isVisible(allowPartial: boolean, element: Element, domRect: DOMRect | undefined): boolean {\n    if (win.READIUM2.isFixedLayout) {\n        return true;\n    } else if (!win.document || !win.document.documentElement || !win.document.body) {\n        return false;\n    }\n    if (element === win.document.body || element === win.document.documentElement) {\n        return true;\n    }\n\n    const blacklisted = checkBlacklisted(element);\n    if (blacklisted) {\n        return false;\n    }\n\n    const elStyle = win.getComputedStyle(element);\n    if (elStyle) {\n        const display = elStyle.getPropertyValue(\"display\");\n        if (display === \"none\") {\n            if (IS_DEV) {\n                debug(\"element DISPLAY NONE\");\n            }\n            // console.log(element.outerHTML);\n            return false;\n        }\n        // Cannot be relied upon, because web browser engine reports\n        // invisible when out of view in scrolled columns!!\n        // const visibility = elStyle.getPropertyValue(\"visibility\");\n        // if (visibility === \"hidden\") {\n        //     if (IS_DEV) {\n        //         console.log(\"element VISIBILITY HIDDEN\");\n        //     }\n        //     console.log(element.outerHTML);\n        //     return false;\n        // }\n        const opacity = elStyle.getPropertyValue(\"opacity\");\n        if (opacity === \"0\") {\n            if (IS_DEV) {\n                debug(\"element OPACITY ZERO\");\n            }\n            // console.log(element.outerHTML);\n            return false;\n        }\n    }\n\n    const scrollElement = getScrollingElement(win.document);\n\n    const vwm = isVerticalWritingMode();\n\n    if (!isPaginated(win.document)) { // scroll\n\n        const rect = domRect || element.getBoundingClientRect();\n        // debug(rect.top);\n        // debug(rect.left);\n        // debug(rect.width);\n        // debug(rect.height);\n\n        // let offset = 0;\n        // if (isVerticalWritingMode()) {\n        //     offset = ((isRTL() ? -1 : 1) * scrollElement.scrollLeft) + rect.left + (isRTL() ? rect.width : 0);\n        // } else {\n        //     offset = scrollElement.scrollTop + rect.top;\n        // }\n        // const progressionRatio = offset /\n        //     (isVerticalWritingMode() ? scrollElement.scrollWidth : scrollElement.scrollHeight);\n\n        if (vwm) {\n            if (\n                rect.left >= 0 &&\n                // (rect.left + rect.width) >= 0 &&\n                (rect.left + rect.width) <= win.document.documentElement.clientWidth\n                // rect.left <= win.document.documentElement.clientWidth\n            ) {\n                return true;\n            }\n            if (allowPartial && (rect.left >= 0 || (rect.left + rect.width) <= win.document.documentElement.clientWidth)) {\n                return true;\n            }\n        } else {\n            if (rect.top >= 0 &&\n                // (rect.top + rect.height) >= 0 &&\n                (rect.top + rect.height) <= win.document.documentElement.clientHeight\n                // rect.top <= win.document.documentElement.clientHeight\n            ) {\n                return true;\n            }\n            if (allowPartial && (rect.top >= 0 || (rect.top + rect.height) <= win.document.documentElement.clientWidth)) {\n                return true;\n            }\n        }\n\n        // tslint:disable-next-line:max-line-length\n        // debug(`isVisible FALSE: clientRect TOP: ${rect.top} -- win.document.documentElement.clientHeight: ${win.document.documentElement.clientHeight}`);\n        return false;\n    }\n\n    // TODO: vertical writing mode\n    if (vwm) {\n        return false;\n    }\n\n    const scrollLeftPotentiallyExcessive = getScrollOffsetIntoView(element as HTMLElement, domRect);\n\n    // const { maxScrollShift, maxScrollShiftAdjusted } = calculateMaxScrollShift();\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const extraShift = (scrollElement as any).scrollLeftExtra;\n    // extraShift === maxScrollShiftAdjusted - maxScrollShift\n\n    let currentOffset = scrollElement.scrollLeft;\n    if (extraShift) {\n        currentOffset += (((currentOffset < 0) ? -1 : 1) * extraShift);\n    }\n\n    if (scrollLeftPotentiallyExcessive >= (currentOffset - 10) &&\n        scrollLeftPotentiallyExcessive <= (currentOffset + 10)) {\n        return true;\n    }\n\n    // tslint:disable-next-line:max-line-length\n    // debug(`isVisible FALSE: getScrollOffsetIntoView: ${scrollLeftPotentiallyExcessive} -- scrollElement.scrollLeft: ${currentOffset}`);\n    return false;\n}\nfunction isVisible_(location: LocatorLocations): boolean {\n\n    let visible = false;\n    if (win.READIUM2.isAudio) {\n        visible = true;\n    } else if (win.READIUM2.isFixedLayout) {\n        visible = true;\n    } else if (!win.document || !win.document.documentElement || !win.document.body) {\n        visible = false;\n    } else if (!location || !location.cssSelector) {\n        visible = false;\n    } else {\n        // payload.location.cssSelector = payload.location.cssSelector.replace(/\\+/g, \" \");\n        let selected: Element | null = null;\n        try {\n            selected = win.document.querySelector(location.cssSelector);\n        } catch (err) {\n            debug(err);\n        }\n        if (selected) {\n            visible = isVisible(false, selected, undefined); // TODO: domRect of DOM Range in LocatorExtended?\n        }\n    }\n    return visible;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nipcRenderer.on(R2_EVENT_LOCATOR_VISIBLE, (_event: any, payload: IEventPayload_R2_EVENT_LOCATOR_VISIBLE) => {\n\n    payload.visible = isVisible_(payload.location);\n    ipcRenderer.sendToHost(R2_EVENT_LOCATOR_VISIBLE, payload);\n});\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nipcRenderer.on(R2_EVENT_SCROLLTO, (_event: any, payload: IEventPayload_R2_EVENT_SCROLLTO) => {\n\n    if (win.READIUM2.isAudio) {\n        return;\n    }\n\n    showHideContentMask(false, win.READIUM2.isFixedLayout);\n\n    clearCurrentSelection(win);\n    closePopupDialogs(win.document);\n\n    // _cancelInitialScrollCheck = true;\n\n    if (!win.READIUM2.urlQueryParams) {\n        win.READIUM2.urlQueryParams = {};\n    }\n    if (payload.isSecondWebView) {\n        win.READIUM2.urlQueryParams[URL_PARAM_SECOND_WEBVIEW] = \"1\";\n    } else {\n        win.READIUM2.urlQueryParams[URL_PARAM_SECOND_WEBVIEW] = \"0\";\n    }\n    if (payload.previous) {\n        // tslint:disable-next-line:no-string-literal\n        win.READIUM2.urlQueryParams[URL_PARAM_PREVIOUS] = \"true\";\n    } else {\n        // tslint:disable-next-line:no-string-literal\n        if (typeof win.READIUM2.urlQueryParams[URL_PARAM_PREVIOUS] !== \"undefined\") {\n            // tslint:disable-next-line:no-string-literal\n            delete win.READIUM2.urlQueryParams[URL_PARAM_PREVIOUS];\n        }\n    }\n    if (payload.goto) {\n        // tslint:disable-next-line:no-string-literal\n        win.READIUM2.urlQueryParams[URL_PARAM_GOTO] = payload.goto; // decodeURIComponent\n    } else {\n        // tslint:disable-next-line:no-string-literal\n        if (typeof win.READIUM2.urlQueryParams[URL_PARAM_GOTO] !== \"undefined\") {\n            // tslint:disable-next-line:no-string-literal\n            delete win.READIUM2.urlQueryParams[URL_PARAM_GOTO];\n        }\n    }\n    if (payload.gotoDomRange) {\n        // tslint:disable-next-line:no-string-literal\n        win.READIUM2.urlQueryParams[URL_PARAM_GOTO_DOM_RANGE] = payload.gotoDomRange; // decodeURIComponent\n    } else {\n        // tslint:disable-next-line:no-string-literal\n        if (typeof win.READIUM2.urlQueryParams[URL_PARAM_GOTO_DOM_RANGE] !== \"undefined\") {\n            // tslint:disable-next-line:no-string-literal\n            delete win.READIUM2.urlQueryParams[URL_PARAM_GOTO_DOM_RANGE];\n        }\n    }\n\n    if (win.READIUM2.isFixedLayout) {\n        win.READIUM2.locationHashOverride = win.document.body;\n        resetLocationHashOverrideInfo();\n\n        debug(\"processXYRaw BODY\");\n        const x = (isRTL() ? win.document.documentElement.offsetWidth - 1 : 0);\n        processXYRaw(x, 0, false);\n\n        notifyReadingLocationDebounced();\n        return;\n    }\n\n    let delayScrollIntoView = false;\n    if (payload.hash) {\n        debug(\".hashElement = 1\");\n        win.READIUM2.hashElement = win.document.getElementById(payload.hash);\n        if (win.READIUM2.DEBUG_VISUALS) {\n            if (win.READIUM2.hashElement) {\n                // const existings = win.document.querySelectorAll(`*[${readPosCssStylesAttr1}]`);\n                // existings.forEach((existing) => {\n                //     existing.removeAttribute(`${readPosCssStylesAttr1}`);\n                // });\n                win.READIUM2.hashElement.setAttribute(readPosCssStylesAttr1, \"R2_EVENT_SCROLLTO hashElement\");\n            }\n        }\n\n        win.location.href = \"#\" + payload.hash;\n        delayScrollIntoView = true;\n\n        // unfortunately, does not sync CSS :target pseudo-class :(\n        // win.history.replaceState({}, undefined, \"#\" + payload.hash);\n    } else {\n        const scrollElement = getScrollingElement(win.document);\n        const scrollTop = scrollElement.scrollTop;\n        const scrollLeft = scrollElement.scrollLeft;\n        win.location.href = \"#\";\n        delayScrollIntoView = true;\n        setTimeout(() => {\n            debug(\"location HREF # hash, reset scroll left/top: \", scrollTop, scrollLeft);\n            scrollElement.scrollTop = scrollTop;\n            scrollElement.scrollLeft = scrollLeft;\n        }, 0);\n        win.READIUM2.hashElement = null;\n    }\n\n    win.READIUM2.locationHashOverride = undefined;\n    resetLocationHashOverrideInfo();\n\n    if (delayScrollIntoView) {\n        setTimeout(() => {\n            debug(\"++++ scrollToHashRaw FROM DELAYED SCROLL_TO\");\n            scrollToHashRaw(false, true);\n        }, 100);\n    } else {\n        debug(\"++++ scrollToHashRaw FROM SCROLL_TO\");\n        scrollToHashRaw(false, true);\n    }\n});\n\nfunction resetLocationHashOverrideInfo() {\n    win.READIUM2.locationHashOverrideInfo = {\n        audioPlaybackInfo: undefined,\n        docInfo: undefined,\n        epubPage: undefined,\n        epubPageID: undefined,\n        headings: undefined,\n        href: \"\",\n        locations: {\n            cfi: undefined,\n            cssSelector: undefined,\n            position: undefined,\n            progression: undefined,\n        },\n        paginationInfo: undefined,\n        secondWebViewHref: undefined,\n        selectionInfo: undefined,\n        selectionIsNew: undefined,\n        title: undefined,\n        userInteract: false,\n    };\n}\n\nlet _lastAnimState: IPropertyAnimationState | undefined;\n\nfunction elementCapturesKeyboardArrowKeys(target: Element): boolean {\n\n    let curElement: Node | null = target;\n    while (curElement && curElement.nodeType === Node.ELEMENT_NODE) {\n\n        const editable = (curElement as Element).getAttribute(\"contenteditable\");\n        if (editable) {\n            return true;\n        }\n\n        const arrayOfKeyboardCaptureElements = [\"input\", \"textarea\", \"video\", \"audio\", \"select\"];\n        if (arrayOfKeyboardCaptureElements.indexOf((curElement as Element).tagName.toLowerCase()) >= 0) {\n            return true;\n        }\n\n        curElement = curElement.parentNode;\n    }\n\n    return false;\n}\n\nfunction ensureTwoPageSpreadWithOddColumnsIsOffsetTempDisable(): number {\n\n    const scrollElement = getScrollingElement(win.document);\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const val = (scrollElement as any).scrollLeftExtra;\n    if (val === 0) {\n        return 0;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (scrollElement as any).scrollLeftExtra = 0;\n    ipcRenderer.sendToHost(R2_EVENT_SHIFT_VIEW_X,\n        { offset: 0, backgroundColor: undefined } as IEventPayload_R2_EVENT_SHIFT_VIEW_X);\n    return val;\n}\nfunction ensureTwoPageSpreadWithOddColumnsIsOffsetReEnable(scrollLeftExtra: number) {\n\n    const scrollElement = getScrollingElement(win.document);\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (scrollElement as any).scrollLeftExtra = scrollLeftExtra;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const scrollLeftExtraBackgroundColor = (scrollElement as any).scrollLeftExtraBackgroundColor;\n\n    ipcRenderer.sendToHost(R2_EVENT_SHIFT_VIEW_X,\n        {\n            backgroundColor: scrollLeftExtraBackgroundColor ? scrollLeftExtraBackgroundColor : undefined,\n            offset: (isRTL() ? 1 : -1) * scrollLeftExtra,\n        } as IEventPayload_R2_EVENT_SHIFT_VIEW_X);\n}\n\nfunction ensureTwoPageSpreadWithOddColumnsIsOffset(scrollOffset: number, maxScrollShift: number) {\n\n    if (!win || !win.document || !win.document.body || !win.document.documentElement) {\n        return;\n    }\n\n    const scrollElement = getScrollingElement(win.document);\n\n    let dialogPopup = isPopupDialogOpen(win.document);\n    if (dialogPopup) {\n        const diagEl = win.document.getElementById(POPUP_DIALOG_CLASS);\n        if (diagEl) {\n            const isCollapsed = diagEl.classList.contains(POPUP_DIALOG_CLASS_COLLAPSE);\n            if (isCollapsed) {\n                dialogPopup = false; // override\n            }\n        }\n    }\n\n    const noChange = dialogPopup ||\n        !isPaginated(win.document) ||\n        !isTwoPageSpread() ||\n        isVerticalWritingMode() || // TODO: VWM?\n        maxScrollShift <= 0 ||\n        Math.abs(scrollOffset) <= maxScrollShift;\n    if (noChange) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (scrollElement as any).scrollLeftExtra = 0;\n\n        // console.log(`\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" noChange: ${maxScrollShift}`);\n        // win.document.documentElement.classList.remove(\"r2-spread-offset\");\n        ipcRenderer.sendToHost(R2_EVENT_SHIFT_VIEW_X,\n            { offset: 0, backgroundColor: undefined } as IEventPayload_R2_EVENT_SHIFT_VIEW_X);\n        return;\n    }\n    // scrollElement.scrollLeft is maxed-out, we need to simulate further scrolling\n    // isRTL() == val < 0\n    const extraOffset = Math.abs(scrollOffset) - maxScrollShift;\n    // console.log(`\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" shiftOffset: ${extraOffset}`);\n    // win.document.documentElement.style.setProperty(\"--r2-spread-offset\", `-${shiftOffset}px`);\n    // win.document.documentElement.classList.add(\"r2-spread-offset\");\n    // if (isRTL()) {\n    //     win.document.documentElement.classList.add(\"r2-rtl\");\n    // } else {\n    //     win.document.documentElement.classList.remove(\"r2-rtl\");\n    // }\n\n    // const backgroundColor = win.document.documentElement.style.backgroundColor ?\n    //     win.document.documentElement.style.backgroundColor : win.document.body.style.backgroundColor;\n\n    let backgroundColor: string | undefined;\n    const docStyle = win.getComputedStyle(win.document.documentElement);\n    if (docStyle) {\n        backgroundColor = docStyle.getPropertyValue(\"background-color\");\n    }\n    if (!backgroundColor || backgroundColor === \"transparent\") {\n        const bodyStyle = win.getComputedStyle(win.document.body);\n        backgroundColor = bodyStyle.getPropertyValue(\"background-color\");\n        if (backgroundColor === \"transparent\") {\n            backgroundColor = undefined;\n        }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (scrollElement as any).scrollLeftExtra = extraOffset;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (scrollElement as any).scrollLeftExtraBackgroundColor = backgroundColor;\n\n    ipcRenderer.sendToHost(R2_EVENT_SHIFT_VIEW_X,\n        {\n            backgroundColor: backgroundColor ? backgroundColor : undefined,\n            offset: (isRTL() ? 1 : -1) * extraOffset,\n        } as IEventPayload_R2_EVENT_SHIFT_VIEW_X);\n}\n\nfunction onEventPageTurn(payload: IEventPayload_R2_EVENT_PAGE_TURN) {\n\n    let leftRightKeyWasUsedInsideKeyboardCapture = false;\n    if (win.document.activeElement &&\n        elementCapturesKeyboardArrowKeys(win.document.activeElement)) {\n\n        if (win.document.hasFocus()) {\n            leftRightKeyWasUsedInsideKeyboardCapture = true;\n        } else {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const oldDate = (win.document.activeElement as any).r2_leftrightKeyboardTimeStamp;\n            if (oldDate) {\n                const newDate = new Date();\n                const msDiff = newDate.getTime() - oldDate.getTime();\n                if (msDiff <= 300) {\n                    leftRightKeyWasUsedInsideKeyboardCapture = true;\n                }\n            }\n        }\n    }\n    if (leftRightKeyWasUsedInsideKeyboardCapture) {\n        return;\n    }\n\n    clearCurrentSelection(win);\n    closePopupDialogs(win.document);\n\n    if (win.READIUM2.isAudio || win.READIUM2.isFixedLayout || !win.document.body) {\n        ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n        return;\n    }\n\n    if (!win.document || !win.document.documentElement) {\n        return;\n    }\n\n    const scrollElement = getScrollingElement(win.document);\n\n    const reduceMotion = win.document.documentElement.classList.contains(ROOT_CLASS_REDUCE_MOTION);\n\n    const isPaged = isPaginated(win.document);\n\n    const goPREVIOUS = payload.go === \"PREVIOUS\"; // any other value is NEXT\n\n    const animationTime = 300;\n\n    if (_lastAnimState && _lastAnimState.animating) {\n        win.cancelAnimationFrame(_lastAnimState.id);\n        _lastAnimState.object[_lastAnimState.property] = _lastAnimState.destVal;\n    }\n\n    const vwm = isVerticalWritingMode();\n\n    if (!goPREVIOUS) { // goPREVIOUS && isRTL() || !goPREVIOUS && !isRTL()) { // right\n\n        const maxScrollShift = calculateMaxScrollShift().maxScrollShift;\n        const maxScrollShiftTolerated = maxScrollShift - CSS_PIXEL_TOLERANCE;\n\n        if (isPaged) {\n            const unit = vwm ?\n                win.document.documentElement.offsetHeight :\n                win.document.documentElement.offsetWidth;\n            let scrollElementOffset = Math.round(vwm ?\n                scrollElement.scrollTop :\n                scrollElement.scrollLeft);\n            const isNegative = scrollElementOffset < 0;\n            const scrollElementOffsetAbs = Math.abs(scrollElementOffset);\n            const fractional = scrollElementOffsetAbs / unit;\n            const integral = Math.floor(fractional);\n            const decimal = fractional - integral;\n            const partial = decimal * unit;\n            if (partial <= CSS_PIXEL_TOLERANCE) {\n                scrollElementOffset = (isNegative ? -1 : 1) * integral * unit;\n            } else if (partial >= (unit - CSS_PIXEL_TOLERANCE)) {\n                scrollElementOffset = (isNegative ? -1 : 1) * (integral + 1) * unit;\n            }\n            if (vwm && (scrollElementOffsetAbs < maxScrollShiftTolerated) ||\n                !vwm && (scrollElementOffsetAbs < maxScrollShiftTolerated)) {\n\n                const scrollOffsetPotentiallyExcessive_ = vwm ?\n                    (scrollElementOffset + unit) :\n                    (scrollElementOffset + (isRTL() ? -1 : 1) * unit);\n                // now snap (just in case):\n                const nWholes = Math.floor(scrollOffsetPotentiallyExcessive_ / unit); // retains +/- sign\n                const scrollOffsetPotentiallyExcessive = nWholes * unit;\n                // if (scrollOffsetPotentiallyExcessive !== scrollOffsetPotentiallyExcessive_) {\n                // tslint:disable-next-line:max-line-length\n                //     console.log(`}}}}}}}}}}}}}}}}1 offset!! ${scrollOffsetPotentiallyExcessive} != ${scrollOffsetPotentiallyExcessive_}`);\n                // }\n\n                // if (Math.abs(scrollOffsetPotentiallyExcessive) > maxScrollShift) {\n                //     console.log(\"onEventPageTurn scrollOffset EXCESS\");\n                // }\n                // tslint:disable-next-line:max-line-length\n                ensureTwoPageSpreadWithOddColumnsIsOffset(scrollOffsetPotentiallyExcessive, maxScrollShift);\n\n                const scrollOffset = (scrollOffsetPotentiallyExcessive < 0 ? -1 : 1) *\n                    Math.min(Math.abs(scrollOffsetPotentiallyExcessive), maxScrollShift);\n\n                const targetObj = scrollElement;\n                const targetProp = vwm ? \"scrollTop\" : \"scrollLeft\";\n                if (reduceMotion) {\n                    _lastAnimState = undefined;\n                    targetObj[targetProp] = scrollOffset;\n                } else {\n                    _ignoreScrollEvent = true;\n                    // _lastAnimState = undefined;\n                    // (targetObj as HTMLElement).style.transition = \"\";\n                    // (targetObj as HTMLElement).style.transform = \"none\";\n                    // (targetObj as HTMLElement).style.transition =\n                    //     `transform ${animationTime}ms ease-in-out 0s`;\n                    // (targetObj as HTMLElement).style.transform =\n                    //     vwm ?\n                    //     `translateY(${unit}px)` :\n                    //     `translateX(${(isRTL() ? -1 : 1) * unit}px)`;\n                    // setTimeout(() => {\n                    //     (targetObj as HTMLElement).style.transition = \"\";\n                    //     (targetObj as HTMLElement).style.transform = \"none\";\n                    //     targetObj[targetProp] = scrollOffset;\n                    // }, animationTime);\n                    _lastAnimState = animateProperty(\n                        win.cancelAnimationFrame,\n                        // undefined,\n                        (_cancelled: boolean) => {\n                            // debug(cancelled);\n                            _ignoreScrollEvent = false;\n                            onScrollDebounced();\n                        },\n                        targetProp,\n                        animationTime,\n                        targetObj,\n                        scrollOffset,\n                        win.requestAnimationFrame,\n                        easings.easeInOutQuad,\n                    );\n                }\n                payload.go = \"\";\n                // payload.direction = \"\";\n                ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n                return;\n            }\n        } else {\n            if (vwm && (Math.abs(scrollElement.scrollLeft) < (maxScrollShiftTolerated - CSS_PIXEL_TOLERANCE)) ||\n                !vwm && (Math.abs(scrollElement.scrollTop) < (maxScrollShiftTolerated - CSS_PIXEL_TOLERANCE))) {\n                const newVal = vwm ?\n                    (scrollElement.scrollLeft + (isRTL() ? -1 : 1) * win.document.documentElement.clientWidth) :\n                    (scrollElement.scrollTop + win.document.documentElement.clientHeight);\n\n                const targetObj = scrollElement;\n                const targetProp = vwm ? \"scrollLeft\" : \"scrollTop\";\n                if (reduceMotion) {\n                    _lastAnimState = undefined;\n                    targetObj[targetProp] = newVal;\n                } else {\n                    _ignoreScrollEvent = true;\n                    _lastAnimState = animateProperty(\n                        win.cancelAnimationFrame,\n                        // undefined,\n                        (_cancelled: boolean) => {\n                            // debug(cancelled);\n                            _ignoreScrollEvent = false;\n                            onScrollDebounced();\n                        },\n                        targetProp,\n                        animationTime,\n                        targetObj,\n                        newVal,\n                        win.requestAnimationFrame,\n                        easings.easeInOutQuad,\n                    );\n                }\n                payload.go = \"\";\n                // payload.direction = \"\";\n                ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n                return;\n            }\n        }\n    } else if (goPREVIOUS) { //  && !isRTL() || !goPREVIOUS && isRTL()) { // left\n        if (isPaged) {\n            const unit = vwm ?\n                win.document.documentElement.offsetHeight :\n                win.document.documentElement.offsetWidth;\n            let scrollElementOffset = Math.round(vwm ?\n                scrollElement.scrollTop :\n                scrollElement.scrollLeft);\n            const isNegative = scrollElementOffset < 0;\n            const scrollElementOffsetAbs = Math.abs(scrollElementOffset);\n            const fractional = scrollElementOffsetAbs / unit;\n            const integral = Math.floor(fractional);\n            const decimal = fractional - integral;\n            const partial = decimal * unit;\n            if (partial <= CSS_PIXEL_TOLERANCE) {\n                scrollElementOffset = (isNegative ? -1 : 1) * integral * unit;\n            } else if (partial >= (unit - CSS_PIXEL_TOLERANCE)) {\n                scrollElementOffset = (isNegative ? -1 : 1) * (integral + 1) * unit;\n            }\n            if (vwm && (scrollElementOffsetAbs > 0) ||\n                !vwm && (scrollElementOffsetAbs > 0)) {\n\n                const scrollOffset_ = vwm ?\n                    (scrollElementOffset - unit) :\n                    (scrollElementOffset - (isRTL() ? -1 : 1) * unit);\n                // now snap (just in case):\n                // retains +/- sign\n                const nWholes = isRTL() ? Math.floor(scrollOffset_ / unit) : Math.ceil(scrollOffset_ / unit);\n                const scrollOffset = nWholes * unit;\n                // if (scrollOffset !== scrollOffset_) {\n                //     // tslint:disable-next-line:max-line-length\n                //     console.log(`}}}}}}}}}}}}}}}}2 offset!! ${scrollOffset} != ${scrollOffset_}`);\n                // }\n\n                // zero reset\n                ensureTwoPageSpreadWithOddColumnsIsOffset(scrollOffset, 0);\n\n                const targetObj = scrollElement;\n                const targetProp = vwm ? \"scrollTop\" : \"scrollLeft\";\n                if (reduceMotion) {\n                    _lastAnimState = undefined;\n                    targetObj[targetProp] = scrollOffset;\n                } else {\n                    _ignoreScrollEvent = true;\n                    _lastAnimState = animateProperty(\n                        win.cancelAnimationFrame,\n                        // undefined,\n                        (_cancelled: boolean) => {\n                            // debug(cancelled);\n                            _ignoreScrollEvent = false;\n                            onScrollDebounced();\n                        },\n                        targetProp,\n                        animationTime,\n                        targetObj,\n                        scrollOffset,\n                        win.requestAnimationFrame,\n                        easings.easeInOutQuad,\n                    );\n                }\n                payload.go = \"\";\n                // payload.direction = \"\";\n                ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n                return;\n            }\n        } else {\n            if (vwm && (Math.abs(scrollElement.scrollLeft) > CSS_PIXEL_TOLERANCE) ||\n                !vwm && (Math.abs(scrollElement.scrollTop) > CSS_PIXEL_TOLERANCE)) {\n                const newVal = vwm ?\n                    (scrollElement.scrollLeft - (isRTL() ? -1 : 1) * win.document.documentElement.clientWidth) :\n                    (scrollElement.scrollTop - win.document.documentElement.clientHeight);\n\n                const targetObj = scrollElement;\n                const targetProp = vwm ? \"scrollLeft\" : \"scrollTop\";\n                if (reduceMotion) {\n                    _lastAnimState = undefined;\n                    targetObj[targetProp] = newVal;\n                } else {\n                    _ignoreScrollEvent = true;\n                    _lastAnimState = animateProperty(\n                        win.cancelAnimationFrame,\n                        // undefined,\n                        (_cancelled: boolean) => {\n                            // debug(cancelled);\n                            _ignoreScrollEvent = false;\n                            onScrollDebounced();\n                        },\n                        targetProp,\n                        animationTime,\n                        targetObj,\n                        newVal,\n                        win.requestAnimationFrame,\n                        easings.easeInOutQuad,\n                    );\n                }\n                payload.go = \"\";\n                // payload.direction = \"\";\n                ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n                return;\n            }\n        }\n    }\n\n    ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nipcRenderer.on(R2_EVENT_PAGE_TURN, (_event: any, payload: IEventPayload_R2_EVENT_PAGE_TURN) => {\n    // Because 'r2_leftrightKeyboardTimeStamp' is set AFTER the main window left/right keyboard handler!\n    setTimeout(() => { // we could debounce too?\n        onEventPageTurn(payload);\n    }, 100);\n});\n\nfunction focusElement(element: Element) {\n\n    if (element === win.document.body) {\n        const attr = (element as HTMLElement).getAttribute(\"tabindex\");\n        if (!attr) {\n            (element as HTMLElement).setAttribute(\"tabindex\", \"-1\");\n            (element as HTMLElement).classList.add(CSS_CLASS_NO_FOCUS_OUTLINE);\n            if (IS_DEV) {\n                debug(\"tabindex -1 set BODY (focusable):\");\n                debug(getCssSelector(element));\n            }\n        }\n        (element as HTMLElement).focus({preventScroll: true});\n    } else {\n        (element as HTMLElement).focus();\n    }\n\n    // win.blur();\n    // win.focus();\n    // const payload: IEventPayload_R2_EVENT_KEYBOARD_FOCUS_REQUEST = {\n    // };\n    ipcRenderer.sendToHost(R2_EVENT_KEYBOARD_FOCUS_REQUEST, null);\n    if (IS_DEV) {\n        debug(\"KEYBOARD FOCUS REQUEST (1) \", getCssSelector(element));\n    }\n}\n\nconst tempLinkTargetOutline = (element: Element, time: number, alt: boolean) => {\n    let skip = false;\n    const targets = win.document.querySelectorAll(`.${LINK_TARGET_CLASS}`);\n    targets.forEach((t) => {\n        if (alt && !t.classList.contains(LINK_TARGET_ALT_CLASS)) {\n            skip = true;\n            return;\n        }\n        // (t as HTMLElement).style.animationPlayState = \"paused\";\n        t.classList.remove(LINK_TARGET_CLASS);\n        t.classList.remove(LINK_TARGET_ALT_CLASS);\n    });\n    if (skip) {\n        return;\n    }\n\n    (element as HTMLElement).style.animation = \"none\";\n    // trigger layout to restart animation\n    // tslint:disable-next-line: no-unused-expression\n    void (element as HTMLElement).offsetWidth;\n    (element as HTMLElement).style.animation = \"\";\n\n    element.classList.add(LINK_TARGET_CLASS);\n    if (alt) {\n        element.classList.add(LINK_TARGET_ALT_CLASS);\n    }\n\n    // (element as HTMLElement).style.animationPlayState = \"running\";\n\n    // if (!(element as any)._TargetAnimationEnd) {\n    //     (element as any)._TargetAnimationEnd = (ev: Event) => {\n    //         debug(\"ANIMATION END\");\n    //         (ev.target as HTMLElement).style.animationPlayState = \"paused\";\n    //     };\n    //     element.addEventListener(\"animationEnd\", (element as any)._TargetAnimationEnd);\n    // }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    if ((element as any)._timeoutTargetClass) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        clearTimeout((element as any)._timeoutTargetClass);\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (element as any)._timeoutTargetClass = undefined;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (element as any)._timeoutTargetClass = setTimeout(() => {\n        debug(\"ANIMATION TIMEOUT REMOVE\");\n        // (element as HTMLElement).style.animationPlayState = \"paused\";\n        element.classList.remove(LINK_TARGET_CLASS);\n        element.classList.remove(LINK_TARGET_ALT_CLASS);\n    }, time);\n};\n\nlet _lastAnimState2: IPropertyAnimationState | undefined;\nconst animationTime2 = 400;\n\nfunction scrollElementIntoView(element: Element, doFocus: boolean, animate: boolean, domRect: DOMRect | undefined) {\n\n    if (win.READIUM2.DEBUG_VISUALS) {\n        const existings = win.document.querySelectorAll(`*[${readPosCssStylesAttr3}]`);\n        existings.forEach((existing) => {\n            existing.removeAttribute(`${readPosCssStylesAttr3}`);\n        });\n        element.setAttribute(readPosCssStylesAttr3, \"scrollElementIntoView\");\n    }\n    if (win.READIUM2.isFixedLayout) {\n        debug(\"scrollElementIntoView_ SKIP FXL\");\n        return;\n    }\n\n    if (doFocus) {\n        // const tabbables = lazyTabbables();\n        if (!domRect && !isFocusable(element as HTMLElement)) {\n            const attr = (element as HTMLElement).getAttribute(\"tabindex\");\n            if (!attr) {\n                (element as HTMLElement).setAttribute(\"tabindex\", \"-1\");\n                (element as HTMLElement).classList.add(CSS_CLASS_NO_FOCUS_OUTLINE);\n                if (IS_DEV) {\n                    debug(\"tabindex -1 set (focusable):\");\n                    debug(getCssSelector(element));\n                }\n            }\n        }\n\n        tempLinkTargetOutline(element, 2000, false);\n\n        if (!domRect) {\n            focusElement(element);\n        }\n    }\n\n    setTimeout(() => {\n        const isPaged = isPaginated(win.document);\n        if (isPaged) {\n            scrollIntoView(element as HTMLElement, domRect);\n        } else {\n            const scrollElement = getScrollingElement(win.document);\n            const rect = domRect || element.getBoundingClientRect();\n            // calculateMaxScrollShift()\n\n            if (isVisible(false, element, domRect)) {\n                console.log(\"scrollElementIntoView already visible\");\n            } else {\n                const vwm = isVerticalWritingMode();\n                const scrollTopMax = vwm ?\n                    (isRTL() ? -1 : 1) * (scrollElement.scrollWidth - win.document.documentElement.clientWidth) :\n                    scrollElement.scrollHeight - win.document.documentElement.clientHeight;\n\n                let offset = vwm ?\n                    scrollElement.scrollLeft + (rect.left - (win.document.documentElement.clientWidth / 2)) :\n                    scrollElement.scrollTop + (rect.top - (win.document.documentElement.clientHeight / 2));\n\n                if (vwm && isRTL()) {\n                    if (offset < scrollTopMax) {\n                        offset = scrollTopMax;\n                    } else if (offset > 0) {\n                        offset = 0;\n                    }\n                } else {\n                    if (offset > scrollTopMax) {\n                        offset = scrollTopMax;\n                    } else if (offset < 0) {\n                        offset = 0;\n                    }\n                }\n\n                const diff = Math.abs((vwm ? scrollElement.scrollLeft : scrollElement.scrollTop) - offset);\n                if (diff < 10) {\n                    return; // prevents jittering\n                }\n\n                const targetProp = vwm ? \"scrollLeft\" : \"scrollTop\";\n                if (animate) {\n                    const reduceMotion = win.document.documentElement.classList.contains(ROOT_CLASS_REDUCE_MOTION);\n\n                    if (_lastAnimState2 && _lastAnimState2.animating) {\n                        win.cancelAnimationFrame(_lastAnimState2.id);\n                        _lastAnimState2.object[_lastAnimState2.property] = _lastAnimState2.destVal;\n                    }\n\n                    // scrollElement.scrollTop = offset;\n                    const targetObj = scrollElement;\n                    if (reduceMotion) {\n                        _lastAnimState2 = undefined;\n                        targetObj[targetProp] = offset;\n                    } else {\n                        _ignoreScrollEvent = true;\n                        // _lastAnimState = undefined;\n                        // (targetObj as HTMLElement).style.transition = \"\";\n                        // (targetObj as HTMLElement).style.transform = \"none\";\n                        // (targetObj as HTMLElement).style.transition =\n                        //     `transform ${animationTime}ms ease-in-out 0s`;\n                        // (targetObj as HTMLElement).style.transform =\n                        //     isVerticalWritingMode() ?\n                        //     `translateY(${unit}px)` :\n                        //     `translateX(${(isRTL() ? -1 : 1) * unit}px)`;\n                        // setTimeout(() => {\n                        //     (targetObj as HTMLElement).style.transition = \"\";\n                        //     (targetObj as HTMLElement).style.transform = \"none\";\n                        //     targetObj[targetProp] = offset;\n                        // }, animationTime);\n                        _lastAnimState2 = animateProperty(\n                            win.cancelAnimationFrame,\n                            // undefined,\n                            (_cancelled: boolean) => {\n                                // debug(cancelled);\n                                _ignoreScrollEvent = false;\n                                onScrollDebounced();\n                            },\n                            targetProp,\n                            animationTime2,\n                            targetObj,\n                            offset,\n                            win.requestAnimationFrame,\n                            easings.easeInOutQuad,\n                        );\n                    }\n                } else {\n                    scrollElement[targetProp] = offset;\n                }\n\n                // element.scrollIntoView({\n                //     // TypeScript lib.dom.d.ts difference in 3.2.1\n                //     // ScrollBehavior = \"auto\" | \"instant\" | \"smooth\" VS ScrollBehavior = \"auto\" | \"smooth\"\n                //     behavior: \"auto\",\n                //     // ScrollLogicalPosition = \"start\" | \"center\" | \"end\" | \"nearest\"\n                //     block: \"center\",\n                //     // ScrollLogicalPosition = \"start\" | \"center\" | \"end\" | \"nearest\"\n                //     inline: \"nearest\",\n                // } as ScrollIntoViewOptions);\n            }\n        }\n    }, doFocus ? 100 : 0);\n}\n\n// TODO: vertical writing mode\nfunction getScrollOffsetIntoView(element: HTMLElement, domRect: DOMRect | undefined): number {\n    if (!win.document || !win.document.documentElement || !win.document.body ||\n        !isPaginated(win.document) || isVerticalWritingMode()) {\n        return 0;\n    }\n\n    const scrollElement = getScrollingElement(win.document);\n\n    const rect = domRect || element.getBoundingClientRect();\n\n    const columnDimension = calculateColumnDimension();\n\n    const isTwoPage = isTwoPageSpread();\n\n    const fullOffset = (isRTL() ?\n        ((columnDimension * (isTwoPage ? 2 : 1)) - (rect.left + rect.width)) :\n        rect.left) +\n        ((isRTL() ? -1 : 1) * scrollElement.scrollLeft);\n\n    const columnIndex = Math.floor(fullOffset / columnDimension); // 0-based index\n\n    const spreadIndex = isTwoPage ? Math.floor(columnIndex / 2) : columnIndex; // 0-based index\n\n    return (isRTL() ? -1 : 1) *\n        (spreadIndex * (columnDimension * (isTwoPage ? 2 : 1)));\n}\n\n// TODO: vertical writing mode\nfunction scrollIntoView(element: HTMLElement, domRect: DOMRect | undefined) {\n    if (!win.document || !win.document.documentElement || !win.document.body || !isPaginated(win.document)) {\n        return;\n    }\n    const maxScrollShift = calculateMaxScrollShift().maxScrollShift;\n    const scrollLeftPotentiallyExcessive = getScrollOffsetIntoView(element, domRect);\n    // if (Math.abs(scrollLeftPotentiallyExcessive) > maxScrollShift) {\n    //     console.log(\"getScrollOffsetIntoView scrollLeft EXCESS\");\n    // }\n    ensureTwoPageSpreadWithOddColumnsIsOffset(scrollLeftPotentiallyExcessive, maxScrollShift);\n\n    const scrollElement = getScrollingElement(win.document);\n\n    // scrollLeft is capped at maxScrollShift by the browser engine\n    const scrollOffset = (scrollLeftPotentiallyExcessive < 0 ? -1 : 1) *\n        Math.min(Math.abs(scrollLeftPotentiallyExcessive), maxScrollShift);\n    scrollElement.scrollLeft = scrollOffset;\n}\n\nconst scrollToHashRaw = (animate: boolean, skipRedraw?: boolean) => {\n    if (!win.document || !win.document.body || !win.document.documentElement) {\n        return;\n    }\n\n    if (!skipRedraw) {\n        recreateAllHighlightsRaw(win);\n    }\n\n    // if (win.READIUM2.isFixedLayout) {\n    //     debug(\"scrollToHashRaw skipped, FXL\");\n    //     return;\n    // }\n\n    debug(\"++++ scrollToHashRaw\");\n\n    const isPaged = isPaginated(win.document);\n\n    const vwm = isVerticalWritingMode();\n\n    if (win.READIUM2.locationHashOverride) {\n        // if (win.READIUM2.locationHashOverride === win.document.body) {\n        //     notifyReadingLocationDebounced();\n        //     return;\n        // }\n        // _ignoreScrollEvent = true;\n        scrollElementIntoView(win.READIUM2.locationHashOverride, true, animate, undefined);\n\n        notifyReadingLocationDebounced();\n        return;\n    } else if (win.READIUM2.hashElement) {\n        win.READIUM2.locationHashOverride = win.READIUM2.hashElement;\n\n        // _ignoreScrollEvent = true;\n        scrollElementIntoView(win.READIUM2.hashElement, true, animate, undefined);\n\n        notifyReadingLocationDebounced();\n        return;\n    } else {\n        const scrollElement = getScrollingElement(win.document);\n\n        if (win.READIUM2.urlQueryParams) {\n            // tslint:disable-next-line:no-string-literal\n            const previous = win.READIUM2.urlQueryParams[URL_PARAM_PREVIOUS];\n            const isPreviousNavDirection = previous === \"true\";\n            if (isPreviousNavDirection) {\n                const { maxScrollShift, maxScrollShiftAdjusted } = calculateMaxScrollShift();\n\n                _ignoreScrollEvent = true;\n                if (isPaged) {\n                    if (vwm) {\n                        scrollElement.scrollLeft = 0;\n                        scrollElement.scrollTop = maxScrollShift;\n                    } else {\n                        const scrollLeftPotentiallyExcessive = (isRTL() ? -1 : 1) * maxScrollShiftAdjusted;\n                        // tslint:disable-next-line:max-line-length\n                        ensureTwoPageSpreadWithOddColumnsIsOffset(scrollLeftPotentiallyExcessive, maxScrollShift);\n                        const scrollLeft = (isRTL() ? -1 : 1) * maxScrollShift;\n                        scrollElement.scrollLeft = scrollLeft;\n                        scrollElement.scrollTop = 0;\n                    }\n                } else {\n                    if (vwm) {\n                        scrollElement.scrollLeft = (isRTL() ? -1 : 1) * maxScrollShift;\n                        scrollElement.scrollTop = 0;\n                    } else {\n                        scrollElement.scrollLeft = 0;\n                        scrollElement.scrollTop = maxScrollShift;\n                    }\n                }\n\n                win.READIUM2.locationHashOverride = undefined;\n                resetLocationHashOverrideInfo();\n\n                setTimeout(() => {\n                    // relative to fixed window top-left corner\n                    // const y = (isPaged ?\n                    //     (vwm ?\n                    //         win.document.documentElement.offsetWidth :\n                    //         win.document.documentElement.offsetHeight) :\n                    //     (vwm ?\n                    //         win.document.documentElement.clientWidth :\n                    //         win.document.documentElement.clientHeight))\n                    // - 1;\n                    // processXYRaw(0, y, true);\n                    const x = (isRTL() ? win.document.documentElement.offsetWidth - 1 : 0);\n                    processXYRaw(x, 0, false);\n\n                    showHideContentMask(false, win.READIUM2.isFixedLayout);\n\n                    if (!win.READIUM2.locationHashOverride) { // already in processXYRaw()\n                        notifyReadingLocationDebounced();\n                    }\n\n                    setTimeout(() => {\n                        _ignoreScrollEvent = false;\n                    }, 10);\n                }, 60);\n                return;\n            }\n\n            // tslint:disable-next-line:no-string-literal\n            const gto = win.READIUM2.urlQueryParams[URL_PARAM_GOTO];\n            let gotoCssSelector: string | undefined;\n            let gotoProgression: number | undefined;\n            if (gto) {\n                // decodeURIComponent\n                const locStr = Buffer.from(gto, \"base64\").toString(\"utf8\");\n                const locObj = JSON.parse(locStr) as LocatorLocations;\n                gotoCssSelector = locObj.cssSelector;\n                gotoProgression = locObj.progression;\n            }\n            if (gotoCssSelector) {\n                gotoCssSelector = gotoCssSelector.replace(/\\+/g, \" \");\n                let selected: Element | null = null;\n                try {\n                    selected = win.document.querySelector(gotoCssSelector);\n                } catch (err) {\n                    debug(err);\n                }\n                if (selected) {\n                    win.READIUM2.locationHashOverride = selected;\n                    debug(\".hashElement = 2\");\n                    win.READIUM2.hashElement = selected;\n\n                    resetLocationHashOverrideInfo();\n                    if (win.READIUM2.locationHashOverrideInfo) {\n                        win.READIUM2.locationHashOverrideInfo.locations.cssSelector = gotoCssSelector;\n                    }\n\n                    let domRect: DOMRect | undefined;\n                    // tslint:disable-next-line:no-string-literal\n                    const gtoDomRange = win.READIUM2.urlQueryParams[URL_PARAM_GOTO_DOM_RANGE];\n                    if (gtoDomRange) {\n                        try {\n                            // decodeURIComponent\n                            const rangeInfoStr = Buffer.from(gtoDomRange, \"base64\").toString(\"utf8\");\n                            const rangeInfo = JSON.parse(rangeInfoStr);\n                            debug(\"rangeInfo\", rangeInfo);\n                            const domRange = convertRangeInfo(win.document, rangeInfo);\n                            if (domRange) {\n                                domRect = domRange.getBoundingClientRect();\n                            }\n                        } catch (err) {\n                            debug(\"gtoDomRange\", err);\n                        }\n                    }\n\n                    // _ignoreScrollEvent = true;\n                    scrollElementIntoView(selected, true, animate, domRect);\n\n                    notifyReadingLocationDebounced();\n\n                    return;\n                }\n            } else if (typeof gotoProgression !== \"undefined\") {\n                const { maxScrollShift } = calculateMaxScrollShift();\n\n                if (isPaged) {\n                    const isTwoPage = isTwoPageSpread();\n                    const nColumns = calculateTotalColumns();\n                    const nUnits = isTwoPage ? Math.ceil(nColumns / 2) : nColumns;\n                    const unitIndex = Math.floor(gotoProgression * nUnits);\n\n                    const unit = vwm ?\n                        win.document.documentElement.offsetHeight :\n                        win.document.documentElement.offsetWidth;\n\n                    const scrollOffsetPotentiallyExcessive = vwm ?\n                        (unitIndex * unit) :\n                        ((isRTL() ? -1 : 1) * unitIndex * unit);\n\n                    // tslint:disable-next-line:max-line-length\n                    ensureTwoPageSpreadWithOddColumnsIsOffset(scrollOffsetPotentiallyExcessive, maxScrollShift);\n\n                    const scrollOffsetPaged = (scrollOffsetPotentiallyExcessive < 0 ? -1 : 1) *\n                        Math.min(Math.abs(scrollOffsetPotentiallyExcessive), maxScrollShift);\n\n                    debug(\"gotoProgression, set scroll left/top (paged): \", scrollOffsetPaged);\n\n                    _ignoreScrollEvent = true;\n                    if (vwm) {\n                        scrollElement.scrollTop = scrollOffsetPaged;\n                    } else {\n                        scrollElement.scrollLeft = scrollOffsetPaged;\n                    }\n                    setTimeout(() => {\n                        _ignoreScrollEvent = false;\n                    }, 10);\n\n                    win.READIUM2.locationHashOverride = win.document.body;\n                    resetLocationHashOverrideInfo();\n                    focusElement(win.READIUM2.locationHashOverride);\n\n                    const x = (isRTL() ? win.document.documentElement.offsetWidth - 1 : 0);\n                    processXYRaw(x, 0, false);\n\n                    if (!win.READIUM2.locationHashOverride) { // already in processXYRaw()\n                        notifyReadingLocationDebounced();\n                    }\n                    return;\n                }\n                // !isPaged\n                const scrollOffset = gotoProgression * maxScrollShift;\n\n                // console.log(`DEBUGxx maxScrollShift: ${maxScrollShift}`);\n                // console.log(`DEBUGxx gotoProgression: ${gotoProgression}`);\n                // console.log(`DEBUGxx scrollOffset: ${scrollOffset}`);\n\n                debug(\"gotoProgression, set scroll left/top (scrolled): \", scrollOffset);\n\n                _ignoreScrollEvent = true;\n                if (vwm) {\n                    scrollElement.scrollLeft = (isRTL() ? -1 : 1) * scrollOffset;\n                } else {\n                    scrollElement.scrollTop = scrollOffset;\n                }\n                setTimeout(() => {\n                    _ignoreScrollEvent = false;\n                }, 10);\n\n                win.READIUM2.locationHashOverride = win.document.body;\n                resetLocationHashOverrideInfo();\n                focusElement(win.READIUM2.locationHashOverride);\n\n                // maxScrollShift === scrollElement.scrollWidth - win.document.documentElement.clientWidth\n                // * gotoProgression ?\n                const x = (isRTL() ? win.document.documentElement.offsetWidth - 1 : 0);\n                processXYRaw(x, 0, false);\n\n                if (!win.READIUM2.locationHashOverride) { // already in processXYRaw()\n                    notifyReadingLocationDebounced();\n                }\n                return;\n            }\n        }\n\n        _ignoreScrollEvent = true;\n        scrollElement.scrollLeft = 0;\n        scrollElement.scrollTop = 0;\n        setTimeout(() => {\n            _ignoreScrollEvent = false;\n        }, 10);\n\n        win.READIUM2.locationHashOverride = win.document.body;\n        resetLocationHashOverrideInfo();\n        focusElement(win.READIUM2.locationHashOverride);\n\n        debug(\"processXYRaw BODY\");\n        const x = (isRTL() ? win.document.documentElement.offsetWidth - 1 : 0);\n        processXYRaw(x, 0, false);\n\n        // if (!win.READIUM2.locationHashOverride) { // already in processXYRaw()\n        //     notifyReadingLocationDebounced();\n        //     return;\n        // }\n    }\n\n    notifyReadingLocationDebounced();\n};\n\nconst scrollToHashDebounced = debounce((animate: boolean) => {\n    debug(\"++++ scrollToHashRaw FROM DEBOUNCED\");\n    scrollToHashRaw(animate);\n}, 100);\n\nlet _ignoreScrollEvent = false;\n\n// function testReadiumCSS(readiumcssJson: IEventPayload_R2_EVENT_READIUMCSS | undefined) {\n//     const oldHTML = win.document.documentElement.outerHTML;\n//     const iBody = oldHTML.indexOf(\"<body\");\n//     debug(oldHTML.substr(0, iBody + 100));\n\n//     let newHTML: string | undefined;\n//     try {\n//         newHTML = readiumCssTransformHtml(oldHTML, readiumcssJson, \"application/xhtml+xml\");\n//     } catch (err) {\n//         debug(err);\n//         return;\n//     }\n\n//     const iBody_ = newHTML.indexOf(\"<body\");\n//     debug(newHTML.substr(0, iBody_ + 100));\n// }\n\n// ipcRenderer.on(\"R2_EVENT_HIDE\", (_event: any, payload: boolean | null) => {\n//     showHideContentMask(true, payload);\n// });\n\nfunction showHideContentMask(doHide: boolean, isFixedLayout: boolean | null) {\n    if (doHide) {\n        win.document.documentElement.classList.add(ROOT_CLASS_INVISIBLE_MASK);\n        win.document.documentElement.classList.remove(ROOT_CLASS_INVISIBLE_MASK_REMOVED);\n    } else {\n        ipcRenderer.sendToHost(R2_EVENT_SHOW, null);\n\n        if (isFixedLayout) {\n            win.document.documentElement.classList.add(ROOT_CLASS_INVISIBLE_MASK_REMOVED);\n        }\n        win.document.documentElement.classList.remove(ROOT_CLASS_INVISIBLE_MASK);\n    }\n}\n\nfunction focusScrollRaw(el: HTMLOrSVGElement, doFocus: boolean, animate: boolean, domRect: DOMRect | undefined) {\n\n    if (\n        // !isPaginated(win.document) &&\n        !isVisible(false, el as HTMLElement, domRect)) {\n\n        scrollElementIntoView(el as HTMLElement, doFocus, animate, domRect);\n    }\n\n    if (win.READIUM2.locationHashOverride === (el as HTMLElement)) {\n        return;\n    }\n\n    const blacklisted = checkBlacklisted(el as HTMLElement);\n    if (blacklisted) {\n        return;\n    }\n\n    debug(\".hashElement = 3\");\n    // underscore special link will prioritise hashElement!\n    win.READIUM2.hashElement = doFocus ? el as HTMLElement : win.READIUM2.hashElement;\n    win.READIUM2.locationHashOverride = el as HTMLElement;\n    notifyReadingLocationDebounced();\n}\nconst focusScrollDebounced =\n    debounce((el: HTMLOrSVGElement, doFocus: boolean, animate: boolean, domRect: DOMRect | undefined) => {\n\n        focusScrollRaw(el, doFocus, animate, domRect);\n    }, 100);\n\n// let _ignoreFocusInEvent = false;\n\n// function lazyTabbables(): HTMLElement[] {\n//     // cache problem: temporary tabbables? (e.g. HTML5 details/summary element, expand/collapse)\n//     // so right now, resize observer resets body.tabbables. Is that enough? (other edge cases?)\n//     const alreadySet: HTMLElement[] = (win.document.body as any).tabbables;\n//     return alreadySet ? alreadySet :\n//         ((win.document.body as any).tabbables = tabbable(win.document.body) as HTMLElement[]);\n// }\nconst handleFocusInDebounced = debounce((target: HTMLElement, tabKeyDownEvent: KeyboardEvent | undefined) => {\n    handleFocusInRaw(target, tabKeyDownEvent);\n}, 100);\nfunction handleFocusInRaw(target: HTMLElement, _tabKeyDownEvent: KeyboardEvent | undefined) {\n    if (!target || !win.document.body) {\n        return;\n    }\n    // _ignoreFocusInEvent = true;\n\n    // doFocus is false (important, as otherwise\n    // underscore special link will prioritise hashElement)\n    focusScrollRaw(target, false, false, undefined);\n}\n// function handleTabRaw(target: HTMLElement, tabKeyDownEvent: KeyboardEvent | undefined) {\n//     if (!target || !win.document.body) {\n//         return;\n//     }\n\n//     // target\n//     // tab-keydown => originating element (will leave focus)\n//     // focusin => destination element (focuses in)\n\n//     // evt\n//     // non-nil when tab-keydown\n//     // nil when focusin\n//     // const isTabKeyDownEvent = typeof evt !== \"undefined\";\n//     // const isFocusInEvent = !isTabKeyDownEvent;\n\n//     _ignoreFocusInEvent = false;\n\n//     const tabbables = lazyTabbables();\n\n//     // freshly-created, let's insert the first tab stop (SKIP_LINK_ID = readium2_skip_link)\n//     // if (!alreadySet && tabbables) {\n//     //     let skipLinkIndex = -1;\n//     //     const skipLink = tabbables.find((t, arrayIndex) => {\n//     //         skipLinkIndex = arrayIndex;\n//     //         return t.getAttribute && t.getAttribute(\"id\") === SKIP_LINK_ID;\n//     //     });\n//     //     if (skipLink && skipLinkIndex >= 0) {\n//     //         (win.document.body as any).tabbables.splice(skipLinkIndex, 1);\n//     //         (win.document.body as any).tabbables.unshift(skipLink);\n//     //         tabbables = (win.document.body as any).tabbables;\n//     //     }\n//     // }\n\n//     const i = tabbables ? tabbables.indexOf(target) : -1;\n//     // debug(\"TABBABLE: \" + i);\n\n//     if (i === 0) {\n//         // debug(\"FIRST TABBABLE\");\n//         // prevent the webview from cycling scroll (does its own unwanted focus)\n//         if (!tabKeyDownEvent || tabKeyDownEvent.shiftKey) {\n//             // debug(\"FIRST TABBABLE focusin or shift-tab\");\n//             _ignoreFocusInEvent = true;\n//             focusScrollDebounced(target, true);\n//             return;\n//         }\n//         if (i < (tabbables.length - 1)) {\n//             // debug(\"TABBABLE FORWARD >>\");\n//             tabKeyDownEvent.preventDefault();\n//             const nextTabbable = tabbables[i + 1];\n//             focusScrollDebounced(nextTabbable, true);\n//             return;\n//         }\n//         // debug(\"FIRST TABBABLE ??\");\n//     } else if (i === (tabbables.length - 1)) {\n//         // debug(\"LAST TABBABLE\");\n//         // prevent the webview from cycling scroll (does its own unwanted focus)\n//         if (!tabKeyDownEvent || !tabKeyDownEvent.shiftKey) {\n//             // debug(\"LAST TABBABLE focusin or no-shift-tab\");\n//             _ignoreFocusInEvent = true;\n//             focusScrollDebounced(target, true);\n//             return;\n//         }\n//         if (i > 0) {\n//             // debug(\"TABBABLE BACKWARD <<\");\n//             tabKeyDownEvent.preventDefault();\n//             const previousTabbable = tabbables[i - 1];\n//             focusScrollDebounced(previousTabbable, true);\n//             return;\n//         }\n//         // debug(\"LAST TABBABLE??\");\n//     } else if (i > 0) {\n//         if (tabKeyDownEvent) {\n//             if (tabKeyDownEvent.shiftKey) {\n//                 // debug(\"TABBABLE BACKWARD <<\");\n//                 tabKeyDownEvent.preventDefault();\n//                 const previousTabbable = tabbables[i - 1];\n//                 focusScrollDebounced(previousTabbable, true);\n//                 return;\n//             } else {\n//                 // debug(\"TABBABLE FORWARD >>\");\n//                 tabKeyDownEvent.preventDefault();\n//                 const nextTabbable = tabbables[i + 1];\n//                 focusScrollDebounced(nextTabbable, true);\n//                 return;\n//             }\n//         }\n//     }\n//     if (!tabKeyDownEvent) {\n//         // debug(\"FOCUSIN force\");\n//         focusScrollDebounced(target, true);\n//     }\n// }\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nipcRenderer.on(R2_EVENT_READIUMCSS, (_event: any, payload: IEventPayload_R2_EVENT_READIUMCSS) => {\n    showHideContentMask(true, payload.isFixedLayout || win.READIUM2.isFixedLayout);\n    readiumCSS(win.document, payload);\n    recreateAllHighlights(win);\n    showHideContentMask(false, payload.isFixedLayout || win.READIUM2.isFixedLayout);\n});\n\nlet _docTitle: string | undefined;\n\nwin.addEventListener(\"DOMContentLoaded\", () => {\n    debug(\"############# DOMContentLoaded\");\n\n    const titleElement = win.document.documentElement.querySelector(\"head > title\");\n    if (titleElement && titleElement.textContent) {\n        _docTitle = titleElement.textContent;\n    }\n\n    // _cancelInitialScrollCheck = true;\n\n    // const linkUri = new URI(win.location.href);\n\n    if (!win.READIUM2.isAudio &&\n        win.location.hash && win.location.hash.length > 1) {\n\n        debug(\".hashElement = 4\");\n        win.READIUM2.hashElement = win.document.getElementById(win.location.hash.substr(1));\n        if (win.READIUM2.DEBUG_VISUALS) {\n            if (win.READIUM2.hashElement) {\n                // const existings = win.document.querySelectorAll(`*[${readPosCssStylesAttr1}]`);\n                // existings.forEach((existing) => {\n                //     existing.removeAttribute(`${readPosCssStylesAttr1}`);\n                // });\n                win.READIUM2.hashElement.setAttribute(readPosCssStylesAttr1, \"DOMContentLoaded hashElement\");\n            }\n        }\n    }\n\n    win.READIUM2.locationHashOverride = undefined;\n    win.READIUM2.ttsClickEnabled = false;\n    win.READIUM2.ttsSkippabilityEnabled = false;\n    win.READIUM2.ttsSentenceDetectionEnabled = true;\n    win.READIUM2.ttsOverlayEnabled = false;\n\n    let readiumcssJson: IEventPayload_R2_EVENT_READIUMCSS | undefined;\n    if (win.READIUM2.urlQueryParams) {\n        // tslint:disable-next-line:no-string-literal\n        const base64ReadiumCSS = win.READIUM2.urlQueryParams[URL_PARAM_CSS];\n        if (base64ReadiumCSS) {\n            let str: string | undefined;\n            try {\n                str = Buffer.from(base64ReadiumCSS, \"base64\").toString(\"utf8\");\n                readiumcssJson = JSON.parse(str);\n            } catch (err) {\n                debug(\"################## READIUM CSS PARSE ERROR?!\");\n                debug(base64ReadiumCSS);\n                debug(err);\n                debug(str);\n            }\n        }\n    }\n\n    if (win.READIUM2.isAudio) {\n        // let audioPlaybackRate = 1;\n        // if (readiumcssJson?.setCSS?.audioPlaybackRate) {\n        //     audioPlaybackRate = readiumcssJson.setCSS.audioPlaybackRate;\n        // }\n        setupAudioBook(_docTitle, undefined);\n    }\n\n    if (readiumcssJson) {\n        win.READIUM2.isFixedLayout = (typeof readiumcssJson.isFixedLayout !== \"undefined\") ?\n            readiumcssJson.isFixedLayout : false;\n    }\n\n    // let didHide = false;\n    // if (!win.READIUM2.isFixedLayout) {\n    //     // only applies to previous nav spine item reading order\n    //     if (win.READIUM2.urlQueryParams) {\n    //         // tslint:disable-next-line:no-string-literal\n    //         const previous = win.READIUM2.urlQueryParams[URL_PARAM_PREVIOUS];\n    //         const isPreviousNavDirection = previous === \"true\";\n    //         if (isPreviousNavDirection) {\n    //             didHide = true;\n    //             showHideContentMask(true, win.READIUM2.isFixedLayout);\n    //         }\n    //     }\n    //     // ensure visible (can be triggered from host)\n    //     if (!didHide) {\n    //         showHideContentMask(false, win.READIUM2.isFixedLayout);\n    //     }\n    // }\n\n    if (!win.READIUM2.isFixedLayout && !win.READIUM2.isAudio) {\n        const scrollElement = getScrollingElement(win.document);\n\n        // without this CSS hack, the paginated scrolling is SUPER janky!\n        if (!(scrollElement as HTMLElement).classList.contains(ZERO_TRANSFORM_CLASS)) {\n            (scrollElement as HTMLElement).classList.add(ZERO_TRANSFORM_CLASS);\n        }\n    }\n\n    // testReadiumCSS(readiumcssJson);\n\n    // innerWidth/Height can be zero at this rendering stage! :(\n    const w = (readiumcssJson && readiumcssJson.fixedLayoutWebViewWidth) || win.innerWidth;\n    const h = (readiumcssJson && readiumcssJson.fixedLayoutWebViewHeight) || win.innerHeight;\n    win.READIUM2.fxlZoomPercent = (readiumcssJson && readiumcssJson.fixedLayoutZoomPercent) || 0;\n    const wh = configureFixedLayout(win.document, win.READIUM2.isFixedLayout,\n        win.READIUM2.fxlViewportWidth, win.READIUM2.fxlViewportHeight,\n        w, h, win.READIUM2.webViewSlot, win.READIUM2.fxlZoomPercent);\n    if (wh) {\n        win.READIUM2.fxlViewportWidth = wh.width;\n        win.READIUM2.fxlViewportHeight = wh.height;\n        win.READIUM2.fxlViewportScale = wh.scale;\n\n        const payload: IEventPayload_R2_EVENT_FXL_CONFIGURE = {\n            fxl: wh,\n        };\n        ipcRenderer.sendToHost(R2_EVENT_FXL_CONFIGURE, payload);\n    } else {\n        const payload: IEventPayload_R2_EVENT_FXL_CONFIGURE = {\n            fxl: null,\n        };\n        ipcRenderer.sendToHost(R2_EVENT_FXL_CONFIGURE, payload);\n    }\n\n    const alreadedInjected = win.document.documentElement.hasAttribute(\"data-readiumcss-injected\");\n    if (alreadedInjected) {\n        debug(\">>>>> ReadiumCSS already injected by streamer\");\n        // console.log(\">>>>>2 ReadiumCSS already injected by streamer\");\n    }\n\n    computeVerticalRTL();\n    if (readiumcssJson) {\n        // ReadiumCSS already injected at the streamer level?\n        if (isVerticalWritingMode() || // force update, because needs getComputedStyle()\n            !alreadedInjected) {\n\n            debug(\">>>>>> ReadiumCSS inject again\");\n            readiumCSS(win.document, readiumcssJson);\n        }\n    }\n\n    if (!win.READIUM2.isFixedLayout) {\n        if (!alreadedInjected) {\n            injectDefaultCSS(win.document);\n            if (IS_DEV) { // win.READIUM2.DEBUG_VISUALS\n                injectReadPosCSS(win.document);\n            }\n        }\n\n        if (alreadedInjected) { // because querySelector[All]() is not polyfilled\n            checkHiddenFootNotes(win.document);\n        }\n    }\n\n    // sometimes the load event does not occur! (some weird FXL edge case?)\n    setTimeout(() => {\n        loaded(true);\n    }, 500);\n});\n\n// let _cancelInitialScrollCheck = false;\n\nfunction checkSoundtrack(documant: Document) {\n\n    const audioNodeList = documant.querySelectorAll(\"audio\");\n    if (!audioNodeList || !audioNodeList.length) {\n        return;\n    }\n    const audio = audioNodeList[0] as HTMLAudioElement;\n\n    let epubType = audio.getAttribute(\"epub:type\");\n    if (!epubType) {\n        epubType = audio.getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\");\n        if (!epubType) {\n            epubType = audio.getAttribute(\"role\");\n        }\n    }\n    if (!epubType) {\n        return;\n    }\n    epubType = epubType.trim().replace(/\\s\\s+/g, \" \"); // whitespace collapse\n\n    if (epubType.indexOf(\"ibooks:soundtrack\") < 0) {\n        return;\n    }\n\n    let src = audio.getAttribute(\"src\");\n    if (!src) {\n        if (!audio.childNodes) {\n            return;\n        }\n        // tslint:disable-next-line: prefer-for-of\n        for (let i = 0; i < audio.childNodes.length; i++) {\n            const childNode = audio.childNodes[i];\n            if (childNode.nodeType === 1) { // Node.ELEMENT_NODE\n                const el = childNode as Element;\n                const elName = el.nodeName.toLowerCase();\n                if (elName === \"source\") {\n                    src = el.getAttribute(\"src\");\n                    if (src) {\n                        break; // preserve first found (does not mean will be selected by playback engine!)\n                    }\n                }\n            }\n        }\n    }\n    if (!src) {\n        return;\n    }\n    debug(`AUDIO SOUNDTRACK: ${src} ---> ${audio.src}`);\n    if (!audio.src) { // should be absolute URL, even if attribute is relative\n        return;\n    }\n\n    // Basic technique:\n    // (works-ish, because broken playback flow when \"turning pages\" in the book,\n    // and possibility of concurrent multiple playback streams with two-page spreads)\n    // audio.setAttribute(\"loop\", \"loop\");\n    // setTimeout(async () => {\n    //     await audio.play();\n    // }, 500);\n\n    // Advanced technique: let the webview manager/host handle playback:\n    const payload: IEventPayload_R2_EVENT_AUDIO_SOUNDTRACK = {\n        url: audio.src,\n    };\n    ipcRenderer.sendToHost(R2_EVENT_AUDIO_SOUNDTRACK, payload);\n}\n\nfunction mediaOverlaysClickRaw(element: Element | undefined, userInteract: boolean) {\n    const textFragmentIDChain: Array<string | null> = [];\n    if (element) { // !userInteract || win.READIUM2.mediaOverlaysClickEnabled\n        let curEl = element;\n        do {\n            const id = curEl.getAttribute(\"id\");\n            textFragmentIDChain.push(id ? id : null);\n            curEl = curEl.parentNode as Element;\n        } while (curEl && curEl.nodeType === Node.ELEMENT_NODE);\n    }\n    const payload: IEventPayload_R2_EVENT_MEDIA_OVERLAY_CLICK = {\n        locationHashOverrideInfo: win.READIUM2.locationHashOverrideInfo,\n        textFragmentIDChain,\n        userInteract,\n    };\n    ipcRenderer.sendToHost(R2_EVENT_MEDIA_OVERLAY_CLICK, payload);\n}\n// const mediaOverlaysClickDebounced = debounce((element: Element | undefined, userInteract: boolean) => {\n//     mediaOverlaysClickRaw(element, userInteract);\n// }, 100);\n\nconst onScrollRaw = () => {\n    debug(\"onScrollRaw\");\n\n    if (!win.document || !win.document.documentElement) {\n        return;\n    }\n\n    // win.document.documentElement.classList.contains(R2_MO_CLASS_PAUSED)\n    if (win.document.documentElement.classList.contains(R2_MO_CLASS_PLAYING)) {\n        debug(\"onScrollRaw Media OVerlays PLAYING/PAUSED ... skip\"); // also note that display:none pagebreaks may have sync MO!\n        return;\n    }\n\n    if (!win.READIUM2.ttsClickEnabled &&\n        !win.document.documentElement.classList.contains(TTS_CLASS_PLAYING) &&\n        !win.document.documentElement.classList.contains(TTS_CLASS_PAUSED)) {\n\n        const el = win.READIUM2.locationHashOverride; // || win.READIUM2.hashElement\n        if (el && isVisible(false, el, undefined)) {\n            debug(\"onScrollRaw VISIBLE SKIP\");\n            return;\n        }\n    }\n\n    const x = (isRTL() ? win.document.documentElement.offsetWidth - 1 : 0);\n    processXYRaw(x, 0, false);\n};\nconst onScrollDebounced = debounce(() => {\n    onScrollRaw();\n}, 300);\n\nlet _loaded = false;\nfunction loaded(forced: boolean) {\n    if (_loaded) {\n        return;\n    }\n    _loaded = true;\n    if (forced) {\n        debug(\">>> LOAD EVENT WAS FORCED!\");\n    } else {\n        debug(\">>> LOAD EVENT was not forced.\");\n    }\n\n    if (win.READIUM2.isAudio) {\n        showHideContentMask(false, win.READIUM2.isFixedLayout);\n    } else {\n        if (!win.READIUM2.isFixedLayout) {\n            showHideContentMask(false, win.READIUM2.isFixedLayout);\n\n            debug(\"++++ scrollToHashDebounced FROM LOAD\");\n            scrollToHashDebounced(false);\n\n            if (win.document.body) {\n                /*\n                if (isPaginated(win.document)) {\n                    win.document.body.addEventListener(\"scroll\", (ev) => {\n                        if (isPaginated(win.document)) {\n                            console.log(\"BODY SCROLL PREVENT\");\n                            ev.preventDefault();\n                        }\n                    });\n                }\n                */\n\n                const focusLink = win.document.createElement(\"a\");\n                focusLink.setAttribute(\"id\", SKIP_LINK_ID);\n                // focusLink.appendChild(win.document.createTextNode(INJECTED_LINK_TXT));\n                focusLink.appendChild(win.document.createTextNode(\" \"));\n                focusLink.setAttribute(\"title\", INJECTED_LINK_TXT);\n                focusLink.setAttribute(\"aria-label\", INJECTED_LINK_TXT);\n                focusLink.setAttribute(\"href\", \"javascript:;\");\n                focusLink.setAttribute(\"tabindex\", \"0\");\n                win.document.body.insertAdjacentElement(\"afterbegin\", focusLink);\n                setTimeout(() => {\n                    focusLink.addEventListener(\"click\", (ev) => {\n                        ev.preventDefault();\n\n                        if (IS_DEV) {\n                            debug(\">>>> focus link click: \");\n                            debug(win.READIUM2.hashElement ?\n                                getCssSelector(win.READIUM2.hashElement) : \"!hashElement\");\n                            debug(win.READIUM2.locationHashOverride ?\n                                getCssSelector(win.READIUM2.locationHashOverride) : \"!locationHashOverride\");\n                        }\n\n                        const el = win.READIUM2.hashElement || win.READIUM2.locationHashOverride;\n                        if (el) {\n                            focusScrollDebounced(el as HTMLElement, true, false, undefined);\n                        }\n                    });\n                }, 200);\n                // Does not work! :(\n                // setTimeout(() => {\n                //     console.log(\"TEST AUTOFOCUS\");\n                //     focusLink.focus();\n                // }, 2000);\n            }\n\n            // setTimeout(() => {\n            //     debug(\"++++ scrollToHashRaw FROM LOAD\");\n            //     scrollToHashRaw();\n            // }, 100);\n            // _cancelInitialScrollCheck = false;\n            // setTimeout(() => {\n            //     if (_cancelInitialScrollCheck) {\n            //         return;\n            //     }\n            //     // if (!isPaginated(win.document)) {\n            //     //     // scrollToHashRaw();\n            //     //     return;\n            //     // }\n            //     // let visible = false;\n            //     // if (win.READIUM2.locationHashOverride === win.document.body ||\n            //     //     win.READIUM2.hashElement === win.document.body) {\n            //     //     visible = true;\n            //     // } else if (win.READIUM2.locationHashOverride) {\n            //     //     visible = isVisible(win.READIUM2.locationHashOverride);\n            //     // } else if (win.READIUM2.hashElement) {\n            //     //     visible = isVisible(win.READIUM2.hashElement);\n            //     // }\n            //     // if (!visible) {\n            //     //     debug(\"!visible (delayed layout pass?) => forcing second scrollToHashRaw()...\");\n            //     //     if (win.READIUM2.locationHashOverride) {\n            //     //         debug(uniqueCssSelector(win.READIUM2.locationHashOverride, win.document, undefined));\n            //     //     }\n            //     //     scrollToHashRaw();\n            //     // }\n            // }, 500);\n        } else {\n            // processXYDebounced(0, 0, false);\n\n            showHideContentMask(false, win.READIUM2.isFixedLayout);\n\n            win.READIUM2.locationHashOverride = win.document.body;\n            notifyReadingLocationDebounced();\n        }\n\n        checkSoundtrack(win.document);\n\n        // if (win.READIUM2.isFixedLayout) {\n        //     mediaOverlaysClickRaw(undefined, false);\n        // } else {\n        //     setTimeout(() => {\n        //         const element = findFirstVisibleElement(win.document.body);\n        //         mediaOverlaysClickDebounced(element, false);\n        //     }, 200);\n        // }\n    }\n\n    win.document.documentElement.addEventListener(\"keydown\", (ev: KeyboardEvent) => {\n        if (win.document && win.document.documentElement) {\n            win.document.documentElement.classList.add(ROOT_CLASS_KEYBOARD_INTERACT);\n        }\n        // DEPRECATED\n        // if (ev.keyCode === 37 || ev.keyCode === 39) { // left / right\n        // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode\n        // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code\n        // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code/code_values\n        if (ev.code === \"ArrowLeft\" || ev.code === \"ArrowRight\") {\n            if (ev.target && elementCapturesKeyboardArrowKeys(ev.target as Element)) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                (ev.target as any).r2_leftrightKeyboardTimeStamp = new Date();\n            }\n            // allow event up to win.document.addEventListener(\"keydown\")\n            else {\n                ev.preventDefault();\n                // ev.stopPropagation();\n            }\n        }\n    }, true);\n\n    win.document.documentElement.addEventListener(\"mousedown\", (_ev: MouseEvent) => {\n\n        if (win.document && win.document.documentElement) {\n            win.document.documentElement.classList.remove(ROOT_CLASS_KEYBOARD_INTERACT);\n        }\n    }, true);\n\n    if (win.READIUM2.isAudio) {\n        debug(\"AUDIOBOOK RENDER ...\");\n        return;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    win.document.body.addEventListener(\"focusin\", (ev: any) => {\n\n        // if (_ignoreFocusInEvent) {\n        //     debug(\"focusin --- IGNORE\");\n        //     _ignoreFocusInEvent = false;\n        //     return;\n        // }\n\n        if (isPopupDialogOpen(win.document)) {\n            return;\n        }\n\n        if (ev.target) {\n            let ignoreIncomingMouseClickOnFocusable = false;\n            if (win.document && win.document.documentElement) {\n                const low = (ev.target as HTMLElement).tagName.toLowerCase();\n                if (low === \"body\") {\n                    ignoreIncomingMouseClickOnFocusable = true;\n                } else if (!win.document.documentElement.classList.contains(ROOT_CLASS_KEYBOARD_INTERACT)) {\n                    if (low === \"a\" &&\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                        (ev.target as any).href\n                        ||\n                        ev.target.getAttribute(\"tabindex\") === \"-1\" &&\n                        (ev.target as HTMLElement).classList.contains(CSS_CLASS_NO_FOCUS_OUTLINE)\n                    ) {\n                        ignoreIncomingMouseClickOnFocusable = true;\n                    }\n                }\n            }\n            if (!ignoreIncomingMouseClickOnFocusable) {\n                handleFocusInDebounced(ev.target as HTMLElement, undefined);\n            } else {\n                debug(\"focusin mouse click --- IGNORE\");\n            }\n        }\n        // if (!win.document) {\n        //     return;\n        // }\n        // const isPaged = isPaginated(win.document);\n        // if (isPaged) {\n        // }\n    });\n\n    // win.document.body.addEventListener(\"keydown\", (ev: KeyboardEvent) => {\n    //     if (isPopupDialogOpen(win.document)) {\n    //         return;\n    //     }\n\n    //     const TAB_KEY = 9;\n    //     if (ev.which === TAB_KEY) {\n    //         if (ev.target) {\n    //             handleTabDebounced(ev.target as HTMLElement, ev);\n    //         }\n    //     }\n    //     // if (!win.document) {\n    //     //     return;\n    //     // }\n    //     // const isPaged = isPaginated(win.document);\n    //     // if (isPaged) {\n    //     // }\n    // }, true);\n\n    const useResizeObserver = !win.READIUM2.isFixedLayout;\n    if (useResizeObserver && win.document.body) {\n\n        setTimeout(() => {\n            let _firstResizeObserver = true;\n            const resizeObserver = new win.ResizeObserver((_entries: ResizeObserverEntry[]) => {\n                // for (const entry of entries) {\n                //     const rect = entry.contentRect as DOMRect;\n                //     const element = entry.target as HTMLElement;\n                // }\n\n                if (_firstResizeObserver) {\n                    _firstResizeObserver = false;\n                    debug(\"ResizeObserver SKIP FIRST\");\n                    return;\n                }\n                // debug(\"ResizeObserver\");\n\n                // invalidateBoundingClientRectOfDocumentBody(win);\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                (win.document.body as any).tabbables = undefined;\n\n                // debug(\"++++ scrollToHashDebounced from ResizeObserver\");\n                scrollToHashDebounced(false);\n            });\n            resizeObserver.observe(win.document.body);\n\n            setTimeout(() => {\n                if (_firstResizeObserver) {\n                    _firstResizeObserver = false;\n                    debug(\"ResizeObserver CANCEL SKIP FIRST\");\n                }\n            }, 700);\n            // Note that legacy ResizeSensor sets body position to \"relative\" (default static).\n            // Also note that ReadiumCSS default to (via stylesheet :root):\n            // document.documentElement.style.position = \"relative\";\n        }, 1000);\n        // win.requestAnimationFrame((_timestamp) => {\n        // });\n    }\n\n    // // \"selectionchange\" event NOT SUITABLE\n    // // IF selection.removeAllRanges() + selection.addRange(range) in selection.ts\n    // // (normalization of selection to single range => infinite loop!!)\n    // // PROBLEM: \"selectionstart\" DOES NOT ALWAYS TRIGGER :(\n    // win.document.addEventListener(\"selectionstart\", (_ev: any) => {\n    //     // notifyReadingLocationDebounced();\n    //     debug(\"############ selectionstart EVENT:\");\n    //     const selInfo = getCurrentSelectionInfo(win, getCssSelector, computeCFI);\n    //     debug(selInfo);\n    //     if (win.READIUM2.DEBUG_VISUALS) {\n    //         if (selInfo) {\n    //             createHighlight(win.document, selInfo);\n    //         }\n    //     }\n    // });\n\n    let _mouseMoveTimeout: number | undefined;\n    win.document.documentElement.addEventListener(\"mousemove\", (_ev: MouseEvent) => {\n        if (_mouseMoveTimeout) {\n            win.clearTimeout(_mouseMoveTimeout);\n            _mouseMoveTimeout = undefined;\n        }\n        win.document.documentElement.classList.remove(HIDE_CURSOR_CLASS);\n        _mouseMoveTimeout = win.setTimeout(() => {\n            win.document.documentElement.classList.add(HIDE_CURSOR_CLASS);\n        }, 1000);\n    });\n\n    win.document.addEventListener(\"auxclick\", async (ev: MouseEvent) => {\n        debug(`AUX __CLICK: ${ev.button} (SKIP middle)`);\n        if (ev.button === 1) {\n            ev.preventDefault();\n            ev.stopPropagation();\n        }\n    }, true);\n    win.document.addEventListener(\"click\", async (ev: MouseEvent) => {\n        debug(`!AUX __CLICK: ${ev.button} ...`);\n        if (win.document.documentElement.classList.contains(R2_MO_CLASS_PAUSED) || win.document.documentElement.classList.contains(R2_MO_CLASS_PLAYING)) {\n            debug(\"!AUX __CLICK skip because MO playing/paused\");\n\n            ev.preventDefault();\n            ev.stopPropagation();\n\n            return;\n        }\n\n        if (!isPopupDialogOpen(win.document)) {\n            // relative to fixed window top-left corner\n            // (unlike pageX/Y which is relative to top-left rendered content area, subject to scrolling)\n            const x = ev.clientX;\n            const y = ev.clientY;\n\n            const domPointData = domDataFromPoint(x, y);\n\n            if (domPointData.element && win.READIUM2.ttsClickEnabled && isVisible(true, domPointData.element, undefined)) {\n                debug(\"!AUX __CLICK domPointData.element && win.READIUM2.ttsClickEnabled\");\n\n                ev.preventDefault();\n                ev.stopPropagation();\n\n                if (ev.altKey) {\n                    ttsPlay(\n                        win.READIUM2.ttsPlaybackRate,\n                        win.READIUM2.ttsVoice,\n                        focusScrollRaw,\n                        domPointData.element,\n                        undefined,\n                        undefined,\n                        -1,\n                        ensureTwoPageSpreadWithOddColumnsIsOffsetTempDisable,\n                        ensureTwoPageSpreadWithOddColumnsIsOffsetReEnable);\n                    return;\n                }\n\n                ttsPlay(\n                    win.READIUM2.ttsPlaybackRate,\n                    win.READIUM2.ttsVoice,\n                    focusScrollRaw,\n                    (domPointData.element.ownerDocument as Document).body,\n                    domPointData.element,\n                    domPointData.textNode,\n                    domPointData.textNodeOffset,\n                    ensureTwoPageSpreadWithOddColumnsIsOffsetTempDisable,\n                    ensureTwoPageSpreadWithOddColumnsIsOffsetReEnable);\n\n                return;\n            }\n        }\n\n        if (win.READIUM2.ttsClickEnabled || win.document.documentElement.classList.contains(TTS_CLASS_PAUSED) || win.document.documentElement.classList.contains(TTS_CLASS_PLAYING)) {\n            debug(\"!AUX __CLICK skip because TTS playing/paused\");\n\n            ev.preventDefault();\n            // ev.stopPropagation();\n\n            return;\n        }\n\n        // win.document.documentElement.classList.forEach((c) => {\n        //     debug(c);\n        // });\n\n        let linkElement: Element | undefined;\n        let imageElement: Element | undefined;\n\n        let href_src: string | SVGAnimatedString | undefined;\n        let href_src_image_nested_in_link: string | SVGAnimatedString | undefined;\n        let isSVG = false;\n        let globalSVGDefs: NodeListOf<Element> | undefined;\n        let currentElement: Element | undefined = ev.target as Element;\n        while (currentElement && currentElement.nodeType === Node.ELEMENT_NODE) {\n            const tagName = currentElement.tagName.toLowerCase();\n            if ((tagName === \"img\" || tagName === \"image\" || tagName === \"svg\")\n                && !currentElement.classList.contains(POPOUTIMAGE_CONTAINER_ID)) {\n\n                isSVG = false;\n                if (tagName === \"svg\") {\n                    if (imageElement) {\n                        // image inside SVG\n                        currentElement = currentElement.parentNode as Element;\n                        continue;\n                    }\n\n                    isSVG = true;\n                    href_src = currentElement.outerHTML;\n\n                    const defs = currentElement.querySelectorAll(\"defs > *[id]\");\n                    debug(\"SVG INNER defs: \", defs.length);\n                    const uses = currentElement.querySelectorAll(\"use\");\n                    debug(\"SVG INNER uses: \", uses.length);\n                    const useIDs: string[] = [];\n                    uses.forEach((useElem) => {\n                        const href = useElem.getAttribute(\"href\") || useElem.getAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\");\n                        if (href?.startsWith(\"#\")) {\n                            const id = href.substring(1);\n                            let found = false;\n                            for (let i = 0; i < defs.length; i++) {\n                                const defElem = defs[i];\n                                if (defElem.getAttribute(\"id\") === id) {\n                                    found = true;\n                                    break;\n                                }\n                            }\n                            if (!found) {\n                                debug(\"SVG INNER use (need inject def): \", id);\n                                useIDs.push(id);\n                            } else {\n                                debug(\"SVG INNER use (already has def): \", id);\n                            }\n                        }\n                    });\n                    let defsToInject = \"\";\n                    for (const useID of useIDs) {\n                        if (!globalSVGDefs) {\n                            globalSVGDefs = win.document.querySelectorAll(\"defs > *[id]\");\n                        }\n                        debug(\"SVG GLOBAL defs: \", globalSVGDefs.length);\n                        let found = false;\n                        globalSVGDefs.forEach((globalSVGDef) => {\n                            if (globalSVGDef.getAttribute(\"id\") === useID) {\n                                found = true;\n                                const outer = globalSVGDef.outerHTML;\n                                if (outer.includes(\"<use\")) {\n                                    debug(\"!!!!!! SVG WARNING use inside def: \" + outer);\n                                }\n                                defsToInject += outer;\n                            }\n                        });\n                        if (found) {\n                            debug(\"SVG GLOBAL def for INNER use id: \", useID);\n                        } else {\n                            debug(\"no SVG GLOBAL def for INNER use id!! \", useID);\n                        }\n                    }\n                    if (href_src.indexOf(\"<defs\") >= 0) {\n                        href_src = href_src.replace(/<\\/defs>/, `${defsToInject} </defs>`);\n                    } else {\n                        href_src = href_src.replace(/>/, `> <defs> ${defsToInject} </defs>`);\n                    }\n\n                    // href_src = href_src.replace(/<svg/g, `<svg xml:base=\"${win.location.origin}${win.location.pathname}\" `);\n                    href_src = href_src.replace(/:href[\\s]*=([\"|'])(.+?)([\"|'])/g, (match, ...args: string[]) => {\n                        const l = args[1].trim();\n                        const ret = l.startsWith(\"#\") || l.startsWith(\"/\") || l.startsWith(\"data:\") || /https?:/.test(l) ? match :\n                            `:href=${args[0]}${new URL(l, win.location.origin + win.location.pathname)}${args[2]}`;\n                        debug(\"SVG URL REPLACE: \", match, ret);\n                        return ret;\n                    });\n                    href_src = href_src.replace(/url[\\s]*\\((.+?)\\)/g, (match, ...args: string[]) => {\n                        const l = args[0].trim();\n                        const ret = l.startsWith(\"#\") || l.startsWith(\"/\") || l.startsWith(\"data:\") || /https?:/.test(l) ? match :\n                            `url(${new URL(l, win.location.origin + win.location.pathname)})`;\n                        debug(\"SVG URL REPLACE: \", match, ret);\n                        return ret;\n                    });\n\n                    href_src = href_src.replace(/[\\r\\n]/g, \" \").replace(/\\s\\s+/g, \" \").trim();\n                    href_src = href_src.replace(/<desc[^<]+<\\/desc>/g, \"\");\n                    debug(`SVG CLICK: ${href_src}`);\n                } else {\n                    // absolute (already resolved against base)\n                    href_src = (currentElement as HTMLImageElement).src;\n                    // possibly relative\n                    let href_src_ = currentElement.getAttribute(\"src\");\n                    if (!href_src) {\n                        // SVGAnimatedString (animVal possibly relative)\n                        href_src = (currentElement as SVGImageElement).href;\n\n                        // possibly relative\n                        href_src_ = currentElement.getAttribute(\"href\") || currentElement.getAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\");\n                    }\n                    debug(`IMG CLICK: ${href_src} (${href_src_})`);\n                }\n                imageElement = currentElement;\n\n                // DOM parent / ancestor could be link a@href, so let's continue walking up the tree\n                // break;\n            } else if (tagName === \"a\") {\n\n                if (href_src) {\n                    href_src_image_nested_in_link = href_src;\n                }\n\n                // absolute (already resolved against base),\n                // or SVGAnimatedString (animVal possibly relative)\n                href_src = (currentElement as HTMLAnchorElement | SVGAElement).href;\n\n                // possibly relative\n                const href_ = currentElement.getAttribute(\"href\") || currentElement.getAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\");\n\n                linkElement = currentElement;\n                debug(`A LINK CLICK: ${href_src} (${href_})`);\n\n                // DOM child / descendant could be img/image/svg (see if condition above)\n                break;\n            }\n            currentElement = currentElement.parentNode as Element;\n        }\n        currentElement = undefined;\n\n        // at that point, can be both an image and a link! (\"img\" element descendant of \"a\" ... clickable image link)\n\n        if (!href_src || (!imageElement && !linkElement)) {\n            clearImageZoomOutline();\n            return;\n        }\n\n        if (href_src_image_nested_in_link && (href_src_image_nested_in_link as SVGAnimatedString).animVal) {\n            href_src_image_nested_in_link = (href_src_image_nested_in_link as SVGAnimatedString).animVal;\n\n            if (!href_src_image_nested_in_link) {\n                clearImageZoomOutline();\n                return;\n            }\n        }\n\n        if ((href_src as SVGAnimatedString).animVal) {\n            href_src = (href_src as SVGAnimatedString).animVal;\n\n            if (!href_src) {\n                clearImageZoomOutline();\n                return;\n            }\n        }\n\n        if (typeof href_src !== \"string\") {\n\n            clearImageZoomOutline();\n            return;\n        }\n        if (href_src_image_nested_in_link && typeof href_src_image_nested_in_link !== \"string\") {\n\n            clearImageZoomOutline();\n            return;\n        }\n\n        debug(`HREF SRC: ${href_src} ${href_src_image_nested_in_link} (${win.location.href})`);\n\n        const has = imageElement?.hasAttribute(`data-${POPOUTIMAGE_CONTAINER_ID}`);\n        if (imageElement && href_src && (has ||\n            ((!linkElement && !win.READIUM2.isFixedLayout && !isSVG) || ev.shiftKey)\n        )) {\n            if (linkElement && href_src_image_nested_in_link) {\n                href_src = href_src_image_nested_in_link;\n            }\n\n            clearImageZoomOutline();\n\n            ev.preventDefault();\n            ev.stopPropagation();\n\n            if (has) {\n                if (!isSVG &&\n                    !/^(https?|thoriumhttps):\\/\\//.test(href_src) &&\n                    !href_src.startsWith((READIUM2_ELECTRON_HTTP_PROTOCOL + \"://\"))) {\n\n                    const destUrl = new URL(href_src, win.location.origin + win.location.pathname);\n                    href_src = destUrl.toString();\n                    debug(`IMG CLICK ABSOLUTE-ized: ${href_src}`);\n                }\n\n                popoutImage(\n                    win,\n                    imageElement as HTMLImageElement | SVGElement,\n                    href_src,\n                    focusScrollRaw,\n                    ensureTwoPageSpreadWithOddColumnsIsOffsetTempDisable,\n                    ensureTwoPageSpreadWithOddColumnsIsOffsetReEnable);\n            } else {\n                imageElement.setAttribute(`data-${POPOUTIMAGE_CONTAINER_ID}`, \"1\");\n            }\n\n            return;\n        }\n\n        if (!linkElement || !href_src) {\n            clearImageZoomOutline();\n            return;\n        }\n\n        const hrefStr = href_src as string;\n        if (/^javascript:/.test(hrefStr)) {\n            clearImageZoomOutline();\n            return;\n        }\n\n        clearImageZoomOutline();\n\n        ev.preventDefault();\n        ev.stopPropagation();\n\n        const payload: IEventPayload_R2_EVENT_LINK = {\n            url: \"#\" + FRAG_ID_CSS_SELECTOR + encodeURIComponent_RFC3986(getCssSelector(linkElement)), // see location.ts locationHandleIpcMessage() eventChannel === R2_EVENT_LINK (URL is made absolute if necessary)\n        };\n        ipcRenderer.sendToHost(R2_EVENT_LINK, payload); // this will result in the app registering the element in the navigation history, but is skipped in location.ts ipcRenderer.on(R2_EVENT_LINK)\n\n        const done = await popupFootNote(\n            linkElement as HTMLElement,\n            focusScrollRaw,\n            hrefStr,\n            ensureTwoPageSpreadWithOddColumnsIsOffsetTempDisable,\n            ensureTwoPageSpreadWithOddColumnsIsOffsetReEnable);\n        if (!done) {\n            focusScrollDebounced.clear();\n            // processXYDebounced.clear();\n            processXYDebouncedImmediate.clear();\n            notifyReadingLocationDebounced.clear();\n            notifyReadingLocationDebouncedImmediate.clear();\n            scrollToHashDebounced.clear();\n            onScrollDebounced.clear();\n            onResizeDebounced.clear();\n            handleFocusInDebounced.clear();\n            // mediaOverlaysClickDebounced.clear();\n\n            const payload: IEventPayload_R2_EVENT_LINK = {\n                url: hrefStr,\n            };\n            ipcRenderer.sendToHost(R2_EVENT_LINK, payload);\n        }\n    }, true);\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(\"R2_EVENT_WINDOW_RESIZE\", (_event: any, zoomPercent: number) => {\n        debug(\"R2_EVENT_WINDOW_RESIZE zoomPercent \" + zoomPercent);\n\n        // if (zoomPercent !== win.READIUM2.fxlZoomPercent) {\n        // tslint:disable-next-line:max-line-length\n        //     debug(\"R2_EVENT_WINDOW_RESIZE zoomPercent !== win.READIUM2.fxlZoomPercent ??! \" + zoomPercent + \" -- \" + win.READIUM2.fxlZoomPercent);\n        // }\n        win.READIUM2.fxlZoomPercent = zoomPercent;\n\n        if (!win.READIUM2.isFixedLayout) {\n            debug(\"R2_EVENT_WINDOW_RESIZE skipped, !FXL\");\n            return;\n        }\n\n        const wh = configureFixedLayout(win.document, win.READIUM2.isFixedLayout,\n            win.READIUM2.fxlViewportWidth, win.READIUM2.fxlViewportHeight,\n            win.innerWidth, win.innerHeight, win.READIUM2.webViewSlot,\n            win.READIUM2.fxlZoomPercent);\n\n        if (wh) {\n            win.READIUM2.fxlViewportWidth = wh.width;\n            win.READIUM2.fxlViewportHeight = wh.height;\n            win.READIUM2.fxlViewportScale = wh.scale;\n\n            const payload: IEventPayload_R2_EVENT_FXL_CONFIGURE = {\n                fxl: wh,\n            };\n            ipcRenderer.sendToHost(R2_EVENT_FXL_CONFIGURE, payload);\n        } else {\n            const payload: IEventPayload_R2_EVENT_FXL_CONFIGURE = {\n                fxl: null,\n            };\n            ipcRenderer.sendToHost(R2_EVENT_FXL_CONFIGURE, payload);\n        }\n    });\n\n    const onResizeRaw = () => {\n\n        if (win.READIUM2.isFixedLayout) {\n            debug(\"scrollToHashRaw skipped, FXL\");\n            return;\n        }\n        debug(\"++++ scrollToHashDebounced FROM RESIZE\");\n        scrollToHashDebounced(false);\n    };\n    const onResizeDebounced = debounce(() => {\n        onResizeRaw();\n    }, 200);\n    let _firstWindowResize = true;\n    win.addEventListener(\"resize\", () => {\n        if (_firstWindowResize) {\n            debug(\"Window resize (WEBVIEW), SKIP FIRST\");\n            _firstWindowResize = false;\n            return;\n        }\n\n        // if (ENABLE_WEBVIEW_RESIZE) {\n        //     onResizeRaw();\n        // } else {\n        //     onResizeDebounced();\n        // }\n        onResizeDebounced();\n    });\n\n    let _wheelTimeStamp = -1;\n    let _wheelSpin = 0;\n    const wheelDebounced = // debounce(\n        (ev: WheelEvent) => {\n        // console.log(\"wheel\", ev);\n\n        const now = (new Date()).getTime();\n        if (_wheelTimeStamp === -1) {\n            _wheelTimeStamp = now;\n        } else {\n            const msDiff = now - _wheelTimeStamp;\n            if (msDiff < 500) {\n                // console.log(\"wheel skip time\", msDiff);\n                return;\n            }\n        }\n\n        if (win.READIUM2.isAudio || win.READIUM2.isFixedLayout || !win.document.body) {\n            return;\n        }\n\n        if (!win.document || !win.document.documentElement) {\n            return;\n        }\n\n        const documant = win.document;\n\n        const isPaged = isPaginated(documant);\n        if (isPaged) {\n            return;\n        }\n\n        const delta = Math.abs(ev.deltaY);\n        // MacOS touchpad kinetic scroll generates 1px delta post- flick gesture\n        // if (delta < 2) {\n        //     console.log(\"wheel skip (small delta)\", ev.deltaY, _wheelSpin);\n        //     return;\n        // }\n        _wheelSpin += delta;\n        if (_wheelSpin < 300) {\n            // console.log(\"wheel skip (spin more...)\", ev.deltaY, _wheelSpin);\n            return;\n        }\n\n        // console.log(\"wheel turn page\", ev.deltaY, _wheelSpin);\n        _wheelSpin = 0;\n        _wheelTimeStamp = -1;\n\n        const scrollElement = getScrollingElement(documant);\n\n        const vwm = isVerticalWritingMode();\n\n        const goPREVIOUS = ev.deltaY < 0;\n        if (!goPREVIOUS) { // goPREVIOUS && isRTL() || !goPREVIOUS && !isRTL()) { // right\n\n            const maxScrollShift = calculateMaxScrollShift().maxScrollShift;\n            const maxScrollShiftTolerated = maxScrollShift - CSS_PIXEL_TOLERANCE;\n\n            if (isPaged) {\n                const unit = vwm ?\n                    win.document.documentElement.offsetHeight :\n                    win.document.documentElement.offsetWidth;\n                let scrollElementOffset = Math.round(vwm ?\n                    scrollElement.scrollTop :\n                    scrollElement.scrollLeft);\n                const isNegative = scrollElementOffset < 0;\n                const scrollElementOffsetAbs = Math.abs(scrollElementOffset);\n                const fractional = scrollElementOffsetAbs / unit;\n                const integral = Math.floor(fractional);\n                const decimal = fractional - integral;\n                const partial = decimal * unit;\n                if (partial <= CSS_PIXEL_TOLERANCE) {\n                    scrollElementOffset = (isNegative ? -1 : 1) * integral * unit;\n                } else if (partial >= (unit - CSS_PIXEL_TOLERANCE)) {\n                    scrollElementOffset = (isNegative ? -1 : 1) * (integral + 1) * unit;\n                }\n                if (vwm && (scrollElementOffsetAbs >= maxScrollShiftTolerated) ||\n                    !vwm && (scrollElementOffsetAbs >= maxScrollShiftTolerated)) {\n\n                    const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n                        // direction: \"LTR\",\n                        go: \"NEXT\",\n                    };\n                    ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n                    return;\n                }\n            } else {\n                if (vwm && (Math.abs(scrollElement.scrollLeft) >= maxScrollShiftTolerated) ||\n                    !vwm && (Math.abs(scrollElement.scrollTop) >= maxScrollShiftTolerated)) {\n\n                    const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n                        // direction: \"LTR\",\n                        go: \"NEXT\",\n                    };\n                    ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n                    return;\n                }\n            }\n        } else if (goPREVIOUS) { //  && !isRTL() || !goPREVIOUS && isRTL()) { // left\n            if (isPaged) {\n                const unit = vwm ?\n                    win.document.documentElement.offsetHeight :\n                    win.document.documentElement.offsetWidth;\n                let scrollElementOffset = Math.round(vwm ?\n                    scrollElement.scrollTop :\n                    scrollElement.scrollLeft);\n                const isNegative = scrollElementOffset < 0;\n                const scrollElementOffsetAbs = Math.abs(scrollElementOffset);\n                const fractional = scrollElementOffsetAbs / unit;\n                const integral = Math.floor(fractional);\n                const decimal = fractional - integral;\n                const partial = decimal * unit;\n                if (partial <= CSS_PIXEL_TOLERANCE) {\n                    scrollElementOffset = (isNegative ? -1 : 1) * integral * unit;\n                } else if (partial >= (unit - CSS_PIXEL_TOLERANCE)) {\n                    scrollElementOffset = (isNegative ? -1 : 1) * (integral + 1) * unit;\n                }\n                if (vwm && (scrollElementOffsetAbs <= 0) ||\n                    !vwm && (scrollElementOffsetAbs <= 0)) {\n\n                    const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n                        // direction: \"LTR\",\n                        go: \"PREVIOUS\",\n                    };\n                    ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n                    return;\n                }\n            } else {\n                if (vwm && (Math.abs(scrollElement.scrollLeft) <= 0) ||\n                    !vwm && (Math.abs(scrollElement.scrollTop) <= 0)) {\n\n                    const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n                        // direction: \"LTR\",\n                        go: \"PREVIOUS\",\n                    };\n                    ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n                    return;\n                }\n            }\n        }\n\n    }\n    // , 100)\n    ;\n    win.document.addEventListener(\"wheel\", wheelDebounced);\n    win.document.addEventListener(\"scroll\", (_ev: Event) => {\n        // console.log(\"scroll reset _wheelSpin\");\n        _wheelSpin = 0;\n        _wheelTimeStamp = -1;\n    });\n\n    setTimeout(() => {\n        win.addEventListener(\"scroll\", (_ev: Event) => {\n\n            if (_ignoreScrollEvent) {\n                // _ignoreScrollEvent = false;\n                return;\n            }\n\n            if (_lastAnimState && _lastAnimState.animating) {\n                debug(\"_lastAnimState\"); // should never happen, as _ignoreScrollEvent\n                return;\n            }\n\n            if (_lastAnimState2 && _lastAnimState2.animating) {\n                debug(\"_lastAnimState2\"); // should never happen, as _ignoreScrollEvent\n                return;\n            }\n\n            if (!win.document || !win.document.documentElement) {\n                return;\n            }\n\n            onScrollDebounced();\n        });\n    }, 200);\n\n    function handleMouseEvent(ev: MouseEvent) {\n\n        if (isPopupDialogOpen(win.document)) {\n            return;\n        }\n\n        // debug(\".hashElement = 5 DEBUUUUUG\");\n        // if (win.document.activeElement) {\n        //     debug(\"win.document.activeElement:\");\n        //     debug(getCssSelector(win.document.activeElement));\n        // }\n        // const elSkip = win.document.getElementById(SKIP_LINK_ID);\n        // if (elSkip) {\n        //     debug(\"elSkip:\");\n        //     debug(getCssSelector(elSkip));\n        // }\n        // debug(\"ROOT_CLASS_KEYBOARD_INTERACT: \", win.document.documentElement.classList.contains(ROOT_CLASS_KEYBOARD_INTERACT));\n\n        // screen reader a@href click event without ENTER key generates touch/user interaction!\n        if (win.document.activeElement &&\n            win.document.activeElement === win.document.getElementById(SKIP_LINK_ID)\n\n            // can't filter with this, because screen reader emulates mouse click!\n            // && win.document.documentElement.classList.contains(ROOT_CLASS_KEYBOARD_INTERACT)\n            ) {\n            debug(\".hashElement = 5 => SKIP_LINK_ID mouse click event - screen reader VoiceOver generates mouse click / non-keyboard event\");\n            return;\n        }\n\n        // relative to fixed window top-left corner\n        // (unlike pageX/Y which is relative to top-left rendered content area, subject to scrolling)\n        const x = ev.clientX;\n        const y = ev.clientY;\n\n        processXYDebouncedImmediate(x, y, false, true);\n\n        // const domPointData = domDataFromPoint(x, y);\n\n        // if (domPointData.element && win.READIUM2.ttsClickEnabled) {\n        //     if (ev.altKey) {\n        //         ttsPlay(\n        //             win.READIUM2.ttsPlaybackRate,\n        //             win.READIUM2.ttsVoice,\n        //             focusScrollRaw,\n        //             domPointData.element,\n        //             undefined,\n        //             undefined,\n        //             -1,\n        //             ensureTwoPageSpreadWithOddColumnsIsOffsetTempDisable,\n        //             ensureTwoPageSpreadWithOddColumnsIsOffsetReEnable);\n        //         return;\n        //     }\n\n        //     ttsPlay(\n        //         win.READIUM2.ttsPlaybackRate,\n        //         win.READIUM2.ttsVoice,\n        //         focusScrollRaw,\n        //         (domPointData.element.ownerDocument as Document).body,\n        //         domPointData.element,\n        //         domPointData.textNode,\n        //         domPointData.textNodeOffset,\n        //         ensureTwoPageSpreadWithOddColumnsIsOffsetTempDisable,\n        //         ensureTwoPageSpreadWithOddColumnsIsOffsetReEnable);\n        // }\n    }\n\n    // win.document.body.addEventListener(\"click\", (ev: MouseEvent) => {\n    //     handleMouseEvent(ev);\n    // });\n    win.document.documentElement.addEventListener(\"mouseup\", (ev: MouseEvent) => {\n        handleMouseEvent(ev);\n    });\n\n    win.document.addEventListener(\"mouseup\", (ev: MouseEvent) => {\n\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        if (ev.target && (ev.target as any).getAttribute) {\n\n            const iBooksMO = (ev.target as HTMLElement).getAttribute(\"ibooks:readaloud\") ||\n                (ev.target as HTMLElement).getAttribute(\"readaloud\");\n\n            if (iBooksMO) {\n                const payload: IEventPayload_R2_EVENT_MEDIA_OVERLAY_STARTSTOP = {\n                    start: iBooksMO === \"start\" ? true : undefined,\n                    startstop: iBooksMO === \"startstop\" ? true : undefined,\n                    stop: iBooksMO === \"stop\" ? true : undefined,\n                };\n\n                ipcRenderer.sendToHost(R2_EVENT_MEDIA_OVERLAY_STARTSTOP, payload);\n            }\n        }\n    }, true);\n\n    win.document.body.addEventListener(\"copy\", (evt: ClipboardEvent) => {\n        if (win.READIUM2.isClipboardIntercept) {\n            const selection = win.document.getSelection();\n            if (selection) {\n                const str = selection.toString();\n                if (str) {\n                    evt.preventDefault();\n\n                    setTimeout(() => {\n                        const payload: IEventPayload_R2_EVENT_CLIPBOARD_COPY = {\n                            locator: win.READIUM2.locationHashOverrideInfo, // see notifyReadingLocationRaw()\n                            txt: str,\n                        };\n                        ipcRenderer.sendToHost(R2_EVENT_CLIPBOARD_COPY, payload);\n                        // if (evt.clipboardData) {\n                        //     evt.clipboardData.setData(\"text/plain\", str);\n                        // }\n                    }, 500); // see notifyReadingLocationDebounced()\n                }\n            }\n        }\n    });\n}\n\n// after DOMContentLoaded, but sometimes fail to occur (e.g. some fixed layout docs with single image in body!)\nwin.addEventListener(\"load\", () => {\n    debug(\"############# load\");\n    // console.log(win.location);\n    loaded(false);\n});\n\n// // does not occur when re-using same webview (src=\"href\")\n// win.addEventListener(\"unload\", () => {\n// });\n\nfunction checkBlacklisted(el: Element): boolean {\n\n    const id = el.getAttribute(\"id\");\n    if (id && _blacklistIdClassForCFI.indexOf(id) >= 0) {\n        if (IS_DEV && id !== SKIP_LINK_ID) {\n            debug(\"checkBlacklisted ID: \" + id);\n        }\n        return true;\n    }\n\n    for (const item of _blacklistIdClassForCFI) {\n        if (el.classList.contains(item)) {\n            if (IS_DEV) {\n                debug(\"checkBlacklisted CLASS: \" + item);\n            }\n            return true;\n        }\n    }\n\n    const mathJax = win.document.documentElement.classList.contains(ROOT_CLASS_MATHJAX);\n    if (mathJax) {\n        const low = el.tagName.toLowerCase();\n        for (const item of _blacklistIdClassForCFIMathJax) {\n            if (low.startsWith(item)) {\n                if (IS_DEV) {\n                    debug(\"checkBlacklisted MathJax ELEMENT NAME: \" + el.tagName);\n                }\n                return true;\n            }\n        }\n\n        if (id) {\n            const lowId = id.toLowerCase();\n            for (const item of _blacklistIdClassForCFIMathJax) {\n                if (lowId.startsWith(item)) {\n                    if (IS_DEV) {\n                        debug(\"checkBlacklisted MathJax ID: \" + id);\n                    }\n                    return true;\n                }\n            }\n        }\n\n        // tslint:disable-next-line: prefer-for-of\n        for (let i = 0; i < el.classList.length; i++) {\n            const cl = el.classList[i];\n            const lowCl = cl.toLowerCase();\n            for (const item of _blacklistIdClassForCFIMathJax) {\n                if (lowCl.startsWith(item)) {\n                    if (IS_DEV) {\n                        debug(\"checkBlacklisted MathJax CLASS: \" + cl);\n                    }\n                    return true;\n                }\n            }\n        }\n    }\n\n    return false;\n}\n\nfunction findFirstVisibleElement(rootElement: Element): Element | undefined {\n\n    const blacklisted = checkBlacklisted(rootElement);\n    if (blacklisted) {\n        return undefined;\n    }\n\n    // tslint:disable-next-line:prefer-for-of\n    for (let i = 0; i < rootElement.children.length; i++) {\n        const child = rootElement.children[i];\n        if (child.nodeType !== Node.ELEMENT_NODE) {\n            continue;\n        }\n        const visibleElement = findFirstVisibleElement(child);\n        if (visibleElement) {\n            return visibleElement;\n        }\n    }\n    if (rootElement !== win.document.body &&\n        rootElement !== win.document.documentElement) {\n\n        if (isVisible(false, rootElement, undefined)) {\n            return rootElement;\n        }\n    }\n    return undefined;\n}\n\ntype TDOMPointData = {\n    textNode: Node | undefined;\n    textNodeOffset: number;\n    element: Element | undefined;\n};\nconst domDataFromPoint = (x: number, y: number): TDOMPointData => {\n\n    // const elems = win.document.elementsFromPoint(x, y);\n    // let element: Element | undefined = elems && elems.length ? elems[0] : undefined;\n    // if ((win.document as any).caretPositionFromPoint) {\n    //     const range = (win.document as any).caretPositionFromPoint(x, y);\n    //     const node = range.offsetNode;\n    //     const offset = range.offset;\n    // } else if (win.document.caretRangeFromPoint) {\n    // }\n\n    const domPointData: TDOMPointData = {\n        textNode: undefined,\n        textNodeOffset: -1,\n        element: undefined,\n    };\n    const range = win.document.caretRangeFromPoint(x, y);\n    if (range) {\n        const node = range.startContainer;\n\n        if (node) {\n            if (node.nodeType === Node.ELEMENT_NODE) {\n                domPointData.element = node as Element;\n                const childrenCount = domPointData.element.childNodes?.length; // childElementCount\n                if (childrenCount > 0 &&\n                    range.startOffset > 0 &&\n                    range.startOffset === range.endOffset &&\n                    range.startOffset < childrenCount) {\n                    let c = domPointData.element.childNodes[range.startOffset]; // .children\n                    if (c.nodeType === Node.ELEMENT_NODE) {\n                        domPointData.element = c as Element;\n                    } else if (c.nodeType === Node.TEXT_NODE && range.startOffset > 0) { // hack (weird image click bug)\n                        c = domPointData.element.childNodes[range.startOffset - 1];\n                        if (c.nodeType === Node.ELEMENT_NODE) {\n                            domPointData.element = c as Element;\n                        }\n                    }\n                }\n            } else if (node.nodeType === Node.TEXT_NODE) {\n                domPointData.textNode = node;\n                domPointData.textNodeOffset = range.startOffset;\n                if (node.parentNode && node.parentNode.nodeType === Node.ELEMENT_NODE) {\n                    domPointData.element = node.parentNode as Element;\n                }\n            }\n        }\n    }\n\n    return domPointData;\n};\n\n// relative to fixed window top-left corner\nconst processXYRaw = (x: number, y: number, reverse: boolean, userInteract?: boolean) => {\n\n    debug(\"processXYRaw ENTRY\");\n\n    // includes TTS!\n    if (isPopupDialogOpen(win.document)) {\n        debug(\"processXYRaw isPopupDialogOpen SKIP\");\n        return;\n    }\n\n    const domPointData = domDataFromPoint(x, y);\n\n    if (!domPointData.element ||\n        domPointData.element === win.document.body ||\n        domPointData.element === win.document.documentElement) {\n\n        const root = win.document.body; // || win.document.documentElement;\n        domPointData.element = findFirstVisibleElement(root);\n        if (!domPointData.element) {\n            debug(\"|||||||||||||| cannot find visible element inside BODY / HTML????\");\n            domPointData.element = win.document.body;\n        }\n    } else if (!userInteract &&\n        domPointData.element && !isVisible(false, domPointData.element, undefined)) { // isPaginated(win.document)\n\n        let next: Element | undefined = domPointData.element;\n        let found: Element | undefined;\n        while (next) {\n            // const blacklisted = checkBlacklisted(next);\n            // if (blacklisted) {\n            //     break;\n            // }\n\n            const firstInside = findFirstVisibleElement(next);\n            if (firstInside) {\n                found = firstInside;\n                break;\n            }\n            let sibling: Element | null = reverse ? next.previousElementSibling : next.nextElementSibling;\n            let parent: Node | null = next;\n            while (!sibling) {\n                parent = parent.parentNode;\n                if (!parent || parent.nodeType !== Node.ELEMENT_NODE) {\n                    break;\n                }\n                sibling = reverse ?\n                    (parent as Element).previousElementSibling :\n                    (parent as Element).nextElementSibling;\n            }\n            next = sibling ? sibling : undefined;\n        }\n        if (found) {\n            domPointData.element = found;\n        } else {\n            debug(\"|||||||||||||| cannot find visible element after current????\");\n        }\n    }\n    // if (element) {\n    //     debug(\"|||||||||||||| SELECTED ELEMENT\");\n    //     debug(element);\n    //     if (element) {\n    //         debug(uniqueCssSelector(element, win.document, undefined));\n    //     }\n    // }\n    if (domPointData.element === win.document.body ||\n        domPointData.element === win.document.documentElement) {\n\n        debug(\"|||||||||||||| BODY/HTML selected????\");\n    }\n    if (domPointData.element) {\n        if (userInteract ||\n            !win.READIUM2.locationHashOverride ||\n            win.READIUM2.locationHashOverride === win.document.body ||\n            win.READIUM2.locationHashOverride === win.document.documentElement) {\n\n            debug(\".hashElement = 5 \", userInteract);\n            // underscore special link will prioritise hashElement!\n            win.READIUM2.hashElement = userInteract ? domPointData.element : win.READIUM2.hashElement;\n            win.READIUM2.locationHashOverride = domPointData.element;\n        } else {\n            // this logic exists because of TOC linking,\n            // to avoid reseting to first visible item ... but for page turns we need this!\n            if (!isVisible(false, win.READIUM2.locationHashOverride, undefined)) {\n                debug(\".hashElement = 6\");\n                // underscore special link will prioritise hashElement!\n                win.READIUM2.hashElement = userInteract ? domPointData.element : win.READIUM2.hashElement;\n                win.READIUM2.locationHashOverride = domPointData.element;\n            } else if (\n                win.READIUM2.hashElement !== win.READIUM2.locationHashOverride &&\n                (\n                win.READIUM2.ttsClickEnabled ||\n                win.document.documentElement.classList.contains(TTS_CLASS_PLAYING) ||\n                win.document.documentElement.classList.contains(TTS_CLASS_PAUSED)\n                )\n            ) {\n                debug(\".hashElement = 8\");\n                // underscore special link will prioritise hashElement!\n                win.READIUM2.hashElement = userInteract ? domPointData.element : win.READIUM2.hashElement;\n                win.READIUM2.locationHashOverride = domPointData.element;\n            }\n        }\n\n        // TODO: 250ms debounce on the leading edge (immediate) doesn't allow double-click to capture win.getSelection() for bookmark titles and annotations, because the notifyReadingLocation occurs before the DOM selection is ready. Instead of reverting to the debounce trailing edge (which causes a 200ms+ delay), could we detect double-click? Any other unintended side-effects / possible regression bugs from this change??\n        if (userInteract && win.READIUM2.DEBUG_VISUALS) {\n            notifyReadingLocationDebouncedImmediate(userInteract);\n        } else {\n            notifyReadingLocationDebounced(userInteract);\n        }\n\n        if (win.READIUM2.DEBUG_VISUALS) {\n            const el = win.READIUM2.locationHashOverride ? win.READIUM2.locationHashOverride : domPointData.element;\n            const existings = win.document.querySelectorAll(`*[${readPosCssStylesAttr2}]`);\n            existings.forEach((existing) => {\n                existing.removeAttribute(`${readPosCssStylesAttr2}`);\n            });\n            el.setAttribute(readPosCssStylesAttr2, \"processXYRaw\");\n        }\n    }\n\n    debug(\"processXYRaw EXIT\");\n};\n// const processXYDebounced = debounce((x: number, y: number, reverse: boolean, userInteract?: boolean) => {\n//     processXYRaw(x, y, reverse, userInteract);\n// }, 300);\nconst processXYDebouncedImmediate = debounce((x: number, y: number, reverse: boolean, userInteract?: boolean) => {\n    processXYRaw(x, y, reverse, userInteract);\n}, 300, { immediate: true });\n\ninterface IProgressionData {\n    percentRatio: number;\n    paginationInfo: IPaginationInfo | undefined;\n}\nexport const computeProgressionData = (): IProgressionData => {\n\n    const isPaged = isPaginated(win.document);\n\n    const isTwoPage = isTwoPageSpread();\n\n    const { maxScrollShift, maxScrollShiftAdjusted } = calculateMaxScrollShift();\n\n    const totalColumns = calculateTotalColumns();\n\n    let progressionRatio = 0;\n\n    // zero-based index: 0 <= currentColumn < totalColumns\n    let currentColumn = 0;\n\n    const scrollElement = getScrollingElement(win.document);\n\n    const vwm = isVerticalWritingMode();\n\n    let extraShift = 0;\n    if (isPaged) {\n        if (maxScrollShift > 0) {\n            if (vwm) {\n                progressionRatio = scrollElement.scrollTop / maxScrollShift;\n            } else {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                extraShift = (scrollElement as any).scrollLeftExtra;\n                // extraShift === maxScrollShiftAdjusted - maxScrollShift\n\n                // console.log(\"&&&&& EXTRA\");\n                // console.log(extraShift);\n                // console.log(maxScrollShiftAdjusted);\n                // console.log(maxScrollShift);\n                // console.log(maxScrollShiftAdjusted - maxScrollShift);\n\n                if (extraShift) {\n                    progressionRatio = (((isRTL() ? -1 : 1) * scrollElement.scrollLeft) + extraShift) /\n                        maxScrollShiftAdjusted;\n                } else {\n                    progressionRatio = ((isRTL() ? -1 : 1) * scrollElement.scrollLeft) / maxScrollShift;\n                }\n            }\n        }\n\n        // console.log(\")))))))) 0 progressionRatio\");\n        // console.log(progressionRatio);\n\n        // because maxScrollShift excludes whole viewport width of content (0%-100% scroll but minus last page/spread)\n        const adjustedTotalColumns = (extraShift ? (totalColumns + 1) : totalColumns) - (isTwoPage ? 2 : 1);\n        // tslint:disable-next-line:max-line-length\n        // const adjustedTotalColumns = totalColumns - (isTwoPage ? ((maxScrollShiftAdjusted > maxScrollShift) ? 1 : 2) : 1);\n\n        currentColumn = adjustedTotalColumns * progressionRatio;\n        // console.log(\"%%%%%%%% 0 currentColumn\");\n        // console.log(currentColumn);\n\n        currentColumn = Math.round(currentColumn);\n    } else {\n        if (maxScrollShift > 0) {\n            if (vwm) {\n                // (isRTL() ? -1 : 1) * scrollElement.scrollLeft\n                // CSS quirk? scrollLeft should always be negative?!\n                // ... using abs() instead\n                progressionRatio = Math.abs(scrollElement.scrollLeft) / maxScrollShift;\n            } else {\n                progressionRatio = scrollElement.scrollTop / maxScrollShift;\n            }\n        }\n    }\n\n    if (win.READIUM2.locationHashOverride) {\n        const element = win.READIUM2.locationHashOverride as HTMLElement;\n\n        // imprecise\n        // const offsetTop = computeOffsetTop(element);\n\n        let offset = 0;\n\n        if (isPaged) {\n\n            if (isVisible(false, element, undefined)) {\n                // because clientRect is based on visual rendering,\n                // which does not account for extra shift (CSS transform X-translate of the webview)\n                const curCol = extraShift ? (currentColumn - 1) : currentColumn;\n\n                const columnDimension = calculateColumnDimension();\n                // console.log(\"##### columnDimension\");\n                // console.log(columnDimension);\n\n                if (vwm) {\n                    const rect = element.getBoundingClientRect();\n                    offset = (curCol * scrollElement.scrollWidth) + rect.left +\n                        (rect.top >= columnDimension ? scrollElement.scrollWidth : 0);\n                } else {\n                    const boundingRect = element.getBoundingClientRect();\n                    const clientRects = getClientRectsNoOverlap_(element.getClientRects(), false);\n                    let rectangle: IRect | undefined;\n                    for (const rect of clientRects) {\n                        if (!rectangle) {\n                            rectangle = rect;\n                            continue;\n                        }\n                        if (isRTL()) {\n                            if ((rect.left + rect.width) > (columnDimension * (isTwoPage ? 2 : 1))) {\n                                continue;\n                            }\n                            if (isTwoPage) {\n                                if ((boundingRect.left + boundingRect.width) >= columnDimension &&\n                                    (rect.left + rect.width) < columnDimension) {\n                                    continue;\n                                }\n                            }\n                            if ((boundingRect.left + boundingRect.width) >= 0 &&\n                                (rect.left + rect.width) < 0) {\n                                continue;\n                            }\n                        } else {\n                            if (rect.left < 0) {\n                                continue;\n                            }\n                            if (boundingRect.left < columnDimension &&\n                                rect.left >= columnDimension) {\n                                continue;\n                            }\n                            if (isTwoPage) {\n                                const boundary = 2 * columnDimension;\n                                if (boundingRect.left < boundary &&\n                                    rect.left >= boundary) {\n                                    continue;\n                                }\n                            }\n                        }\n                        if (rect.top < rectangle.top) {\n                            rectangle = rect;\n                            continue;\n                        }\n                    }\n                    if (!rectangle) {\n                        rectangle = element.getBoundingClientRect();\n                    }\n\n                    // console.log(\"##### RECT TOP LEFT\");\n                    // console.log(rectangle.top);\n                    // console.log(rectangle.left);\n\n                    offset = (curCol * scrollElement.scrollHeight) + rectangle.top;\n                    if (isTwoPage) {\n                        if (isRTL()) {\n                            if (rectangle.left < columnDimension) {\n                                offset += scrollElement.scrollHeight;\n                            }\n                        } else {\n                            if (rectangle.left >= columnDimension) {\n                                offset += scrollElement.scrollHeight;\n                            }\n                        }\n                    }\n                }\n\n                // console.log(\"##### offset\");\n                // console.log(offset);\n\n                // includes whitespace beyond bottom/end of document, to fill the unnocupied remainder of the column\n                const totalDocumentDimension = ((vwm ? scrollElement.scrollWidth :\n                    scrollElement.scrollHeight) * totalColumns);\n                // console.log(\"##### totalDocumentDimension\");\n                // console.log(totalDocumentDimension);\n                progressionRatio = offset / totalDocumentDimension;\n\n                // console.log(\")))))))) 1 progressionRatio\");\n                // console.log(progressionRatio);\n\n                currentColumn = totalColumns * progressionRatio;\n\n                // console.log(\"%%%%%%%% 1 currentColumn\");\n                // console.log(currentColumn);\n\n                currentColumn = Math.floor(currentColumn);\n            }\n        } else {\n\n            const rect = element.getBoundingClientRect();\n            if (vwm) {\n                offset = scrollElement.scrollLeft + rect.left;\n            } else {\n                offset = scrollElement.scrollTop + rect.top;\n            }\n\n            // (isRTL() ? -1 : 1) * offset (derived from scrollElement.scrollLeft)\n            // CSS quirk? scrollLeft should always be negative?!\n            // ... using abs() instead\n            progressionRatio =\n                (vwm ? Math.abs(offset - win.document.documentElement.clientWidth) : offset)\n                /\n                (vwm ? scrollElement.scrollWidth : scrollElement.scrollHeight);\n        }\n    }\n\n    let spreadIndex = 0;\n    if (isPaged) {\n        spreadIndex = isTwoPage ? Math.floor(currentColumn / 2) : currentColumn;\n    }\n\n    return {\n        paginationInfo: isPaged ? {\n            currentColumn,\n            isTwoPageSpread: isTwoPage,\n            spreadIndex,\n            totalColumns,\n        } : undefined,\n        percentRatio: progressionRatio,\n    };\n};\n\n// tslint:disable-next-line:max-line-length\nconst _blacklistIdClassForCssSelectors = [LINK_TARGET_CLASS, CSS_CLASS_NO_FOCUS_OUTLINE, SKIP_LINK_ID, POPUP_DIALOG_CLASS, ID_HIGHLIGHTS_CONTAINER, CLASS_HIGHLIGHT_CONTAINER, CLASS_HIGHLIGHT_AREA, CLASS_HIGHLIGHT_BOUNDING_AREA, CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN, TTS_ID_SPEAKING_DOC_ELEMENT, ROOT_CLASS_KEYBOARD_INTERACT, ROOT_CLASS_INVISIBLE_MASK, ROOT_CLASS_INVISIBLE_MASK_REMOVED, CLASS_PAGINATED, ROOT_CLASS_NO_FOOTNOTES];\nconst _blacklistIdClassForCssSelectorsMathJax = [\"mathjax\", \"ctxt\", \"mjx\"];\n\n// tslint:disable-next-line:max-line-length\nconst _blacklistIdClassForCFI = [SKIP_LINK_ID, POPUP_DIALOG_CLASS, ID_HIGHLIGHTS_CONTAINER, CLASS_HIGHLIGHT_CONTAINER, CLASS_HIGHLIGHT_AREA, CLASS_HIGHLIGHT_BOUNDING_AREA, CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN];\n// \"CtxtMenu_MenuFrame\", \"CtxtMenu_Info\", \"CtxtMenu_MenuItem\", \"CtxtMenu_ContextMenu\",\n// \"CtxtMenu_MenuArrow\", \"CtxtMenu_Attached_0\", \"mjx-container\", \"MathJax\"\nconst _blacklistIdClassForCFIMathJax = [\"mathjax\", \"ctxt\", \"mjx\"];\n\nexport const computeCFI = (node: Node): string | undefined => {\n\n    // TODO: handle character position inside text node\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        return undefined;\n    }\n\n    let cfi = \"\";\n\n    let currentElement = node as Element;\n    while (currentElement.parentNode && currentElement.parentNode.nodeType === Node.ELEMENT_NODE) {\n        const blacklisted = checkBlacklisted(currentElement);\n        if (!blacklisted) {\n            const currentElementParentChildren = (currentElement.parentNode as Element).children;\n            let currentElementIndex = -1;\n            let j = 0;\n            for (let i = 0; i < currentElementParentChildren.length; i++) {\n                const childBlacklisted = checkBlacklisted(currentElementParentChildren[i]);\n                if (childBlacklisted) {\n                    j++;\n                }\n                if (currentElement === currentElementParentChildren[i]) {\n                    currentElementIndex = i;\n                    break;\n                }\n            }\n            if (currentElementIndex >= 0) {\n                const cfiIndex = (currentElementIndex - j + 1) * 2;\n                cfi = cfiIndex +\n                    (currentElement.id ? (\"[\" + currentElement.id + \"]\") : \"\") +\n                    (cfi.length ? (\"/\" + cfi) : \"\");\n            }\n        } else {\n            cfi = \"\";\n        }\n        currentElement = currentElement.parentNode as Element;\n    }\n\n    return \"/\" + cfi;\n};\n\nconst _getCssSelectorOptions = {\n    className: (str: string) => {\n        if (_blacklistIdClassForCssSelectors.indexOf(str) >= 0) {\n            return false;\n        }\n        const mathJax = win.document.documentElement.classList.contains(ROOT_CLASS_MATHJAX);\n        if (mathJax) {\n            const low = str.toLowerCase();\n            for (const item of _blacklistIdClassForCssSelectorsMathJax) {\n                if (low.startsWith(item)) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    },\n    idName: (str: string) => {\n        if (_blacklistIdClassForCssSelectors.indexOf(str) >= 0) {\n            return false;\n        }\n        const mathJax = win.document.documentElement.classList.contains(ROOT_CLASS_MATHJAX);\n        if (mathJax) {\n            const low = str.toLowerCase();\n            for (const item of _blacklistIdClassForCssSelectorsMathJax) {\n                if (low.startsWith(item)) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    },\n    tagName: (str: string) => {\n        // if (_blacklistIdClassForCssSelectors.indexOf(str) >= 0) {\n        //     return false;\n        // }\n        const mathJax = win.document.documentElement.classList.contains(ROOT_CLASS_MATHJAX);\n        if (mathJax) {\n            for (const item of _blacklistIdClassForCssSelectorsMathJax) {\n                if (str.startsWith(item)) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    },\n};\nfunction getCssSelector(element: Element): string {\n    try {\n        return uniqueCssSelector(element, win.document, _getCssSelectorOptions);\n    } catch (err) {\n        debug(\"uniqueCssSelector:\");\n        debug(err);\n        return \"\";\n    }\n}\n\nconst _htmlNamespaces: { [prefix: string]: string } = {\n    epub: \"http://www.idpf.org/2007/ops\",\n    xhtml: \"http://www.w3.org/1999/xhtml\",\n};\nconst _namespaceResolver = (prefix: string | null): string | null => {\n    if (!prefix) {\n        return null;\n    }\n    return _htmlNamespaces[prefix] || null;\n};\n// type XPathNSResolver =\n// ((prefix: string | null) => string | null) |\n// { lookupNamespaceURI(prefix: string | null): string | null; };\n// const namespaceResolver = win.document.createNSResolver(win.document.documentElement);\n\ninterface IHeading {\n    element: Element;\n    level: number;\n    id: string | undefined;\n    text: string | undefined;\n}\nlet _allHeadings: IHeading[] | undefined;\nconst findPrecedingAncestorSiblingHeadings = (element: Element):\n    Array<{ id: string | undefined, txt: string | undefined, level: number }> | undefined => {\n\n    if (!_allHeadings) {\n        // const xpathResult = win.document.evaluate(\n        //     \"//h1 | //h2 | //h3 | //h4 | //h5 | //h6\",\n        //     win.document.body,\n        //     _namespaceResolver,\n        //     XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,\n        //     null);\n\n        // for (let i = 0; i < xpathResult.snapshotLength; i++) {\n        //     const n = xpathResult.snapshotItem(i);\n        const headingElements = Array.from(win.document.querySelectorAll(\"h1,h2,h3,h4,h5,h6\"));\n        for (const n of headingElements) {\n            if (n) {\n                const el = n as Element;\n                const t = el.textContent || el.getAttribute(\"title\") || el.getAttribute(\"aria-label\");\n                let i = el.getAttribute(\"id\");\n                if (!i) { // common authoring pattern: parent section (or other container element) has the navigation target anchor\n                    let cur = el;\n                    let p: Element | null;\n                    while ((p = (cur.parentNode as Element | null)) &&\n                        p?.nodeType === Node.ELEMENT_NODE) {\n                        // debug(`------ PARENT ID LOOP 1 ${cur.tagName} ${p.tagName} (${p.tagName} - ${t})`);\n\n                        if (p.firstElementChild !== cur) {\n                            // debug(`------ PARENT ID LOOP 2 ${cur.tagName} ${p.tagName} (${p.tagName} - ${t})`);\n                            break;\n                        }\n\n                        const di = p.getAttribute(\"id\");\n                        if (di) {\n                            // debug(`------ PARENT ID LOOP 3 ${cur.tagName} ${p.tagName} (${p.tagName} - ${t})`);\n                            i = di;\n                            break;\n                        }\n\n                        cur = p;\n                    }\n                }\n                const heading: IHeading = {\n                    element: el,\n                    id: i ? i : undefined,\n                    // level: el.localName.toLowerCase(),\n                    level: parseInt(el.localName.substring(1), 10),\n                    text: t ? t : undefined,\n                };\n                if (!_allHeadings) {\n                    _allHeadings = [];\n                }\n                _allHeadings.push(heading);\n            }\n        }\n\n        if (!_allHeadings) {\n            _allHeadings = [];\n        }\n\n        // debug(\"_allHeadings\", JSON.stringify(_allHeadings, null, 4));\n        // JSON.stringify(_allHeadings, null, 4)\n        debug(\"_allHeadings\", _allHeadings.length, headingElements.length); // xpathResult.snapshotLength\n    }\n\n    let arr: Array<{ id: string | undefined, txt: string | undefined, level: number }> | undefined;\n    for (let i = _allHeadings.length - 1; i >= 0; i--) {\n        const heading = _allHeadings[i];\n\n        const c = element.compareDocumentPosition(heading.element);\n        // tslint:disable-next-line: no-bitwise\n        if (c === 0 || (c & Node.DOCUMENT_POSITION_PRECEDING) || (c & Node.DOCUMENT_POSITION_CONTAINS)) {\n            debug(\"preceding or containing heading\", heading.id, heading.text);\n            if (!arr) {\n                arr = [];\n            }\n            arr.push({\n                id: heading.id,\n                level: heading.level,\n                txt: heading.text,\n            });\n        }\n    }\n\n    return arr;\n};\n\ninterface IPageBreak {\n    element: Element;\n    text: string;\n}\nlet _allEpubPageBreaks: IPageBreak[] | undefined;\nconst findPrecedingAncestorSiblingEpubPageBreak = (element: Element): { epubPage: string | undefined, epubPageID: string | undefined } => {\n    if (!_allEpubPageBreaks) {\n        // // @namespace epub \"http://www.idpf.org/2007/ops\";\n        // // [epub|type~=\"pagebreak\"]\n        // const cssSelectorResult = win.document.documentElement.querySelectorAll(`*[epub\\\\:type~=\"pagebreak\"]`);\n        // cssSelectorResult.forEach((el) => {\n        //     if (el.textContent) {\n        //         const pageBreak: IPageBreak = {\n        //             element: el,\n        //             text: el.textContent,\n        //         };\n        //         if (!_allEpubPageBreaks) {\n        //             _allEpubPageBreaks = [];\n        //         }\n        //         _allEpubPageBreaks.push(pageBreak);\n        //     }\n        // });\n        // // debug(\"_allEpubPageBreaks CSS selector\", JSON.stringify(_allEpubPageBreaks, null, 4));\n        // debug(\"_allEpubPageBreaks CSS selector\", _allEpubPageBreaks.length);\n        // _allEpubPageBreaks = undefined;\n\n        const xpathResult = win.document.evaluate(\n            // `//*[contains(@epub:type,'pagebreak')]`,\n            // `//*[tokenize(@epub:type,'\\s+')='pagebreak']`\n            \"//*[contains(concat(' ', normalize-space(@role), ' '), ' doc-pagebreak ')] | //*[contains(concat(' ', normalize-space(@epub:type), ' '), ' pagebreak ')]\",\n            win.document.body,\n            _namespaceResolver,\n            XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,\n            null);\n\n        for (let i = 0; i < xpathResult.snapshotLength; i++) {\n            const n = xpathResult.snapshotItem(i);\n            if (n) {\n                const el = n as Element;\n                const elTitle = el.getAttribute(\"title\");\n                const elLabel = el.getAttribute(\"aria-label\");\n                const elText = el.textContent;\n                const pageLabel = elTitle || elLabel || elText || \" \"; // (\"_\" + (el.getAttribute(\"id\") || \"\"));\n                if (pageLabel) {\n                    const pageBreak: IPageBreak = {\n                        element: el,\n                        text: pageLabel,\n                    };\n                    if (!_allEpubPageBreaks) {\n                        _allEpubPageBreaks = [];\n                    }\n                    _allEpubPageBreaks.push(pageBreak);\n                }\n            }\n        }\n\n        if (!_allEpubPageBreaks) {\n            _allEpubPageBreaks = [];\n        }\n\n        // debug(\"_allEpubPageBreaks XPath\", JSON.stringify(_allEpubPageBreaks, null, 4));\n        debug(\"_allEpubPageBreaks XPath\", _allEpubPageBreaks.length, xpathResult.snapshotLength);\n    }\n\n    for (let i = _allEpubPageBreaks.length - 1; i >= 0; i--) {\n        const pageBreak = _allEpubPageBreaks[i];\n\n        const c = element.compareDocumentPosition(pageBreak.element);\n        // tslint:disable-next-line: no-bitwise\n        if (c === 0 || (c & Node.DOCUMENT_POSITION_PRECEDING) || (c & Node.DOCUMENT_POSITION_CONTAINS)) {\n            debug(\"preceding or containing EPUB page break\", pageBreak.text);\n            return { epubPage: pageBreak.text, epubPageID: pageBreak.element.getAttribute(\"id\") || undefined };\n        }\n    }\n\n    const nil = { epubPage: undefined, epubPageID: undefined };\n    if (_allEpubPageBreaks.length > 0) {\n        const first = { epubPage: _allEpubPageBreaks[0].text, epubPageID: _allEpubPageBreaks[0].element.getAttribute(\"id\") || undefined };\n\n        if (win.document.body.firstChild === _allEpubPageBreaks[0].element) {\n            debug(\"pagebreak first\", first);\n            return first;\n        }\n\n        const range = new Range(); // document.createRange()\n        range.setStart(win.document.body, 0);\n        range.setEnd(_allEpubPageBreaks[0].element, 0);\n        let txt = range.toString() || \"\";\n        if (txt) {\n            // txt = txt.trim().replace(new RegExp(`^${INJECTED_LINK_TXT}`), \"\").trim();\n            txt = txt.trim();\n        }\n        const pass = txt.length <= 10;\n        debug(\"pagebreak first? txt\", first, txt.length, pass ? txt : \"\");\n        return pass ? first : nil;\n    }\n    return nil;\n};\n\nlet _elementsWithID: Array<Element> | undefined;\nconst findFollowingDescendantSiblingElementsWithID = (el: Element): string[] | undefined => {\n    let followingElementIDs: string[] | undefined;\n    if (true // win.document.documentElement.classList.contains(R2_MO_CLASS_PLAYING) || win.document.documentElement.classList.contains(R2_MO_CLASS_PAUSED)\n    ) {\n        followingElementIDs = [];\n\n        if (!_elementsWithID) {\n            _elementsWithID = Array.from(win.document.querySelectorAll(`:not(#${ID_HIGHLIGHTS_CONTAINER}):not(#${POPUP_DIALOG_CLASS}):not(#${SKIP_LINK_ID}) *[id]:not(#${ID_HIGHLIGHTS_CONTAINER}):not(#${POPUP_DIALOG_CLASS}):not(#${SKIP_LINK_ID})`));\n        }\n        // const elHighlightsContainer = win.document.getElementById(ID_HIGHLIGHTS_CONTAINER);\n        // const elPopupDialog = win.document.getElementById(POPUP_DIALOG_CLASS);\n        // const elSkipLink = win.document.getElementById(SKIP_LINK_ID);\n\n        // for (let i = _elementsWithID.length - 1; i >= 0; i--) {\n        for (let i = 0; i < _elementsWithID.length; i++) {\n            const elementWithID = _elementsWithID[i];\n            const id = elementWithID.id || elementWithID.getAttribute(\"id\");\n            if (!id) {\n                continue;\n            }\n\n            const c = el.compareDocumentPosition(elementWithID);\n            // tslint:disable-next-line: no-bitwise\n            if (// c === 0 ||\n                (c & Node.DOCUMENT_POSITION_FOLLOWING) || (c & Node.DOCUMENT_POSITION_CONTAINED_BY)) {\n                // let doPush = true;\n                // if (elHighlightsContainer) {\n                //     const c1 = elHighlightsContainer.compareDocumentPosition(elementWithID);\n                //     if (c1 === 0 || (c1 & Node.DOCUMENT_POSITION_CONTAINED_BY)) {\n                //         doPush = false;\n                //     }\n                // }\n                // if (elPopupDialog) {\n                //     const c2 = elPopupDialog.compareDocumentPosition(elementWithID);\n                //     if (c2 === 0 || (c2 & Node.DOCUMENT_POSITION_CONTAINED_BY)) {\n                //         doPush = false;\n                //     }\n                // }\n                // if (elSkipLink) {\n                //     const c3 = elSkipLink.compareDocumentPosition(elementWithID);\n                //     if (c3 === 0 || (c3 & Node.DOCUMENT_POSITION_CONTAINED_BY)) {\n                //         doPush = false;\n                //     }\n                // }\n                // if (doPush) {\n                //     followingElementIDs.push(id);\n                // }\n                followingElementIDs.push(id);\n            }\n        }\n    }\n    return followingElementIDs;\n};\n\nconst notifyReadingLocationRaw = (userInteract?: boolean, ignoreMediaOverlays?: boolean) => {\n    if (!win.READIUM2.locationHashOverride) {\n        return;\n    }\n\n    // skips the first render notification because the first primary webview takes precedence\n    // as it has been explicitly linked into (contrary to the second webview which is ancillary)\n    if (// !userInteract &&\n        win.READIUM2.urlQueryParams && win.READIUM2.urlQueryParams[URL_PARAM_SECOND_WEBVIEW] === \"1\") {\n        win.READIUM2.urlQueryParams[URL_PARAM_SECOND_WEBVIEW] = \"2\";\n        return;\n    }\n\n    const blacklisted = checkBlacklisted(win.READIUM2.locationHashOverride);\n    if (blacklisted) {\n        return;\n    }\n\n    // win.READIUM2.locationHashOverride.nodeType === ELEMENT_NODE\n\n    let progressionData: IProgressionData | undefined;\n\n    let cssSelector = getCssSelector(win.READIUM2.locationHashOverride);\n    let cfi = computeCFI(win.READIUM2.locationHashOverride);\n    let progression = 0;\n    if (win.READIUM2.isFixedLayout) {\n        progression = 1;\n    } else {\n        progressionData = computeProgressionData();\n        progression = progressionData.percentRatio;\n    }\n\n    const pinfo = (progressionData && progressionData.paginationInfo) ?\n        progressionData.paginationInfo : undefined;\n\n    const selInfo = getCurrentSelectionInfo(win, getCssSelector, computeCFI);\n    // if (IS_DEV) { // && win.READIUM2.DEBUG_VISUALS\n    //     if (selInfo) {\n    //         createHighlight(win,\n    //             selInfo,\n    //             undefined, // default background color\n    //             true, // mouse / pointer interaction\n    //         );\n    //     }\n    // }\n\n    // text selections created by screen readers do not trigger mouse click on container element,\n    // and this makes sense anyway in the general case (start position of the selection is the location to focus on)\n    if (selInfo) {\n        cssSelector = selInfo.rangeInfo.startContainerElementCssSelector;\n        cfi = selInfo.rangeInfo.startContainerElementCFI;\n    }\n\n    const text = selInfo ? {\n        after: selInfo.cleanAfter,\n        before: selInfo.cleanBefore,\n        highlight: selInfo.cleanText,\n        afterRaw: selInfo.rawAfter,\n        beforeRaw: selInfo.rawBefore,\n        highlightRaw: selInfo.rawText,\n    } as LocatorText : undefined;\n\n    let selectionIsNew: boolean | undefined;\n    if (selInfo) {\n        selectionIsNew =\n            !win.READIUM2.locationHashOverrideInfo ||\n            !win.READIUM2.locationHashOverrideInfo.selectionInfo ||\n            !sameSelections(win.READIUM2.locationHashOverrideInfo.selectionInfo, selInfo);\n    }\n\n    const { epubPage, epubPageID } = findPrecedingAncestorSiblingEpubPageBreak(win.READIUM2.locationHashOverride);\n    const headings = findPrecedingAncestorSiblingHeadings(win.READIUM2.locationHashOverride);\n    const followingElementIDs = findFollowingDescendantSiblingElementsWithID(win.READIUM2.locationHashOverride);\n\n    const secondWebViewHref = win.READIUM2.urlQueryParams &&\n        win.READIUM2.urlQueryParams[URL_PARAM_SECOND_WEBVIEW] &&\n        win.READIUM2.urlQueryParams[URL_PARAM_SECOND_WEBVIEW].length > 1 &&\n        win.READIUM2.urlQueryParams[URL_PARAM_SECOND_WEBVIEW].startsWith(\"0\") ?\n        win.READIUM2.urlQueryParams[URL_PARAM_SECOND_WEBVIEW].substr(1) :\n        undefined;\n\n    win.READIUM2.locationHashOverrideInfo = {\n        audioPlaybackInfo: undefined,\n        docInfo: {\n            isFixedLayout: win.READIUM2.isFixedLayout,\n            isRightToLeft: isRTL(),\n            isVerticalWritingMode: isVerticalWritingMode(),\n        },\n        epubPage,\n        epubPageID,\n        headings,\n        href: \"\", // filled-in from host index.js renderer\n        locations: {\n            cfi,\n            cssSelector,\n            position: undefined, // calculated in host index.js renderer, where publication object is available\n            progression,\n        },\n        paginationInfo: pinfo,\n        secondWebViewHref,\n        selectionInfo: selInfo,\n        selectionIsNew,\n        text,\n        title: _docTitle,\n        userInteract: userInteract ? true : false,\n    };\n    if (followingElementIDs) {\n        win.READIUM2.locationHashOverrideInfo.followingElementIDs = followingElementIDs;\n    }\n\n    const payload: IEventPayload_R2_EVENT_READING_LOCATION = win.READIUM2.locationHashOverrideInfo;\n    ipcRenderer.sendToHost(R2_EVENT_READING_LOCATION, payload);\n\n    if (!ignoreMediaOverlays) {\n        mediaOverlaysClickRaw(win.READIUM2.locationHashOverride, userInteract ? true : false);\n    }\n\n    if (\n        // !win.document.documentElement.classList.contains(R2_MO_CLASS_PAUSED) &&\n        !win.document.documentElement.classList.contains(R2_MO_CLASS_PLAYING)\n    ) {\n        tempLinkTargetOutline(win.READIUM2.locationHashOverride, 1000, true);\n    }\n\n    if (win.READIUM2.DEBUG_VISUALS) {\n        const existings = win.document.querySelectorAll(`*[${readPosCssStylesAttr4}]`);\n        existings.forEach((existing) => {\n            existing.removeAttribute(`${readPosCssStylesAttr4}`);\n        });\n        win.READIUM2.locationHashOverride.setAttribute(readPosCssStylesAttr4, \"notifyReadingLocationRaw\");\n    }\n};\nconst notifyReadingLocationDebounced = debounce((userInteract?: boolean, ignoreMediaOverlays?: boolean) => {\n    notifyReadingLocationRaw(userInteract, ignoreMediaOverlays);\n}, 250);\nconst notifyReadingLocationDebouncedImmediate = debounce((userInteract?: boolean, ignoreMediaOverlays?: boolean) => {\n    notifyReadingLocationRaw(userInteract, ignoreMediaOverlays);\n}, 250, { immediate: true });\n\nif (!win.READIUM2.isAudio) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_TTS_DO_PLAY, (_event: any, payload: IEventPayload_R2_EVENT_TTS_DO_PLAY) => {\n        const rootElement = win.document.querySelector(payload.rootElement);\n        const startElement = payload.startElement ? win.document.querySelector(payload.startElement) : null;\n        ttsPlay(\n            payload.speed,\n            payload.voice,\n            focusScrollRaw,\n            rootElement ? rootElement : undefined,\n            startElement ? startElement : undefined,\n            undefined,\n            -1,\n            ensureTwoPageSpreadWithOddColumnsIsOffsetTempDisable,\n            ensureTwoPageSpreadWithOddColumnsIsOffsetReEnable);\n    });\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_TTS_DO_STOP, (_event: any) => {\n        ttsStop();\n    });\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_TTS_DO_PAUSE, (_event: any) => {\n        ttsPause();\n    });\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_TTS_DO_RESUME, (_event: any) => {\n        ttsResume();\n    });\n\n    ipcRenderer.on(R2_EVENT_TTS_DO_NEXT,\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (_event: any, payload?: IEventPayload_R2_EVENT_TTS_DO_NEXT_OR_PREVIOUS) => {\n        ttsNext(payload?.skipSentences);\n    });\n\n    ipcRenderer.on(R2_EVENT_TTS_DO_PREVIOUS,\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (_event: any, payload?: IEventPayload_R2_EVENT_TTS_DO_NEXT_OR_PREVIOUS) => {\n        ttsPrevious(payload?.skipSentences);\n    });\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_TTS_PLAYBACK_RATE, (_event: any, payload: IEventPayload_R2_EVENT_TTS_PLAYBACK_RATE) => {\n        ttsPlaybackRate(payload.speed);\n    });\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_TTS_VOICE, (_event: any, payload: IEventPayload_R2_EVENT_TTS_VOICE) => {\n        ttsVoice(payload.voice);\n    });\n\n    ipcRenderer.on(R2_EVENT_TTS_SKIP_ENABLE,\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (_event: any, payload: IEventPayload_R2_EVENT_TTS_SKIP_ENABLE) => {\n        win.READIUM2.ttsSkippabilityEnabled = payload.doEnable;\n    });\n    ipcRenderer.on(R2_EVENT_TTS_SENTENCE_DETECT_ENABLE,\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (_event: any, payload: IEventPayload_R2_EVENT_TTS_SENTENCE_DETECT_ENABLE) => {\n        win.READIUM2.ttsSentenceDetectionEnabled = payload.doEnable;\n    });\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_TTS_CLICK_ENABLE, (_event: any, payload: IEventPayload_R2_EVENT_TTS_CLICK_ENABLE) => {\n        win.READIUM2.ttsClickEnabled = payload.doEnable;\n    });\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_TTS_OVERLAY_ENABLE, (_event: any, payload: IEventPayload_R2_EVENT_TTS_OVERLAY_ENABLE) => {\n        win.READIUM2.ttsOverlayEnabled = payload.doEnable;\n    });\n\n    ipcRenderer.on(R2_EVENT_MEDIA_OVERLAY_STATE,\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (_event: any, payload: IEventPayload_R2_EVENT_MEDIA_OVERLAY_STATE) => {\n\n        clearImageZoomOutlineDebounced();\n\n        win.document.documentElement.classList.remove(R2_MO_CLASS_PAUSED, R2_MO_CLASS_PLAYING, R2_MO_CLASS_STOPPED);\n\n        win.document.documentElement.classList.add(payload.state === MediaOverlaysStateEnum.PAUSED ? R2_MO_CLASS_PAUSED :\n            (payload.state === MediaOverlaysStateEnum.PLAYING ? R2_MO_CLASS_PLAYING : R2_MO_CLASS_STOPPED));\n    });\n\n    ipcRenderer.on(R2_EVENT_MEDIA_OVERLAY_HIGHLIGHT,\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (_event: any, payload: IEventPayload_R2_EVENT_MEDIA_OVERLAY_HIGHLIGHT) => {\n\n            const styleAttr = win.document.documentElement.getAttribute(\"style\");\n            const isNight = styleAttr ? styleAttr.indexOf(\"readium-night-on\") > 0 : false;\n            const isSepia = styleAttr ? styleAttr.indexOf(\"readium-sepia-on\") > 0 : false;\n            // \"--USER__backgroundColor\" \"--USER__backgroundColor\"\n\n            const activeClass = (isNight || isSepia) ? R2_MO_CLASS_ACTIVE :\n                (payload.classActive ? payload.classActive : R2_MO_CLASS_ACTIVE);\n            const activeClassPlayback =\n                payload.classActivePlayback ? payload.classActivePlayback : R2_MO_CLASS_ACTIVE_PLAYBACK;\n\n            if (payload.classActive) {\n                const activeMoElements = win.document.body.querySelectorAll(`.${payload.classActive}`);\n                activeMoElements.forEach((elem) => {\n                    if (payload.classActive) {\n                        elem.classList.remove(payload.classActive);\n                    }\n                });\n            }\n            const activeMoElements_ = win.document.body.querySelectorAll(`.${R2_MO_CLASS_ACTIVE}`);\n            activeMoElements_.forEach((elem) => {\n                elem.classList.remove(R2_MO_CLASS_ACTIVE);\n            });\n\n            let removeCaptionContainer = true;\n            if (!payload.id) {\n                win.document.documentElement.classList.remove(R2_MO_CLASS_ACTIVE_PLAYBACK, activeClassPlayback);\n            } else {\n                win.document.documentElement.classList.add(activeClassPlayback);\n\n                const targetEl = win.document.getElementById(payload.id);\n                if (targetEl) {\n                    targetEl.classList.add(activeClass);\n\n                    if (payload.captionsMode) {\n                        let text = targetEl.textContent;\n                        if (text) {\n                            // text = text.trim().replace(/[\\r\\n]/g, \" \").replace(/\\s+/g, \" \");\n                            text = normalizeText(text).trim();\n                            if (text) {\n                                removeCaptionContainer = false;\n                                const isUserBackground = styleAttr ?\n                                    styleAttr.indexOf(\"--USER__backgroundColor\") >= 0 : false;\n                                const isUserColor = styleAttr ?\n                                    styleAttr.indexOf(\"--USER__textColor\") >= 0 : false;\n                                const docStyle = win.getComputedStyle(win.document.documentElement);\n                                let containerStyle = \"background-color: white; color: black;\";\n                                if (isNight || isSepia) {\n                                    const rsBackground = docStyle.getPropertyValue(\"--RS__backgroundColor\");\n                                    const rsColor = docStyle.getPropertyValue(\"--RS__textColor\");\n                                    containerStyle = `background-color: ${rsBackground}; color: ${rsColor};`;\n                                } else {\n                                    if (isUserBackground || isUserColor) {\n                                        containerStyle = \"\";\n                                    }\n                                    if (isUserBackground) {\n                                        const usrBackground = docStyle.getPropertyValue(\"--USER__backgroundColor\");\n                                        containerStyle += `background-color: ${usrBackground};`;\n                                    }\n                                    if (isUserColor) {\n                                        const usrColor = docStyle.getPropertyValue(\"--USER__textColor\");\n                                        containerStyle += `color: ${usrColor};`;\n                                    }\n                                }\n                                const isUserFontSize = styleAttr ?\n                                    styleAttr.indexOf(\"--USER__fontSize\") >= 0 : false;\n                                if (isUserFontSize) {\n                                    const usrFontSize = docStyle.getPropertyValue(\"--USER__fontSize\");\n                                    containerStyle += `font-size: ${usrFontSize};`;\n                                } else {\n                                    containerStyle += \"font-size: 120%;\";\n                                }\n                                const isUserLineHeight = styleAttr ?\n                                    styleAttr.indexOf(\"--USER__lineHeight\") >= 0 : false;\n                                if (isUserLineHeight) {\n                                    const usrLineHeight = docStyle.getPropertyValue(\"--USER__lineHeight\");\n                                    containerStyle += `line-height: ${usrLineHeight};`;\n                                } else {\n                                    containerStyle += \"line-height: 1.2;\";\n                                }\n                                const isUserFont = styleAttr ?\n                                    styleAttr.indexOf(\"--USER__fontFamily\") >= 0 : false;\n                                if (isUserFont) {\n                                    const usrFont = docStyle.getPropertyValue(\"--USER__fontFamily\");\n                                    containerStyle += `font-family: ${usrFont};`;\n                                }\n\n                                const payloadCaptions: IEventPayload_R2_EVENT_CAPTIONS = {\n                                    containerStyle,\n                                    text,\n                                    textStyle: \"font-size: 120%;\",\n                                };\n                                ipcRenderer.sendToHost(R2_EVENT_CAPTIONS, payloadCaptions);\n                            }\n                        }\n                    }\n\n                    debug(\".hashElement = 7\");\n                    // underscore special link will prioritise hashElement!\n                    win.READIUM2.hashElement = targetEl;\n                    win.READIUM2.locationHashOverride = targetEl;\n\n                    if (\n                        // !isPaginated(win.document) &&\n                        !isVisible(false, targetEl, undefined)) {\n\n                        scrollElementIntoView(targetEl, false, true, undefined);\n                    }\n\n                    scrollToHashDebounced.clear();\n                    notifyReadingLocationRaw(false, true);\n\n                    if (win.READIUM2.DEBUG_VISUALS) {\n                        const el = win.READIUM2.locationHashOverride;\n                        const existings = win.document.querySelectorAll(`*[${readPosCssStylesAttr2}]`);\n                        existings.forEach((existing) => {\n                            existing.removeAttribute(`${readPosCssStylesAttr2}`);\n                        });\n                        el.setAttribute(readPosCssStylesAttr2, \"R2_EVENT_MEDIA_OVERLAY_HIGHLIGHT\");\n                    }\n                }\n            }\n\n            if (removeCaptionContainer) {\n                const payloadCaptions: IEventPayload_R2_EVENT_CAPTIONS = {\n                    containerStyle: undefined,\n                    text: undefined,\n                    textStyle: undefined,\n                };\n                ipcRenderer.sendToHost(R2_EVENT_CAPTIONS, payloadCaptions);\n            }\n        });\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_HIGHLIGHT_CREATE, (_event: any, payloadPing: IEventPayload_R2_EVENT_HIGHLIGHT_CREATE) => {\n\n        if (payloadPing.highlightDefinitions &&\n            payloadPing.highlightDefinitions.length === 1 &&\n            payloadPing.highlightDefinitions[0].selectionInfo) {\n            const selection = win.getSelection();\n            if (selection) {\n                // selection.empty();\n                selection.removeAllRanges();\n                // selection.collapseToStart();\n            }\n        }\n        const highlightDefinitions = !payloadPing.highlightDefinitions ?\n            [\n                {\n                    color: undefined,\n                    drawType: undefined,\n                    expand: undefined,\n                    selectionInfo: undefined,\n                } as IHighlightDefinition,\n            ] :\n            payloadPing.highlightDefinitions;\n\n        const selInfo = getCurrentSelectionInfo(win, getCssSelector, computeCFI);\n        for (const highlightDefinition of highlightDefinitions) {\n            if (!highlightDefinition.selectionInfo) {\n                highlightDefinition.selectionInfo = selInfo;\n            }\n        }\n        const highlights = createHighlights(\n            win,\n            highlightDefinitions,\n            true, // mouse / pointer interaction\n        );\n        const payloadPong: IEventPayload_R2_EVENT_HIGHLIGHT_CREATE = {\n            highlightDefinitions: payloadPing.highlightDefinitions,\n            highlights: highlights.length ? highlights : undefined,\n        };\n        ipcRenderer.sendToHost(R2_EVENT_HIGHLIGHT_CREATE, payloadPong);\n    });\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_HIGHLIGHT_REMOVE, (_event: any, payload: IEventPayload_R2_EVENT_HIGHLIGHT_REMOVE) => {\n        payload.highlightIDs.forEach((highlightID) => {\n            destroyHighlight(win.document, highlightID);\n        });\n    });\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ipcRenderer.on(R2_EVENT_HIGHLIGHT_REMOVE_ALL, (_event: any) => {\n        destroyAllhighlights(win.document);\n    });\n}\n"]}