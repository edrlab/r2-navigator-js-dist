{"version":3,"file":"media-overlays.js","sourceRoot":"","sources":["../../../../../src/electron/renderer/media-overlays.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\nimport * as debug_ from \"debug\";\nimport * as util from \"util\";\n\nimport { getCurrentReadingLocation } from \"./location\";\n\nimport { TaJsonDeserialize } from \"@r2-lcp-js/serializable\";\nimport { MediaOverlayNode } from \"@r2-shared-js/models/media-overlay\";\nimport { Publication } from \"@r2-shared-js/models/publication\";\nimport { Link } from \"@r2-shared-js/models/publication-link\";\n\nimport { DEBUG_AUDIO } from \"../common/audiobook\";\nimport {\n    IEventPayload_R2_EVENT_MEDIA_OVERLAY_CLICK, IEventPayload_R2_EVENT_MEDIA_OVERLAY_HIGHLIGHT,\n    IEventPayload_R2_EVENT_MEDIA_OVERLAY_STATE, R2_EVENT_MEDIA_OVERLAY_STATE, MediaOverlaysStateEnum as MediaOverlaysStateEnum_,\n    IEventPayload_R2_EVENT_MEDIA_OVERLAY_STARTSTOP, R2_EVENT_MEDIA_OVERLAY_CLICK,\n    R2_EVENT_MEDIA_OVERLAY_HIGHLIGHT, R2_EVENT_MEDIA_OVERLAY_STARTSTOP, IEventPayload_R2_EVENT_READING_LOCATION,\n} from \"../common/events\";\nimport { handleLinkUrl, navPreviousOrNext } from \"./location\";\nimport { ReadiumElectronBrowserWindow, IReadiumElectronWebview } from \"./webview/state\";\n\n// export enum MediaOverlaysStateEnum {\n//     PAUSED = \"PAUSED\",\n//     PLAYING = \"PLAYING\",\n//     STOPPED = \"STOPPED\",\n// }\nexport { MediaOverlaysStateEnum_ as MediaOverlaysStateEnum };\n\n// import { READIUM2_ELECTRON_HTTP_PROTOCOL, convertCustomSchemeToHttpUrl } from \"../common/sessions\";\n\nconst debug = debug_(\"r2:navigator#electron/renderer/media-overlays\");\n\nconst IS_DEV = process.env.NODE_ENV === \"development\" || process.env.NODE_ENV === \"dev\";\n\nconst win = global.window as ReadiumElectronBrowserWindow;\n\nconst AUDIO_MO_ID = \"R2_AUDIO_MO_ID\";\n\nexport function publicationHasMediaOverlays(publication: Publication) {\n    if (publication.Spine) {\n        const firstMoLink = publication.Spine.find((link) => {\n            if (link.Properties?.MediaOverlay) {\n                return true;\n            }\n            if (link.Alternate) {\n                for (const altLink of link.Alternate) {\n                    if (altLink.TypeLink === \"application/vnd.syncnarr+json\") {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        });\n        if (firstMoLink) {\n            return true;\n        }\n    }\n    return false;\n}\n\nlet _captionsMode = false;\n\nlet _mediaOverlaysClickEnabled = false;\nlet _mediaOverlaysPlaybackRate = 1;\n\n// URL without t=begin,end media fragment! (pure audio reference)\nlet _currentAudioUrl: string | undefined;\nlet _previousAudioUrl: string | undefined;\n\nlet _currentAudioBegin: number | undefined;\n// let _previousAudioBegin: number | undefined;\n\nlet _currentAudioEnd: number | undefined;\nlet _previousAudioEnd: number | undefined;\n\nlet _currentAudioElement: HTMLAudioElement | undefined;\n\nlet _mediaOverlayRoot: MediaOverlayNode | undefined;\nlet _mediaOverlayTextAudioPair: MediaOverlayNode | undefined;\nlet _mediaOverlayTextId: string | undefined;\nlet _mediaOverlayTextHref: string | undefined;\n\nlet _mediaOverlayActive = false;\n\nasync function playMediaOverlays(\n    textHref: string,\n    rootMo: MediaOverlayNode,\n    textFragmentIDChain: Array<string | null> | undefined,\n    isInteract: boolean) {\n\n    if (IS_DEV) {\n        debug(\"playMediaOverlays() : \" + textHref + \" //// \" + decodeURIComponent(textHref));\n        debug(JSON.stringify(textFragmentIDChain, null, 4));\n    }\n\n    const loc = getCurrentReadingLocation();\n    const locationHashOverrideInfo = _lastClickedNotification?.locationHashOverrideInfo;\n\n    if (!textFragmentIDChain) {\n        if (loc) {\n            if (IS_DEV) {\n                debug(\"playMediaOverlays() CURRENT LOCATOR \" + textHref + \" -- \" + loc.locator?.href);\n                debug(JSON.stringify(loc, null, 4));\n            }\n            const hrefUrlObj = new URL(\"https://dummy.com/\" + loc.locator?.href);\n            if (textHref === hrefUrlObj.pathname.substr(1)) { // includes leading slash\n                if (loc.locator.locations?.cssSelector) {\n                    debug(\"playMediaOverlays() CSS SELECTOR: \" + loc.locator.locations.cssSelector);\n                    const hashI = loc.locator.locations.cssSelector.lastIndexOf(\"#\");\n                    if (hashI >= 0) {\n                        const after = loc.locator.locations.cssSelector.substring(hashI + 1);\n                        if (after) {\n                            const spaceI = after.indexOf(\" \");\n                            let hashID = after;\n                            if (spaceI > 0) {\n                                hashID = after.substring(0, spaceI);\n                            }\n                            debug(\"playMediaOverlays() CSS SELECTOR ID: \" + hashID);\n                            // textFragmentIDChain = [hashID];\n                        }\n                    }\n                }\n                if (loc.locator.locations?.cfi) {\n                    debug(\"playMediaOverlays() CFI: \" + loc.locator.locations.cfi);\n                    let arrayIDs: string[] = [];\n                    const regexpr = /\\[([^\\]]+)\\]/g;\n                    const matches = loc.locator.locations.cfi.matchAll(regexpr);\n                    // debug(\"playMediaOverlays() CFI MATCHES: \" + JSON.stringify(matches, null, 4));\n                    if (matches) {\n                        arrayIDs = Array.from(matches, (m) => m[1]);\n                    }\n                    // let match;\n                    // while (match = regexpr.exec(loc.locator.locations.cfi)) {\n                    //     arrayIDs.push(match[1]);\n                    // }\n                    debug(\"playMediaOverlays() CFI IDs: \" + JSON.stringify(arrayIDs, null, 4));\n                    textFragmentIDChain = arrayIDs;\n                }\n            }\n        }\n    }\n\n    let textFragmentIDChain_: Array<string> | undefined | null = textFragmentIDChain ? textFragmentIDChain.filter((id) => id) as Array<string> : undefined;\n    if (textFragmentIDChain_ && textFragmentIDChain_.length === 0) {\n        textFragmentIDChain_ = null;\n    }\n\n    let moTextAudioPair = findDepthFirstTextAudioPair(textHref, rootMo, textFragmentIDChain_, false);\n    if (!moTextAudioPair && (textFragmentIDChain_ || textFragmentIDChain_ === null && !isInteract)) {\n        const followingElementIDs = loc?.followingElementIDs || locationHashOverrideInfo?.followingElementIDs;\n        if (followingElementIDs) {\n            if (IS_DEV) {\n                debug(\"playMediaOverlays() - findDepthFirstTextAudioPair() SECOND CHANCE TRY ... \");\n                debug(JSON.stringify(textFragmentIDChain_, null, 4));\n                debug(JSON.stringify(followingElementIDs, null, 4));\n            }\n            for (const id of followingElementIDs) {\n                moTextAudioPair = findDepthFirstTextAudioPair(textHref, rootMo, [id], false);\n                if (moTextAudioPair) {\n                    debug(\"playMediaOverlays() - findDepthFirstTextAudioPair() SECOND CHANCE FOUND: \" + id);\n                    break;\n                }\n            }\n        }\n        if (!moTextAudioPair) {\n            debug(\"playMediaOverlays() - findDepthFirstTextAudioPair() SECOND CHANCE FALLBACK...\");\n            moTextAudioPair = findDepthFirstTextAudioPair(textHref, rootMo, textFragmentIDChain_, true);\n        }\n        // if (textFragmentIDChain) {\n        //     if (IS_DEV) {\n        //         debug(\"playMediaOverlays() - findDepthFirstTextAudioPair() SECOND CHANCE SKIP (jump back to body begin not desirable)\");\n        //         debug(JSON.stringify(textFragmentIDChain, null, 4));\n        //         debug(JSON.stringify(textFragmentIDChain_, null, 4));\n        //     }\n        // } else {\n        //     if (IS_DEV) {\n        //         debug(\"playMediaOverlays() - findDepthFirstTextAudioPair() SECOND CHANCE \");\n        //         debug(JSON.stringify(textFragmentIDChain_, null, 4));\n        //         debug(JSON.stringify(rootMo, null, 4));\n        //     }\n        //     moTextAudioPair = findDepthFirstTextAudioPair(textHref, rootMo, undefined);\n        // }\n    }\n    if (moTextAudioPair) {\n        if (moTextAudioPair.Audio || moTextAudioPair.Video) {\n            if (IS_DEV) {\n                debug(\"playMediaOverlays() - playMediaOverlaysAudio()\");\n            }\n            _mediaOverlayRoot = rootMo;\n            await playMediaOverlaysAudio(moTextAudioPair, undefined, undefined);\n            mediaOverlaysStateSet(MediaOverlaysStateEnum_.PLAYING);\n        }\n    } else {\n        if (IS_DEV) {\n            debug(\"playMediaOverlays() - !moTextAudioPair \" + textHref);\n        }\n    }\n}\n\nconst ontimeupdate = async (ev: Event) => {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    if (_currentAudioElement && (_currentAudioElement as any).__draggable && (_currentAudioElement as any).__hidden) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (_currentAudioElement as any).__hidden = false;\n        _currentAudioElement.style.display = \"block\";\n    }\n    const currentAudioElement = ev.currentTarget as HTMLAudioElement;\n    if (_currentAudioEnd && currentAudioElement.currentTime >= (_currentAudioEnd - 0.05)) {\n\n        if (IS_DEV) {\n            debug(\"ontimeupdate - mediaOverlaysNext()\");\n        }\n        mediaOverlaysNext();\n    }\n};\nconst ensureOnTimeUpdate = (remove: boolean) => {\n    if (_currentAudioElement) {\n        if (remove) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            if ((_currentAudioElement as any).__ontimeupdate) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                (_currentAudioElement as any).__ontimeupdate = false;\n                _currentAudioElement.removeEventListener(\"timeupdate\", ontimeupdate);\n            }\n        } else {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            if (!(_currentAudioElement as any).__ontimeupdate) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                (_currentAudioElement as any).__ontimeupdate = true;\n                _currentAudioElement.addEventListener(\"timeupdate\", ontimeupdate);\n            }\n        }\n    }\n};\n\nfunction ensureVideoFrameDraggable() {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    if (!_currentAudioElement || (_currentAudioElement as any).__draggable) {\n        return;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (_currentAudioElement as any).__draggable = true;\n\n    let moveDiv: HTMLDivElement | undefined;\n\n    let pos1 = 0;\n    let pos2 = 0;\n    let pos3 = 0;\n    let pos4 = 0;\n\n    _currentAudioElement.addEventListener(\"mousedown\", elMouseDown, true);\n\n    function elMouseDown(e: MouseEvent) {\n        if (!_currentAudioElement) {\n            docMouseUp();\n            return;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        pos3 = e.clientX;\n        pos4 = e.clientY;\n\n        if (moveDiv?.parentNode) {\n            moveDiv.parentNode.removeChild(moveDiv);\n            moveDiv = undefined;\n        }\n        moveDiv = document.createElement(\"div\");\n        moveDiv.setAttribute(\"style\", \"display: block; position: absolute; padding: 0; margin: 0; left: 0; top: 0; right: 0; bottom: 0; z-index: 9998; cursor: move; opacity: 0.4; background-color: black;\");\n        document.body.insertBefore(moveDiv, _currentAudioElement);\n\n        document.body.addEventListener(\"mouseup\", docMouseUp, true);\n        document.body.addEventListener(\"mousemove\", docMouseMove, true);\n    }\n\n    function docMouseMove(e: MouseEvent) {\n        if (!_currentAudioElement) {\n            docMouseUp();\n            return;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        pos1 = pos3 - e.clientX;\n        pos2 = pos4 - e.clientY;\n        pos3 = e.clientX;\n        pos4 = e.clientY;\n        _currentAudioElement.style.top = (_currentAudioElement.offsetTop - pos2) + \"px\";\n        _currentAudioElement.style.left = (_currentAudioElement.offsetLeft - pos1) + \"px\";\n    }\n\n    function docMouseUp() {\n        if (moveDiv?.parentNode) {\n            moveDiv.parentNode.removeChild(moveDiv);\n            moveDiv = undefined;\n        }\n        document.body.removeEventListener(\"mouseup\", docMouseUp, true);\n        document.body.removeEventListener(\"mousemove\", docMouseMove, true);\n    }\n}\n\nasync function playMediaOverlaysAudio(\n    moTextAudioPair: MediaOverlayNode,\n    begin: number | undefined,\n    end: number | undefined) {\n\n    if (IS_DEV) {\n        debug(\"playMediaOverlaysAudio()\");\n    }\n\n    ensureKillAutoNextTimeout();\n    _mediaOverlayActive = true;\n\n    _mediaOverlayTextAudioPair = moTextAudioPair;\n    _mediaOverlayTextId = undefined;\n\n    if (!moTextAudioPair.Audio && !moTextAudioPair.Video) {\n\n        if (IS_DEV) {\n            debug(\"playMediaOverlaysAudio - !moTextAudioPair.Audio => mediaOverlaysNext()\");\n        }\n        mediaOverlaysNext();\n        return; // TODO TTS\n    }\n\n    moHighlight_(moTextAudioPair);\n\n    const publicationURL = win.READIUM2.publicationURL;\n    // if (publicationURL.startsWith(READIUM2_ELECTRON_HTTP_PROTOCOL + \"://\")) {\n    //     publicationURL = convertCustomSchemeToHttpUrl(publicationURL);\n    // }\n\n    // const url = publicationURL + \"/../\" + moTextAudioPair.Audio;\n    const urlObjFull = new URL(moTextAudioPair.Audio || moTextAudioPair.Video, publicationURL);\n    const urlFull = urlObjFull.toString();\n\n    const urlObjNoQuery = new URL(urlFull);\n    urlObjNoQuery.hash = \"\";\n    urlObjNoQuery.search = \"\";\n    const urlNoQuery = urlObjNoQuery.toString();\n\n    const hasBegin = typeof begin !== \"undefined\";\n    const hasEnd = typeof end !== \"undefined\";\n\n    // _previousAudioBegin = _currentAudioBegin;\n    _previousAudioEnd = _currentAudioEnd;\n\n    _currentAudioBegin = undefined;\n    _currentAudioEnd = undefined;\n\n    if (!hasBegin && !hasEnd) {\n        if (urlObjFull.hash) {\n            const matches = urlObjFull.hash.match(/t=([0-9\\.]+)(,([0-9\\.]+))?/);\n            if (matches && matches.length >= 1) {\n                const b = matches[1];\n                try {\n                    _currentAudioBegin = parseFloat(b);\n                } catch (err) {\n                    debug(err);\n                }\n                if (matches.length >= 3) {\n                    const e = matches[3];\n                    try {\n                        _currentAudioEnd = parseFloat(e);\n                    } catch (err) {\n                        debug(err);\n                    }\n                }\n            }\n        }\n    } else {\n        // const mediaFragmentUrl = `${urlNoQuery}${`t=${hasBegin ? begin : \"\"}${hasEnd ? `,${end}` : \"\"}`}`;\n        _currentAudioBegin = begin;\n        _currentAudioEnd = end;\n    }\n    if (IS_DEV) {\n        debug(`${urlFull} => [${_currentAudioBegin}-${_currentAudioEnd}]`);\n    }\n\n    const playClip = async (initial: boolean) => {\n        if (!_currentAudioElement) {\n            return;\n        }\n\n        const timeToSeekTo = _currentAudioBegin ? _currentAudioBegin : 0;\n\n        if (initial || _currentAudioElement.paused) {\n            if ((initial && !timeToSeekTo) ||\n                _currentAudioElement.currentTime === timeToSeekTo) {\n\n                if (IS_DEV) {\n                    debug(\"playMediaOverlaysAudio() - playClip() - _currentAudioElement.play()\");\n                }\n                ensureOnTimeUpdate(false);\n                _currentAudioElement.playbackRate = _mediaOverlaysPlaybackRate;\n                await _currentAudioElement.play();\n\n                // mediaOverlaysStateSetMediaOverlaysStateEnum_.PLAYING);\n            } else {\n                if (IS_DEV) {\n                    debug(\"playMediaOverlaysAudio() - playClip() - ontimeupdateSeeked\");\n                }\n                const ontimeupdateSeeked = async (ev: Event) => {\n                    const currentAudioElement = ev.currentTarget as HTMLAudioElement;\n                    currentAudioElement.removeEventListener(\"timeupdate\", ontimeupdateSeeked);\n\n                    if (IS_DEV) {\n                        debug(\"playMediaOverlaysAudio() - playClip() - ontimeupdateSeeked - .play()\");\n                    }\n                    ensureOnTimeUpdate(false);\n                    if (_currentAudioElement) {\n                        _currentAudioElement.playbackRate = _mediaOverlaysPlaybackRate;\n                        await _currentAudioElement.play();\n                    }\n                    // mediaOverlaysStateSet(MediaOverlaysStateEnum_.PLAYING);\n                };\n                _currentAudioElement.addEventListener(\"timeupdate\", ontimeupdateSeeked);\n                _currentAudioElement.currentTime = timeToSeekTo;\n            }\n        } else {\n            const contiguous =\n                _previousAudioUrl === _currentAudioUrl &&\n                typeof _previousAudioEnd !== \"undefined\" &&\n                _previousAudioEnd > (timeToSeekTo - 0.02) &&\n                _previousAudioEnd <= timeToSeekTo &&\n                _currentAudioElement.currentTime >= (timeToSeekTo - 0.1);\n                // _currentAudioElement.currentTime <= (timeToSeekTo + 0.5)\n            ensureOnTimeUpdate(false);\n            if (contiguous) {\n                if (IS_DEV) {\n                    debug(\"playMediaOverlaysAudio() - playClip() - ensureOnTimeUpdate\");\n                }\n            } else {\n                if (IS_DEV) {\n                    debug(\"playMediaOverlaysAudio() - playClip() - currentTime = timeToSeekTo\");\n                }\n                _currentAudioElement.currentTime = timeToSeekTo;\n            }\n        }\n    };\n\n    _previousAudioUrl = _currentAudioUrl;\n    if (!_currentAudioUrl || urlNoQuery !== _currentAudioUrl) {\n        _currentAudioUrl = urlNoQuery;\n        if (IS_DEV) {\n            debug(\"playMediaOverlaysAudio() - RESET: \" + _previousAudioUrl + \" => \" + _currentAudioUrl);\n        }\n\n        // _currentAudioElement = document.getElementById(AUDIO_MO_ID) as HTMLAudioElement;\n        ensureOnTimeUpdate(true);\n        if (_currentAudioElement) {\n            _currentAudioElement.pause();\n            _currentAudioElement.setAttribute(\"src\", \"\");\n            if (_currentAudioElement.parentNode) {\n                _currentAudioElement.parentNode.removeChild(_currentAudioElement);\n            }\n        }\n        _currentAudioElement = document.createElement(moTextAudioPair.Video ? \"video\" : \"audio\"); // no controls => should be invisible\n        if (moTextAudioPair.Video) {\n            _currentAudioElement.setAttribute(\"style\", \"display: block; position: absolute; padding: 0; margin: 0; left: 10px; top: 10px; width: auto; height: auto; z-index: 9999; cursor: move; border: 2px solid black;\");\n            ensureVideoFrameDraggable();\n        } else {\n            _currentAudioElement.setAttribute(\"style\", \"display: none\");\n        }\n        _currentAudioElement.setAttribute(\"id\", AUDIO_MO_ID);\n        // _currentAudioElement.setAttribute(\"loop\", \"loop\");\n        // _currentAudioElement.setAttribute(\"autoplay\", \"autoplay\");\n        _currentAudioElement.setAttribute(\"role\", \"media-overlays\");\n        document.body.appendChild(_currentAudioElement);\n\n        _currentAudioElement.addEventListener(\"error\", (ev) => {\n            debug(\"-1) error: \" +\n            (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n            + (ev.currentTarget as HTMLAudioElement).src.substr((ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n\n            if (_currentAudioElement && _currentAudioElement.error) {\n                // 1 === MEDIA_ERR_ABORTED\n                // 2 === MEDIA_ERR_NETWORK\n                // 3 === MEDIA_ERR_DECODE\n                // 4 === MEDIA_ERR_SRC_NOT_SUPPORTED\n                debug(_currentAudioElement.error.code);\n                debug(_currentAudioElement.error.message);\n            }\n        });\n\n        if (IS_DEV) {\n            _currentAudioElement.addEventListener(\"load\", (ev) => {\n                debug(\"0) load: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"loadstart\", (ev) => {\n                debug(\"1) loadstart: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"durationchange\", (ev) => {\n                debug(\"2) durationchange: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"loadedmetadata\", (ev) => {\n                debug(\"3) loadedmetadata: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"loadeddata\", (ev) => {\n                debug(\"4) loadeddata: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"progress\", (ev) => {\n                debug(\"5) progress: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"canplay\", (ev) => {\n                debug(\"6) canplay: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"canplaythrough\", (ev) => {\n                debug(\"7) canplaythrough: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"play\", (ev) => {\n                debug(\"8) play: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"pause\", (ev) => {\n                debug(\"9) pause: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"ended\", (ev) => {\n                debug(\"10) ended: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"seeked\", (ev) => {\n                debug(\"11) seeked: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            if (DEBUG_AUDIO) {\n                _currentAudioElement.addEventListener(\"timeupdate\", (ev) => {\n                    debug(\"12) timeupdate: \" +\n                    (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                    + (ev.currentTarget as HTMLAudioElement).src.substr(\n                        (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n                });\n            }\n\n            _currentAudioElement.addEventListener(\"seeking\", (ev) => {\n                debug(\"13) seeking: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"waiting\", (ev) => {\n                debug(\"14) waiting: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"volumechange\", (ev) => {\n                debug(\"15) volumechange: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"suspend\", (ev) => {\n                debug(\"16) suspend: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"stalled\", (ev) => {\n                debug(\"17) stalled: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"ratechange\", (ev) => {\n                debug(\"18) ratechange: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"playing\", (ev) => {\n                debug(\"19) playing: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"interruptend\", (ev) => {\n                debug(\"20) interruptend: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"interruptbegin\", (ev) => {\n                debug(\"21) interruptbegin: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"emptied\", (ev) => {\n                debug(\"22) emptied: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n\n            _currentAudioElement.addEventListener(\"abort\", (ev) => {\n                debug(\"23) abort: \" +\n                (_currentAudioUrl !== (ev.currentTarget as HTMLAudioElement).src ? (_currentAudioUrl + \" -- \") : \"\")\n                + (ev.currentTarget as HTMLAudioElement).src.substr(\n                    (ev.currentTarget as HTMLAudioElement).src.lastIndexOf(\"/\")));\n            });\n        }\n\n        const oncanplaythrough = async (ev: Event) => {\n            const currentAudioElement = ev.currentTarget as HTMLAudioElement;\n            currentAudioElement.removeEventListener(\"canplaythrough\", oncanplaythrough);\n            debug(\"oncanplaythrough\");\n            await playClip(true);\n        };\n        _currentAudioElement.addEventListener(\"canplaythrough\", oncanplaythrough);\n\n        const onpause = async (_ev: Event) => {\n            debug(\"onpause\");\n            // mediaOverlaysStateSet(MediaOverlaysStateEnum_.PAUSED);\n        };\n        _currentAudioElement.addEventListener(\"pause\", onpause);\n\n        const onplay = async (_ev: Event) => {\n            debug(\"onplay\");\n            // mediaOverlaysStateSet(MediaOverlaysStateEnum_.PLAYING);\n        };\n        _currentAudioElement.addEventListener(\"play\", onplay);\n\n        _currentAudioElement.playbackRate = _mediaOverlaysPlaybackRate;\n        _currentAudioElement.setAttribute(\"src\", _currentAudioUrl);\n    } else {\n        if (IS_DEV) {\n            debug(\"playMediaOverlaysAudio() - playClip()\");\n        }\n        await playClip(false);\n    }\n}\n\n// https://www.w3.org/TR/epub-33/#sec-behaviors-skip-escape\n// https://www.w3.org/TR/epub-ssv-11/\nconst _skippables = [\n    \"footnote\",\n    \"endnote\",\n    \"pagebreak\",\n    //\n    \"note\",\n    \"rearnote\",\n    \"sidebar\",\n    \"marginalia\",\n    \"annotation\",\n    // \"practice\",\n    // \"help\",\n];\nfunction isSkippable(mo: MediaOverlayNode): boolean {\n    return mo.Role && mo.Role.findIndex((r) => {\n        return _skippables.includes(r);\n    }) >= 0;\n}\n\n// https://www.w3.org/publishing/epub3/epub-mediaoverlays.html#sec-escabaility\n// const _escapables = [\n//     \"table\",\n//     \"table-row\",\n//     \"table-cell\",\n//     \"list\",\n//     \"list-item\",\n//     \"figure\",\n//     //\n//     \"footnote\",\n//     \"endnote\",\n//     \"note\",\n//     \"rearnote\",\n//     \"footnotes\",\n//     \"rearnotes\",\n//     \"sidebar\",\n//     \"bibliography\",\n//     \"toc\",\n//     \"loi\",\n//     \"appendix\",\n//     \"landmarks\",\n//     \"lot\",\n//     \"index\",\n//     \"colophon\",\n//     \"epigraph\",\n//     \"conclusion\",\n//     \"afterword\",\n//     \"warning\",\n//     \"epilogue\",\n//     \"foreword\",\n//     \"introduction\",\n//     \"prologue\",\n//     \"preface\",\n//     \"preamble\",\n//     \"notice\",\n//     \"errata\",\n//     \"copyright-page\",\n//     \"acknowledgments\",\n//     \"other-credits\",\n//     \"titlepage\",\n//     \"imprimatur\",\n//     \"contributors\",\n//     \"halftitlepage\",\n//     \"dedication\",\n//     \"help\",\n//     \"annotation\",\n//     \"marginalia\",\n//     \"practice\",\n//     \"bridgehead\",\n//     \"page-list\",\n//     \"glossary\",\n// ];\n// function isEscapable(mo: MediaOverlayNode): boolean {\n//     return mo.Role && mo.Role.findIndex((r) => {\n//         return _escapables.includes(r);\n//     }) >= 0;\n// }\n\nfunction findNextTextAudioPair(\n    mo: MediaOverlayNode,\n    moToMatch: MediaOverlayNode,\n    previousMo: {prev: MediaOverlayNode | undefined},\n    escape: boolean):\n    MediaOverlayNode | undefined | null { // returns null when skipped\n\n    if (DEBUG_AUDIO) {\n        debug(\"findNextTextAudioPair()\");\n        debug(JSON.stringify(moToMatch));\n        debug(JSON.stringify(previousMo.prev));\n    }\n    const isSkip = _mediaOverlaySkippabilityIsEnabled && isSkippable(mo);\n    if (isSkip) {\n        if (DEBUG_AUDIO) {\n            debug(\"findNextTextAudioPair() - isSkippable\");\n            debug(JSON.stringify(mo));\n        }\n        return null;\n    }\n\n    if (!mo.Children || !mo.Children.length) { // leaf === text/audio pair (SMIL par)\n        if (DEBUG_AUDIO) {\n            debug(\"findNextTextAudioPair() - leaf text/audio pair\");\n            debug(JSON.stringify(mo));\n        }\n        if (previousMo.prev === moToMatch\n            // && (!escape || !isEscapable(mo))\n            ) {\n\n            if (DEBUG_AUDIO) {\n                debug(\"findNextTextAudioPair() - prevMo === moToMatch\");\n            }\n            return mo;\n        }\n        if (!_mediaOverlaySkippabilityIsEnabled || !isSkippable(mo)) {\n            if (DEBUG_AUDIO) {\n                debug(\"findNextTextAudioPair() - set previous\");\n                debug(JSON.stringify(mo));\n            }\n            previousMo.prev = mo;\n        }\n        return undefined;\n    }\n    for (const child of mo.Children) {\n        if (DEBUG_AUDIO) {\n            debug(\"findNextTextAudioPair() - child\");\n            debug(JSON.stringify(child));\n        }\n        const match = findNextTextAudioPair(child, moToMatch, previousMo, escape);\n        if (match) {\n            if (DEBUG_AUDIO) {\n                debug(\"findNextTextAudioPair() - match\");\n                debug(JSON.stringify(match));\n            }\n            return match;\n        }\n    }\n    return undefined;\n}\n\nfunction findPreviousTextAudioPair(\n    mo: MediaOverlayNode,\n    moToMatch: MediaOverlayNode,\n    previousMo: {prev: MediaOverlayNode | undefined}):\n    MediaOverlayNode | undefined | null { // returns null when skipped\n\n    if (DEBUG_AUDIO) {\n        debug(\"findPreviousTextAudioPair()\");\n        debug(JSON.stringify(moToMatch));\n        debug(JSON.stringify(previousMo.prev));\n    }\n    const isSkip = _mediaOverlaySkippabilityIsEnabled && isSkippable(mo);\n    if (isSkip) {\n        if (DEBUG_AUDIO) {\n            debug(\"findPreviousTextAudioPair() - isSkippable\");\n            debug(JSON.stringify(mo));\n        }\n        return null;\n    }\n\n    if (!mo.Children || !mo.Children.length) { // leaf === text/audio pair (SMIL par)\n        if (DEBUG_AUDIO) {\n            debug(\"findPreviousTextAudioPair() - leaf text/audio pair\");\n            debug(JSON.stringify(mo));\n        }\n        if (previousMo.prev &&\n            mo === moToMatch\n            ) {\n\n            if (DEBUG_AUDIO) {\n                debug(\"findPreviousTextAudioPair() - mo === moToMatch\");\n                debug(JSON.stringify(previousMo.prev));\n            }\n            return previousMo.prev;\n        }\n        if (!_mediaOverlaySkippabilityIsEnabled || !isSkippable(mo)) {\n            if (DEBUG_AUDIO) {\n                debug(\"findPreviousTextAudioPair() - set previous\");\n                debug(JSON.stringify(mo));\n            }\n            previousMo.prev = mo;\n        }\n        return undefined;\n    }\n    for (const child of mo.Children) {\n        if (DEBUG_AUDIO) {\n            debug(\"findPreviousTextAudioPair() - child\");\n            debug(JSON.stringify(child));\n        }\n        const match = findPreviousTextAudioPair(child, moToMatch, previousMo);\n        if (match) {\n            if (DEBUG_AUDIO) {\n                debug(\"findPreviousTextAudioPair() - match\");\n                debug(JSON.stringify(match));\n            }\n            return match;\n        }\n    }\n    return undefined;\n}\n\nfunction findDepthFirstTextAudioPair(\n    textHref: string,\n    mo: MediaOverlayNode,\n    textFragmentIDChain: Array<string> | undefined | null,\n    allowFallbackSeek: boolean):\n    MediaOverlayNode | undefined | null { // returns null when skipped\n\n    if (DEBUG_AUDIO) {\n        debug(\"findDepthFirstTextAudioPair()\");\n    }\n    const isSkip = _mediaOverlaySkippabilityIsEnabled && isSkippable(mo);\n\n    let isTextUrlMatch: boolean | undefined;\n    let isFragmentIDMatch: boolean | undefined;\n    if (mo.Text) {\n        const hrefUrlObj = new URL(\"https://dummy.com/\" + mo.Text);\n        if (hrefUrlObj.pathname.substr(1) === textHref) { // includes leading slash\n            isTextUrlMatch = true;\n\n            if (hrefUrlObj.hash && textFragmentIDChain) {\n                isFragmentIDMatch = false;\n                const id = hrefUrlObj.hash.substr(1); // includes #\n                for (const frag of textFragmentIDChain) {\n                    if (frag === id) {\n                        isFragmentIDMatch = true;\n                        break;\n                    }\n                }\n            }\n        } else {\n            isTextUrlMatch = false;\n        }\n    }\n\n    if (DEBUG_AUDIO) {\n        debug(\"isSkip: \" + isSkip);\n        debug(\"isFragmentIDMatch: \" + isFragmentIDMatch);\n        debug(\"isTextUrlMatch: \" + isTextUrlMatch);\n    }\n    const isLeaf = mo.Children?.length;\n    if (!isLeaf) { // leaf === text/audio pair (SMIL par)\n        if (DEBUG_AUDIO) {\n            debug(\"findDepthFirstTextAudioPair() - leaf text/audio pair\");\n        }\n        if (!isTextUrlMatch) {\n            if (DEBUG_AUDIO) {\n                debug(\"findDepthFirstTextAudioPair() - leaf - !isTextUrlMatch\");\n            }\n            return undefined;\n        }\n        if (isFragmentIDMatch ||\n            (isTextUrlMatch && textFragmentIDChain === undefined) // excludes null which is for root call only\n        ) {\n            if (isSkip) {\n                if (DEBUG_AUDIO) {\n                    debug(\"findDepthFirstTextAudioPair() - leaf - isFragmentIDMatch || (isTextUrlMatch && !textFragmentIDChain (isSkip)\");\n                }\n                return null;\n            } else {\n                if (DEBUG_AUDIO) {\n                    debug(\"findDepthFirstTextAudioPair() - leaf - isFragmentIDMatch || (isTextUrlMatch && !textFragmentIDChain\");\n                }\n                return mo;\n            }\n        }\n        return undefined;\n    }\n    const textFragmentIDChainOriginal = textFragmentIDChain;\n    let frags = textFragmentIDChain;\n    for (const child of mo.Children) {\n        if (DEBUG_AUDIO) {\n            debug(\"findDepthFirstTextAudioPair() - child\");\n            debug(JSON.stringify(child));\n        }\n        const match = findDepthFirstTextAudioPair(textHref, child, frags, allowFallbackSeek);\n        if (match === null) { // match, but skipped ... let's ignore the fragment IDs and just pick the next\n            if (DEBUG_AUDIO) {\n                debug(\"findDepthFirstTextAudioPair() - child - match null (skip)\");\n            }\n            frags = undefined;\n        }\n        if (match) {\n            if (DEBUG_AUDIO) {\n                debug(\"findDepthFirstTextAudioPair() - child - match\");\n                debug(JSON.stringify(match));\n            }\n            return match;\n        }\n    }\n    if (allowFallbackSeek && isFragmentIDMatch) {\n        if (isSkip) {\n            if (DEBUG_AUDIO) {\n                debug(\"findDepthFirstTextAudioPair() - post isFragmentIDMatch (skip)\");\n            }\n            return null;\n        } else {\n            if (DEBUG_AUDIO) {\n                debug(\"findDepthFirstTextAudioPair() - post isFragmentIDMatch\");\n            }\n            const match = findDepthFirstTextAudioPair(textHref, mo, undefined, false);\n            if (match) {\n                if (DEBUG_AUDIO) {\n                    debug(\"findDepthFirstTextAudioPair() - post isFragmentIDMatch - match\");\n                    debug(JSON.stringify(match));\n                }\n                return match;\n            } else {\n                return match; // null for skipped, or undefined otherwise\n            }\n        }\n    }\n    if (textFragmentIDChainOriginal && !frags) {\n        // was found, but skippable\n        return null;\n    }\n    return undefined;\n}\n\nlet _timeoutAutoNext: number | undefined;\nfunction ensureKillAutoNextTimeout() {\n    if (_timeoutAutoNext) {\n        clearTimeout(_timeoutAutoNext);\n        _timeoutAutoNext = undefined;\n    }\n}\nasync function playMediaOverlaysForLink(link: Link, textFragmentIDChain: Array<string | null> | undefined, isInteract: boolean) {\n\n    if (IS_DEV) {\n        debug(\"playMediaOverlaysForLink()\");\n        debug(link.Href);\n        debug(link.HrefDecoded);\n        debug(JSON.stringify(textFragmentIDChain, null, 4));\n    }\n    let moUrl: string | undefined;\n    if (link.Properties?.MediaOverlay) {\n        moUrl = link.Properties.MediaOverlay;\n        if (IS_DEV) {\n            debug(link.Properties.MediaOverlay);\n            debug(link.Duration);\n        }\n    }\n    if (link.Alternate) {\n        for (const altLink of link.Alternate) {\n            if (altLink.TypeLink === \"application/vnd.syncnarr+json\") {\n                if (!moUrl) {\n                    moUrl = altLink.Href; // HrefDecoded corrupts the query param! media-overlay.json?href=PATH\n                }\n                if (IS_DEV) {\n                    debug(altLink.Href);\n                    debug(altLink.HrefDecoded);\n                    debug(altLink.TypeLink);\n                    debug(altLink.Duration);\n                }\n            }\n        }\n    }\n\n    ensureKillAutoNextTimeout();\n\n    if (!moUrl) {\n        if (IS_DEV) {\n            debug(\"playMediaOverlaysForLink() - navLeftOrRight()\");\n        }\n        _timeoutAutoNext = win.setTimeout(() => {\n            _timeoutAutoNext = undefined;\n\n            mediaOverlaysStop(true);\n            // metadata-level RTL\n            // const rtl = isRTL_PackageMeta();\n            // navLeftOrRight(rtl, true, true);\n            navPreviousOrNext(false, true, true);\n        }, 600); // was 2 seconds, but transition too slow (user thinks playback is stalled)\n\n        mediaOverlaysStateSet(MediaOverlaysStateEnum_.PLAYING);\n        return;\n    }\n    // typically undefined at first, because serialized JSON not init'ed, lazy-loaded\n    if (!link.MediaOverlays || !link.MediaOverlays.initialized) {\n\n        const publicationURL = win.READIUM2.publicationURL;\n        // if (publicationURL.startsWith(READIUM2_ELECTRON_HTTP_PROTOCOL + \"://\")) {\n        //     publicationURL = convertCustomSchemeToHttpUrl(publicationURL);\n        // }\n\n        // const moUrlFull = publicationURL + \"/../\" + moUrl;\n        const moUrlObjFull = new URL(moUrl, publicationURL);\n        const moUrlFull = moUrlObjFull.toString();\n\n        let response: Response;\n        try {\n            response = await fetch(moUrlFull);\n        } catch (e) {\n            debug(e);\n            debug(moUrlFull);\n            return;\n        }\n        if (!response.ok) {\n            debug(\"BAD RESPONSE?!\");\n        }\n        // response.headers.forEach((arg0: any, arg1: any) => {\n        //     debug(arg0 + \" => \" + arg1);\n        // });\n\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        let moJson: any | undefined;\n        try {\n            moJson = await response.json();\n        } catch (e) {\n            debug(e);\n        }\n        if (!moJson) {\n            return;\n        }\n\n        link.MediaOverlays = TaJsonDeserialize<MediaOverlayNode>(moJson, MediaOverlayNode);\n        // link.MediaOverlays.SmilPathInZip = smilFilePath;\n        link.MediaOverlays.initialized = true;\n\n        if (IS_DEV) {\n            // debug(JSON.stringify(link.MediaOverlays, null, 4));\n            debug(util.inspect(link.MediaOverlays,\n                { showHidden: false, depth: 1000, colors: true, customInspect: true }));\n        }\n    }\n    if (!link.MediaOverlays || !link.MediaOverlays.initialized) {\n        debug(\"Has MO but no Media Overlays?! \" + link.Href);\n        if (IS_DEV) {\n            debug(JSON.stringify(win.READIUM2.publication, null, 4));\n            debug(util.inspect(win.READIUM2.publication,\n                { showHidden: false, depth: 1000, colors: true, customInspect: true }));\n        }\n        return;\n    }\n\n    if (IS_DEV) {\n        debug(\"playMediaOverlaysForLink() - playMediaOverlays()\");\n    }\n    const href = link.HrefDecoded || link.Href;\n    const hrefUrlObj = new URL(\"https://dummy.com/\" + href);\n    // hrefUrlObj.hash = \"\";\n    // hrefUrlObj.search = \"\";\n    await playMediaOverlays(hrefUrlObj.pathname.substr(1), link.MediaOverlays, textFragmentIDChain, isInteract);\n}\n\nlet _lastClickedNotification: {\n    locationHashOverrideInfo: IEventPayload_R2_EVENT_READING_LOCATION | undefined;\n    textFragmentIDChain: Array<string | null> | undefined;\n    link: Link | undefined;\n} | undefined;\nexport function mediaOverlaysHandleIpcMessage(\n    eventChannel: string,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    eventArgs: any[],\n    eventCurrentTarget: IReadiumElectronWebview): boolean {\n\n    const activeWebView = eventCurrentTarget;\n\n    if (eventChannel === R2_EVENT_MEDIA_OVERLAY_CLICK) {\n        // debug(\"R2_EVENT_MEDIA_OVERLAY_CLICK (webview.addEventListener('ipc-message')\");\n        if (publicationHasMediaOverlays(win.READIUM2.publication)\n            // &&\n            // (\n            // // win.READIUM2.mediaOverlaysClickEnabled &&\n            // _mediaOverlayRoot\n            // )\n        ) {\n            if (IS_DEV) {\n                debug(\"R2_EVENT_MEDIA_OVERLAY_CLICK\");\n            }\n\n            const payload = eventArgs[0] as IEventPayload_R2_EVENT_MEDIA_OVERLAY_CLICK;\n\n            // if (!payload.userInteract) {\n            //     let linkFirst: Link | undefined;\n            //     let linkSecond: Link | undefined;\n            //     const firstWebView = win.READIUM2.getFirstWebView();\n            //     if (firstWebView) {\n            //         linkFirst = firstWebView.READIUM2.link;\n            //     }\n            //     const secondWebView = win.READIUM2.getSecondWebView(false);\n            //     if (secondWebView) {\n            //         linkSecond = secondWebView.READIUM2.link;\n            //     }\n            //     if (linkFirst && linkSecond && win.READIUM2.publication.Spine) {\n            //         const indexFirst = win.READIUM2.publication.Spine.indexOf(linkFirst);\n            //         const indexSecond = win.READIUM2.publication.Spine.indexOf(linkSecond);\n            //         if (indexSecond >= 0 && indexFirst >= 0) {\n            //             const firstLink = indexSecond < indexFirst ? linkSecond : linkFirst;\n            //             if (activeWebView.READIUM2.link?.Href &&\n            //                 activeWebView.READIUM2.link?.Href !== firstLink.Href) {\n            //                 debug(`R2_EVENT_MEDIA_OVERLAY_CLICK skipped spread\n            //                 ${activeWebView.READIUM2.link?.Href}`);\n            //                 return true;\n            //             }\n            //         }\n            //     }\n            // }\n\n            const wasPlaying = _mediaOverlaysState === MediaOverlaysStateEnum_.PLAYING;\n            const lastClickedNotification = _lastClickedNotification;\n\n            mediaOverlaysInterrupt();\n\n            _lastClickedNotification = {\n                link: activeWebView.READIUM2.link,\n                textFragmentIDChain: payload.textFragmentIDChain,\n                locationHashOverrideInfo: payload.locationHashOverrideInfo,\n            };\n\n            if ((payload.userInteract && _mediaOverlaysClickEnabled) ||\n                _mediaOverlayActive) {\n\n                if (IS_DEV) {\n                    debug(\"playMediaOverlaysForLink\");\n                }\n                setTimeout(async () => {\n                    if (activeWebView.READIUM2.link) {\n                        await playMediaOverlaysForLink(activeWebView.READIUM2.link, payload.textFragmentIDChain, payload.userInteract);\n                        if (_mediaOverlaysState !== MediaOverlaysStateEnum_.PLAYING) {\n                            _lastClickedNotification = lastClickedNotification;\n                            if (wasPlaying) {\n                                mediaOverlaysResume();\n                            }\n                        }\n                    }\n                }, 0);\n            } else {\n                _lastClickedNotification = lastClickedNotification;\n            }\n        }\n    } else if (eventChannel === R2_EVENT_MEDIA_OVERLAY_STARTSTOP) {\n        const payload = eventArgs[0] as IEventPayload_R2_EVENT_MEDIA_OVERLAY_STARTSTOP;\n\n        if (IS_DEV) {\n            debug(\"R2_EVENT_MEDIA_OVERLAY_STARTSTOP\");\n        }\n        mediaOverlaysStop();\n\n        if (payload.start) {\n            const rate = _mediaOverlaysPlaybackRate;\n            mediaOverlaysPlay(1); // iBooks\n            _mediaOverlaysPlaybackRate = rate;\n        } else if (payload.stop) {\n            //\n        } else {\n            if (_currentAudioElement && !_currentAudioElement.paused) {\n                //\n            } else {\n                const rate = _mediaOverlaysPlaybackRate;\n                mediaOverlaysPlay(1); // iBooks\n                _mediaOverlaysPlaybackRate = rate;\n            }\n        }\n    } else {\n        return false;\n    }\n    return true;\n}\nfunction moHighlight_(moTextAudioPair: MediaOverlayNode) {\n    if (IS_DEV) {\n        debug(\"moHighlight ...\");\n    }\n    if (moTextAudioPair.Text) {\n        const i = moTextAudioPair.Text.lastIndexOf(\"#\");\n        if (i >= 0) {\n            const id = moTextAudioPair.Text.substr(i + 1);\n            if (id) {\n                _mediaOverlayTextId = id;\n                _mediaOverlayTextHref = moTextAudioPair.Text.substr(0, i);\n                moHighlight(_mediaOverlayTextHref, _mediaOverlayTextId);\n            }\n        }\n    }\n}\nfunction moHighlight(href: string | undefined, id: string | undefined) {\n    if (IS_DEV) {\n        debug(\"moHighlight: \" + href + \" ## \" + id);\n    }\n\n    const classActive = win.READIUM2.publication.Metadata?.MediaOverlay?.ActiveClass;\n    const classActivePlayback =\n        win.READIUM2.publication.Metadata?.MediaOverlay?.PlaybackActiveClass;\n    const payload: IEventPayload_R2_EVENT_MEDIA_OVERLAY_HIGHLIGHT = {\n        captionsMode: _captionsMode,\n        classActive: classActive ? classActive : undefined,\n        classActivePlayback: classActivePlayback ? classActivePlayback : undefined,\n        id,\n    };\n    const activeWebViews = win.READIUM2.getActiveWebViews();\n    for (const activeWebView of activeWebViews) {\n        if (href && activeWebView.READIUM2.link?.Href !== href) {\n            continue;\n        }\n\n        if (href) {\n            if (id) {\n                // const loc = getCurrentReadingLocation();\n                // loc?.followingElementIDs\n                _lastClickedNotification = {\n                    link: activeWebView.READIUM2.link,\n                    textFragmentIDChain: [id],\n                    locationHashOverrideInfo: undefined,\n                };\n            } else {\n                _lastClickedNotification = undefined;\n            }\n        }\n        setTimeout(async () => {\n            if (activeWebView.READIUM2?.DOMisReady) {\n                await activeWebView.send(R2_EVENT_MEDIA_OVERLAY_HIGHLIGHT, payload);\n            }\n        }, 0);\n    }\n}\n\nlet _mediaOverlaysState = MediaOverlaysStateEnum_.STOPPED;\nconst mediaOverlaysStateSet = (mediaOverlaysState: MediaOverlaysStateEnum_) => {\n    _mediaOverlaysState = mediaOverlaysState;\n    debug(\"mediaOverlaysStateSet\", mediaOverlaysState);\n\n    const payload: IEventPayload_R2_EVENT_MEDIA_OVERLAY_STATE = {\n        state: mediaOverlaysState,\n    };\n    const activeWebViews = win.READIUM2.getActiveWebViews();\n    for (const activeWebView of activeWebViews) {\n        setTimeout(async () => {\n            if (activeWebView.READIUM2?.DOMisReady) {\n                await activeWebView.send(R2_EVENT_MEDIA_OVERLAY_STATE, payload);\n            }\n        }, 0);\n    }\n\n    if (_mediaOverlaysListener) {\n        _mediaOverlaysListener(mediaOverlaysState);\n    }\n};\n\nlet _mediaOverlaysListener: ((mediaOverlaysState: MediaOverlaysStateEnum_) => void) | undefined;\nexport function mediaOverlaysListen(mediaOverlaysListener: (mediaOverlaysState: MediaOverlaysStateEnum_) => void) {\n    _mediaOverlaysListener = mediaOverlaysListener;\n}\n\nexport function mediaOverlaysPlay(speed: number) {\n    if (IS_DEV) {\n        debug(\"mediaOverlaysPlay()\");\n    }\n    if (!win.READIUM2 || !win.READIUM2.publication) {\n        return;\n    }\n\n    _mediaOverlaysPlaybackRate = speed;\n\n    if (!_mediaOverlayRoot || !_mediaOverlayTextAudioPair) {\n        if (IS_DEV) {\n            debug(\"mediaOverlaysPlay() - playMediaOverlaysForLink()\");\n        }\n        let textFragmentIDChain: Array<string | null> | undefined;\n        const href = _lastClickedNotification?.link?.Href;\n        let activeWebView = win.READIUM2.getActiveWebViews().find((webview) => {\n            return href && webview.READIUM2.link?.Href === href;\n        });\n        if (activeWebView) {\n            textFragmentIDChain = _lastClickedNotification?.textFragmentIDChain;\n        } else {\n            activeWebView = win.READIUM2.getFirstWebView();\n        }\n        setTimeout(async () => {\n            if (activeWebView && activeWebView.READIUM2.link) {\n                await playMediaOverlaysForLink(activeWebView.READIUM2.link, textFragmentIDChain, false);\n            }\n        }, 0);\n    } else {\n        if (IS_DEV) {\n            debug(\"mediaOverlaysPlay() - mediaOverlaysResume()\");\n        }\n        mediaOverlaysResume();\n    }\n}\n\nexport function mediaOverlaysPause() {\n    if (IS_DEV) {\n        debug(\"mediaOverlaysPause()\");\n    }\n    if (!win.READIUM2 || !win.READIUM2.publication) {\n        return;\n    }\n\n    moHighlight(undefined, undefined);\n\n    ensureOnTimeUpdate(true);\n    if (_currentAudioElement) {\n        _currentAudioElement.pause();\n    }\n\n    mediaOverlaysStateSet(MediaOverlaysStateEnum_.PAUSED);\n}\n\nexport function mediaOverlaysInterrupt() {\n    if (!win.READIUM2 || !win.READIUM2.publication) {\n        return;\n    }\n    if (!publicationHasMediaOverlays(win.READIUM2.publication)) {\n        return;\n    }\n    if (IS_DEV) {\n        debug(\"mediaOverlaysInterrupt()\");\n    }\n    mediaOverlaysStop(_mediaOverlayActive);\n}\nexport function mediaOverlaysStop(stayActive?: boolean) {\n    if (IS_DEV) {\n        debug(\"mediaOverlaysStop() stayActive: \" + stayActive);\n    }\n    if (!win.READIUM2 || !win.READIUM2.publication) {\n        return;\n    }\n\n    _mediaOverlayActive = stayActive ? true : false;\n\n    mediaOverlaysPause();\n\n    _mediaOverlayRoot = undefined;\n    _mediaOverlayTextAudioPair = undefined;\n    _mediaOverlayTextId = undefined;\n\n    if (!_mediaOverlayActive) {\n        _lastClickedNotification = undefined;\n        mediaOverlaysStateSet(MediaOverlaysStateEnum_.STOPPED);\n\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        if (_currentAudioElement && (_currentAudioElement as any).__draggable) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            (_currentAudioElement as any).__hidden = true;\n            _currentAudioElement.style.display = \"none\";\n        }\n        // if (_currentAudioElement) {\n        //     ensureOnTimeUpdate(true);\n        //     // _currentAudioElement.pause();\n        //     _currentAudioElement.setAttribute(\"src\", \"\");\n        //     if (_currentAudioElement.parentNode) {\n        //         _currentAudioElement.parentNode.removeChild(_currentAudioElement);\n        //     }\n        //     _currentAudioElement = undefined;\n        // }\n    }\n}\n\nexport function mediaOverlaysResume() {\n    if (IS_DEV) {\n        debug(\"mediaOverlaysResume()\");\n    }\n    if (!win.READIUM2 || !win.READIUM2.publication) {\n        return;\n    }\n\n    if (_mediaOverlayRoot && _mediaOverlayTextAudioPair) {\n        if (IS_DEV) {\n            debug(\"mediaOverlaysResume() - _currentAudioElement.play()\");\n        }\n        ensureOnTimeUpdate(false);\n        if (_currentAudioElement) {\n            setTimeout(async () => {\n                if (_currentAudioElement) {\n                    _currentAudioElement.playbackRate = _mediaOverlaysPlaybackRate;\n                    await _currentAudioElement.play();\n                }\n            }, 0);\n        }\n        mediaOverlaysStateSet(MediaOverlaysStateEnum_.PLAYING);\n        moHighlight_(_mediaOverlayTextAudioPair);\n    } else {\n        if (IS_DEV) {\n            debug(\"mediaOverlaysResume() - mediaOverlaysPlay()\");\n        }\n        mediaOverlaysPlay(_mediaOverlaysPlaybackRate);\n    }\n}\n\nexport function mediaOverlaysPrevious() {\n    if (IS_DEV) {\n        debug(\"mediaOverlaysPrevious()\");\n    }\n    if (!win.READIUM2 || !win.READIUM2.publication) {\n        return;\n    }\n    // (currentAudioElement as any).__ontimeupdate = false;\n    // currentAudioElement.removeEventListener(\"timeupdate\", ontimeupdate);\n    ensureOnTimeUpdate(true);\n\n    if (_mediaOverlayRoot && _mediaOverlayTextAudioPair) {\n        const previousTextAudioPair =\n            findPreviousTextAudioPair(_mediaOverlayRoot, _mediaOverlayTextAudioPair, {prev: undefined});\n        if (!previousTextAudioPair) {\n            if (IS_DEV) {\n                debug(\"mediaOverlaysPrevious() - navLeftOrRight()\");\n            }\n            mediaOverlaysStop(true);\n            // metadata-level RTL\n            // const rtl = isRTL_PackageMeta();\n            // navLeftOrRight(!rtl, true, true);\n            navPreviousOrNext(true, true, true);\n        } else {\n            let switchDoc = false;\n            if (_mediaOverlayTextAudioPair.Text && previousTextAudioPair.Text) {\n                const hrefUrlObj1 = new URL(\"https://dummy.com/\" + _mediaOverlayTextAudioPair.Text);\n                const hrefUrlObj2 = new URL(\"https://dummy.com/\" + previousTextAudioPair.Text);\n                if (hrefUrlObj1.pathname !== hrefUrlObj2.pathname) { // includes leading slash\n                    if (IS_DEV) {\n                        debug(\"mediaOverlaysPrevious SWITCH! \" + hrefUrlObj1.pathname + \" != \" + hrefUrlObj2.pathname);\n                    }\n                    switchDoc = true;\n                }\n            }\n            if (switchDoc) {\n                mediaOverlaysStop(true);\n\n                const publicationURL = win.READIUM2.publicationURL;\n                // if (publicationURL.startsWith(READIUM2_ELECTRON_HTTP_PROTOCOL + \"://\")) {\n                //     publicationURL = convertCustomSchemeToHttpUrl(publicationURL);\n                // }\n\n                // const url = publicationURL + \"/../\" + previousTextAudioPair.Text;\n                const urlObjFull = new URL(previousTextAudioPair.Text, publicationURL);\n                const urlFull = urlObjFull.toString();\n                if (IS_DEV) {\n                    debug(\"mediaOverlaysPrevious() - handleLinkUrl()\");\n                }\n                const activeWebView = win.READIUM2.getFirstOrSecondWebView();\n                handleLinkUrl(\n                    urlFull,\n                    activeWebView ? activeWebView.READIUM2.readiumCss : undefined);\n            } else {\n                if (IS_DEV) {\n                    debug(\"mediaOverlaysPrevious() - playMediaOverlaysAudio()\");\n                }\n                setTimeout(async () => {\n                    await playMediaOverlaysAudio(previousTextAudioPair, undefined, undefined);\n                }, 0);\n\n                mediaOverlaysStateSet(MediaOverlaysStateEnum_.PLAYING);\n            }\n        }\n    } else {\n        if (IS_DEV) {\n            debug(\"mediaOverlaysPrevious() - navLeftOrRight() 2\");\n        }\n        mediaOverlaysStop(true);\n        // metadata-level RTL\n        // const rtl = isRTL_PackageMeta();\n        // navLeftOrRight(!rtl, true, true);\n        navPreviousOrNext(true, true, true);\n        // if (IS_DEV) {\n        //     debug(\"mediaOverlaysPrevious() - mediaOverlaysPlay()\");\n        // }\n        // mediaOverlaysPlay(_mediaOverlaysPlaybackRate);\n    }\n}\n\nexport function mediaOverlaysNext(escape?: boolean) {\n    if (IS_DEV) {\n        debug(\"mediaOverlaysNext()\");\n    }\n    if (!win.READIUM2 || !win.READIUM2.publication) {\n        return;\n    }\n    // (currentAudioElement as any).__ontimeupdate = false;\n    // currentAudioElement.removeEventListener(\"timeupdate\", ontimeupdate);\n    ensureOnTimeUpdate(true);\n\n    if (_mediaOverlayRoot && _mediaOverlayTextAudioPair) {\n        const nextTextAudioPair =\n            findNextTextAudioPair(_mediaOverlayRoot, _mediaOverlayTextAudioPair, {prev: undefined},\n                escape ? true : false);\n        if (!nextTextAudioPair) {\n            if (IS_DEV) {\n                debug(\"mediaOverlaysNext() - navLeftOrRight()\");\n            }\n            mediaOverlaysStop(true);\n            // metadata-level RTL\n            // const rtl = isRTL_PackageMeta();\n            // navLeftOrRight(rtl, true, true);\n            navPreviousOrNext(false, true, true);\n        } else {\n            let switchDoc = false;\n            if (_mediaOverlayTextAudioPair.Text && nextTextAudioPair.Text) {\n                const hrefUrlObj1 = new URL(\"https://dummy.com/\" + _mediaOverlayTextAudioPair.Text);\n                const hrefUrlObj2 = new URL(\"https://dummy.com/\" + nextTextAudioPair.Text);\n                if (hrefUrlObj1.pathname !== hrefUrlObj2.pathname) { // includes leading slash\n                    if (IS_DEV) {\n                        debug(\"mediaOverlaysNext() SWITCH! \" + hrefUrlObj1.pathname + \" != \" + hrefUrlObj2.pathname);\n                    }\n                    switchDoc = true;\n                }\n            }\n            if (switchDoc) {\n                mediaOverlaysStop(true);\n\n                const publicationURL = win.READIUM2.publicationURL;\n                // if (publicationURL.startsWith(READIUM2_ELECTRON_HTTP_PROTOCOL + \"://\")) {\n                //     publicationURL = convertCustomSchemeToHttpUrl(publicationURL);\n                // }\n\n                // const url = publicationURL + \"/../\" + nextTextAudioPair.Text;\n                const urlObjFull = new URL(nextTextAudioPair.Text, publicationURL);\n                const urlFull = urlObjFull.toString();\n                if (IS_DEV) {\n                    debug(\"mediaOverlaysNext() - handleLinkUrl()\");\n                }\n                const activeWebView = win.READIUM2.getFirstOrSecondWebView();\n                handleLinkUrl(\n                    urlFull,\n                    activeWebView ? activeWebView.READIUM2.readiumCss : undefined);\n            } else {\n                if (IS_DEV) {\n                    debug(\"mediaOverlaysNext() - playMediaOverlaysAudio()\");\n                }\n                setTimeout(async () => {\n                    await playMediaOverlaysAudio(nextTextAudioPair, undefined, undefined);\n                }, 0);\n\n                mediaOverlaysStateSet(MediaOverlaysStateEnum_.PLAYING);\n            }\n        }\n    } else {\n        if (IS_DEV) {\n            debug(\"mediaOverlaysNext() - navLeftOrRight() 2\");\n        }\n        mediaOverlaysStop(true);\n        // metadata-level RTL\n        // const rtl = isRTL_PackageMeta();\n        // navLeftOrRight(rtl, true, true);\n        navPreviousOrNext(false, true, true);\n        // if (IS_DEV) {\n        //     debug(\"mediaOverlaysNext() - mediaOverlaysPlay()\");\n        // }\n        // mediaOverlaysPlay(_mediaOverlaysPlaybackRate);\n    }\n}\n\nexport function mediaOverlaysEscape() {\n    if (!win.READIUM2 || !win.READIUM2.publication) {\n        return;\n    }\n    mediaOverlaysNext(true);\n}\n\nexport function mediaOverlaysEnableCaptionsMode(captionsMode: boolean) {\n    _captionsMode = captionsMode;\n\n    // if (IS_DEV) {\n    //     debug(\"mediaOverlaysEnableCaptionsMode() - mediaOverlaysPause() + mediaOverlaysPlay()\");\n    // }\n    // mediaOverlaysPause();\n    // setTimeout(() => {\n    //     mediaOverlaysPlay(_mediaOverlaysPlaybackRate);\n    // }, 300);\n}\n\nexport function mediaOverlaysClickEnable(doEnable: boolean) {\n    _mediaOverlaysClickEnabled = doEnable;\n    // if (win.READIUM2) {\n    //     win.READIUM2.mediaOverlaysClickEnabled = doEnable;\n    // }\n\n    // const activeWebViews = win.READIUM2.getActiveWebViews();\n\n    // if (!activeWebView) {\n    //     return;\n    // }\n\n    // const payload: IEventPayload_R2_EVENT_MEDIA_OVERLAYS_CLICK_ENABLE = {\n    //     doEnable,\n    // };\n\n    // setTimeout(async () => {\n    // if (activeWebView.READIUM2?.DOMisReady) {\n    //     await activeWebView.send(R2_EVENT_MEDIA_OVERLAYS_CLICK_ENABLE, payload);\n    // }, 0);\n}\n\nexport function mediaOverlaysPlaybackRate(speed: number) {\n    if (!win.READIUM2 || !win.READIUM2.publication) {\n        return;\n    }\n\n    _mediaOverlaysPlaybackRate = speed;\n\n    if (_currentAudioElement) {\n        _currentAudioElement.playbackRate = speed;\n    }\n}\n\nlet _mediaOverlaySkippabilityIsEnabled = true;\nexport function mediaOverlaysEnableSkippability(doEnable: boolean) {\n    _mediaOverlaySkippabilityIsEnabled = doEnable;\n}\n"]}