{"version":3,"file":"cssselector2.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/common/cssselector2.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\n// https://github.com/antonmedv/finder\n\nimport * as cssesc from \"cssesc\";\n\ninterface CSSNode {\n    name: string;\n    penalty: number;\n    level?: number;\n}\n\nenum Limit {\n    All,\n    Two,\n    One,\n}\n\nexport interface Options {\n    root: Element;\n    idName: (name: string) => boolean;\n    className: (name: string) => boolean;\n    tagName: (name: string) => boolean;\n    seedMinLength: number;\n    optimizedMinLength: number;\n    threshold: number;\n}\n\nlet config: Options;\nlet rootDocument: Document | Element;\n\nexport function uniqueCssSelector(input: Element, doc: Document, options?: Partial<Options>) {\n    if (input.nodeType !== Node.ELEMENT_NODE) {\n        throw new Error(`Can't generate CSS selector for non-element node type.`);\n    }\n\n    if (\"html\" === input.tagName.toLowerCase()) {\n        return input.tagName.toLowerCase();\n    }\n\n    const defaults: Options = {\n        className: (_name: string) => true,\n        idName: (_name: string) => true,\n        optimizedMinLength: 2,\n        root: doc.body,\n        seedMinLength: 1,\n        tagName: (_name: string) => true,\n        threshold: 1000,\n    };\n\n    config = { ...defaults, ...options };\n\n    rootDocument = findRootDocument(config.root, defaults);\n\n    let path =\n        bottomUpSearch(input, Limit.All, () =>\n            bottomUpSearch(input, Limit.Two, () =>\n                bottomUpSearch(input, Limit.One)));\n\n    if (path) {\n        const optimized = sort(optimize(path, input));\n\n        if (optimized.length > 0) {\n            path = optimized[0];\n        }\n\n        return selector(path);\n    } else {\n        throw new Error(`Selector was not found.`);\n    }\n}\n\nfunction findRootDocument(rootNode: Element | Document, defaults: Options) {\n    if (rootNode.nodeType === Node.DOCUMENT_NODE) {\n        return rootNode;\n    }\n    if (rootNode === defaults.root) {\n        return rootNode.ownerDocument as Document;\n    }\n    return rootNode;\n}\n\nfunction bottomUpSearch(input: Element, limit: Limit, fallback?: () => CSSNode[] | null): CSSNode[] | null {\n    let path: CSSNode[] | null = null;\n    const stack: CSSNode[][] = [];\n    let current: Element | null = input;\n    let i = 0;\n\n    while (current && current !== config.root.parentElement) {\n        let level: CSSNode[] = maybe(id(current)) || maybe(...classNames(current)) ||\n            maybe(tagName(current)) || [any()];\n\n        const nth = index(current);\n\n        if (limit === Limit.All) {\n            if (nth) {\n                level = level.concat(level.filter(dispensableNth).map((node) => nthChild(node, nth)));\n            }\n        } else if (limit === Limit.Two) {\n            level = level.slice(0, 1);\n\n            if (nth) {\n                level = level.concat(level.filter(dispensableNth).map((node) => nthChild(node, nth)));\n            }\n        } else if (limit === Limit.One) {\n            const [node] = level = level.slice(0, 1);\n\n            if (nth && dispensableNth(node)) {\n                level = [nthChild(node, nth)];\n            }\n        }\n\n        for (const node of level) {\n            node.level = i;\n        }\n\n        stack.push(level);\n\n        if (stack.length >= config.seedMinLength) {\n            path = findUniquePath(stack, fallback);\n            if (path) {\n                break;\n            }\n        }\n\n        current = current.parentElement;\n        i++;\n    }\n\n    if (!path) {\n        path = findUniquePath(stack, fallback);\n    }\n\n    return path;\n}\n\nfunction findUniquePath(stack: CSSNode[][], fallback?: () => CSSNode[] | null): CSSNode[] | null {\n    const paths = sort(combinations(stack));\n\n    if (paths.length > config.threshold) {\n        return fallback ? fallback() : null;\n    }\n\n    for (const candidate of paths) {\n        if (unique(candidate)) {\n            return candidate;\n        }\n    }\n\n    return null;\n}\n\nfunction selector(path: CSSNode[]): string {\n    let node = path[0];\n    let query = node.name;\n    for (let i = 1; i < path.length; i++) {\n        const level = path[i].level || 0;\n\n        if (node.level === level - 1) {\n            query = `${path[i].name} > ${query}`;\n        } else {\n            query = `${path[i].name} ${query}`;\n        }\n\n        node = path[i];\n    }\n    return query;\n}\n\nfunction penalty(path: CSSNode[]): number {\n    return path.map((node) => node.penalty).reduce((acc, i) => acc + i, 0);\n}\n\nfunction unique(path: CSSNode[]) {\n    switch (rootDocument.querySelectorAll(selector(path)).length) {\n        case 0:\n            throw new Error(`Can't select any node with this selector: ${selector(path)}`);\n        case 1:\n            return true;\n        default:\n            return false;\n    }\n}\n\nfunction id(input: Element): CSSNode | null {\n    const elementId = input.getAttribute(\"id\");\n    if (elementId && config.idName(elementId)) {\n        return {\n            name: \"#\" + cssesc(elementId, { isIdentifier: true }),\n            penalty: 0,\n        };\n    }\n    return null;\n}\n\nfunction classNames(input: Element): CSSNode[] {\n    const names = Array.from(input.classList)\n        .filter(config.className);\n\n    return names.map((name): CSSNode => ({\n        name: \".\" + cssesc(name, { isIdentifier: true }),\n        penalty: 1,\n    }));\n}\n\nfunction tagName(input: Element): CSSNode | null {\n    const name = input.tagName.toLowerCase();\n    if (config.tagName(name)) {\n        return {\n            name,\n            penalty: 2,\n        };\n    }\n    return null;\n}\n\nfunction any(): CSSNode {\n    return {\n        name: \"*\",\n        penalty: 3,\n    };\n}\n\nfunction index(input: Element): number | null {\n    const parent = input.parentNode;\n    if (!parent) {\n        return null;\n    }\n\n    let child: Node | null = parent.firstChild;\n    if (!child) {\n        return null;\n    }\n\n    let i = 0;\n    while (child) {\n        if (child.nodeType === Node.ELEMENT_NODE) {\n            i++;\n        }\n\n        if (child === input) {\n            break;\n        }\n\n        child = child.nextSibling;\n    }\n\n    return i;\n}\n\nfunction nthChild(node: CSSNode, i: number): CSSNode {\n    return {\n        name: node.name + `:nth-child(${i})`,\n        penalty: node.penalty + 1,\n    };\n}\n\nfunction dispensableNth(node: CSSNode) {\n    return node.name !== \"html\" && !node.name.startsWith(\"#\");\n}\n\nfunction maybe(...level: Array<CSSNode | null>): CSSNode[] | null {\n    const list = level.filter(notEmpty);\n    if (list.length > 0) {\n        return list;\n    }\n    return null;\n}\n\nfunction notEmpty<T>(value: T | null | undefined): value is T {\n    return value !== null && value !== undefined;\n}\n\nfunction* combinations(stack: CSSNode[][], path: CSSNode[] = []): IterableIterator<CSSNode[]> {\n    if (stack.length > 0) {\n        for (const node of stack[0]) {\n            yield* combinations(stack.slice(1, stack.length), path.concat(node));\n        }\n    } else {\n        yield path;\n    }\n}\n\nfunction sort(paths: IterableIterator<CSSNode[]>): CSSNode[][] {\n    return Array.from(paths).sort((a, b) => penalty(a) - penalty(b));\n}\n\nfunction* optimize(path: CSSNode[], input: Element): IterableIterator<CSSNode[]> {\n    if (path.length > 2 && path.length > config.optimizedMinLength) {\n        for (let i = 1; i < path.length - 1; i++) {\n            const newPath = [...path];\n            newPath.splice(i, 1);\n\n            if (unique(newPath) && same(newPath, input)) {\n                yield newPath;\n                yield* optimize(newPath, input);\n            }\n        }\n    }\n}\n\nfunction same(path: CSSNode[], input: Element) {\n    return rootDocument.querySelector(selector(path)) === input;\n}\n"]}