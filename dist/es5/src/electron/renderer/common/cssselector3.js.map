{"version":3,"file":"cssselector3.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/common/cssselector3.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\n// @medv/finder v3.1.0\n// https://github.com/antonmedv/finder/blob/df88b7266bdf21fc657efc00469001c2af04b433/finder.ts\n\n// This polyfill automatically invokes the native CSS.escape API if available\n// https://github.com/mathiasbynens/CSS.escape/blob/4b25c283eaf4dd443f44a7096463e973d56dd1b2/css.escape.js#L16-L18\n// https://developer.mozilla.org/en-US/docs/Web/API/CSS/escape_static\nimport * as CSSEscape from \"css.escape\";\n\ntype Knot = {\n    name: string\n    penalty: number\n    level?: number\n}\n\ntype Path = Knot[]\n\nexport type Options = {\n    root: Element\n    idName: (name: string) => boolean\n    className: (name: string) => boolean\n    tagName: (name: string) => boolean\n    attr: (name: string, value: string) => boolean\n    seedMinLength: number\n    optimizedMinLength: number\n    threshold: number\n    maxNumberOfTries: number\n}\n\nlet config: Options;\nlet rootDocument: Document | Element;\n\nexport function uniqueCssSelector(input: Element, doc: Document, options?: Partial<Options>) {\n    if (input.nodeType !== Node.ELEMENT_NODE) {\n        throw new Error(\"Can't generate CSS selector for non-element node type.\");\n    }\n    if (\"html\" === input.tagName.toLowerCase()) {\n        return \"html\";\n    }\n    const defaults: Options = {\n        root: doc.body,\n        idName: (_name: string) => true,\n        className: (_name: string) => true,\n        tagName: (_name: string) => true,\n        attr: (_name: string, _value: string) => false,\n        seedMinLength: 1,\n        optimizedMinLength: 2,\n        threshold: 1000,\n        maxNumberOfTries: 10000,\n    };\n\n    config = { ...defaults, ...options };\n    rootDocument = findRootDocument(config.root, defaults);\n\n    let path =\n        bottomUpSearch(input, \"all\",\n            () => bottomUpSearch(input, \"two\",\n                () => bottomUpSearch(input, \"one\",\n                    () => bottomUpSearch(input, \"none\"))));\n\n    if (path) {\n        const optimized = sort(optimize(path, input));\n        if (optimized.length > 0) {\n            path = optimized[0];\n        }\n        return selector(path);\n    } else {\n        throw new Error(\"Selector was not found.\");\n    }\n}\n\nfunction findRootDocument(rootNode: Element | Document, defaults: Options) {\n    if (rootNode.nodeType === Node.DOCUMENT_NODE) {\n        return rootNode;\n    }\n    if (rootNode === defaults.root) {\n        return rootNode.ownerDocument as Document;\n    }\n    return rootNode;\n}\n\nfunction bottomUpSearch(\n    input: Element,\n    limit: \"all\" | \"two\" | \"one\" | \"none\",\n    fallback?: () => Path | null,\n): Path | null {\n    let path: Path | null = null;\n    const stack: Knot[][] = [];\n    let current: Element | null = input;\n    let i = 0;\n    while (current) {\n        let level: Knot[] = maybe(id(current)) ||\n            maybe(...attr(current)) ||\n            maybe(...classNames(current)) ||\n            maybe(tagName(current)) || [any()];\n        const nth = index(current);\n        if (limit == \"all\") {\n            if (nth) {\n                level = level.concat(\n                    level.filter(dispensableNth).map((node) => nthChild(node, nth)),\n                );\n            }\n        } else if (limit == \"two\") {\n            level = level.slice(0, 1);\n            if (nth) {\n                level = level.concat(\n                    level.filter(dispensableNth).map((node) => nthChild(node, nth)),\n                );\n            }\n        } else if (limit == \"one\") {\n            const [node] = (level = level.slice(0, 1));\n            if (nth && dispensableNth(node)) {\n                level = [nthChild(node, nth)];\n            }\n        } else if (limit == \"none\") {\n            level = [any()];\n            if (nth) {\n                level = [nthChild(level[0], nth)];\n            }\n        }\n        for (const node of level) {\n            node.level = i;\n        }\n        stack.push(level);\n        if (stack.length >= config.seedMinLength) {\n            path = findUniquePath(stack, fallback);\n            if (path) {\n                break;\n            }\n        }\n        current = current.parentElement;\n\n        if (current && !current.parentElement) {\n            break; // exclude root HTML document element for when seedMinLength and optimizedMinLength allow reaching up to the body and even beyond in the ancestor path.\n        }\n        // if (current && (!current.parentElement || !current.parentElement.parentElement)) {\n        //     break; // exclude root HTML document element or even body element for when seedMinLength and optimizedMinLength allow reaching up to the body and even beyond in the ancestor path.\n        // }\n\n        i++;\n    }\n    if (!path) {\n        path = findUniquePath(stack, fallback);\n    }\n    if (!path && fallback) {\n        return fallback();\n    }\n    return path;\n}\n\nfunction findUniquePath(\n    stack: Knot[][],\n    fallback?: () => Path | null,\n): Path | null {\n    const paths = sort(combinations(stack));\n    if (paths.length > config.threshold) {\n        return fallback ? fallback() : null;\n    }\n    for (const candidate of paths) {\n        if (unique(candidate)) {\n            return candidate;\n        }\n    }\n    return null;\n}\n\nfunction selector(path: Path): string {\n    let node = path[0];\n    let query = node.name;\n    for (let i = 1; i < path.length; i++) {\n        const level = path[i].level || 0;\n        if (node.level === level - 1) {\n            query = `${path[i].name} > ${query}`;\n        } else {\n            query = `${path[i].name} ${query}`;\n        }\n        node = path[i];\n    }\n    return query;\n}\n\nfunction penalty(path: Path): number {\n    return path.map((node) => node.penalty).reduce((acc, i) => acc + i, 0);\n}\n\nfunction unique(path: Path) {\n    const css = selector(path);\n    switch (rootDocument.querySelectorAll(css).length) {\n        case 0:\n            throw new Error(\n                `Can't select any node with this selector: ${css}`,\n            );\n        case 1:\n            return true;\n        default:\n            return false;\n    }\n}\n\nfunction id(input: Element): Knot | null {\n    const elementId = input.getAttribute(\"id\");\n    if (elementId && config.idName(elementId)) {\n        return {\n            name: \"#\" + CSSEscape(elementId),\n            penalty: 0,\n        };\n    }\n    return null;\n}\n\nfunction attr(input: Element): Knot[] {\n    const attrs = Array.from(input.attributes).filter((attr) =>\n        config.attr(attr.name, attr.value),\n    );\n    return attrs.map(\n        (attr): Knot => ({\n            name: `[${CSSEscape(attr.name)}=\"${CSSEscape(attr.value)}\"]`,\n            penalty: 0.5,\n        }),\n    );\n}\n\nfunction classNames(input: Element): Knot[] {\n    const names = Array.from(input.classList).filter(config.className);\n    return names.map(\n        (name): Knot => ({\n            name: \".\" + CSSEscape(name),\n            penalty: 1,\n        }),\n    );\n}\n\nconst ELEMENT_NAMESPACE_PREFIX = /^(.+:)(.+)$/;\nconst ELEMENT_NAMESPACE_PREFIX_ = /^\\*\\|(a|script|style)$/;\nfunction tagName(input: Element): Knot | null {\n    const name = input.tagName.toLowerCase();\n    if (config.tagName(name)) {\n\n        // https://github.com/antonmedv/finder/issues/78\n        // \"div\" ==> \"div\", \"m:math\" ==> \"*|math\", \"svg:a\" ==> \"*|a\" (which unfortunately matches HTML \"a\" without XML namespace too! ... that's a shortcoming of the web's querySelector() API) https://www.w3.org/TR/selectors-api/#namespace-prefix-needs-to-be-resolved\n        const n = name.replace(ELEMENT_NAMESPACE_PREFIX, \"*|$2\").replace(ELEMENT_NAMESPACE_PREFIX_, \"*|$1:not(|$1)\"); // match SVG / MathML namespace-prefixed elements but exclude HTML elements with the same non-prefixed name\n        return {\n            name: n,\n            penalty: 2,\n        };\n    }\n    return null;\n}\n\nfunction any(): Knot {\n    return {\n        name: \"*\",\n        penalty: 3,\n    };\n}\n\nfunction index(input: Element): number | null {\n    const parent = input.parentNode;\n    if (!parent) {\n        return null;\n    }\n    let child = parent.firstChild;\n    if (!child) {\n        return null;\n    }\n    let i = 0;\n    while (child) {\n        if (child.nodeType === Node.ELEMENT_NODE) {\n            i++;\n        }\n        if (child === input) {\n            break;\n        }\n        child = child.nextSibling;\n    }\n    return i;\n}\n\nfunction nthChild(node: Knot, i: number): Knot {\n    return {\n        name: node.name + `:nth-child(${i})`,\n        penalty: node.penalty + 1,\n    };\n}\n\nfunction dispensableNth(node: Knot) {\n    return node.name !== \"html\" && !node.name.startsWith(\"#\");\n}\n\nfunction maybe(...level: (Knot | null)[]): Knot[] | null {\n    const list = level.filter(notEmpty);\n    if (list.length > 0) {\n        return list;\n    }\n    return null;\n}\n\nfunction notEmpty<T>(value: T | null | undefined): value is T {\n    return value !== null && value !== undefined;\n}\n\nfunction* combinations(stack: Knot[][], path: Knot[] = []): Generator<Knot[]> {\n    if (stack.length > 0) {\n        for (const node of stack[0]) {\n            yield* combinations(stack.slice(1, stack.length), path.concat(node));\n        }\n    } else {\n        yield path;\n    }\n}\n\nfunction sort(paths: Iterable<Path>): Path[] {\n    return [...paths].sort((a, b) => penalty(a) - penalty(b));\n}\n\ntype Scope = {\n    counter: number\n    visited: Map<string, boolean>\n}\n\nfunction* optimize(\n    path: Path,\n    input: Element,\n    scope: Scope = {\n        counter: 0,\n        visited: new Map<string, boolean>(),\n    },\n): Generator<Knot[]> {\n    if (path.length > 2 && path.length > config.optimizedMinLength) {\n        for (let i = 1; i < path.length - 1; i++) {\n            if (scope.counter > config.maxNumberOfTries) {\n                return; // Okay At least I tried!\n            }\n            scope.counter += 1;\n            const newPath = [...path];\n            newPath.splice(i, 1);\n            const newPathKey = selector(newPath);\n            if (scope.visited.has(newPathKey)) {\n                return;\n            }\n            if (unique(newPath) && same(newPath, input)) {\n                yield newPath;\n                scope.visited.set(newPathKey, true);\n                yield* optimize(newPath, input, scope);\n            }\n        }\n    }\n}\n\nfunction same(path: Path, input: Element) {\n    return rootDocument.querySelector(selector(path)) === input;\n}\n"]}