{"version":3,"file":"animateProperty.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/common/animateProperty.ts"],"names":[],"mappings":";;;AAqBO,IAAM,eAAe,GAAG,UAC3B,GAAyB,EACzB,QAAoD,EACpD,QAAgB,EAChB,QAAgB,EAChB,MAAW,EACX,OAAe,EACf,GAAiC,EACjC,UAAkE;IAGlE,IAAM,KAAK,GAA4B;QACnC,SAAS,EAAE,KAAK;QAChB,QAAQ,EAAE,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAC;QACpC,OAAO,SAAA;QACP,QAAQ,UAAA;QACR,EAAE,EAAE,CAAC;QACL,OAAO,EAAE,CAAC;QACV,OAAO,EAAE,CAAC;QACV,MAAM,QAAA;QACN,SAAS,EAAE,MAAM,CAAC,QAAQ,CAAC;QAC3B,QAAQ,UAAA;QACR,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;KACxB,CAAC;IAEF,IAAM,OAAO,GAAG;QACZ,KAAK,CAAC,SAAS,GAAG,IAAI,CAAC;QACvB,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAC3B,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CACrB,UAAU,CAAC,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC,SAAS,EAAE,KAAK,CAAC,SAAS,EAAE,KAAK,CAAC,QAAQ,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;QAElG,IAAI,CAAC,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,KAAK,KAAK,CAAC,OAAO,EAAE;YAClE,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,MAAM,CAAC;YACtC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;SAC1B;aAAM;YACH,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC;YACxB,KAAK,CAAC,MAAM,GAAG,EAAE,CAAC;YAClB,IAAI,QAAQ,EAAE;gBACV,QAAQ,CAAC,IAAI,CAAC,CAAC;aAClB;YACD,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YACd,OAAO;SACV;QAED,IAAI,KAAK,CAAC,OAAO,GAAG,CAAC,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAE;YACpD,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC;YACxB,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC;YAC7C,KAAK,CAAC,MAAM,GAAG,EAAE,CAAC;YAClB,IAAI,QAAQ,EAAE;gBACV,QAAQ,CAAC,KAAK,CAAC,CAAC;aACnB;YACD,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YACd,OAAO;SACV;QAED,KAAK,CAAC,EAAE,GAAG,GAAG,CAAC,OAAO,CAAC,CAAC;IAC5B,CAAC,CAAC;IAEF,KAAK,CAAC,EAAE,GAAG,GAAG,CAAC,OAAO,CAAC,CAAC;IAExB,OAAO,KAAK,CAAC;AACjB,CAAC,CAAC;AA7DW,QAAA,eAAe,mBA6D1B","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\nexport interface IPropertyAnimationState {\n    animating: boolean;\n    duration: number;\n    destVal: number;\n    originVal: number;\n    object: any;\n    property: string;\n    deltaVal: number;\n    startTime: number;\n    id: number;\n    lastVal: number;\n    nowTime: number;\n}\n\nexport const animateProperty = (\n    cAF: (id: number) => void, // typically: window.cancelAnimationFrame\n    callback: ((cancelled: boolean) => void) | undefined,\n    property: string, // numerical, e.g. \"scrollTop\" or \"scrollLeft\"\n    duration: number, // e.g. 200\n    object: any, // typically, window.document.body (Element)\n    destVal: number, // e.g. 0\n    rAF: (func: () => void) => number, // typically: window.requestAnimationFrame\n    transition: (t: number, b: number, c: number, d: number) => number, // e.g. easings.easeInQuad\n) => {\n\n    const state: IPropertyAnimationState = {\n        animating: false, // changes\n        deltaVal: destVal - object[property], // fixed\n        destVal, // fixed\n        duration, // fixed\n        id: 0, // changes\n        lastVal: 0, // changes\n        nowTime: 0, // changes\n        object, // fixed\n        originVal: object[property], // fixed\n        property, // fixed\n        startTime: Date.now(), // fixed\n    };\n\n    const animate = () => {\n        state.animating = true;\n        state.nowTime = Date.now(); // +new Date()\n        const newVal = Math.floor(\n            transition(state.nowTime - state.startTime, state.originVal, state.deltaVal, state.duration));\n\n        if (!state.lastVal || state.object[state.property] !== state.destVal) {\n            state.object[state.property] = newVal;\n            state.lastVal = newVal;\n        } else { // lastVal && object[property] === destVal\n            state.animating = false;\n            state.object = {}; // to avoid memory leaks / DOM pointer retention\n            if (callback) {\n                callback(true);\n            }\n            cAF(state.id);\n            return;\n        }\n\n        if (state.nowTime > (state.startTime + state.duration)) {\n            state.animating = false;\n            state.object[state.property] = state.destVal;\n            state.object = {}; // to avoid memory leaks / DOM pointer retention\n            if (callback) {\n                callback(false);\n            }\n            cAF(state.id);\n            return;\n        }\n\n        state.id = rAF(animate);\n    };\n\n    state.id = rAF(animate);\n\n    return state;\n};\n"]}