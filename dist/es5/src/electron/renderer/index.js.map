{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/electron/renderer/index.ts"],"names":[],"mappings":"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","sourcesContent":["import debounce = require(\"debounce\");\nimport URI = require(\"urijs\");\n\nimport { Publication } from \"@models/publication\";\nimport { Link } from \"@models/publication-link\";\nimport { encodeURIComponent_RFC3986 } from \"@utils/http/UrlUtils\";\nimport { shell } from \"electron\";\nimport { ipcRenderer } from \"electron\";\n\nimport {\n    R2_EVENT_LINK,\n    R2_EVENT_PAGE_TURN,\n    R2_EVENT_PAGE_TURN_RES,\n    R2_EVENT_READIUMCSS,\n    R2_EVENT_SCROLLTO,\n    R2_EVENT_WEBVIEW_READY,\n} from \"../common/events\";\nimport { R2_SESSION_WEBVIEW } from \"../common/sessions\";\n\n// const queryParams = getURLQueryParams();\n\n// // tslint:disable-next-line:no-string-literal\n// const publicationJsonUrl = queryParams[\"pub\"];\n\n// const pathBase64 = publicationJsonUrl.replace(/.*\\/pub\\/(.*)\\/manifest.json/, \"$1\");\n\n// const pathDecoded = window.atob(pathBase64);\n\n// const pathFileName = pathDecoded.substr(\n//     pathDecoded.replace(/\\\\/g, \"/\").lastIndexOf(\"/\") + 1,\n//     pathDecoded.length - 1);\n\n// // tslint:disable-next-line:no-string-literal\n// const lcpHint = queryParams[\"lcpHint\"];\n\nlet _computeReadiumCssJsonMessage: () => string = () => {\n    return \"\";\n};\nexport function setReadiumCssJsonGetter(func: () => string) {\n    _computeReadiumCssJsonMessage = func;\n}\n\nexport function readiumCssOnOff() {\n    if (!_computeReadiumCssJsonMessage) {\n        return;\n    }\n    const readiumCssJsonMessage = _computeReadiumCssJsonMessage();\n    (_webview1 as any).send(R2_EVENT_READIUMCSS, readiumCssJsonMessage); // .getWebContents()\n    (_webview2 as any).send(R2_EVENT_READIUMCSS, readiumCssJsonMessage); // .getWebContents()\n}\n\n// CAN'T USE Electron.WebviewTag !! :(\n// https://github.com/electron/electron-typescript-definitions/pull/81\n// TypeScript compiler with strictFunctionTypes =>\n// node_modules/electron/electron.d.ts(5390,13):\n// error TS2430: Interface 'WebviewTag' incorrectly extends interface 'HTMLElement'.\nlet _webview1: HTMLElement; // Electron.WebviewTag;\nlet _webview2: HTMLElement; // Electron.WebviewTag;\n\nlet _viewHideInterval: NodeJS.Timer | undefined;\n\nlet _publication: Publication | undefined;\nlet _publicationJsonUrl: string | undefined;\n\nexport function handleLink(href: string, previous: boolean | undefined, useGoto: boolean) {\n    if (!_publicationJsonUrl) {\n        return;\n    }\n\n    const prefix = _publicationJsonUrl.replace(\"manifest.json\", \"\");\n    if (href.startsWith(prefix)) {\n        // TODO\n        // if (drawer.open) {\n        //     drawer.open = false;\n        //     setTimeout(() => {\n        //         loadLink(href, previous, useGoto);\n        //     }, 200);\n        // } else {\n        //     loadLink(href, previous, useGoto);\n        // }\n        loadLink(href, previous, useGoto);\n    } else {\n        shell.openExternal(href);\n    }\n}\n\nexport function installNavigatorDOM(\n    publication: Publication,\n    publicationJsonUrl: string,\n    rootHtmlElementID: string,\n    preloadScriptPath: string,\n    pubDocHrefToLoad: string,\n    pubDocSelectorToGoto: string) {\n\n    _publication = publication;\n    _publicationJsonUrl = publicationJsonUrl;\n\n    const rootHtmlElement = document.getElementById(rootHtmlElementID) as HTMLElement;\n    if (!rootHtmlElement) {\n        console.log(\"!rootHtmlElement ???\");\n        return;\n    }\n\n    const slidingViewport = document.createElement(\"div\");\n    slidingViewport.setAttribute(\"id\", \"r2_navigator_sliding_viewport\");\n    slidingViewport.setAttribute(\"style\", \"display: block; position: absolute; left: 0; width: 200%; \" +\n        \"top: 0; bottom: 0; margin: 0; padding: 0; box-sizing: border-box; background: white; overflow: hidden;\");\n\n    _webview1 = createWebView(preloadScriptPath);\n    (_webview1 as any).readiumwebviewid = 1;\n    _webview1.setAttribute(\"id\", \"webview1\");\n\n    _webview2 = createWebView(preloadScriptPath);\n    (_webview2 as any).readiumwebviewid = 2;\n    _webview2.setAttribute(\"id\", \"webview2\");\n\n    slidingViewport.appendChild(_webview1 as Node);\n    slidingViewport.appendChild(_webview2 as Node);\n\n    rootHtmlElement.appendChild(slidingViewport);\n\n    const isRTL = _publication.Metadata &&\n        _publication.Metadata.Direction &&\n        _publication.Metadata.Direction.toLowerCase() === \"rtl\"; //  any other value is LTR\n    if (isRTL) {\n        _webview1.classList.add(\"posRight\");\n        _webview1.style.left = \"50%\";\n    } else {\n        _webview2.classList.add(\"posRight\");\n        _webview1.style.left = \"50%\";\n    }\n\n    let linkToLoad: Link | undefined;\n    let linkToLoadGoto: string | undefined;\n    if (pubDocHrefToLoad) {\n        if (_publication.Spine && _publication.Spine.length) {\n            linkToLoad = _publication.Spine.find((spineLink) => {\n                return spineLink.Href === pubDocHrefToLoad;\n            });\n            if (linkToLoad && pubDocSelectorToGoto) {\n                linkToLoadGoto = pubDocSelectorToGoto;\n            }\n        }\n        if (!linkToLoad &&\n            _publication.Resources && _publication.Resources.length) {\n            linkToLoad = _publication.Resources.find((resLink) => {\n                return resLink.Href === pubDocHrefToLoad;\n            });\n            if (linkToLoad && pubDocSelectorToGoto) {\n                linkToLoadGoto = pubDocSelectorToGoto;\n            }\n        }\n    }\n    if (!linkToLoad) {\n        if (_publication.Spine && _publication.Spine.length) {\n            const firstLinear = _publication.Spine[0];\n            if (firstLinear) {\n                linkToLoad = firstLinear;\n            }\n        }\n    }\n\n    setTimeout(() => {\n        // TODO\n        // drawer.open = true; // necessary otherwise focus steal for links in publication documents!\n        if (linkToLoad) {\n            const hrefToLoad = _publicationJsonUrl + \"/../\" + linkToLoad.Href +\n                (linkToLoadGoto ? (\"?readiumgoto=\" + encodeURIComponent_RFC3986(linkToLoadGoto)) : \"\");\n            handleLink(hrefToLoad, undefined, true);\n        }\n    }, 100);\n}\n\nexport function navLeftOrRight(left: boolean) {\n    if (!_publication) {\n        return;\n    }\n    const activeWebView = getActiveWebView();\n    const isRTL = _publication.Metadata &&\n        _publication.Metadata.Direction &&\n        _publication.Metadata.Direction.toLowerCase() === \"rtl\"; //  any other value is LTR\n    const goPREVIOUS = left ? !isRTL : isRTL;\n    const messageJson = {\n        direction: isRTL ? \"RTL\" : \"LTR\",\n        go: goPREVIOUS ? \"PREVIOUS\" : \"NEXT\",\n    };\n    const messageStr = JSON.stringify(messageJson);\n    (activeWebView as any).send(R2_EVENT_PAGE_TURN, messageStr); // .getWebContents()\n}\n\nconst getActiveWebView = (): HTMLElement => { // Electron.WebviewTag\n\n    let activeWebView: HTMLElement; // Electron.WebviewTag\n\n    const slidingViewport = document.getElementById(\"r2_navigator_sliding_viewport\") as HTMLElement;\n    if (!slidingViewport) {\n        return document.body;\n    }\n    if (slidingViewport.classList.contains(\"shiftedLeft\")) {\n        if (_webview1.classList.contains(\"posRight\")) {\n            activeWebView = _webview1;\n        } else {\n            activeWebView = _webview2;\n        }\n    } else {\n        if (_webview2.classList.contains(\"posRight\")) {\n            activeWebView = _webview1;\n        } else {\n            activeWebView = _webview2;\n        }\n    }\n\n    return activeWebView;\n};\n\nfunction loadLink(hrefFull: string, previous: boolean | undefined, useGoto: boolean) {\n\n    if (!_publication || !_publicationJsonUrl) {\n        return;\n    }\n\n    const rcssJsonstr = _computeReadiumCssJsonMessage ? _computeReadiumCssJsonMessage() : \"{}\";\n    // const str = window.atob(base64);\n    const rcssJsonstrBase64 = window.btoa(rcssJsonstr);\n\n    const linkUri = new URI(hrefFull);\n    linkUri.search((data: any) => {\n        // overrides existing (leaves others intact)\n\n        if (typeof previous === \"undefined\") {\n            // erase unwanted forward of query param during linking\n            data.readiumprevious = undefined;\n            // delete data.readiumprevious;\n        } else {\n            data.readiumprevious = previous ? \"true\" : \"false\";\n        }\n\n        if (!useGoto) {\n            // erase unwanted forward of query param during linking\n            data.readiumgoto = undefined;\n            // delete data.readiumgoto;\n        }\n\n        data.readiumcss = rcssJsonstrBase64;\n    });\n    if (useGoto) {\n        linkUri.hash(\"\").normalizeHash();\n    }\n\n    const pubUri = new URI(_publicationJsonUrl);\n\n    // \"/pub/BASE64_PATH/manifest.json\" ==> \"/pub/BASE64_PATH/\"\n    const pathPrefix = pubUri.path().replace(\"manifest.json\", \"\");\n\n    // \"/pub/BASE64_PATH/epub/chapter.html\" ==> \"epub/chapter.html\"\n    const linkPath = decodeURIComponent(linkUri.normalizePath().path().replace(pathPrefix, \"\"));\n\n    let pubLink = _publication.Spine.find((spineLink) => {\n        return spineLink.Href === linkPath;\n    });\n    if (!pubLink) {\n        pubLink = _publication.Resources.find((spineLink) => {\n            return spineLink.Href === linkPath;\n        });\n    }\n\n    if (!pubLink) {\n        console.log(\"FATAL WEBVIEW READIUM2_LINK ??!! \" + hrefFull + \" ==> \" + linkPath);\n        return;\n    }\n\n    const activeWebView = getActiveWebView();\n    const wv1AlreadyLoaded = (_webview1 as any).READIUM2_LINK === pubLink;\n    const wv2AlreadyLoaded = (_webview2 as any).READIUM2_LINK === pubLink;\n    if (wv1AlreadyLoaded || wv2AlreadyLoaded) {\n        const msgJson = {\n            goto: useGoto ? linkUri.search(\"readiumgoto\") : undefined,\n            hash: useGoto ? undefined : linkUri.fragment(),\n            previous,\n        };\n        const msgStr = JSON.stringify(msgJson);\n\n        console.log(\"ALREADY LOADED: \" + pubLink.Href);\n        console.log(msgStr);\n\n        const webviewToReuse = wv1AlreadyLoaded ? _webview1 : _webview2;\n        // const otherWebview = webviewToReuse === _webview2 ? _webview1 : _webview2;\n        if (webviewToReuse !== activeWebView) {\n\n            console.log(\"INTO VIEW ...\");\n\n            const slidingView = document.getElementById(\"r2_navigator_sliding_viewport\") as HTMLElement;\n            if (slidingView) {\n                let animate = true;\n                if (msgJson.goto || msgJson.hash) {\n                    console.log(\"DISABLE ANIM\");\n                    animate = false;\n                } else if (previous) {\n                    if (!slidingView.classList.contains(\"shiftedLeft\")) {\n                        console.log(\"DISABLE ANIM\");\n                        animate = false;\n                    }\n                }\n                if (animate) {\n                    if (!slidingView.classList.contains(\"animated\")) {\n                        slidingView.classList.add(\"animated\");\n                        slidingView.style.transition = \"left 500ms ease-in-out\";\n                    }\n                } else {\n                    if (slidingView.classList.contains(\"animated\")) {\n                        slidingView.classList.remove(\"animated\");\n                        slidingView.style.transition = \"none\";\n                    }\n                }\n                if (slidingView.classList.contains(\"shiftedLeft\")) {\n                    slidingView.classList.remove(\"shiftedLeft\");\n                    slidingView.style.left = \"0\";\n\n                    // if (_webview1.classList.contains(\"posRight\")) {\n                    //     // activeWebView === _webview1;\n                    // } else {\n                    //     // activeWebView === _webview2;\n                    // }\n                } else {\n                    slidingView.classList.add(\"shiftedLeft\");\n                    slidingView.style.left = \"-100%\";\n\n                    // if (_webview2.classList.contains(\"posRight\")) {\n                    //     // activeWebView === _webview1;\n                    // } else {\n                    //     // activeWebView === _webview2;\n                    // }\n                }\n            }\n        }\n\n        (webviewToReuse as any).send(R2_EVENT_SCROLLTO, msgStr); // .getWebContents()\n\n        return;\n    }\n\n    const hidePanel = document.getElementById(\"r2_navigator_reader_chrome_HIDE\") as HTMLElement;\n    if (hidePanel) {\n        hidePanel.style.display = \"block\";\n        _viewHideInterval = setInterval(() => {\n            unhideWebView(true);\n        }, 5000);\n    }\n\n    const uriStr = linkUri.toString();\n    console.log(\"####### >>> ---\");\n    console.log((activeWebView as any).readiumwebviewid);\n    console.log(pubLink.Href);\n    console.log(linkUri.hash());\n    // tslint:disable-next-line:no-string-literal\n    console.log(linkUri.search(true)[\"readiumgoto\"]);\n    // tslint:disable-next-line:no-string-literal\n    console.log(linkUri.search(true)[\"readiumprevious\"]);\n    console.log(\"####### >>> ---\");\n    (activeWebView as any).READIUM2_LINK = pubLink;\n    activeWebView.setAttribute(\"src\", uriStr);\n    // wv.getWebContents().loadURL(uriStr, { extraHeaders: \"pragma: no-cache\\n\" });\n    // wv.loadURL(uriStr, { extraHeaders: \"pragma: no-cache\\n\" });\n\n    const enableOffScreenRenderPreload = false;\n    if (enableOffScreenRenderPreload) {\n        setTimeout(() => {\n            if (!_publication || !pubLink) {\n                return;\n            }\n\n            const otherWebview = activeWebView === _webview2 ? _webview1 : _webview2;\n\n            // let inSpine = true;\n            const index = _publication.Spine.indexOf(pubLink);\n            // if (!index) {\n            //     inSpine = false;\n            //     index = _publication.Resources.indexOf(pubLink);\n            // }\n            if (index >= 0 &&\n                previous && (index - 1) >= 0 ||\n                !previous && (index + 1) < _publication.Spine.length\n                // (index + 1) < (inSpine ? _publication.Spine.length : _publication.Resources.length)\n            ) {\n                const nextPubLink = _publication.Spine[previous ? (index - 1) : (index + 1)];\n                // (inSpine ? _publication.Spine[index + 1] : _publication.Resources[index + 1]);\n\n                if ((otherWebview as any).READIUM2_LINK !== nextPubLink) {\n                    const linkUriNext = new URI(_publicationJsonUrl + \"/../\" + nextPubLink.Href);\n                    linkUriNext.normalizePath();\n                    linkUriNext.search((data: any) => {\n                        // overrides existing (leaves others intact)\n                        data.readiumcss = rcssJsonstrBase64;\n                    });\n                    const uriStrNext = linkUriNext.toString();\n\n                    console.log(\"####### ======\");\n                    console.log((otherWebview as any).readiumwebviewid);\n                    console.log(nextPubLink.Href);\n                    console.log(linkUriNext.hash());\n                    // tslint:disable-next-line:no-string-literal\n                    console.log(linkUriNext.search(true)[\"readiumgoto\"]);\n                    // tslint:disable-next-line:no-string-literal\n                    console.log(linkUriNext.search(true)[\"readiumprevious\"]);\n                    console.log(\"####### ======\");\n                    (otherWebview as any).READIUM2_LINK = nextPubLink;\n                    otherWebview.setAttribute(\"src\", uriStrNext);\n                }\n            }\n        }, 300);\n    }\n}\n\nfunction createWebView(preloadScriptPath: string): HTMLElement { // Electron.WebviewTag\n    const wv = document.createElement(\"webview\") as HTMLElement;\n    wv.setAttribute(\"webpreferences\",\n        \"nodeIntegration=0, nodeIntegrationInWorker=0, sandbox=0, javascript=1, \" +\n        \"contextIsolation=0, webSecurity=1, allowRunningInsecureContent=0\");\n    wv.setAttribute(\"partition\", R2_SESSION_WEBVIEW);\n    if (_publicationJsonUrl) {\n        wv.setAttribute(\"httpreferrer\", _publicationJsonUrl);\n    }\n    wv.setAttribute(\"style\", \"display: flex; margin: 0; padding: 0; box-sizing: border-box; \" +\n        \"position: absolute; left: 0; width: 50%; bottom: 0; top: 0;\");\n    wv.setAttribute(\"preload\", preloadScriptPath); // \"./webview/preload.js\"\n    wv.setAttribute(\"disableguestresize\", \"\");\n    setTimeout(() => {\n        wv.removeAttribute(\"tabindex\");\n    }, 500);\n\n    wv.addEventListener(\"dom-ready\", () => {\n        // wv.openDevTools();\n        (wv as any).clearHistory();\n    });\n\n    wv.addEventListener(\"ipc-message\", (event: any) => { // Electron.IpcMessageEvent\n        const webview = event.currentTarget as HTMLElement; // Electron.WebviewTag;\n        const activeWebView = getActiveWebView();\n        if (webview !== activeWebView) {\n            return;\n        }\n\n        if (event.channel === R2_EVENT_LINK) {\n            handleLink(event.args[0], undefined, false);\n        } else if (event.channel === R2_EVENT_WEBVIEW_READY) {\n            // const id = event.args[0];\n            unhideWebView(false);\n        } else if (event.channel === R2_EVENT_PAGE_TURN_RES) {\n            if (!_publication) {\n                return;\n            }\n            // const isRTL = _publication.Metadata &&\n            // _publication.Metadata.Direction &&\n            // _publication.Metadata.Direction.toLowerCase() === \"rtl\"; //  any other value is LTR\n\n            const messageString = event.args[0];\n            const messageJson = JSON.parse(messageString);\n            // const isRTL = messageJson.direction === \"RTL\"; //  any other value is LTR\n            const goPREVIOUS = messageJson.go === \"PREVIOUS\"; // any other value is NEXT\n\n            if (!(webview as any).READIUM2_LINK) {\n                console.log(\"WEBVIEW READIUM2_LINK ??!!\");\n                return;\n            }\n\n            let nextOrPreviousSpineItem: Link | undefined;\n            for (let i = 0; i < _publication.Spine.length; i++) {\n                if (_publication.Spine[i] === (webview as any).READIUM2_LINK) {\n                    if (goPREVIOUS && (i - 1) >= 0) {\n                        nextOrPreviousSpineItem = _publication.Spine[i - 1];\n                    } else if (!goPREVIOUS && (i + 1) < _publication.Spine.length) {\n                        nextOrPreviousSpineItem = _publication.Spine[i + 1];\n                    }\n                    break;\n                }\n            }\n            if (!nextOrPreviousSpineItem) {\n                return;\n            }\n            if (_publicationJsonUrl) {\n                const linkHref = _publicationJsonUrl + \"/../\" + nextOrPreviousSpineItem.Href;\n                handleLink(linkHref, goPREVIOUS, false);\n            }\n        } else {\n            console.log(\"webview1 ipc-message\");\n            console.log(event.channel);\n        }\n    });\n\n    return wv;\n}\n\nconst adjustResize = (webview: HTMLElement) => { // Electron.WebviewTag\n    const width = webview.clientWidth;\n    const height = webview.clientHeight;\n    const wc = (webview as any).getWebContents();\n    if (wc && width && height) {\n        wc.setSize({\n            normal: {\n                height,\n                width,\n            },\n        });\n    }\n};\n\nconst onResizeDebounced = debounce(() => {\n    adjustResize(_webview1);\n    adjustResize(_webview2);\n    setTimeout(() => {\n        unhideWebView(false);\n    }, 1000);\n}, 200);\n\nwindow.addEventListener(\"resize\", () => {\n    const hidePanel = document.getElementById(\"r2_navigator_reader_chrome_HIDE\") as HTMLElement;\n    if (hidePanel && hidePanel.style.display !== \"block\") {\n        hidePanel.style.display = \"block\";\n        _viewHideInterval = setInterval(() => {\n            unhideWebView(true);\n        }, 5000);\n    }\n    onResizeDebounced();\n});\n\nipcRenderer.on(R2_EVENT_LINK, (_event: any, href: string) => {\n    console.log(\"R2_EVENT_LINK\");\n    console.log(href);\n    handleLink(href, undefined, false);\n});\n\nconst unhideWebView = (forced: boolean) => {\n    if (_viewHideInterval) {\n        clearInterval(_viewHideInterval);\n        _viewHideInterval = undefined;\n    }\n    const hidePanel = document.getElementById(\"r2_navigator_reader_chrome_HIDE\") as HTMLElement;\n    if (!hidePanel || hidePanel.style.display === \"none\") {\n        return;\n    }\n    if (forced) {\n        console.log(\"unhideWebView FORCED\");\n    }\n    if (hidePanel) {\n        hidePanel.style.display = \"none\";\n    }\n};\n"]}