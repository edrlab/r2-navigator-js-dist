{"version":3,"file":"audiobook.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/webview/audiobook.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\nimport { debounce } from \"debounce\";\nimport { ipcRenderer } from \"electron\";\n\nimport {\n    IEventPayload_R2_EVENT_PAGE_TURN, IEventPayload_R2_EVENT_READING_LOCATION,\n    R2_EVENT_AUDIO_DO_PAUSE, R2_EVENT_AUDIO_DO_PLAY, R2_EVENT_PAGE_TURN_RES,\n    R2_EVENT_READING_LOCATION,\n} from \"../../common/events\";\nimport {\n    AUDIO_COVER_ID, AUDIO_FORWARD_ID, AUDIO_ID, AUDIO_NEXT_ID, AUDIO_PERCENT_ID, AUDIO_PLAYPAUSE_ID,\n    AUDIO_PREVIOUS_ID, AUDIO_PROGRESS_CLASS, AUDIO_REWIND_ID, AUDIO_SLIDER_ID, AUDIO_TIME_ID,\n} from \"../../common/styles\";\nimport { IReadiumElectronWebviewWindow } from \"./state\";\n\n// const IS_DEV = (process.env.NODE_ENV === \"development\" || process.env.NODE_ENV === \"dev\");\n\nconst win = (global as any).window as IReadiumElectronWebviewWindow;\n\nfunction throttle(fn: (...argz: any[]) => any, time: number) {\n    let called = false;\n    return (...args: any[]) => {\n        if (!called) {\n            fn(...args);\n            called = true;\n            setTimeout(() => {\n                called = false;\n            }, time);\n        }\n    };\n}\n\nexport function setupAudioBook(_docTitle: string | undefined) {\n\n    win.document.documentElement.classList.add(AUDIO_PROGRESS_CLASS);\n\n    const coverElement = win.document.getElementById(AUDIO_COVER_ID) as HTMLImageElement;\n    const audioElement = win.document.getElementById(AUDIO_ID) as HTMLAudioElement;\n    const sliderElement = win.document.getElementById(AUDIO_SLIDER_ID) as HTMLInputElement;\n    const timeElement = win.document.getElementById(AUDIO_TIME_ID) as HTMLSpanElement;\n    const percentElement = win.document.getElementById(AUDIO_PERCENT_ID) as HTMLSpanElement;\n    const playPauseElement = win.document.getElementById(AUDIO_PLAYPAUSE_ID) as HTMLButtonElement;\n    const previousElement = win.document.getElementById(AUDIO_PREVIOUS_ID) as HTMLButtonElement;\n    const nextElement = win.document.getElementById(AUDIO_NEXT_ID) as HTMLButtonElement;\n    const rewindElement = win.document.getElementById(AUDIO_REWIND_ID) as HTMLButtonElement;\n    const forwardElement = win.document.getElementById(AUDIO_FORWARD_ID) as HTMLButtonElement;\n\n    ipcRenderer.on(R2_EVENT_AUDIO_DO_PLAY, async (_event: any) => {\n        await audioElement.play();\n    });\n    ipcRenderer.on(R2_EVENT_AUDIO_DO_PAUSE, (_event: any) => {\n        audioElement.pause();\n    });\n\n    rewindElement.addEventListener(\"click\", () => {\n        const newTime = Math.max(0, audioElement.currentTime - 30);\n        audioElement.currentTime = newTime;\n        // if (newTime < 0.5) {\n        //     const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n        //         direction: \"LTR\",\n        //         go: \"PREVIOUS\",\n        //     };\n        //     ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n        // } else {\n        //     audioElement.currentTime = newTime;\n        // }\n    });\n    forwardElement.addEventListener(\"click\", () => {\n        const newTime = Math.min(audioElement.duration, audioElement.currentTime + 30);\n        audioElement.currentTime = newTime;\n        // if (newTime >= audioElement.duration - 0.5) {\n        //     const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n        //         direction: \"LTR\",\n        //         go: \"NEXT\",\n        //     };\n        //     ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n        // } else {\n        //     audioElement.currentTime = newTime;\n        // }\n    });\n\n    previousElement.addEventListener(\"click\", () => {\n        const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n            direction: \"LTR\",\n            go: \"PREVIOUS\",\n        };\n        ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n    });\n    nextElement.addEventListener(\"click\", () => {\n        const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n            direction: \"LTR\",\n            go: \"NEXT\",\n        };\n        ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n    });\n\n    // const debounceSlider = debounce((wasPlaying: boolean | undefined) => {\n    //     const p = sliderElement.valueAsNumber / 100;\n    //     audioElement.currentTime = audioElement.duration * p;\n    //     if (wasPlaying) {\n    //         setTimeout(async () => {\n    //             await audioElement.play();\n    //         }, 200);\n    //     }\n    // }, 500);\n    sliderElement.addEventListener(\"input\", () => {\n\n        const p = sliderElement.valueAsNumber / 100;\n        audioElement.currentTime = audioElement.duration * p;\n\n        // const wasPlaying = win.READIUM2.locationHashOverrideInfo?.audioPlaybackInfo?.isPlaying;\n        // audioElement.pause();\n        // debounceSlider(wasPlaying);\n    });\n    function togglePlayPause() {\n        if (win.READIUM2.locationHashOverrideInfo &&\n            win.READIUM2.locationHashOverrideInfo.audioPlaybackInfo) {\n            const isPlaying = win.READIUM2.locationHashOverrideInfo.audioPlaybackInfo.isPlaying;\n            if (isPlaying) {\n                audioElement.pause();\n            } else {\n                if (audioElement.currentTime >= audioElement.duration - 0.5) {\n                    const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n                        direction: \"LTR\",\n                        go: \"NEXT\",\n                    };\n                    ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n                } else {\n                    setTimeout(async () => {\n                        await audioElement.play();\n                    }, 0);\n                }\n            }\n        }\n    }\n    coverElement.addEventListener(\"mousedown\", () => {\n        togglePlayPause();\n    });\n    playPauseElement.addEventListener(\"click\", () => {\n        togglePlayPause();\n    });\n\n    function formatTime(seconds: number): string {\n        const secondsPerMinute = 60;\n        const minutesPerHours = 60;\n        const secondsPerHour = minutesPerHours * secondsPerMinute;\n        let remainingSeconds = seconds;\n        const nHours = Math.floor(remainingSeconds / secondsPerHour);\n        remainingSeconds -= (nHours * secondsPerHour);\n        if (remainingSeconds < 0) {\n            remainingSeconds = 0;\n        }\n        const nMinutes = Math.floor(remainingSeconds / secondsPerMinute);\n        remainingSeconds -= (nMinutes * secondsPerMinute);\n        if (remainingSeconds < 0) {\n            remainingSeconds = 0;\n        }\n        remainingSeconds = Math.floor(remainingSeconds);\n        return `${nHours > 0 ? (nHours.toString().padStart(2, \"0\") + \":\") : ``}${nMinutes > 0 ? (nMinutes.toString().padStart(2, \"0\") + \":\") : `00:`}${remainingSeconds > 0 ? (remainingSeconds.toString().padStart(2, \"0\")) : `00`}`;\n    }\n\n    function notifyPlaybackLocation() {\n        const percent = audioElement.currentTime / audioElement.duration;\n        const p = Math.round(percent * 100);\n        // sliderElement.value = \"\" + p;\n        sliderElement.valueAsNumber = p;\n\n        percentElement.innerText = `${p}%`;\n\n        const prettyTime = `${formatTime(audioElement.currentTime)} / ${formatTime(audioElement.duration)}`;\n        timeElement.innerText = prettyTime;\n\n        win.READIUM2.locationHashOverrideInfo = {\n            audioPlaybackInfo: {\n                globalDuration: undefined,\n                globalProgression: undefined,\n                globalTime: undefined,\n                isPlaying: (audioElement as any).isPlaying,\n                localDuration: audioElement.duration,\n                localProgression: percent,\n                localTime: audioElement.currentTime,\n            },\n            docInfo: {\n                isFixedLayout: false,\n                isRightToLeft: false,\n                isVerticalWritingMode: false,\n            },\n            epubPage: undefined,\n            href: \"\", // filled-in from host index.js renderer\n            locations: {\n                cfi: undefined,\n                cssSelector: undefined,\n                    // calculated in host index.js renderer, where publication object is available\n                position: undefined,\n                progression: percent,\n            },\n            paginationInfo: undefined,\n            selectionInfo: undefined,\n            selectionIsNew: false,\n            text: undefined,\n            title: _docTitle,\n        };\n        const payload: IEventPayload_R2_EVENT_READING_LOCATION = win.READIUM2.locationHashOverrideInfo;\n        ipcRenderer.sendToHost(R2_EVENT_READING_LOCATION, payload);\n    }\n    const notifyPlaybackLocationThrottled = throttle(() => {\n        notifyPlaybackLocation();\n    }, 1000);\n\n    // const notifyPlaybackLocationDebounced = debounce(() => {\n    //     notifyPlaybackLocation();\n    // }, 200);\n\n    const progressDebounced = debounce((progress: boolean) => {\n        if (progress) {\n            win.document.documentElement.classList.add(AUDIO_PROGRESS_CLASS);\n        } else {\n            win.document.documentElement.classList.remove(AUDIO_PROGRESS_CLASS);\n        }\n    }, 150);\n\n    audioElement.addEventListener(\"play\", () => {\n        (audioElement as any).isPlaying = true;\n        playPauseElement.classList.add(\"pause\");\n        notifyPlaybackLocation();\n    });\n    audioElement.addEventListener(\"pause\", () => {\n        (audioElement as any).isPlaying = false;\n        playPauseElement.classList.remove(\"pause\");\n        notifyPlaybackLocation();\n    });\n    audioElement.addEventListener(\"seeking\", () => {\n        progressDebounced(true);\n    });\n    audioElement.addEventListener(\"canplay\", () => {\n        progressDebounced(false);\n    });\n    audioElement.addEventListener(\"ended\", () => {\n        (audioElement as any).isPlaying = false;\n        playPauseElement.classList.remove(\"pause\");\n        notifyPlaybackLocation();\n        const payload: IEventPayload_R2_EVENT_PAGE_TURN = {\n            direction: \"LTR\",\n            go: \"NEXT\",\n        };\n        ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, payload);\n    });\n\n    audioElement.addEventListener(\"timeupdate\", () => {\n        // (audioElement as any).isPlaying = true;\n        notifyPlaybackLocationThrottled();\n    });\n}\n"]}