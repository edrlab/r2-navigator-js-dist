{"version":3,"file":"highlight.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/webview/highlight.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\nimport * as crypto from \"crypto\";\nimport * as debounce from \"debounce\";\nimport { ipcRenderer } from \"electron\";\n\nimport {\n    IEventPayload_R2_EVENT_HIGHLIGHT_CLICK, R2_EVENT_HIGHLIGHT_CLICK,\n} from \"../../common/events\";\nimport {\n    HighlightDrawTypeStrikethrough, HighlightDrawTypeUnderline, HighlightDrawTypeOutline, IColor, IHighlight,\n    IHighlightDefinition,\n    HighlightDrawTypeBackground,\n} from \"../../common/highlight\";\nimport { isPaginated } from \"../../common/readium-css-inject\";\nimport { ISelectionInfo } from \"../../common/selection\";\nimport { VERBOSE, IRectSimple, getClientRectsNoOverlap, getBoundingRect, IRect, getTextClientRects, DOMRectListToArray } from \"../common/rect-utils\";\nimport { getScrollingElement, isVerticalWritingMode, isTwoPageSpread } from \"./readium-css\";\nimport { convertRangeInfo } from \"./selection\";\nimport { ReadiumElectronWebviewWindow } from \"./state\";\n\nimport { CLASS_HIGHLIGHT_CONTOUR, CLASS_HIGHLIGHT_CONTOUR_MARGIN, ID_HIGHLIGHTS_CONTAINER, CLASS_HIGHLIGHT_CONTAINER, CLASS_HIGHLIGHT_CURSOR2, CLASS_HIGHLIGHT_COMMON, CLASS_HIGHLIGHT_MARGIN, CLASS_HIGHLIGHT_HOVER } from \"../../common/styles\";\n\nimport { isRTL } from \"./readium-css\";\n\nimport {\nPolygon,\nBox,\nBooleanOperations,\nPoint,\nFace,\nSegment,\nVector,\nArc,\nORIENTATION,\nCCW, // true\nCW, // false\nUtils,\nEdge,\n// PolygonEdge,\n} from \"@flatten-js/core\";\nconst { unify, subtract } = BooleanOperations;\n\nconst IS_DEV = (process.env.NODE_ENV === \"development\" || process.env.NODE_ENV === \"dev\");\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\n(window as any).DEBUG_RECTS = IS_DEV && VERBOSE;\n\nconst cleanupPolygon = (polygonAccumulator: Polygon, off: number) => {\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const DEBUG_RECTS = (window as any).DEBUG_RECTS;\n\n    const minLength = Math.abs(off) + 1;\n    let nSegments = 0;\n    let nArcs = 0;\n    let total = 0;\n    if (DEBUG_RECTS) {\n        console.log(\"--====}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}\");\n    }\n    for (const e of polygonAccumulator.edges) {\n        const edge = e as Edge;\n        if (edge.isSegment()) {\n            nSegments++;\n            const segment = edge.shape as Segment;\n            const l = segment.length;\n            if (Utils.LE(l, minLength)) {\n                total++;\n                if (DEBUG_RECTS) {\n                    console.log(\"--POLYGON SEGMENT small LENGTH: \" + l + \"(\" + off + \")\");\n                }\n            } else {\n                if (DEBUG_RECTS) {\n                    console.log(\"--POLYGON SEGMENT ok LENGTH: \" + l + \"(\" + off + \")\");\n                }\n            }\n        } else if (edge.isArc()) {\n            nArcs++;\n            if (DEBUG_RECTS) {\n                console.log(\"--POLYGON ARC\");\n            }\n        }\n    }\n    if (DEBUG_RECTS) {\n        console.log(\"--====\");\n        console.log(\"--==== POLYGON SEGMENT small TOTAL 1: \" + total);\n        console.log(\"--==== POLYGON SEGMENT small SEGMENTS 1: \" + nSegments);\n        console.log(\"--==== POLYGON SEGMENT small ARCS 1: \" + nArcs);\n    }\n    total = 0;\n    nSegments = 0;\n    nArcs = 0;\n    if (DEBUG_RECTS) {\n        console.log(\"--====}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}\");\n    }\n    for (const f of polygonAccumulator.faces) {\n        const face = f as Face;\n        for (const e of face.edges) {\n            const edge = e as Edge;\n            if (edge.isSegment()) {\n                nSegments++;\n                const segment = edge.shape as Segment;\n                const l = segment.length;\n                if (Utils.LE(l, minLength)) {\n                    total++;\n                    if (DEBUG_RECTS) {\n                        console.log(\"--POLYGON SEGMENT small LENGTH: \" + l + \"(\" + off + \")\");\n                    }\n                } else {\n                    if (DEBUG_RECTS) {\n                        console.log(\"--POLYGON SEGMENT ok LENGTH: \" + l + \"(\" + off + \")\");\n                    }\n                }\n            } else if (edge.isArc()) {\n                nArcs++;\n                if (DEBUG_RECTS) {\n                    console.log(\"--POLYGON ARC\");\n                }\n            }\n        }\n    }\n    if (DEBUG_RECTS) {\n        console.log(\"--====\");\n        console.log(\"--==== POLYGON SEGMENT small TOTAL 2: \" + total);\n        console.log(\"--==== POLYGON SEGMENT small SEGMENTS 2: \" + nSegments);\n        console.log(\"--==== POLYGON SEGMENT small ARCS 2: \" + nArcs);\n    }\n    total = 0;\n    nSegments = 0;\n    nArcs = 0;\n    if (DEBUG_RECTS) {\n        console.log(\"--====}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}\");\n    }\n    for (const f of polygonAccumulator.faces) {\n        const face = f as Face;\n        let edge = face.first;\n        while (edge) {\n            if (edge.isSegment()) {\n                nSegments++;\n                const segment = edge.shape as Segment;\n                const l = segment.length;\n                if (Utils.LE(l, minLength)) {\n                    total++;\n                    if (DEBUG_RECTS) {\n                        console.log(\"--POLYGON SEGMENT small LENGTH: \" + l + \"(\" + off + \")\");\n                    }\n                } else {\n                    if (DEBUG_RECTS) {\n                        console.log(\"--POLYGON SEGMENT ok LENGTH: \" + l + \"(\" + off + \")\");\n                    }\n                }\n            } else if (edge.isArc()) {\n                nArcs++;\n                if (DEBUG_RECTS) {\n                    console.log(\"--POLYGON ARC\");\n                }\n            }\n            if (edge == face.last) {\n                break;\n            }\n            edge = edge.next;\n        }\n    }\n    if (DEBUG_RECTS) {\n        console.log(\"--====\");\n        console.log(\"--==== POLYGON SEGMENT small TOTAL 3: \" + total);\n        console.log(\"--==== POLYGON SEGMENT small SEGMENTS 3: \" + nSegments);\n        console.log(\"--==== POLYGON SEGMENT small ARCS 3: \" + nArcs);\n\n        console.log(\"--====}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}\");\n    }\n\n    const faces: Face[] = Array.from(polygonAccumulator.faces);\n    for (const f of faces) {\n        const face = f as Face;\n        if (DEBUG_RECTS) {\n            console.log(\"~~~~ POLY FACE\");\n        }\n\n        const edges = Array.from(face.edges);\n        const edgeShapes = edges.map((edge) => edge.shape);\n        let chainedEdgeShapes: Array<Segment | Arc> = [];\n\n        while (edgeShapes.length) {\n            if (DEBUG_RECTS) {\n                console.log(\"~~~~ POLY EDGE SHAPE\");\n            }\n\n            if (!chainedEdgeShapes.length) {\n                const last = edgeShapes.pop()!;\n                chainedEdgeShapes.push(last);\n                continue;\n            }\n\n            // peek not pop\n            const lastInChain = chainedEdgeShapes[chainedEdgeShapes.length - 1];\n\n            const lastInChainStartPoint = (lastInChain as Arc).breakToFunctional ? (lastInChain as Arc).start : (lastInChain as Segment).start;\n\n            const lastInChainEndPoint = (lastInChain as Arc).breakToFunctional ? (lastInChain as Arc).end : (lastInChain as Segment).end;\n\n            const shapesBefore: Array<Segment | Arc> = [];\n            const shapesAfter: Array<Segment | Arc> = [];\n            for (const edgeShape of edgeShapes) {\n\n                const edgeShapeStartPoint = (edgeShape as Arc).breakToFunctional ? (edgeShape as Arc).start : (edgeShape as Segment).start;\n\n                const edgeShapeEndPoint = (edgeShape as Arc).breakToFunctional ? (edgeShape as Arc).end : (edgeShape as Segment).end;\n\n                if (Utils.EQ(lastInChainStartPoint.x, edgeShapeEndPoint.x) && Utils.EQ(lastInChainStartPoint.y, edgeShapeEndPoint.y)) {\n                    shapesBefore.push(edgeShape);\n                }\n\n                if (Utils.EQ(lastInChainEndPoint.x, edgeShapeStartPoint.x) && Utils.EQ(lastInChainEndPoint.y, edgeShapeStartPoint.y)) {\n                    shapesAfter.push(edgeShape);\n                }\n            }\n\n            // FAIL, should be a closed shape\n            //  || shapesBefore.length === 0\n            if (shapesBefore.length > 1 || shapesAfter.length > 1 || shapesAfter.length === 0) {\n                if (DEBUG_RECTS) {\n                    console.log(\"~~~~ POLY SHAPES BEFORE/AFTER ABORT: \" + shapesBefore.length + \" ... \" + shapesAfter.length);\n                }\n\n                chainedEdgeShapes = [];\n                // chainedEdgeShapes = edges.map((edge) => edge.shape);\n                break;\n            }\n\n            const startPoint = (shapesAfter[0] as Arc).breakToFunctional ? (shapesAfter[0] as Arc).start : (shapesAfter[0] as Segment).start;\n            const endPoint = (shapesAfter[0] as Arc).breakToFunctional ? (shapesAfter[0] as Arc).end : (shapesAfter[0] as Segment).end;\n            if (DEBUG_RECTS) {\n                console.log(\"*** SEGMENT/ARC --- START: (\" + startPoint.x + \", \" + startPoint.y + \") END: (\" + endPoint.x + \", \" + endPoint.y + \")\");\n            }\n\n            edgeShapes.splice(edgeShapes.indexOf(shapesAfter[0]), 1);\n            chainedEdgeShapes.push(shapesAfter[0]);\n\n            if (chainedEdgeShapes.length === edges.length) {\n\n                // const edgeShapeStartPoint = (shapesAfter[0] as Arc).breakToFunctional ? (shapesAfter[0] as Arc).start : (shapesAfter[0] as Segment).start;\n\n                const edgeShapeEndPoint = (shapesAfter[0] as Arc).breakToFunctional ? (shapesAfter[0] as Arc).end : (shapesAfter[0] as Segment).end;\n\n                const firstInChainStartPoint = (chainedEdgeShapes[0] as Arc).breakToFunctional ? (chainedEdgeShapes[0] as Arc).start : (chainedEdgeShapes[0] as Segment).start;\n\n                // const firstInChainEndPoint = (chainedEdgeShapes[0] as Arc).breakToFunctional ? (chainedEdgeShapes[0] as Arc).end : (chainedEdgeShapes[0] as Segment).end;\n\n                // FAIL, should be a closed shape\n                if (!Utils.EQ(firstInChainStartPoint.x, edgeShapeEndPoint.x) || !Utils.EQ(firstInChainStartPoint.y, edgeShapeEndPoint.y)) {\n                    if (DEBUG_RECTS) {\n                        console.log(\"~~~~ POLY SHAPES TAIL/HEAD ABORT\");\n                    }\n\n                    chainedEdgeShapes = [];\n                    // chainedEdgeShapes = edges.map((edge) => edge.shape);\n                    break;\n                }\n            }\n        }\n        // if (chainedEdgeShapes.length !== edges.length) {\n        //     chainedEdgeShapes = edges.map((edge) => edge.shape);\n        // }\n\n        let previousSegment: Segment | undefined;\n        let previousSmallSegment: Segment | undefined;\n        const newEdgeShapes: Array<Segment | Arc> = [];\n        let hasChanged = false;\n\n        // guaranteed chain loop\n        for (const edgeShape of chainedEdgeShapes) {\n            if (!(edgeShape as Arc).breakToFunctional) {\n                const segment = edgeShape as Segment;\n\n                const l = segment.length;\n\n                if (DEBUG_RECTS) {\n                    console.log(\"--POLYGON SLOPES: \" + previousSegment?.slope + \" vs. \" + segment.slope);\n                }\n                if (previousSegment && Utils.EQ(previousSegment.slope, segment.slope)) {\n                    if (DEBUG_RECTS) {\n                        console.log(\"--POLYGON SLOPE EQUAL ... merge :)\");\n                    }\n                    hasChanged = true;\n                    newEdgeShapes.pop();\n                    const seg = new Segment(new Point(previousSegment.start.x, previousSegment.start.y), new Point(segment.end.x, segment.end.y));\n                    newEdgeShapes.push(seg);\n                    previousSmallSegment = undefined;\n                    previousSegment = seg;\n\n                    if (chainedEdgeShapes.indexOf(edgeShape) === chainedEdgeShapes.length - 1 && !(newEdgeShapes[0] as Arc).breakToFunctional && Utils.EQ((newEdgeShapes[0] as Segment).slope, seg.slope)) {\n                        if (DEBUG_RECTS) {\n                            console.log(\"--POLYGON SLOPE EQUAL (tail/head link) 1... merge :)\");\n                        }\n                        hasChanged = true;\n                        newEdgeShapes.splice(0, 1);\n                        const seg2 = new Segment(new Point(newEdgeShapes[0].start.x, newEdgeShapes[0].start.y), new Point(seg.end.x, seg.end.y));\n                        newEdgeShapes.push(seg2);\n                        previousSmallSegment = undefined;\n                        previousSegment = seg2;\n                    }\n                } else if (newEdgeShapes.length && chainedEdgeShapes.indexOf(edgeShape) === chainedEdgeShapes.length - 1 && !(newEdgeShapes[0] as Arc).breakToFunctional && Utils.EQ((newEdgeShapes[0] as Segment).slope, segment.slope)) {\n                    if (DEBUG_RECTS) {\n                        console.log(\"--POLYGON SLOPE EQUAL (tail/head link) 2... merge :)\");\n                    }\n                    hasChanged = true;\n                    newEdgeShapes.splice(0, 1);\n                    const seg = new Segment(new Point(newEdgeShapes[0].start.x, newEdgeShapes[0].start.y), new Point(segment.end.x, segment.end.y));\n                    newEdgeShapes.push(seg);\n                    previousSmallSegment = undefined;\n                    previousSegment = seg;\n                } else if (Utils.LE(l, minLength)) {\n                    if (DEBUG_RECTS) {\n                        console.log(\"--POLYGON SEGMENT small LENGTH: \" + l + \"(\" + off + \")\");\n                    }\n\n                    if (previousSmallSegment) {\n                        if (DEBUG_RECTS) {\n                            console.log(\"-->>>> POLYGON SEGMENT small will merge :) ...\");\n                        }\n                        hasChanged = true;\n                        newEdgeShapes.pop();\n                        const seg = new Segment(new Point(previousSmallSegment.start.x, previousSmallSegment.start.y), new Point(segment.end.x, segment.end.y));\n                        newEdgeShapes.push(seg);\n                        previousSmallSegment = undefined;\n                        previousSegment = seg;\n                    } else if (newEdgeShapes.length && chainedEdgeShapes.indexOf(edgeShape) === chainedEdgeShapes.length - 1 && !(newEdgeShapes[0] as Arc).breakToFunctional && Utils.LE((newEdgeShapes[0] as Segment).length, minLength)) {\n                        if (DEBUG_RECTS) {\n                            console.log(\"-->>>> POLYGON SEGMENT small (tail/head link) will merge :) ...\");\n                        }\n                        hasChanged = true;\n                        newEdgeShapes.splice(0, 1);\n                        const seg = new Segment(new Point(newEdgeShapes[0].start.x, newEdgeShapes[0].start.y), new Point(segment.end.x, segment.end.y));;\n                        newEdgeShapes.push(seg);\n                        previousSmallSegment = undefined;\n                        previousSegment = seg;\n                    } else {\n                        newEdgeShapes.push(segment);\n                        previousSmallSegment = segment;\n                        previousSegment = segment;\n                    }\n                } else {\n                    if (DEBUG_RECTS) {\n                        console.log(\"--POLYGON SEGMENT ok LENGTH: \" + l + \"(\" + off + \")\");\n                    }\n\n                    previousSmallSegment = undefined;\n                    newEdgeShapes.push(segment);\n                    previousSegment = segment;\n                }\n            } else {\n                if (DEBUG_RECTS) {\n                    console.log(\"--POLYGON ARC\");\n                }\n                previousSmallSegment = undefined;\n                previousSegment = undefined;\n                newEdgeShapes.push(edgeShape as Arc);\n            }\n        }\n\n        if (hasChanged) {\n            if (DEBUG_RECTS) {\n                console.log(\"-->>>> POLYGON face changed :)\");\n            }\n            polygonAccumulator.deleteFace(face);\n            polygonAccumulator.addFace(newEdgeShapes);\n            // polygonAccumulator.recreateFaces();\n        }\n    }\n};\n\nconst addEdgePoints = (polygon: Polygon, offset: number) => {\n\n    const boxes: Box[] = [];\n    for (const f of polygon.faces) {\n        const face = f as Face;\n        for (const edge of face.edges) {\n            if (edge.isSegment()) {\n                const segment = edge.shape as Segment;\n                const bStart = new Box(segment.start.x - offset, segment.start.y - offset, segment.start.x + offset * 2, segment.start.y + offset * 2);\n                boxes.push(bStart);\n                const bEnd = new Box(segment.end.x - offset, segment.end.y - offset, segment.end.x + offset * 2, segment.end.y + offset * 2);\n                boxes.push(bEnd);\n            } else {\n                const arc = edge.shape as Arc;\n                const bStart = new Box(arc.start.x - offset, arc.start.y - offset, arc.start.x + offset * 2, arc.start.y + offset * 2);\n                boxes.push(bStart);\n                const bEnd = new Box(arc.end.x - offset, arc.end.y - offset, arc.end.x + offset * 2, arc.end.y + offset * 2);\n                boxes.push(bEnd);\n            }\n        }\n    }\n    for (const box of boxes) {\n        polygon.addFace(box);\n    }\n};\n\nconst BASE_ORIENTATION = ORIENTATION.CCW; // -1\n// const BASE_ORIENTATION_INVERSE = ORIENTATION.CW; // 1\n\nconst USE_SEGMENT_JOINS_NOT_ARCS = false;\n// import offset from \"@flatten-js/polygon-offset\";\n// Number((x).toPrecision(12))\n// https://github.com/alexbol99/flatten-offset/issues/17#issuecomment-1949934684\nfunction arcSE(center: Point, start: Point, end: Point, counterClockwise: boolean): Arc {\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const DEBUG_RECTS = (window as any).DEBUG_RECTS;\n\n    const startAngle = Number((new Vector(center, start).slope).toPrecision(12));\n    let endAngle = Number((new Vector(center, end).slope).toPrecision(12));\n\n    if (Utils.EQ(startAngle, endAngle)) {\n        if (DEBUG_RECTS) {\n            console.log(\"--POLYGON ARC ORIENTATION CCW/CW inverse\");\n        }\n        endAngle += 2 * Math.PI;\n        counterClockwise = !counterClockwise;\n    }\n\n    const r = Number((new Vector(center, start).length).toPrecision(12));;\n\n    return new Arc(center, r, startAngle, endAngle, counterClockwise); // default is CCW / true\n}\n\nfunction offset_(polygon: Polygon, off: number, useSegmentJoinsNotArcs: boolean) {\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const DEBUG_RECTS = (window as any).DEBUG_RECTS;\n\n    const postponeFinalUnify = off > 0; // Utils.GT(off, 0);\n    let polygonAccumulator = postponeFinalUnify ? undefined : polygon.clone();\n\n    for (const f of polygon.faces) {\n        const face = f as Face;\n        for (const edge of face.edges) {\n            if (edge.isSegment()) {\n                const polygonEdge = new Polygon();\n\n                const segment = edge.shape as Segment;\n\n                const v_seg = new Vector(segment.end.x - segment.start.x, segment.end.y - segment.start.y);\n                const v_seg_unit = v_seg.normalize();\n\n                // console.log(\"--POLYGON SEGMENT LENGTH: \" + v_seg.length);\n\n                const absOffset = Math.abs(off);\n                const v_left = v_seg_unit.rotate90CCW().multiply(absOffset);\n                const v_right = v_seg_unit.rotate90CW().multiply(absOffset);\n\n                const seg_left = segment.translate(v_left).reverse();\n                const seg_right = segment.translate(v_right);\n\n                const seg_left_ = new Segment(new Point(Number((seg_left.start.x).toPrecision(12)), Number((seg_left.start.y).toPrecision(12))), new Point(Number((seg_left.end.x).toPrecision(12)), Number((seg_left.end.y).toPrecision(12))));\n\n                const seg_right_ = new Segment(new Point(Number((seg_right.start.x).toPrecision(12)), Number((seg_right.start.y).toPrecision(12))), new Point(Number((seg_right.end.x).toPrecision(12)), Number((seg_right.end.y).toPrecision(12))));\n\n                const orientation = BASE_ORIENTATION === ORIENTATION.CCW ? CCW : CW;\n                const cap1 = arcSE(segment.start, seg_left_.end, seg_right_.start, orientation);\n                const cap2 = arcSE(segment.end, seg_right_.end, seg_left_.start, orientation);\n\n                const cap1_ =\n                    useSegmentJoinsNotArcs\n                    ?\n                    new Segment(seg_left_.end, seg_right_.start)\n                    :\n                    cap1;\n                    // new Arc(new Point(Number((cap1.center.x).toPrecision(12)), Number((cap1.center.y).toPrecision(12))), Number((cap1.r).toPrecision(12)), Number((cap1.startAngle).toPrecision(12)), Number((cap1.endAngle).toPrecision(12)), cap1.counterClockwise)\n                const cap2_ =\n                    useSegmentJoinsNotArcs\n                    ?\n                    new Segment(seg_right_.end, seg_left_.start)\n                    :\n                    cap2;\n                    // new Arc(new Point(Number((cap2.center.x).toPrecision(12)), Number((cap2.center.y).toPrecision(12))), Number((cap2.r).toPrecision(12)), Number((cap2.startAngle).toPrecision(12)), Number((cap2.endAngle).toPrecision(12)), cap2.counterClockwise)\n\n                const face = polygonEdge.addFace([\n                    seg_left_,\n                    cap1_,\n                    seg_right_,\n                    cap2_,\n                ]);\n                if (face.orientation() !== BASE_ORIENTATION) {\n                    if (DEBUG_RECTS) {\n                        console.log(\"--POLYGON FACE ORIENTATION CCW/CW reverse() 1\");\n                    }\n                    face.reverse();\n                }\n\n                // console.log(\"--POLYGON FACE AREA: \" + face.area());\n\n                if (!(polygonAccumulator || polygonEdge).faces.size) {\n\n                    if (DEBUG_RECTS) {\n                        console.log(\"--################# POLYGON BEFORE unify/substract HAS NO FACES!! \" + (polygonAccumulator || polygonEdge).faces.size);\n                    }\n                }\n\n                if (off > 0) { // Utils.GT(off, 0)\n                    polygonAccumulator = polygonAccumulator ? unify(polygonAccumulator, polygonEdge) : polygonEdge;\n                } else {\n                    polygonAccumulator = polygonAccumulator ? subtract(polygonAccumulator, polygonEdge) : polygonEdge;\n                }\n\n                if (!(polygonAccumulator || polygonEdge).faces.size) {\n                    if (DEBUG_RECTS) {\n                        console.log(\"--################# POLYGON AFTER unify/substract HAS NO FACES!! \" + (polygonAccumulator || polygonEdge).faces.size);\n                    }\n\n                    if (!useSegmentJoinsNotArcs) {\n                        if (DEBUG_RECTS) {\n                            console.log(\"--##### POLYGON AFTER unify/substract try again without arc, only segment joiners ...\");\n                        }\n                        return offset_(polygon, off, true);\n                    }\n                } else {\n                    if (DEBUG_RECTS) {\n                        console.log(\"--################# POLYGON AFTER unify/substract FACES: \" + (polygonAccumulator || polygonEdge).edges.size + \" /// \" + (polygonAccumulator || polygonEdge).faces.size);\n                    }\n                }\n\n                for (const f of polygonAccumulator.faces) {\n                    const face = f as Face;\n                    if (face.edges.length < 4) {\n                        if (DEBUG_RECTS) {\n                            console.log(\"-------- POLYGON FACE EDGES not at least 4??!\");\n                        }\n                        if (!useSegmentJoinsNotArcs) {\n                            if (DEBUG_RECTS) {\n                                console.log(\"--##### POLYGON AFTER unify/substract try again without arc, only segment joiners ...\");\n                            }\n                            return offset_(polygon, off, true);\n                        }\n                    }\n\n                    if (face.orientation() !== BASE_ORIENTATION) {\n                        if (DEBUG_RECTS) {\n                            console.log(\"-------- POLYGON FACE ORIENTATION\");\n                        }\n                        // face.reverse();\n                    }\n                }\n            } else {\n                // offsetEdge = offsetArc(segment, w);\n                console.log(\"!!!!!!!! POLYGON ARC??!\");\n                // process.exit(0);\n                return polygon;\n            }\n        }\n    }\n\n    Array.from((polygonAccumulator ? polygonAccumulator : polygon).faces).forEach((face: Face) => {\n        if (face.orientation() !== BASE_ORIENTATION) {\n            if (DEBUG_RECTS) {\n                console.log(\"--HIGH WEBVIEW-- removing polygon orientation face / inner hole (offset poly 1))\");\n            }\n            if (polygonAccumulator) {\n                polygonAccumulator.deleteFace(face);\n                // face.reverse();\n            }\n        }\n    });\n\n    if (polygonAccumulator && postponeFinalUnify) {\n        polygonAccumulator = unify(polygonAccumulator, polygon);\n    }\n\n    Array.from((polygonAccumulator ? polygonAccumulator : polygon).faces).forEach((face: Face) => {\n        if (face.orientation() !== BASE_ORIENTATION) {\n            if (DEBUG_RECTS) {\n                console.log(\"--HIGH WEBVIEW-- removing polygon orientation face / inner hole (offset poly 2))\");\n            }\n            if (polygonAccumulator) {\n                polygonAccumulator.deleteFace(face);\n                // face.reverse();\n            }\n        }\n    });\n\n    if (polygonAccumulator) {\n        if (!polygonAccumulator.faces.size) {\n            if (DEBUG_RECTS) {\n                console.log(\"--################# POLYGON INTERMEDIARY HAS NO FACES!! \" + polygonAccumulator.faces.size);\n            }\n        }\n\n        cleanupPolygon(polygonAccumulator, off);\n    }\n\n    let resPoly = polygonAccumulator ? polygonAccumulator : polygon;\n\n    if (!resPoly.faces.size) {\n        if (DEBUG_RECTS) {\n            console.log(\"--################# POLYGON INTERMEDIARY HAS NO FACES!! \" + resPoly.faces.size);\n        }\n        if (polygonAccumulator) {\n            if (DEBUG_RECTS) {\n                console.log(\"--################# FALLBACK TO SINGLE FACE POLY (BEFORE SUBSTRACT/UNIFY): \" + polygon.faces.size);\n            }\n            resPoly = polygon;\n        }\n    }\n\n    return resPoly;\n}\n\nfunction offset(originaPolygon: Polygon, off: number, useSegmentJoinsNotArcs: boolean = USE_SEGMENT_JOINS_NOT_ARCS) {\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const DEBUG_RECTS = (window as any).DEBUG_RECTS;\n\n    off = Number((off).toPrecision(12));\n\n    if (Utils.EQ_0(off)) {\n        return originaPolygon;\n    }\n\n    const singleFacePolygons: Polygon[] = [];\n    for (const f of originaPolygon.faces) {\n        const face = f as Face;\n        const poly = new Polygon();\n        poly.addFace(face.edges.map((edge) => edge.shape));\n        singleFacePolygons.push(poly);\n    }\n\n    const singlePolygon = new Polygon();\n\n    for (const polygon of singleFacePolygons) {\n        const resPoly = offset_(polygon, off, useSegmentJoinsNotArcs);\n\n        for (const f of resPoly.faces) {\n            const face = f as Face;\n            singlePolygon.addFace(face.edges.map(((edge) => edge.shape)));\n        }\n    }\n\n    if (!singlePolygon.faces.size) {\n        if (DEBUG_RECTS) {\n            console.log(\"--##### POLYGON OFFSET HAS NO FACES!! \" + singlePolygon.faces.size);\n        }\n\n        if (!useSegmentJoinsNotArcs) {\n            if (DEBUG_RECTS) {\n                console.log(\"--##### POLYGON OFFSET try again without arc, only segment joiners ...\");\n            }\n            return offset(originaPolygon, off, true);\n        }\n    }\n\n    return singlePolygon;\n}\n\n//     const rgb = Math.round(0xffffff * Math.random());\n//     // tslint:disable-next-line:no-bitwise\n//     const r = rgb >> 16;\n//     // tslint:disable-next-line:no-bitwise\n//     const g = rgb >> 8 & 255;\n//     // tslint:disable-next-line:no-bitwise\n//     const b = rgb & 255;\n// rgb(${r}, ${g}, ${b});\n\nconst DEFAULT_BACKGROUND_COLOR: IColor = {\n    blue: 0,\n    green: 0,\n    red: 255,\n};\n\nconst _highlights: IHighlight[] = [];\n\nlet _drawMargin: boolean | string[] = false;\nconst drawMargin = (h: IHighlight) => {\n    if (Array.isArray(_drawMargin)) {\n        if (h.group) {\n            return _drawMargin.includes(h.group);\n        }\n        return false;\n    }\n    return _drawMargin;\n};\nexport const setDrawMargin = (win: ReadiumElectronWebviewWindow, drawMargin: boolean | string[]) => {\n    _drawMargin = drawMargin;\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- _drawMargin: \" + JSON.stringify(_drawMargin, null, 4));\n    }\n    recreateAllHighlightsRaw(win);\n};\n\ninterface IWithRect {\n    rect: IRectSimple;\n    scale: number;\n    // xOffset: number;\n    // yOffset: number;\n}\ninterface IHTMLDivElementWithRect extends HTMLDivElement, IWithRect {\n}\n\ninterface IWithPolygon {\n    polygon: Polygon;\n}\nconst SVG_XML_NAMESPACE = \"http://www.w3.org/2000/svg\";\n// interface ISVGRectElementWithRect extends SVGRectElement, IWithRect {\n// }\n// interface ISVGLineElementWithRect extends SVGLineElement, IWithRect {\n// }\ninterface ISVGElementWithPolygon extends SVGSVGElement, IWithPolygon {\n}\n\n// interface IDocumentBody extends HTMLElement {\n//     _CachedBoundingClientRect: DOMRect | undefined;\n//     _CachedMargins: IRect | undefined;\n// }\nexport function getBoundingClientRectOfDocumentBody(win: ReadiumElectronWebviewWindow): DOMRect {\n    // TODO: does this need to be cached? (performance, notably during mouse hover)\n    return win.document.body.getBoundingClientRect();\n\n    // if (!(win.document.body as IDocumentBody)._CachedBoundingClientRect) {\n    //     (win.document.body as IDocumentBody)._CachedBoundingClientRect = win.document.body.getBoundingClientRect();\n    // }\n    // console.log(\"_CachedBoundingClientRect\",\n    //     JSON.stringify((win.document.body as IDocumentBody)._CachedBoundingClientRect));\n    // return (win.document.body as IDocumentBody)._CachedBoundingClientRect as DOMRect;\n}\n// export function invalidateBoundingClientRectOfDocumentBody(win: ReadiumElectronWebviewWindow) {\n//     (win.document.body as IDocumentBody)._CachedBoundingClientRect = undefined;\n// }\n// function getBodyMargin(win: ReadiumElectronWebviewWindow): IRect {\n//     const bodyStyle = win.getComputedStyle(win.document.body);\n//     if (!(win.document.body as IDocumentBody)._CachedMargins) {\n//         (win.document.body as IDocumentBody)._CachedMargins = {\n//             bottom: parseInt(bodyStyle.marginBottom, 10),\n//             height: 0,\n//             left: parseInt(bodyStyle.marginLeft, 10),\n//             right: parseInt(bodyStyle.marginRight, 10),\n//             top: parseInt(bodyStyle.marginTop, 10),\n//             width: 0,\n//         };\n//     }\n//     console.log(\"_CachedMargins\",\n//         JSON.stringify((win.document.body as IDocumentBody)._CachedMargins));\n//     return (win.document.body as IDocumentBody)._CachedMargins as IRect;\n// }\n\nfunction processMouseEvent(win: ReadiumElectronWebviewWindow, ev: MouseEvent) {\n\n    // const highlightsContainer = documant.getElementById(`${ID_HIGHLIGHTS_CONTAINER}`);\n    if (!_highlightsContainer) {\n        return;\n    }\n\n    const isMouseMove = ev.type === \"mousemove\";\n    if (isMouseMove) {\n        // no hit testing during user selection drag\n        if (ev.buttons > 0) {\n            return;\n        }\n\n        if (!_highlights.length) {\n            return;\n        }\n    }\n\n    const documant = win.document;\n    const scrollElement = getScrollingElement(documant);\n\n    // relative to fixed window top-left corner\n    // (unlike pageX/Y which is relative to top-left rendered content area, subject to scrolling)\n    const x = ev.clientX;\n    const y = ev.clientY;\n\n    const paginated = isPaginated(documant);\n\n    // COSTLY! TODO: cache DOMRect\n    const bodyRect = getBoundingClientRectOfDocumentBody(win);\n\n    const xOffset = paginated ? (-scrollElement.scrollLeft) : bodyRect.left;\n    const yOffset = paginated ? (-scrollElement.scrollTop) : bodyRect.top;\n\n    const scale = 1 / ((win.READIUM2 && win.READIUM2.isFixedLayout) ? win.READIUM2.fxlViewportScale : 1);\n\n    let hit = false;\n    let foundHighlight: IHighlight | undefined;\n    let foundElement: IHTMLDivElementWithRect | undefined;\n    // for (const highlight of _highlights) {\n    for (let i = _highlights.length - 1; i >= 0; i--) {\n        const highlight = _highlights[i];\n\n        let highlightParent = documant.getElementById(`${highlight.id}`);\n        if (!highlightParent) { // ??!!\n            highlightParent = _highlightsContainer.querySelector(`#${highlight.id}`); // .${CLASS_HIGHLIGHT_CONTAINER}\n        }\n        if (!highlightParent) { // what?\n            continue;\n        }\n\n        let highlightFragment = highlightParent.firstElementChild;\n        while (highlightFragment) {\n            if (highlightFragment.namespaceURI === SVG_XML_NAMESPACE) {\n\n                const svg = highlightFragment as ISVGElementWithPolygon;\n                hit = svg.polygon.contains(new Point((x - xOffset) * scale, (y - yOffset) * scale));\n                if (hit) {\n                    break;\n                }\n            }\n\n            highlightFragment = highlightFragment.nextElementSibling;\n        }\n\n        if (hit) {\n            foundHighlight = highlight;\n            foundElement = highlightParent as IHTMLDivElementWithRect;\n            break;\n        }\n    }\n\n    let highlightContainer = _highlightsContainer.firstElementChild;\n    while (highlightContainer) {\n        if (!foundElement || foundElement !== highlightContainer) {\n            highlightContainer.classList.remove(CLASS_HIGHLIGHT_HOVER);\n        }\n\n        // const id = highlightContainer.id || highlightContainer.getAttribute(\"id\");\n        // const highlight = id ? _highlights.find((h) => h.id === id) : undefined;\n        // const drawUnderline = highlight?.drawType === HighlightDrawTypeUnderline;\n        // const drawStrikeThrough = highlight?.drawType === HighlightDrawTypeStrikethrough;\n        // const doDrawMargin = highlight ? drawMargin(highlight) : false;\n\n        highlightContainer = highlightContainer.nextElementSibling;\n    }\n\n    if (!hit) { // !foundHighlight || !foundElement\n\n        // documant.documentElement.classList.remove(CLASS_HIGHLIGHT_CURSOR1);\n        documant.documentElement.classList.remove(CLASS_HIGHLIGHT_CURSOR2);\n        return;\n    }\n\n    if (foundElement && foundHighlight?.pointerInteraction) {\n\n        if (isMouseMove) {\n            foundElement.classList.add(CLASS_HIGHLIGHT_HOVER);\n\n            // const doDrawMargin = drawMargin(foundHighlight);\n            // documant.documentElement.classList.add(doDrawMargin ? CLASS_HIGHLIGHT_CURSOR1 : CLASS_HIGHLIGHT_CURSOR2);\n            documant.documentElement.classList.add(CLASS_HIGHLIGHT_CURSOR2);\n\n        } else if (ev.type === \"mouseup\" || ev.type === \"click\") {\n            // documant.documentElement.classList.remove(CLASS_HIGHLIGHT_CURSOR1);\n            documant.documentElement.classList.remove(CLASS_HIGHLIGHT_CURSOR2);\n\n            ev.preventDefault();\n            ev.stopPropagation();\n\n            const payload: IEventPayload_R2_EVENT_HIGHLIGHT_CLICK = {\n                highlight: foundHighlight,\n                event: {\n                    type: ev.type,\n                    button: ev.button,\n                    alt: ev.altKey,\n                    shift: ev.shiftKey,\n                    ctrl: ev.ctrlKey,\n                    meta: ev.metaKey,\n                    x: ev.clientX,\n                    y: ev.clientY,\n                },\n            };\n            ipcRenderer.sendToHost(R2_EVENT_HIGHLIGHT_CLICK, payload);\n        }\n    }\n}\n\nlet lastMouseDownX = -1;\nlet lastMouseDownY = -1;\nlet bodyEventListenersSet = false;\nlet _highlightsContainer: HTMLElement | null;\nfunction ensureHighlightsContainer(win: ReadiumElectronWebviewWindow): HTMLElement {\n    const documant = win.document;\n\n    if (!_highlightsContainer) {\n\n        // Note that legacy ResizeSensor sets body position to \"relative\" (default static).\n        // Also note that ReadiumCSS default to (via stylesheet :root):\n        // documant.documentElement.style.position = \"relative\";\n        // see styles.js (static CSS injection):\n        // documant.documentElement.style.setProperty(\"height\", \"100vh\", \"important\");\n        // documant.body.style.position = \"relative\";\n        // documant.body.style.setProperty(\"position\", \"relative\", \"important\");\n        // documant.body.style.height = \"inherit\";\n        // https://github.com/edrlab/thorium-reader/issues/1658\n\n        if (!bodyEventListenersSet) {\n            bodyEventListenersSet = true;\n\n            // reminder: mouseenter/mouseleave do not bubble, so no event delegation\n            // documant.body.addEventListener(\"click\", (ev: MouseEvent) => {\n            //     processMouseEvent(win, ev);\n            // }, false);\n            documant.body.addEventListener(\"mousedown\", (ev: MouseEvent) => {\n                lastMouseDownX = ev.clientX;\n                lastMouseDownY = ev.clientY;\n            }, false);\n            documant.body.addEventListener(\"mouseup\", (ev: MouseEvent) => {\n                if ((Math.abs(lastMouseDownX - ev.clientX) < 3) &&\n                    (Math.abs(lastMouseDownY - ev.clientY) < 3)) {\n                    processMouseEvent(win, ev);\n                }\n            }, false);\n            documant.body.addEventListener(\"mousemove\", (ev: MouseEvent) => {\n                processMouseEvent(win, ev);\n            }, false);\n        }\n\n        _highlightsContainer = documant.createElement(\"div\");\n        _highlightsContainer.setAttribute(\"id\", ID_HIGHLIGHTS_CONTAINER);\n        _highlightsContainer.setAttribute(\"class\", CLASS_HIGHLIGHT_COMMON);\n        _highlightsContainer.setAttribute(\"style\",\n            \"width: auto !important; \" +\n            \"height: auto !important; \");\n        documant.body.append(_highlightsContainer);\n    }\n    return _highlightsContainer;\n}\n\nexport function hideAllhighlights(_documant: Document) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- hideAllhighlights: \" + _highlights.length);\n    }\n\n    if (_highlightsContainer) {\n        _highlightsContainer.remove();\n        _highlightsContainer = null;\n        // ensureHighlightsContainer(documant); LAZY\n    }\n}\n\nexport function destroyAllhighlights(documant: Document) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- destroyAllhighlights: \" + _highlights.length);\n    }\n    hideAllhighlights(documant);\n    _highlights.splice(0, _highlights.length);\n}\n\nexport function destroyHighlight(documant: Document, id: string) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- destroyHighlight: \" + id + \" ... \" + _highlights.length);\n    }\n    let i = -1;\n    const highlight = _highlights.find((h, j) => {\n        i = j;\n        return h.id === id;\n    });\n    if (highlight && i >= 0 && i < _highlights.length) {\n        _highlights.splice(i, 1);\n    }\n\n    const highlightContainer = documant.getElementById(id);\n    if (highlightContainer) {\n        highlightContainer.remove();\n    }\n}\n\nexport function destroyHighlightsGroup(documant: Document, group: string) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- destroyHighlightsGroup: \" + group + \" ... \" + _highlights.length);\n    }\n    while (true) {\n        let i = -1;\n        const highlight = _highlights.find((h, j) => {\n            i = j;\n            return h.group === group;\n        });\n        if (highlight) {\n            if (i >= 0 && i < _highlights.length) {\n                _highlights.splice(i, 1);\n            }\n\n            const highlightContainer = documant.getElementById(highlight.id);\n            if (highlightContainer) {\n                highlightContainer.remove();\n            }\n        } else {\n            break;\n        }\n    }\n}\n\nexport function recreateAllHighlightsRaw(win: ReadiumElectronWebviewWindow, highlights?: IHighlight[]) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- recreateAllHighlightsRaw: \" + _highlights.length + \" ==> \" + highlights?.length);\n    }\n\n    const documant = win.document;\n\n    if (highlights?.length) {\n        if (_highlights.length) {\n            if (IS_DEV) {\n                console.log(\"--HIGH WEBVIEW-- recreateAllHighlightsRaw DESTROY OLD BEFORE RESTORE BACKUP: \" + _highlights.length + \" ==> \" + highlights.length);\n            }\n            destroyAllhighlights(documant);\n        }\n        if (IS_DEV) {\n            console.log(\"--HIGH WEBVIEW-- recreateAllHighlightsRaw RESTORE BACKUP: \" + _highlights.length + \" ==> \" + highlights.length);\n        }\n        _highlights.push(...highlights);\n    }\n\n    if (!_highlights.length) {\n        return;\n    }\n\n    if (!documant.body) {\n        if (IS_DEV) {\n            console.log(\"--HIGH WEBVIEW-- NO BODY?! (retrying...): \" + _highlights.length);\n        }\n        recreateAllHighlightsDebounced(win);\n        return;\n    }\n\n    hideAllhighlights(documant);\n\n    const bodyRect = getBoundingClientRectOfDocumentBody(win);\n    const bodyComputedStyle = win.getComputedStyle(documant.body);\n\n    const docFrag = documant.createDocumentFragment();\n    for (const highlight of _highlights) {\n        const div = createHighlightDom(win, highlight, bodyRect, bodyComputedStyle);\n        if (div) {\n            docFrag.append(div);\n        }\n    }\n\n    const highlightsContainer = ensureHighlightsContainer(win);\n    highlightsContainer.append(docFrag);\n}\n\nexport const recreateAllHighlightsDebounced = debounce((win: ReadiumElectronWebviewWindow) => {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- recreateAllHighlightsDebounced: \" + _highlights.length);\n    }\n    recreateAllHighlightsRaw(win);\n}, 500);\n\nexport function recreateAllHighlights(win: ReadiumElectronWebviewWindow) {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- recreateAllHighlights: \" + _highlights.length);\n    }\n    hideAllhighlights(win.document);\n    recreateAllHighlightsDebounced(win);\n}\n\nexport function createHighlights(\n    win: ReadiumElectronWebviewWindow,\n    highDefs: IHighlightDefinition[],\n    pointerInteraction: boolean): Array<IHighlight | null> {\n    if (IS_DEV) {\n        console.log(\"--HIGH WEBVIEW-- createHighlights: \" + highDefs.length + \" ... \" + _highlights.length);\n    }\n\n    const documant = win.document;\n    const highlights: Array<IHighlight | null> = [];\n\n    const bodyRect = getBoundingClientRectOfDocumentBody(win);\n    const bodyComputedStyle = win.getComputedStyle(documant.body);\n\n    const docFrag = documant.createDocumentFragment();\n    for (const highDef of highDefs) {\n        if (!highDef.selectionInfo && !highDef.range) {\n            highlights.push(null);\n            continue;\n        }\n        const [high, div] = createHighlight(\n            win,\n            highDef.selectionInfo,\n            highDef.range,\n            highDef.color,\n            pointerInteraction,\n            highDef.drawType,\n            highDef.expand,\n            highDef.group,\n            bodyRect,\n            bodyComputedStyle);\n        highlights.push(high);\n\n        if (div) {\n            docFrag.append(div);\n        }\n    }\n\n    const highlightsContainer = ensureHighlightsContainer(win);\n    highlightsContainer.append(docFrag);\n\n    return highlights;\n}\n\nconst computeCFI = (node: Node): string | undefined => {\n\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        if (node.parentNode) {\n            return computeCFI(node.parentNode);\n        }\n        return undefined;\n    }\n\n    let cfi = \"\";\n\n    let currentElement = node as Element;\n    while (currentElement.parentNode && currentElement.parentNode.nodeType === Node.ELEMENT_NODE) {\n        const currentElementParentChildren = (currentElement.parentNode as Element).children;\n        let currentElementIndex = -1;\n        for (let i = 0; i < currentElementParentChildren.length; i++) {\n            if (currentElement === currentElementParentChildren[i]) {\n                currentElementIndex = i;\n                break;\n            }\n        }\n        if (currentElementIndex >= 0) {\n            const cfiIndex = (currentElementIndex + 1) * 2;\n            cfi = cfiIndex +\n                (currentElement.id ? (\"[\" + currentElement.id + \"]\") : \"\") +\n                (cfi.length ? (\"/\" + cfi) : \"\");\n        }\n        currentElement = currentElement.parentNode as Element;\n    }\n\n    return \"/\" + cfi;\n};\n\nexport function createHighlight(\n    win: ReadiumElectronWebviewWindow,\n    selectionInfo: ISelectionInfo | undefined,\n    range: Range | undefined,\n    color: IColor | undefined,\n    pointerInteraction: boolean,\n    drawType: number | undefined,\n    expand: number | undefined,\n    group: string | undefined,\n    bodyRect: DOMRect,\n    bodyComputedStyle: CSSStyleDeclaration): [IHighlight, HTMLDivElement | null] {\n\n    // tslint:disable-next-line:no-string-literal\n    // console.log(\"Chromium: \" + process.versions[\"chrome\"]);\n\n    const uniqueStr = selectionInfo ? `${selectionInfo.rangeInfo.startContainerElementCssSelector}${selectionInfo.rangeInfo.startContainerChildTextNodeIndex}${selectionInfo.rangeInfo.startOffset}${selectionInfo.rangeInfo.endContainerElementCssSelector}${selectionInfo.rangeInfo.endContainerChildTextNodeIndex}${selectionInfo.rangeInfo.endOffset}` : range ? `${range.startOffset}-${range.endOffset}-${computeCFI(range.startContainer)}-${computeCFI(range.endContainer)}` : \"_RANGE_\"; // ${selectionInfo.rangeInfo.cfi} useless\n\n    // console.log(\"RANGE uniqueStr: \" + uniqueStr + \" (( \" + range?.toString());\n\n    // const unique = Buffer.from(JSON.stringify(selectionInfo.rangeInfo, null, \"\")).toString(\"base64\");\n    // const unique = Buffer.from(uniqueStr).toString(\"base64\");\n    // const id = \"R2_HIGHLIGHT_\" + unique.replace(/\\+/, \"_\").replace(/=/, \"-\").replace(/\\//, \".\");\n    const checkSum = crypto.createHash(\"sha1\"); // sha256 slow\n    checkSum.update(uniqueStr);\n    const shaHex = checkSum.digest(\"hex\");\n    const idBase = \"R2_HIGHLIGHT_\" + shaHex;\n    let id = idBase;\n    let idIdx = 0;\n    while (\n        _highlights.find((h) => h.id === id) ||\n        win.document.getElementById(id)) {\n\n        if (IS_DEV) {\n            console.log(\"HIGHLIGHT ID already exists, increment: \" + uniqueStr + \" ==> \" + id);\n        }\n        id = `${idBase}_${idIdx++}`;\n    }\n\n    const highlight: IHighlight = {\n        color: color ? color : DEFAULT_BACKGROUND_COLOR,\n        drawType,\n        expand,\n        id,\n        pointerInteraction,\n        selectionInfo,\n        range,\n        group,\n    };\n    _highlights.push(highlight);\n\n    const div = createHighlightDom(win, highlight, bodyRect, bodyComputedStyle);\n    return [highlight, div];\n}\n\nfunction createHighlightDom(\n    win: ReadiumElectronWebviewWindow,\n    highlight: IHighlight,\n    bodyRect: DOMRect,\n    bodyComputedStyle: CSSStyleDeclaration): HTMLDivElement | null {\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const DEBUG_RECTS = (window as any).DEBUG_RECTS;\n\n    const documant = win.document;\n    const scrollElement = getScrollingElement(documant);\n\n    const range = highlight.selectionInfo ? convertRangeInfo(documant, highlight.selectionInfo.rangeInfo) : highlight.range;\n    if (!range) {\n        return null;\n    }\n\n    const drawBackground = highlight.drawType === HighlightDrawTypeBackground;\n    const drawUnderline = highlight.drawType === HighlightDrawTypeUnderline;\n    const drawStrikeThrough = highlight.drawType === HighlightDrawTypeStrikethrough;\n    const drawOutline = highlight.drawType === HighlightDrawTypeOutline;\n\n    const paginated = isPaginated(documant);\n\n    const rtl = isRTL();\n    const vertical = isVerticalWritingMode();\n\n    const doDrawMargin = drawMargin(highlight);\n\n    // checkRangeFix(documant);\n\n    // const highlightsContainer = ensureHighlightsContainer(win);\n\n    const highlightParent = documant.createElement(\"div\") as IHTMLDivElementWithRect;\n    highlightParent.setAttribute(\"id\", highlight.id);\n    highlightParent.setAttribute(\"class\", `${CLASS_HIGHLIGHT_CONTAINER} ${CLASS_HIGHLIGHT_COMMON}`);\n    highlightParent.setAttribute(\"data-type\", `${highlight.drawType}`);\n    if (highlight.group) {\n        highlightParent.setAttribute(\"data-group\", highlight.group);\n    }\n    if (doDrawMargin) {\n        // highlightParent.setAttribute(\"data-margin\", \"true\");\n        highlightParent.classList.add(CLASS_HIGHLIGHT_MARGIN);\n    }\n\n    const styleAttr = win.document.documentElement.getAttribute(\"style\");\n    const isNight = styleAttr ? styleAttr.indexOf(\"readium-night-on\") > 0 : false;\n    // const isSepia = styleAttr ? styleAttr.indexOf(\"readium-sepia-on\") > 0 : false;\n\n    highlightParent.style.setProperty(\n        \"mix-blend-mode\",\n        isNight ? \"hard-light\" : \"multiply\",\n        \"important\");\n\n    // const docStyle = (documant.defaultView as Window).getComputedStyle(documant.documentElement);\n    // const bodyStyle = (documant.defaultView as Window).getComputedStyle(documant.body);\n    // const marginLeft = bodyStyle.getPropertyValue(\"margin-left\");\n    // console.log(\"marginLeft: \" + marginLeft);\n    // const marginTop = bodyStyle.getPropertyValue(\"margin-top\");\n    // console.log(\"marginTop: \" + marginTop);\n\n    // console.log(\"==== bodyRect:\");\n    // console.log(\"width: \" + bodyRect.width);\n    // console.log(\"height: \" + bodyRect.height);\n    // console.log(\"top: \" + bodyRect.top);\n    // console.log(\"bottom: \" + bodyRect.bottom);\n    // console.log(\"left: \" + bodyRect.left);\n    // console.log(\"right: \" + bodyRect.right);\n\n    // const xOffset = paginated ? (bodyRect.left - parseInt(marginLeft, 10)) : bodyRect.left;\n    // const yOffset = paginated ? (bodyRect.top - parseInt(marginTop, 10)) : bodyRect.top;\n\n    const xOffset = paginated ? (-scrollElement.scrollLeft) : bodyRect.left;\n    const yOffset = paginated ? (-scrollElement.scrollTop) : bodyRect.top;\n\n    const scale = 1 / ((win.READIUM2 && win.READIUM2.isFixedLayout) ? win.READIUM2.fxlViewportScale : 1);\n    // const scale = 1;\n\n    // console.log(\"scrollElement.scrollLeft: \" + scrollElement.scrollLeft);\n    // console.log(\"scrollElement.scrollTop: \" + scrollElement.scrollTop);\n\n    const doNotMergeHorizontallyAlignedRects = drawUnderline || drawStrikeThrough;\n\n    let clientRects: IRect[] | undefined;\n\n    const rangeClientRects = DOMRectListToArray(range.getClientRects());\n\n    if (doNotMergeHorizontallyAlignedRects) {\n        // non-solid highlight (underline or strikethrough), cannot merge and reduce/simplify client rectangles much due to importance of line-level decoration (must preserve horizontal/vertical line heights)\n\n        const textClientRects = getTextClientRects(range);\n        const textReducedClientRects = getClientRectsNoOverlap(textClientRects, true, vertical, highlight.expand ? highlight.expand : 0);\n\n        clientRects = (DEBUG_RECTS && drawStrikeThrough) ? textClientRects : textReducedClientRects;\n\n        // const rangeReducedClientRects = getClientRectsNoOverlap(rangeClientRects, false, vertical, 0);\n\n        // // const rangeUnionPolygon = rangeReducedClientRects.reduce((previous, current) => unify(previous, new Polygon(new Box(current.left, current.top, current.left + current.width, current.top + current.height))), new Polygon());\n\n        // // Array.from(rangeUnionPolygon.faces).forEach((face: Face) => {\n        // //     if (face.orientation() !== BASE_ORIENTATION) {\n        // //         if (DEBUG_RECTS) {\n        // //             console.log(\"--HIGH WEBVIEW-- removing polygon orientation face / inner hole (text range))\");\n        // //         }\n        // //         polygonCountourUnionPoly.deleteFace(face);\n        // //     }\n        // // });\n\n        // const textReducedClientRectsToKeep: IRect[] = [];\n        // textReducedClientRectsToKeep.push(...textReducedClientRects);\n\n        // for (const rect of textReducedClientRects) {\n        //     console.log(\"__RECT__ text :: \" + `TOP:${rect.top} BOTTOM:${rect.bottom} LEFT:${rect.left} RIGHT:${rect.right} WIDTH:${rect.width} HEIGHT:${rect.height}`);\n\n        //     let intersections: IRect[] | undefined;\n        //     for (const rectRange of rangeReducedClientRects) {\n        //         console.log(\"__RECT__ range :: \" + `TOP:${rect.top} BOTTOM:${rect.bottom} LEFT:${rect.left} RIGHT:${rect.right} WIDTH:${rect.width} HEIGHT:${rect.height}`);\n        //         const rectIntersection = rectIntersect(rect, rectRange);\n        //         const hasIntersection = rectIntersection.width > 0 || rectIntersection.height > 0;\n        //         if (!hasIntersection) {\n        //             console.log(\"__RECT__ no intersect\");\n        //             continue;\n        //         }\n        //         console.log(\"__RECT__ intersect :: \" + `TOP:${rectIntersection.top} BOTTOM:${rectIntersection.bottom} LEFT:${rectIntersection.left} RIGHT:${rectIntersection.right} WIDTH:${rectIntersection.width} HEIGHT:${rectIntersection.height}`);\n        //         if (!intersections) {\n        //             intersections = [];\n        //         }\n        //         intersections.push(rectIntersection);\n        //     }\n\n        //     if (!intersections?.length) {\n        //         console.log(\"__RECT__ zero intersect, eject rect\");\n        //         textReducedClientRectsToKeep.splice(textReducedClientRectsToKeep.indexOf(rect), 1);\n        //     } else {\n        //         const intersectionsBoundingBox = intersections.reduce((previous, current) => {\n        //             if (current === previous) {\n        //                 return current;\n        //             }\n        //             return getBoundingRect(previous, current);\n        //         }, intersections[0]);\n\n        //         console.log(\"__RECT__ intersect bounds :: \" + `TOP:${intersectionsBoundingBox.top} BOTTOM:${intersectionsBoundingBox.bottom} LEFT:${intersectionsBoundingBox.left} RIGHT:${intersectionsBoundingBox.right} WIDTH:${intersectionsBoundingBox.width} HEIGHT:${intersectionsBoundingBox.height}`);\n\n        //         if (!rectSame(intersectionsBoundingBox, rect, 2)) {\n        //             console.log(\"__RECT__ rect different than intersect bounds, replace\");\n        //             textReducedClientRectsToKeep.splice(textReducedClientRectsToKeep.indexOf(rect), 1, intersectionsBoundingBox);\n        //         }\n        //     }\n\n        //     // const rectPolygon = new Polygon(new Box(rect.left, rect.top, rect.left + rect.width, rect.top + rect.height));\n\n        //     // const poly = intersect(rangeUnionPolygon, rectPolygon);\n        //     // const b = poly.box; // shortcut, but we could check polygon faces too\n\n        //     // if (rect.left !== b.xmin || rect.top !== b.ymin || rect.right !== b.xmax || rect.bottom !== b.ymax) {\n        //     //     console.log(\"__RECT__ before\" + `TOP:${rect.top} BOTTOM:${rect.bottom} LEFT:${rect.left} RIGHT:${rect.right} WIDTH:${rect.width} HEIGHT:${rect.height}`);\n\n        //     //     rect.left = b.xmin;\n        //     //     rect.top = b.ymin;\n        //     //     rect.right = b.xmax;\n        //     //     rect.bottom = b.ymax;\n        //     //     rect.width = b.width;\n        //     //     rect.height = b.height;\n\n        //     //     console.log(\"__RECT__ after\" + `TOP:${rect.top} BOTTOM:${rect.bottom} LEFT:${rect.left} RIGHT:${rect.right} WIDTH:${rect.width} HEIGHT:${rect.height}`);\n        //     // }\n        // }\n\n        // console.log(\"__RECT__ :: \" + textClientRects.length + \" ===> \" + textReducedClientRectsToKeep.length);\n\n        // clientRects = (DEBUG_RECTS && drawStrikeThrough) ? textClientRects : textReducedClientRectsToKeep;\n    } else {\n        // solid highlight, can merge and reduce/simplify client rectangles as much as possible\n        clientRects = getClientRectsNoOverlap(rangeClientRects, false, vertical, highlight.expand ? highlight.expand : 0);\n    }\n\n    // let highlightAreaSVGDocFrag: DocumentFragment | undefined;\n    // const roundedCorner = 3;\n\n    const underlineThickness = 3;\n    const strikeThroughLineThickness = 4;\n\n    // const rangeBoundingClientRect = range.getBoundingClientRect();\n\n    const bodyWidth = parseInt(bodyComputedStyle.width, 10);\n    const paginatedTwo = paginated && isTwoPageSpread();\n    const paginatedWidth = scrollElement.clientWidth / (paginatedTwo ? 2 : 1);\n    const paginatedOffset = (paginatedWidth - bodyWidth) / 2 + parseInt(bodyComputedStyle.paddingLeft, 10);\n\n    const gap = 2;\n    const gapX = ((drawOutline || drawBackground) ? gap : 0);\n\n    const boxesNoGapExpanded = [];\n    const boxesGapExpanded = [];\n\n    for (const clientRect of clientRects) {\n\n        const rect = {\n            height: clientRect.height,\n            left: clientRect.left - xOffset,\n            top: clientRect.top - yOffset,\n            width: clientRect.width,\n        };\n        const w = rect.width * scale;\n        const h = rect.height * scale;\n        const x = rect.left * scale;\n        const y = rect.top * scale;\n\n        boxesGapExpanded.push(new Box(\n            Number((x - gap).toPrecision(12)),\n            Number((y - gap).toPrecision(12)),\n            Number((x + w + gap).toPrecision(12)),\n            Number((y + h + gap).toPrecision(12)),\n        ));\n\n        // boxesNoGapExpanded.push(new Box(\n        //     Number((x).toPrecision(12)),\n        //     Number((y).toPrecision(12)),\n        //     Number((x + w).toPrecision(12)),\n        //     Number((y + h).toPrecision(12)),\n        // ));\n\n        if (drawStrikeThrough) {\n\n            const thickness = DEBUG_RECTS ? (vertical ? rect.width : rect.height) : strikeThroughLineThickness;\n            const ww = (vertical ? thickness : rect.width) * scale;\n            const hh = (vertical ? rect.height : thickness) * scale;\n            const xx =\n            (\n            vertical\n            ?\n            (\n                DEBUG_RECTS\n                ?\n                rect.left\n                :\n                (rect.left + (rect.width / 2) - (thickness / 2))\n            )\n            :\n            rect.left\n            ) * scale;\n\n            const yy =\n            (\n            vertical\n            ?\n            rect.top\n            :\n            (\n                DEBUG_RECTS\n                ?\n                rect.top\n                :\n                (rect.top + (rect.height / 2) - (thickness / 2))\n            )\n            ) * scale;\n\n            boxesNoGapExpanded.push(new Box(\n                Number((xx - gapX).toPrecision(12)),\n                Number((yy - gapX).toPrecision(12)),\n                Number((xx + ww + gapX).toPrecision(12)),\n                Number((yy + hh + gapX).toPrecision(12)),\n            ));\n\n        } else { // drawStrikeThrough\n\n            const thickness = DEBUG_RECTS ? (vertical ? rect.width : rect.height) : underlineThickness;\n            if (drawUnderline) {\n                const ww = (vertical ? thickness : rect.width) * scale;\n                const hh = (vertical ? rect.height : thickness) * scale;\n                const xx =\n                (\n                vertical\n                ?\n                (\n                    DEBUG_RECTS\n                    ?\n                    rect.left\n                    :\n                    (rect.left - (thickness / 2))\n                )\n                :\n                rect.left\n                ) * scale;\n\n                const yy =\n                (\n                vertical\n                ?\n                rect.top\n                :\n                (\n                    DEBUG_RECTS\n                    ?\n                    rect.top\n                    :\n                    (rect.top + rect.height - (thickness / 2))\n                )\n                ) * scale;\n\n                boxesNoGapExpanded.push(new Box(\n                    Number((xx - gapX).toPrecision(12)),\n                    Number((yy - gapX).toPrecision(12)),\n                    Number((xx + ww + gapX).toPrecision(12)),\n                    Number((yy + hh + gapX).toPrecision(12)),\n                ));\n            } else {\n                boxesNoGapExpanded.push(new Box(\n                    Number((x - gapX).toPrecision(12)),\n                    Number((y - gapX).toPrecision(12)),\n                    Number((x + w + gapX).toPrecision(12)),\n                    Number((y + h + gapX).toPrecision(12)),\n                ));\n            }\n        }\n    }\n\n    const polygonCountourUnionPoly = boxesGapExpanded.reduce((previousPolygon, currentBox) => {\n        const p = new Polygon();\n        const f = p.addFace(currentBox);\n        if (f.orientation() !== BASE_ORIENTATION) {\n            console.log(\"--POLYGON FACE ORIENTATION CCW/CW reverse() 2\");\n            f.reverse();\n        }\n        return unify(previousPolygon, p);\n    }, new Polygon());\n\n    Array.from(polygonCountourUnionPoly.faces).forEach((face: Face) => {\n        if (face.orientation() !== BASE_ORIENTATION) {\n            if (DEBUG_RECTS) {\n                console.log(\"--HIGH WEBVIEW-- removing polygon orientation face / inner hole (contour))\");\n            }\n            polygonCountourUnionPoly.deleteFace(face);\n        }\n    });\n    cleanupPolygon(polygonCountourUnionPoly, gap);\n\n    let polygonSurface: Polygon | Polygon[] | undefined;\n    if (doNotMergeHorizontallyAlignedRects) {\n        const singleSVGPath = !DEBUG_RECTS;\n        if (singleSVGPath) {\n            polygonSurface = new Polygon();\n            for (const box of boxesNoGapExpanded) {\n                const f = polygonSurface.addFace(box);\n                if (f.orientation() !== BASE_ORIENTATION) {\n                    console.log(\"--POLYGON FACE ORIENTATION CCW/CW reverse() 3\");\n                    f.reverse();\n                }\n            }\n        } else {\n            polygonSurface = [];\n            for (const box of boxesNoGapExpanded) {\n                const poly = new Polygon();\n                const f = poly.addFace(box);\n                if (f.orientation() !== BASE_ORIENTATION) {\n                    console.log(\"--POLYGON FACE ORIENTATION CCW/CW reverse() 4\");\n                    f.reverse();\n                }\n                polygonSurface.push(poly);\n            }\n        }\n    } else {\n        polygonSurface = boxesNoGapExpanded.reduce((previousPolygon, currentBox) => {\n            const p = new Polygon();\n            const f = p.addFace(currentBox);\n            if (f.orientation() !== BASE_ORIENTATION) {\n                console.log(\"--POLYGON FACE ORIENTATION CCW/CW reverse() 5\");\n                f.reverse();\n            }\n            return unify(previousPolygon, p);\n        }, new Polygon());\n\n        Array.from(polygonSurface.faces).forEach((face: Face) => {\n            if (face.orientation() !== BASE_ORIENTATION) {\n                if (DEBUG_RECTS) {\n                    console.log(\"--HIGH WEBVIEW-- removing polygon orientation face / inner hole (surface))\");\n                }\n                (polygonSurface as Polygon).deleteFace(face);\n            }\n        });\n\n        if (drawOutline || drawBackground) {\n\n            if (DEBUG_RECTS) {\n                console.log(\"--==========--==========--==========--==========--==========--==========\");\n                console.log(\"--POLY FACES BEFORE ...\");\n            }\n            for (const f of polygonSurface.faces) {\n                const face = f as Face;\n                if (DEBUG_RECTS) {\n                    console.log(\"--................--................--................\");\n                    console.log(\"--POLY FACE: \" + (face.orientation() === ORIENTATION.CCW ? \"CCW\" : face.orientation() === ORIENTATION.CW ? \"CW\" : \"ORIENTATION.NOT_ORIENTABLE\" ));\n                }\n                for (const edge of face.edges) {\n                    if (DEBUG_RECTS) {\n                        console.log(\"--POLY EDGE\");\n                    }\n                    if (edge.isSegment()) {\n                        if (DEBUG_RECTS) {\n                            console.log(\"--POLY SEGMENT...\");\n                        }\n                        const segment = edge.shape as Segment;\n                        const pointStart = segment.start;\n                        const pointEnd = segment.end;\n                        if (DEBUG_RECTS) {\n                            console.log(\"--POLY SEGMENT START x, y: \" + pointStart.x + \", \" + pointStart.y);\n                            console.log(\"--POLY SEGMENT END x, y: \" + pointEnd.x + \", \" + pointEnd.y);\n                        }\n                    } else if (edge.isArc()) {\n                        if (DEBUG_RECTS) {\n                            console.log(\"--POLY ARC...\");\n                        }\n                        const arc = edge.shape as Arc;\n\n                        if (DEBUG_RECTS) {\n                            console.log(\"--POLY ARC: \" + arc.start.x + \", \" + arc.start.y);\n                            console.log(\"--POLY ARC: \" + arc.end.x + \", \" + arc.end.y);\n                            console.log(\"--POLY ARC: \" + arc.length + \" / \" + arc.sweep);\n                            // console.log(\"--POLY ARC: \" + arc.ps.x + \", \" + arc.ps.y + \" (\" + arc.r + \") \" + \"[\" + arc.startAngle + \", \" + arc.endAngle + \"]\");\n                        }\n                    }\n                }\n            }\n\n            try {\n                polygonSurface = offset(polygonSurface, -(gap + gap/2));\n            } catch (e) {\n                console.log(e);\n            }\n\n            if (DEBUG_RECTS) {\n                console.log(\"--==========--==========--==========--==========--==========--==========\");\n                console.log(\"--POLY FACES AFTER ...\");\n            }\n            for (const f of polygonSurface.faces) {\n                const face = f as Face;\n                if (DEBUG_RECTS) {\n                    console.log(\"--................--................--................\");\n                    console.log(\"--POLY FACE: \" + (face.orientation() === ORIENTATION.CCW ? \"CCW\" : face.orientation() === ORIENTATION.CW ? \"CW\" : \"ORIENTATION.NOT_ORIENTABLE\" ));\n                }\n\n                for (const edge of face.edges) {\n                    if (DEBUG_RECTS) {\n                        console.log(\"--POLY EDGE\");\n                    }\n                    if (edge.isSegment()) {\n                        if (DEBUG_RECTS) {\n                            console.log(\"--POLY SEGMENT...\");\n                        }\n                        const segment = edge.shape as Segment;\n                        const pointStart = segment.start;\n                        const pointEnd = segment.end;\n                        if (DEBUG_RECTS) {\n                            console.log(\"--POLY SEGMENT START x, y: \" + pointStart.x + \", \" + pointStart.y);\n                            console.log(\"--POLY SEGMENT END x, y: \" + pointEnd.x + \", \" + pointEnd.y);\n                        }\n                    } else if (edge.isArc()) {\n                        if (DEBUG_RECTS) {\n                            console.log(\"--POLY ARC...\");\n                        }\n                        const arc = edge.shape as Arc;\n\n                        if (DEBUG_RECTS) {\n                            console.log(\"--POLY ARC: \" + arc.start.x + \", \" + arc.start.y);\n                            console.log(\"--POLY ARC: \" + arc.end.x + \", \" + arc.end.y);\n                            console.log(\"--POLY ARC: \" + arc.length + \" / \" + arc.sweep);\n                            // console.log(\"--POLY ARC: \" + arc.ps.x + \", \" + arc.ps.y + \" (\" + arc.r + \") \" + \"[\" + arc.startAngle + \", \" + arc.endAngle + \"]\");\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    if (DEBUG_RECTS) {\n        addEdgePoints(polygonCountourUnionPoly, 1);\n\n        if (Array.isArray(polygonSurface)) {\n            for (const poly of polygonSurface) {\n                addEdgePoints(poly, 1);\n            }\n        } else {\n            addEdgePoints(polygonSurface, 1);\n        }\n    }\n\n    // const highlightAreaSVGDocFrag = documant.createDocumentFragment();\n    // highlightAreaSVGDocFrag.appendChild(highlightAreaSVGRect);\n    // const highlightAreaSVGG = documant.createElementNS(SVG_XML_NAMESPACE, \"g\");\n    // highlightAreaSVGG.appendChild(highlightAreaSVGDocFrag);\n    const highlightAreaSVG = documant.createElementNS(SVG_XML_NAMESPACE, \"svg\") as ISVGElementWithPolygon;\n    highlightAreaSVG.setAttribute(\"class\", `${CLASS_HIGHLIGHT_COMMON} ${CLASS_HIGHLIGHT_CONTOUR}`);\n\n    // highlightAreaSVG.polygon = polygonSurface;\n    highlightAreaSVG.polygon = polygonCountourUnionPoly; // TODO: gap expansion too generous for hit testing?\n\n    // highlightAreaSVG.append((new DOMParser()​​.parseFromString(`<svg xmlns=\"${SVG_XML_NAMESPACE}\">${polys.svg()}</svg>`, \"image/svg+xml\")).firstChild);\n    highlightAreaSVG.innerHTML =\n    (\n    Array.isArray(polygonSurface)\n    ?\n    polygonSurface.reduce((prevSVGPath, currentPolygon) => {\n        return prevSVGPath + currentPolygon.svg({\n            fill: DEBUG_RECTS ? \"pink\" : drawOutline ? \"transparent\" : `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})`,\n            fillRule: \"evenodd\",\n            stroke: DEBUG_RECTS ? \"magenta\" : drawOutline ? `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})` : \"transparent\",\n            strokeWidth: DEBUG_RECTS ? 1 : drawOutline ? 2 : 0,\n            fillOpacity: 1,\n            className: undefined,\n            // r: 4,\n        });\n    }, \"\")\n    :\n    polygonSurface.svg({\n        fill: DEBUG_RECTS ? \"yellow\" : drawOutline ? \"transparent\" : `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})`,\n        fillRule: \"evenodd\",\n        stroke: DEBUG_RECTS ? \"green\" : drawOutline ? `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})` : \"transparent\",\n        strokeWidth: DEBUG_RECTS ? 1 : drawOutline ? 2 : 0,\n        fillOpacity: 1,\n        className: undefined,\n        // r: 4,\n    })\n    )\n    +\n    polygonCountourUnionPoly.svg({\n        fill: \"transparent\",\n        fillRule: \"evenodd\",\n        stroke: DEBUG_RECTS ? \"red\" : \"transparent\",\n        strokeWidth: DEBUG_RECTS ? 1 : 1,\n        fillOpacity: 1,\n        className: undefined,\n        // r: 4,\n    })\n    ;\n\n    highlightParent.append(highlightAreaSVG);\n\n    if (doDrawMargin && highlight.pointerInteraction) {\n        const MARGIN_MARKER_THICKNESS = 14 * (win.READIUM2.isFixedLayout ? scale : 1);\n        const MARGIN_MARKER_OFFSET = 6 * (win.READIUM2.isFixedLayout ? scale : 1);\n        const paginatedOffset_ = paginatedOffset - MARGIN_MARKER_OFFSET - MARGIN_MARKER_THICKNESS;\n\n        let boundingRect: IRect | IRect[] | undefined;\n        const polygonCountourMarginRects: IRect[] = [];\n        for (const f of polygonCountourUnionPoly.faces) {\n            const face = f as Face;\n\n            const b = face.box;\n            const left =\n                // ----\n                vertical ?\n                b.xmin :\n                // ----\n                paginated ?\n                (\n                    (rtl\n                    ?\n                    paginatedWidth - MARGIN_MARKER_THICKNESS // - MARGIN_MARKER_OFFSET\n                    :\n                    0 // MARGIN_MARKER_OFFSET\n                    )\n                    +\n                    (rtl\n                    ?\n                    -1 * paginatedOffset_\n                    :\n                    paginatedOffset_\n                    )\n                    +\n                    Math.floor((b.xmin) / paginatedWidth) * paginatedWidth\n                )\n                :\n                // ---- scroll\n                (rtl\n                ?\n                MARGIN_MARKER_OFFSET + bodyRect.width - parseInt(bodyComputedStyle.paddingRight, 10)\n                :\n                win.READIUM2.isFixedLayout\n                ?\n                MARGIN_MARKER_OFFSET\n                :\n                parseInt(bodyComputedStyle.paddingLeft, 10) - MARGIN_MARKER_THICKNESS - MARGIN_MARKER_OFFSET\n                );\n            const top =\n                vertical\n                ?\n                parseInt(bodyComputedStyle.paddingTop, 10) - MARGIN_MARKER_THICKNESS - MARGIN_MARKER_OFFSET\n                :\n                b.ymin;\n            const width = vertical ? b.width : MARGIN_MARKER_THICKNESS;\n            const height = vertical ? MARGIN_MARKER_THICKNESS : b.height;\n\n            const extra = 0;\n            // const extra = paginated ? 2 : 0; // useful to union-join small gaps, but here we are able to compute groups of bounding boxes so that in column-paginated mode when crossing over page boundaries there is no gigantic bounding box.\n\n            const r: IRect = {\n                left: left - (vertical ? extra : 0),\n                top: top - (vertical ? 0 : extra),\n                right: left + width + (vertical ? extra : 0),\n                bottom: top + height + (vertical ? 0 : extra),\n                width: width + extra * 2,\n                height: height + extra * 2,\n            };\n\n            boundingRect = boundingRect ? getBoundingRect(boundingRect as IRect, r) : r;\n\n            polygonCountourMarginRects.push(r);\n        }\n\n        const useFastBoundingRect = true; // we never union-join the polygons, instead we group possible rectangle bounding boxes together to allow fragmentation across page boundaries\n        let polygonMarginUnionPoly: Polygon | undefined;\n        if (paginated) {\n            const tolerance = 1;\n            const groups: Array<{\n                x: number,\n                boxes: IRect[],\n            }> = [];\n            for (const r of polygonCountourMarginRects) {\n                const group = groups.find((g) => {\n                    return !(r.left < (g.x - tolerance) || r.left > (g.x + tolerance));\n                });\n\n                if (!group) {\n                    groups.push({\n                        x: r.left,\n                        boxes: [r],\n                    });\n                } else {\n                    group.boxes?.push(r);\n                }\n            }\n\n            // console.log(\"XX RECTS: \" + polygonCountourMarginRects.length);\n            // console.log(JSON.stringify(polygonCountourMarginRects, null, 4));\n            // console.log(\"XX GROUPS: \" + groups.length);\n            // groups.forEach((g) => console.log(JSON.stringify(g.boxes, null, 4)));\n\n            boundingRect = groups.map<IRect>((g) => {\n                return g.boxes.reduce((prev, cur) => {\n                    if (prev === cur) {\n                        return cur;\n                    }\n                    return getBoundingRect(prev, cur);\n                }, g.boxes[0]);\n            });\n            if (boundingRect.length === 1) {\n                boundingRect = boundingRect[0];\n            }\n        }\n\n        if (useFastBoundingRect) {\n            if (boundingRect) {\n                polygonMarginUnionPoly = new Polygon();\n                if (Array.isArray(boundingRect)) {\n                    for (const b of boundingRect) {\n                        const f = polygonMarginUnionPoly.addFace(new Box(b.left, b.top, b.right, b.bottom));\n                        if (f.orientation() !== BASE_ORIENTATION) {\n                            console.log(\"--POLYGON FACE ORIENTATION CCW/CW reverse() 6\");\n                            f.reverse();\n                        }\n                    }\n                } else {\n                    const f = polygonMarginUnionPoly.addFace(new Box(boundingRect.left, boundingRect.top, boundingRect.right, boundingRect.bottom));\n                    if (f.orientation() !== BASE_ORIENTATION) {\n                        console.log(\"--POLYGON FACE ORIENTATION CCW/CW reverse() 7\");\n                        f.reverse();\n                    }\n                }\n            } else {\n                const poly = new Polygon();\n                for (const r of polygonCountourMarginRects) {\n                    const f = poly.addFace(new Box(r.left, r.top, r.right, r.bottom));\n                    if (f.orientation() !== BASE_ORIENTATION) {\n                        console.log(\"--POLYGON FACE ORIENTATION CCW/CW reverse() 8\");\n                        f.reverse();\n                    }\n                }\n                polygonMarginUnionPoly = new Polygon();\n                const f = polygonMarginUnionPoly.addFace(poly.box);\n                if (f.orientation() !== BASE_ORIENTATION) {\n                    console.log(\"--POLYGON FACE ORIENTATION CCW/CW reverse() 9\");\n                    f.reverse();\n                }\n            }\n        } else {\n            polygonMarginUnionPoly = polygonCountourMarginRects.reduce((previousPolygon, r) => {\n                const b = new Box(r.left, r.top, r.right, r.bottom);\n                const p = new Polygon();\n                const f = p.addFace(b);\n                if (f.orientation() !== BASE_ORIENTATION) {\n                    console.log(\"--POLYGON FACE ORIENTATION CCW/CW reverse() 10\");\n                    f.reverse();\n                }\n                return unify(previousPolygon, p);\n            }, new Polygon());\n\n            // Array.from(polygonMarginUnionPoly.faces).forEach((face: Face) => {\n            //     if (face.orientation() !== BASE_ORIENTATION) {\n            //         if (DEBUG_RECTS) {\n            //             console.log(\"--HIGH WEBVIEW-- removing polygon orientation face / inner hole (margin))\");\n            //         }\n            //         (polygonMarginUnionPoly as Polygon).deleteFace(face);\n            //     }\n            // });\n        }\n\n        const highlightMarginSVG = documant.createElementNS(SVG_XML_NAMESPACE, \"svg\") as ISVGElementWithPolygon;\n        highlightMarginSVG.setAttribute(\"class\", `${CLASS_HIGHLIGHT_COMMON} ${CLASS_HIGHLIGHT_CONTOUR_MARGIN}`);\n        highlightMarginSVG.polygon = polygonMarginUnionPoly;\n        highlightMarginSVG.innerHTML = polygonMarginUnionPoly.svg({\n            fill: `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})`,\n            fillRule: \"evenodd\",\n            stroke: \"transparent\",\n            strokeWidth: 0,\n            // stroke: \"magenta\",\n            // strokeWidth: 1,\n            fillOpacity: 1,\n            className: undefined,\n            // r: 4,\n        });\n\n        highlightParent.append(highlightMarginSVG);\n    }\n\n    return highlightParent;\n}\n"]}