{"version":3,"file":"highlight.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/webview/highlight.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\nimport * as crypto from \"crypto\";\nimport * as debounce from \"debounce\";\nimport { ipcRenderer } from \"electron\";\n\nimport {\n    IEventPayload_R2_EVENT_HIGHLIGHT_CLICK, R2_EVENT_HIGHLIGHT_CLICK,\n} from \"../../common/events\";\nimport {\n    HighlightDrawTypeStrikethrough, HighlightDrawTypeUnderline, IColor, IHighlight,\n    IHighlightDefinition,\n} from \"../../common/highlight\";\nimport { isPaginated } from \"../../common/readium-css-inject\";\nimport { ISelectionInfo } from \"../../common/selection\";\nimport { IRectSimple, getClientRectsNoOverlap_ } from \"../common/rect-utils\";\nimport { getScrollingElement, isVerticalWritingMode, isTwoPageSpread } from \"./readium-css\";\nimport { convertRangeInfo } from \"./selection\";\nimport { ReadiumElectronWebviewWindow } from \"./state\";\n\nimport { ID_HIGHLIGHTS_CONTAINER, CLASS_HIGHLIGHT_CURSOR1, CLASS_HIGHLIGHT_CURSOR2, CLASS_HIGHLIGHT_COMMON } from \"../../common/styles\";\n\nimport { isRTL } from \"./readium-css\";\n\nexport const CLASS_HIGHLIGHT_CONTAINER = \"R2_CLASS_HIGHLIGHT_CONTAINER\";\nexport const CLASS_HIGHLIGHT_AREA = \"R2_CLASS_HIGHLIGHT_AREA\";\nexport const CLASS_HIGHLIGHT_BOUNDING_AREA = \"R2_CLASS_HIGHLIGHT_BOUNDING_AREA\";\nexport const CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN = \"R2_CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN\";\n\nconst IS_DEV = (process.env.NODE_ENV === \"development\" || process.env.NODE_ENV === \"dev\");\n\nconst DEBUG_VISUALS = false; // IS_DEV;\n\nconst USE_SVG = false;\nconst USE_BLEND_MODE = true;\n\nconst DEFAULT_BACKGROUND_COLOR_OPACITY = USE_BLEND_MODE ? 0.8 : 0.3;\nconst ALT_BACKGROUND_COLOR_OPACITY = USE_BLEND_MODE ? 1 : 0.45;\nconst ALT_OTHER_BACKGROUND_COLOR_OPACITY = 0.2;\nconst DEFAULT_BACKGROUND_COLOR: IColor = {\n    blue: 100,\n    green: 50,\n    red: 230,\n};\n\nconst _highlights: IHighlight[] = [];\n\nlet _drawMarginMarkers = false;\n\ninterface IAreaWithActiveFlag extends Element {\n    active: boolean | undefined;\n}\n\ninterface IWithRect {\n    rect: IRectSimple;\n    scale: number;\n    // xOffset: number;\n    // yOffset: number;\n}\ninterface IHTMLDivElementWithRect extends HTMLDivElement, IWithRect {\n}\n\nconst SVG_XML_NAMESPACE = \"http://www.w3.org/2000/svg\";\ninterface ISVGRectElementWithRect extends SVGRectElement, IWithRect {\n}\ninterface ISVGLineElementWithRect extends SVGLineElement, IWithRect {\n}\n\n// interface IDocumentBody extends HTMLElement {\n//     _CachedBoundingClientRect: DOMRect | undefined;\n//     _CachedMargins: IRect | undefined;\n// }\nexport function getBoundingClientRectOfDocumentBody(win: ReadiumElectronWebviewWindow): DOMRect {\n    // TODO: does this need to be cached? (performance, notably during mouse hover)\n    return win.document.body.getBoundingClientRect();\n\n    // if (!(win.document.body as IDocumentBody)._CachedBoundingClientRect) {\n    //     (win.document.body as IDocumentBody)._CachedBoundingClientRect = win.document.body.getBoundingClientRect();\n    // }\n    // console.log(\"_CachedBoundingClientRect\",\n    //     JSON.stringify((win.document.body as IDocumentBody)._CachedBoundingClientRect));\n    // return (win.document.body as IDocumentBody)._CachedBoundingClientRect as DOMRect;\n}\n// export function invalidateBoundingClientRectOfDocumentBody(win: ReadiumElectronWebviewWindow) {\n//     (win.document.body as IDocumentBody)._CachedBoundingClientRect = undefined;\n// }\n// function getBodyMargin(win: ReadiumElectronWebviewWindow): IRect {\n//     const bodyStyle = win.getComputedStyle(win.document.body);\n//     if (!(win.document.body as IDocumentBody)._CachedMargins) {\n//         (win.document.body as IDocumentBody)._CachedMargins = {\n//             bottom: parseInt(bodyStyle.marginBottom, 10),\n//             height: 0,\n//             left: parseInt(bodyStyle.marginLeft, 10),\n//             right: parseInt(bodyStyle.marginRight, 10),\n//             top: parseInt(bodyStyle.marginTop, 10),\n//             width: 0,\n//         };\n//     }\n//     console.log(\"_CachedMargins\",\n//         JSON.stringify((win.document.body as IDocumentBody)._CachedMargins));\n//     return (win.document.body as IDocumentBody)._CachedMargins as IRect;\n// }\n\nfunction resetHighlightBoundingStyle(_win: ReadiumElectronWebviewWindow, highlightBounding: HTMLElement) {\n\n    if (!(highlightBounding as unknown as IAreaWithActiveFlag).active) {\n        return;\n    }\n    (highlightBounding as unknown as IAreaWithActiveFlag).active = false;\n\n    highlightBounding.style.setProperty(\"outline\", \"none\", \"important\");\n\n    highlightBounding.style.setProperty(\n        \"background-color\",\n        \"transparent\",\n        \"important\");\n}\n\n// tslint:disable-next-line:max-line-length\nfunction setHighlightBoundingStyle(_win: ReadiumElectronWebviewWindow, highlightBounding: HTMLElement, highlight: IHighlight) {\n\n    if ((highlightBounding as unknown as IAreaWithActiveFlag).active) {\n        return;\n    }\n    (highlightBounding as unknown as IAreaWithActiveFlag).active = true;\n\n    const opacity = ALT_BACKGROUND_COLOR_OPACITY;\n\n    highlightBounding.style.setProperty(\n        \"background-color\",\n        USE_BLEND_MODE ?\n            `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})` :\n            `rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, ${opacity})`,\n        \"important\");\n    // if (USE_BLEND_MODE) {\n    //     highlightBounding.style.setProperty(\"mix-blend-mode\", \"multiply\", \"important\");\n    //     highlightBounding.style.opacity = `${opacity}`;\n    // }\n\n    // tslint:disable-next-line:max-line-length\n    highlightBounding.style.setProperty(\"outline-color\", `rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, 1)`, \"important\");\n    highlightBounding.style.setProperty(\"outline-style\", \"solid\", \"important\");\n    highlightBounding.style.setProperty(\"outline-width\", \"1px\", \"important\");\n    highlightBounding.style.setProperty(\"outline-offset\", \"0px\", \"important\");\n}\n\nfunction resetHighlightBoundingMarginStyle(_win: ReadiumElectronWebviewWindow, highlightBounding: HTMLElement) {\n    if (USE_BLEND_MODE) {\n        return;\n    }\n\n    if (!(highlightBounding as unknown as IAreaWithActiveFlag).active) {\n        return;\n    }\n    (highlightBounding as unknown as IAreaWithActiveFlag).active = false;\n\n    // highlightBounding.style.setProperty(\"outline\", \"none\", \"important\");\n\n    const opacity = ALT_BACKGROUND_COLOR_OPACITY;\n\n    // const useSVG = !(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS) && USE_SVG;\n    // const isSVG = useSVG && highlightBounding.namespaceURI === SVG_XML_NAMESPACE;\n\n    // const id = isSVG ?\n    //     // tslint:disable-next-line:max-line-length\n    //     ((highlightBounding.parentNode && highlightBounding.parentNode.parentNode && highlightBounding.parentNode.parentNode.nodeType === Node.ELEMENT_NODE && (highlightBounding.parentNode.parentNode as Element).getAttribute) ? (highlightBounding.parentNode.parentNode as Element).getAttribute(\"id\") : undefined) :\n    //     // tslint:disable-next-line:max-line-length\n    //     ((highlightBounding.parentNode && highlightBounding.parentNode.nodeType === Node.ELEMENT_NODE && (highlightBounding.parentNode as Element).getAttribute) ? (highlightBounding.parentNode as Element).getAttribute(\"id\") : undefined);\n\n    const id = ((highlightBounding.parentNode && highlightBounding.parentNode.nodeType === Node.ELEMENT_NODE && (highlightBounding.parentNode as Element).getAttribute) ? (highlightBounding.parentNode as Element).getAttribute(\"id\") : undefined);\n    if (id) {\n        const highlight = _highlights.find((h) => {\n            return h.id === id;\n        });\n        if (highlight) {\n            // highlightArea as ElementCSSInlineStyle (implied by HTMLElement | SVGElement)\n\n            highlightBounding.style.setProperty(\n            \"background-color\",\n            USE_BLEND_MODE ?\n                `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})` :\n                `rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, ${opacity})`,\n            \"important\");\n            // if (USE_BLEND_MODE) {\n            //     highlightBounding.style.setProperty(\"mix-blend-mode\", \"multiply\", \"important\");\n            //     highlightBounding.style.opacity = `${opacity}`;\n            // }\n        }\n    }\n}\n\n// tslint:disable-next-line:max-line-length\nfunction setHighlightBoundingMarginStyle(_win: ReadiumElectronWebviewWindow, highlightBounding: HTMLElement, highlight: IHighlight) {\n\n    if (USE_BLEND_MODE) {\n        return;\n    }\n\n    if ((highlightBounding as unknown as IAreaWithActiveFlag).active) {\n        return;\n    }\n    (highlightBounding as unknown as IAreaWithActiveFlag).active = true;\n\n    const opacity = ALT_BACKGROUND_COLOR_OPACITY;\n\n    highlightBounding.style.setProperty(\n        \"background-color\",\n        USE_BLEND_MODE ?\n            `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})` :\n            `rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, ${opacity})`,\n        \"important\");\n    // if (USE_BLEND_MODE) {\n    //     highlightBounding.style.setProperty(\"mix-blend-mode\", \"multiply\", \"important\");\n    //     highlightBounding.style.opacity = `${opacity}`;\n    // }\n\n    // // tslint:disable-next-line:max-line-length\n    // highlightBounding.style.setProperty(\"outline-color\", `rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, 1)`, \"important\");\n    // highlightBounding.style.setProperty(\"outline-style\", \"solid\", \"important\");\n    // highlightBounding.style.setProperty(\"outline-width\", \"1px\", \"important\");\n    // highlightBounding.style.setProperty(\"outline-offset\", \"0px\", \"important\");\n}\n\nfunction resetHighlightAreaStyle(win: ReadiumElectronWebviewWindow, highlightArea: HTMLElement | SVGElement) {\n\n    if (USE_BLEND_MODE) {\n        return;\n    }\n\n    if (!(highlightArea as unknown as IAreaWithActiveFlag).active) {\n        return;\n    }\n    (highlightArea as unknown as IAreaWithActiveFlag).active = false;\n\n    const opacity = DEFAULT_BACKGROUND_COLOR_OPACITY;\n\n    const useSVG = !(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS) && USE_SVG;\n    const isSVG = useSVG && highlightArea.namespaceURI === SVG_XML_NAMESPACE;\n\n    const id = isSVG ?\n        // tslint:disable-next-line:max-line-length\n        ((highlightArea.parentNode && highlightArea.parentNode.parentNode && highlightArea.parentNode.parentNode.nodeType === Node.ELEMENT_NODE && (highlightArea.parentNode.parentNode as Element).getAttribute) ? (highlightArea.parentNode.parentNode as Element).getAttribute(\"id\") : undefined) :\n        // tslint:disable-next-line:max-line-length\n        ((highlightArea.parentNode && highlightArea.parentNode.nodeType === Node.ELEMENT_NODE && (highlightArea.parentNode as Element).getAttribute) ? (highlightArea.parentNode as Element).getAttribute(\"id\") : undefined);\n    if (id) {\n        const highlight = _highlights.find((h) => {\n            return h.id === id;\n        });\n        if (highlight) {\n            // highlightArea as ElementCSSInlineStyle (implied by HTMLElement | SVGElement)\n            if (isSVG) {\n                if (!highlight.drawType) {\n                    // tslint:disable-next-line:max-line-length\n                    highlightArea.style.setProperty(\n                        \"fill\",\n                        `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})`,\n                        \"important\");\n                }\n                // tslint:disable-next-line:max-line-length\n                highlightArea.style.setProperty(\n                    \"stroke\",\n                    `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})`,\n                    \"important\");\n                if (!USE_BLEND_MODE) {\n                    if (!highlight.drawType) {\n                        // tslint:disable-next-line:max-line-length\n                        highlightArea.style.setProperty(\n                            \"fill-opacity\",\n                            `${opacity}`,\n                            \"important\");\n                    }\n                    // tslint:disable-next-line:max-line-length\n                    highlightArea.style.setProperty(\n                        \"stroke-opacity\",\n                        `${opacity}`,\n                        \"important\");\n                }\n            } else {\n                // tslint:disable-next-line:max-line-length\n                highlightArea.style.setProperty(\n                    \"background-color\",\n                    highlight.drawType === HighlightDrawTypeUnderline ? \"transparent\" : // underline is border bottom\n                    (USE_BLEND_MODE ?\n                        `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})` :\n                        `rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, ${opacity})`),\n                    \"important\");\n            }\n\n            // if (USE_BLEND_MODE) {\n            //     highlightArea.style.setProperty(\"mix-blend-mode\", \"multiply\");\n            //     highlightArea.style.opacity = `${opacity}`;\n            // }\n        }\n    }\n}\n\n// tslint:disable-next-line:max-line-length\nfunction setHighlightAreaStyle(win: ReadiumElectronWebviewWindow, highlightAreas: NodeList, highlight: IHighlight) {\n\n    if (USE_BLEND_MODE) {\n        return;\n    }\n\n    const opacity = ALT_BACKGROUND_COLOR_OPACITY;\n\n    const useSVG = !(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS) && USE_SVG;\n    for (const highlightArea_ of highlightAreas) {\n        const highlightArea = highlightArea_ as HTMLElement;\n\n        if ((highlightArea as unknown as IAreaWithActiveFlag).active) {\n            continue;\n        }\n        (highlightArea as unknown as IAreaWithActiveFlag).active = true;\n\n        const isSVG = useSVG && highlightArea.namespaceURI === SVG_XML_NAMESPACE;\n\n        // highlightArea as ElementCSSInlineStyle (implied by HTMLElement | SVGElement)\n        if (isSVG) {\n            if (!highlight.drawType) {\n                // tslint:disable-next-line:max-line-length\n                highlightArea.style.setProperty(\n                    \"fill\",\n                    `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})`,\n                    \"important\");\n            }\n            // tslint:disable-next-line:max-line-length\n            highlightArea.style.setProperty(\n                \"stroke\",\n                `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})`,\n                \"important\");\n\n            if (!USE_BLEND_MODE) {\n                if (!highlight.drawType) {\n                    // tslint:disable-next-line:max-line-length\n                    highlightArea.style.setProperty(\n                        \"fill-opacity\",\n                        `${opacity}`,\n                        \"important\");\n                }\n                // tslint:disable-next-line:max-line-length\n                highlightArea.style.setProperty(\n                    \"stroke-opacity\",\n                    `${opacity}`,\n                    \"important\");\n            }\n        } else {\n            // tslint:disable-next-line:max-line-length\n            highlightArea.style.setProperty(\n                \"background-color\",\n                highlight.drawType === HighlightDrawTypeUnderline ? \"transparent\" : // underline is border bottom\n                (USE_BLEND_MODE ?\n                    `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue})` :\n                    `rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, ${opacity})`),\n                \"important\");\n        }\n\n        // if (USE_BLEND_MODE) {\n        //     highlightArea.style.setProperty(\"mix-blend-mode\", \"multiply\", \"important\");\n        //     highlightArea.style.opacity = `${opacity}`;\n        // }\n        // if (!(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS)) {\n        // tslint:disable-next-line:max-line-length\n        //     (highlightArea as HTMLElement).style.outlineColor = `rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, 1)`;\n        //     (highlightArea as HTMLElement).style.outlineStyle = \"solid\";\n        //     (highlightArea as HTMLElement).style.outlineWidth = \"1px\";\n        //     (highlightArea as HTMLElement).style.outlineOffset = \"0px\";\n        // }\n    }\n}\n\nfunction processMouseEvent(win: ReadiumElectronWebviewWindow, ev: MouseEvent) {\n\n    // const highlightsContainer = documant.getElementById(`${ID_HIGHLIGHTS_CONTAINER}`);\n    if (!_highlightsContainer) {\n        return;\n    }\n\n    const isMouseMove = ev.type === \"mousemove\";\n    if (isMouseMove) {\n        // no hit testing during user selection drag\n        if (ev.buttons > 0) {\n            return;\n        }\n\n        if (!_highlights.length) {\n            return;\n        }\n    }\n\n    const documant = win.document;\n    const scrollElement = getScrollingElement(documant);\n\n    // relative to fixed window top-left corner\n    // (unlike pageX/Y which is relative to top-left rendered content area, subject to scrolling)\n    const x = ev.clientX;\n    const y = ev.clientY;\n\n    const paginated = isPaginated(documant);\n\n    // COSTLY! TODO: cache DOMRect\n    const bodyRect = getBoundingClientRectOfDocumentBody(win);\n\n    const xOffset = paginated ? (-scrollElement.scrollLeft) : bodyRect.left;\n    const yOffset = paginated ? (-scrollElement.scrollTop) : bodyRect.top;\n\n    const testHit = (highlightFragment: Element) => {\n        const withRect = (highlightFragment as unknown) as IWithRect;\n        // tslint:disable-next-line:max-line-length\n        // console.log(`RECT: ${withRect.rect.left} | ${withRect.rect.top} // ${withRect.rect.width} | ${withRect.rect.height}`);\n\n        const left = withRect.rect.left + xOffset; // (paginated ? withRect.xOffset : xOffset);\n        const top = withRect.rect.top + yOffset; // (paginated ? withRect.yOffset : yOffset);\n        if (x >= left &&\n            x < (left + withRect.rect.width) &&\n            y >= top &&\n            y < (top + withRect.rect.height)\n            ) {\n\n            return true;\n        }\n        return false;\n    };\n\n    const useSVG = !(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS) && USE_SVG;\n\n    let changeCursor = false;\n    let foundHighlight: IHighlight | undefined;\n    let foundElement: IHTMLDivElementWithRect | undefined;\n    // for (const highlight of _highlights) {\n    for (let i = _highlights.length - 1; i >= 0; i--) {\n        const highlight = _highlights[i];\n\n        let highlightParent = documant.getElementById(`${highlight.id}`);\n        if (!highlightParent) { // ??!!\n            highlightParent = _highlightsContainer.querySelector(`#${highlight.id}`); // .${CLASS_HIGHLIGHT_CONTAINER}\n        }\n        if (!highlightParent) { // what?\n            continue;\n        }\n\n        let hit = false;\n        let highlightFragment = highlightParent.firstElementChild;\n        while (highlightFragment) {\n            if (useSVG && highlightFragment.namespaceURI === SVG_XML_NAMESPACE) {\n                let svgRect = highlightFragment.firstElementChild;\n                while (svgRect) {\n                    if (testHit(svgRect)) {\n                        changeCursor = true;\n                        hit = true;\n                        break;\n                    }\n                    svgRect = svgRect.nextElementSibling;\n                }\n                if (hit) {\n                    break;\n                }\n            } else if (highlightFragment.classList.contains(CLASS_HIGHLIGHT_AREA)) {\n\n                if (testHit(highlightFragment)) {\n                    changeCursor = true;\n                    hit = true;\n                    break;\n                }\n            } else if (highlightFragment.classList.contains(CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN)) {\n\n                if (testHit(highlightFragment)) {\n                    changeCursor = true;\n                    hit = true;\n                    break;\n                }\n            }\n            highlightFragment = highlightFragment.nextElementSibling;\n        }\n        // const highlightFragments = highlightParent.querySelectorAll(`.${CLASS_HIGHLIGHT_AREA}`);\n        // for (const highlightFragment of highlightFragments) {\n        // }\n        if (hit) {\n            foundHighlight = highlight;\n            foundElement = highlightParent as IHTMLDivElementWithRect;\n            break;\n        }\n\n        // hit = false;\n        // const highlightBounding = highlightParent.querySelector(`.${CLASS_HIGHLIGHT_BOUNDING_AREA}`);\n        // if (highlightBounding) {\n        //     const highlightBoundingWithRect = highlightBounding as IHTMLDivElementWithRect;\n\n        //     const left = highlightBoundingWithRect.rect.left + highlightBoundingWithRect.xOffset;\n        //     const top = highlightBoundingWithRect.rect.top + highlightBoundingWithRect.yOffset;\n        //     if (x >= left &&\n        //         x < (left + highlightBoundingWithRect.rect.width) &&\n        //         y >= top &&\n        //         y < (top + highlightBoundingWithRect.rect.height)\n        //         ) {\n\n        //         hit = true;\n        //     }\n        // }\n        // if (hit) {\n        //     foundHighlight = highlight;\n        //     foundElement = highlightParent as IHTMLDivElementWithRect;\n        //     break;\n        // }\n    }\n    const opacity = DEFAULT_BACKGROUND_COLOR_OPACITY;\n    if (!foundHighlight || !foundElement) {\n\n        documant.documentElement.classList.remove(CLASS_HIGHLIGHT_CURSOR1);\n        documant.documentElement.classList.remove(CLASS_HIGHLIGHT_CURSOR2);\n\n        let highlightContainer = _highlightsContainer.firstElementChild;\n        while (highlightContainer) {\n            // if (highlightContainer.classList.contains(CLASS_HIGHLIGHT_CONTAINER)) {\n            // }\n            if (USE_BLEND_MODE) {\n                (highlightContainer as HTMLElement).style.setProperty(\"opacity\", `${opacity}`, \"important\");\n            }\n\n            if ((DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS)) {\n                let highlightContainerChild = highlightContainer.firstElementChild;\n                while (highlightContainerChild) {\n                    if (!USE_BLEND_MODE && highlightContainerChild.classList.contains(CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN)) {\n                        resetHighlightBoundingMarginStyle(win, highlightContainerChild as HTMLElement);\n                    } else if (highlightContainerChild.classList.contains(CLASS_HIGHLIGHT_BOUNDING_AREA)) {\n                        resetHighlightBoundingStyle(win, highlightContainerChild as HTMLElement);\n                    } else if (!USE_BLEND_MODE && highlightContainerChild.classList.contains(CLASS_HIGHLIGHT_AREA)) {\n                        resetHighlightAreaStyle(win, highlightContainerChild as HTMLElement);\n                    } else if (!USE_BLEND_MODE &&\n                        useSVG && highlightContainerChild.namespaceURI === SVG_XML_NAMESPACE) {\n                        let svgRect = highlightContainerChild.firstElementChild;\n                        while (svgRect) {\n                            resetHighlightAreaStyle(win, highlightContainerChild as HTMLElement);\n                            svgRect = svgRect.nextElementSibling;\n                        }\n                    }\n                    highlightContainerChild = highlightContainerChild.nextElementSibling;\n                }\n            }\n\n            highlightContainer = highlightContainer.nextElementSibling;\n        }\n        // const highlightBoundings = _highlightsContainer.querySelectorAll(`.${CLASS_HIGHLIGHT_BOUNDING_AREA}`);\n        // for (const highlightBounding of highlightBoundings) {\n        // }\n        // const allHighlightAreas = _highlightsContainer.querySelectorAll(`.${CLASS_HIGHLIGHT_AREA}`);\n        // for (const highlightArea of allHighlightAreas) {\n        // }\n        // if (USE_BLEND_MODE) {\n        //     const allHighlightContainers =\n        //         _highlightsContainer.querySelectorAll(`.${CLASS_HIGHLIGHT_CONTAINER}`);\n        //     for (const highlightContainer of allHighlightContainers) {\n        //     }\n        // }\n        return;\n    }\n\n    if (foundHighlight.pointerInteraction || foundElement.getAttribute(\"data-click\")) {\n        if (isMouseMove) {\n\n            if (changeCursor) {\n                documant.documentElement.classList.add(_drawMarginMarkers ? CLASS_HIGHLIGHT_CURSOR1 : CLASS_HIGHLIGHT_CURSOR2);\n            }\n\n            if (!_drawMarginMarkers) {\n\n                if (_drawMarginMarkers) { // false (satisfies TS compiler in IDE :)\n\n                    const foundElementHighlightBounding = foundElement.querySelector(`.${CLASS_HIGHLIGHT_BOUNDING_AREA}`);\n\n                    const foundElementHighlightBoundingMargin = foundElement.querySelector(`.${CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN}`);\n\n                    if ((DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS)) {\n                        if (foundElementHighlightBounding) {\n                            setHighlightBoundingStyle(win, foundElementHighlightBounding as HTMLElement, foundHighlight);\n                        }\n\n                        if (foundElementHighlightBoundingMargin) {\n                            setHighlightBoundingMarginStyle(win, foundElementHighlightBoundingMargin as HTMLElement, foundHighlight);\n                        }\n                    }\n\n                    let highlightContainer = _highlightsContainer.firstElementChild;\n                    while (highlightContainer) {\n                        // if (highlightContainer.classList.contains(CLASS_HIGHLIGHT_CONTAINER)) {\n                        // }\n\n                        if (USE_BLEND_MODE) {\n                            if (highlightContainer !== foundElement) {\n                                (highlightContainer as HTMLElement).style.setProperty(\"opacity\", `${ALT_OTHER_BACKGROUND_COLOR_OPACITY}`, \"important\");\n                            }\n                        }\n\n                        if ((DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS)) {\n                            let highlightContainerChild: Element | null = highlightContainer.firstElementChild;\n                            while (highlightContainerChild) {\n                                if (!USE_BLEND_MODE && highlightContainerChild.classList.contains(CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN)) {\n                                    if (!foundElementHighlightBoundingMargin ||\n                                        highlightContainerChild !== foundElementHighlightBoundingMargin) {\n                                        resetHighlightBoundingMarginStyle(win, highlightContainerChild as HTMLElement);\n                                    }\n                                } else if (highlightContainerChild.classList.contains(CLASS_HIGHLIGHT_BOUNDING_AREA)) {\n                                    if (!foundElementHighlightBounding ||\n                                        highlightContainerChild !== foundElementHighlightBounding) {\n                                        resetHighlightBoundingStyle(win, highlightContainerChild as HTMLElement);\n                                    }\n                                } else if (!USE_BLEND_MODE &&\n                                    highlightContainerChild.classList.contains(CLASS_HIGHLIGHT_AREA)) {\n                                    // if (foundElementHighlightAreas.indexOf(highlightContainerChild) < 0) {\n                                    if (highlightContainerChild.parentNode !== foundElement) {\n                                        // can also be SVGElement\n                                        resetHighlightAreaStyle(win, highlightContainerChild as HTMLElement);\n                                    }\n                                }\n                                highlightContainerChild = highlightContainerChild.nextElementSibling;\n                            }\n                        }\n\n                        highlightContainer = highlightContainer.nextElementSibling;\n                    }\n                }\n\n                if (USE_BLEND_MODE) {\n                    foundElement.style.setProperty(\"opacity\", `${ALT_BACKGROUND_COLOR_OPACITY}`, \"important\");\n                } else {\n                    const foundElementHighlightAreas = foundElement.querySelectorAll(`.${CLASS_HIGHLIGHT_AREA}`);\n\n                    setHighlightAreaStyle(win, foundElementHighlightAreas, foundHighlight); // can also be SVGElement[]\n                }\n\n                // const allHighlightAreas = _highlightsContainer.querySelectorAll(`.${CLASS_HIGHLIGHT_AREA}`);\n                // for (const highlightArea of allHighlightAreas) {\n                // }\n                // if (USE_BLEND_MODE) {\n                //     const allHighlightContainers =\n                //         _highlightsContainer.querySelectorAll(`.${CLASS_HIGHLIGHT_CONTAINER}`);\n                //     for (const highlightContainer of allHighlightContainers) {\n                //     }\n                // }\n\n                // const allHighlightBoundings = _highlightsContainer.querySelectorAll(`.${CLASS_HIGHLIGHT_BOUNDING_AREA}`);\n                // for (const highlightBounding of allHighlightBoundings) {\n                // }\n            }\n        } else if (ev.type === \"mouseup\" || ev.type === \"click\") {\n            ev.preventDefault();\n            ev.stopPropagation();\n            if (ev.altKey) {\n                // recreateAllHighlights(win);\n                _drawMarginMarkers = !_drawMarginMarkers;\n                recreateAllHighlightsRaw(win);\n            } else {\n                const payload: IEventPayload_R2_EVENT_HIGHLIGHT_CLICK = {\n                    highlight: foundHighlight,\n                };\n                ipcRenderer.sendToHost(R2_EVENT_HIGHLIGHT_CLICK, payload);\n            }\n        }\n    }\n}\n\nlet lastMouseDownX = -1;\nlet lastMouseDownY = -1;\nlet bodyEventListenersSet = false;\nlet _highlightsContainer: HTMLElement | null;\nfunction ensureHighlightsContainer(win: ReadiumElectronWebviewWindow): HTMLElement {\n    const documant = win.document;\n\n    if (!_highlightsContainer) {\n\n        // Note that legacy ResizeSensor sets body position to \"relative\" (default static).\n        // Also note that ReadiumCSS default to (via stylesheet :root):\n        // documant.documentElement.style.position = \"relative\";\n        // see styles.js (static CSS injection):\n        // documant.documentElement.style.setProperty(\"height\", \"100vh\", \"important\");\n        // documant.body.style.position = \"relative\";\n        // documant.body.style.setProperty(\"position\", \"relative\", \"important\");\n        // documant.body.style.height = \"inherit\";\n        // https://github.com/edrlab/thorium-reader/issues/1658\n\n        if (!bodyEventListenersSet) {\n            bodyEventListenersSet = true;\n\n            // reminder: mouseenter/mouseleave do not bubble, so no event delegation\n            // documant.body.addEventListener(\"click\", (ev: MouseEvent) => {\n            //     processMouseEvent(win, ev);\n            // }, false);\n            documant.body.addEventListener(\"mousedown\", (ev: MouseEvent) => {\n                lastMouseDownX = ev.clientX;\n                lastMouseDownY = ev.clientY;\n            }, false);\n            documant.body.addEventListener(\"mouseup\", (ev: MouseEvent) => {\n                if ((Math.abs(lastMouseDownX - ev.clientX) < 3) &&\n                    (Math.abs(lastMouseDownY - ev.clientY) < 3)) {\n                    processMouseEvent(win, ev);\n                }\n            }, false);\n            documant.body.addEventListener(\"mousemove\", (ev: MouseEvent) => {\n                processMouseEvent(win, ev);\n            }, false);\n        }\n\n        _highlightsContainer = documant.createElement(\"div\");\n        _highlightsContainer.setAttribute(\"id\", ID_HIGHLIGHTS_CONTAINER);\n        _highlightsContainer.setAttribute(\"class\", CLASS_HIGHLIGHT_COMMON);\n        _highlightsContainer.setAttribute(\"style\",\n            \"width: auto !important; \" +\n            \"height: auto !important; \");\n        // _highlightsContainer.style.setProperty(\n        //     \"pointer-events\",\n        //     \"none\",\n        //     \"important\");\n        // if (USE_BLEND_MODE) {\n        //     const opacity = DEFAULT_BACKGROUND_COLOR_OPACITY;\n        //     _highlightsContainer.style.setProperty(\"mix-blend-mode\", \"multiply\", \"important\");\n        //     _highlightsContainer.style.opacity = `${opacity}`;\n        // }\n        documant.body.append(_highlightsContainer);\n        // documant.documentElement.append(_highlightsContainer);\n    }\n    return _highlightsContainer;\n}\n\nexport function hideAllhighlights(_documant: Document) {\n    // for (const highlight of _highlights) {\n    //     const highlightContainer = documant.getElementById(highlight.id);\n    //     if (highlightContainer) {\n    //         highlightContainer.remove();\n    //     }\n    // }\n    if (_highlightsContainer) {\n        _highlightsContainer.remove();\n        _highlightsContainer = null;\n        // ensureHighlightsContainer(documant);\n    }\n}\n\nexport function destroyAllhighlights(documant: Document) {\n    // _highlights.forEach((highlight) => {\n    //     destroyHighlight(highlight.id);\n    // });\n    // for (const highlight of _highlights) {\n    //     destroyHighlight(highlight.id);\n    // }\n    // for (let i = _highlights.length - 1; i >= 0; i--) {\n    //     const highlight = _highlights[i];\n    //     destroyHighlight(highlight.id);\n    // }\n    hideAllhighlights(documant);\n    _highlights.splice(0, _highlights.length);\n}\n\nexport function destroyHighlight(documant: Document, id: string) {\n    let i = -1;\n    const highlight = _highlights.find((h, j) => {\n        i = j;\n        return h.id === id;\n    });\n    if (highlight && i >= 0 && i < _highlights.length) {\n        _highlights.splice(i, 1);\n    }\n\n    const highlightContainer = documant.getElementById(id);\n    if (highlightContainer) {\n        highlightContainer.remove();\n    }\n}\n\nexport function recreateAllHighlightsRaw(win: ReadiumElectronWebviewWindow) {\n    const documant = win.document;\n    hideAllhighlights(documant);\n\n    const bodyRect = getBoundingClientRectOfDocumentBody(win);\n    const bodyWidth = parseInt(win.getComputedStyle(win.document.body).width, 10);\n\n    const docFrag = documant.createDocumentFragment();\n    for (const highlight of _highlights) {\n        const div = createHighlightDom(win, highlight, bodyRect, bodyWidth);\n        if (div) {\n            docFrag.append(div);\n        }\n    }\n\n    const highlightsContainer = ensureHighlightsContainer(win);\n    highlightsContainer.append(docFrag);\n}\n\nexport const recreateAllHighlightsDebounced = debounce((win: ReadiumElectronWebviewWindow) => {\n    recreateAllHighlightsRaw(win);\n}, 500);\n\nexport function recreateAllHighlights(win: ReadiumElectronWebviewWindow) {\n    hideAllhighlights(win.document);\n    recreateAllHighlightsDebounced(win);\n}\n\nexport function createHighlights(\n    win: ReadiumElectronWebviewWindow,\n    highDefs: IHighlightDefinition[],\n    pointerInteraction: boolean): Array<IHighlight | null> {\n\n    const documant = win.document;\n    const highlights: Array<IHighlight | null> = [];\n\n    const bodyRect = getBoundingClientRectOfDocumentBody(win);\n    const bodyWidth = parseInt(win.getComputedStyle(win.document.body).width, 10);\n\n    const docFrag = documant.createDocumentFragment();\n    for (const highDef of highDefs) {\n        if (!highDef.selectionInfo && !highDef.range) {\n            highlights.push(null);\n            continue;\n        }\n        const [high, div] = createHighlight(\n            win,\n            highDef.selectionInfo,\n            highDef.range,\n            highDef.color,\n            pointerInteraction,\n            highDef.drawType,\n            highDef.expand,\n            bodyRect,\n            bodyWidth);\n        highlights.push(high);\n\n        if (div) {\n            docFrag.append(div);\n        }\n    }\n\n    const highlightsContainer = ensureHighlightsContainer(win);\n    highlightsContainer.append(docFrag);\n\n    return highlights;\n}\n\nconst computeCFI = (node: Node): string | undefined => {\n\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        if (node.parentNode) {\n            return computeCFI(node.parentNode);\n        }\n        return undefined;\n    }\n\n    let cfi = \"\";\n\n    let currentElement = node as Element;\n    while (currentElement.parentNode && currentElement.parentNode.nodeType === Node.ELEMENT_NODE) {\n        const currentElementParentChildren = (currentElement.parentNode as Element).children;\n        let currentElementIndex = -1;\n        for (let i = 0; i < currentElementParentChildren.length; i++) {\n            if (currentElement === currentElementParentChildren[i]) {\n                currentElementIndex = i;\n                break;\n            }\n        }\n        if (currentElementIndex >= 0) {\n            const cfiIndex = (currentElementIndex + 1) * 2;\n            cfi = cfiIndex +\n                (currentElement.id ? (\"[\" + currentElement.id + \"]\") : \"\") +\n                (cfi.length ? (\"/\" + cfi) : \"\");\n        }\n        currentElement = currentElement.parentNode as Element;\n    }\n\n    return \"/\" + cfi;\n};\n\nexport function createHighlight(\n    win: ReadiumElectronWebviewWindow,\n    selectionInfo: ISelectionInfo | undefined,\n    range: Range | undefined,\n    color: IColor | undefined,\n    pointerInteraction: boolean,\n    drawType: number | undefined,\n    expand: number | undefined,\n    bodyRect: DOMRect,\n    bodyWidth: number): [IHighlight, HTMLDivElement | null] {\n\n    // tslint:disable-next-line:no-string-literal\n    // console.log(\"Chromium: \" + process.versions[\"chrome\"]);\n\n    // tslint:disable-next-line:max-line-length\n    const uniqueStr = selectionInfo ? `${selectionInfo.rangeInfo.startContainerElementCssSelector}${selectionInfo.rangeInfo.startContainerChildTextNodeIndex}${selectionInfo.rangeInfo.startOffset}${selectionInfo.rangeInfo.endContainerElementCssSelector}${selectionInfo.rangeInfo.endContainerChildTextNodeIndex}${selectionInfo.rangeInfo.endOffset}` : range ? `${range.startOffset}-${range.endOffset}-${computeCFI(range.startContainer)}-${computeCFI(range.endContainer)}` : \"_RANGE_\"; // ${selectionInfo.rangeInfo.cfi} useless\n\n    // console.log(\"RANGE uniqueStr: \" + uniqueStr + \" (( \" + range?.toString());\n\n    // const unique = Buffer.from(JSON.stringify(selectionInfo.rangeInfo, null, \"\")).toString(\"base64\");\n    // const unique = Buffer.from(uniqueStr).toString(\"base64\");\n    // const id = \"R2_HIGHLIGHT_\" + unique.replace(/\\+/, \"_\").replace(/=/, \"-\").replace(/\\//, \".\");\n    const checkSum = crypto.createHash(\"sha1\"); // sha256 slow\n    checkSum.update(uniqueStr);\n    const shaHex = checkSum.digest(\"hex\");\n    const idBase = \"R2_HIGHLIGHT_\" + shaHex;\n    let id = idBase;\n    let idIdx = 0;\n    while (\n        _highlights.find((h) => h.id === id) ||\n        win.document.getElementById(id)) {\n\n        if (IS_DEV) {\n            console.log(\"HIGHLIGHT ID already exists, increment: \" + uniqueStr + \" ==> \" + id);\n        }\n        id = `${idBase}_${idIdx++}`;\n    }\n    // destroyHighlight(win.document, id);\n\n    const highlight: IHighlight = {\n        color: color ? color : DEFAULT_BACKGROUND_COLOR,\n        drawType,\n        expand,\n        id,\n        pointerInteraction,\n        selectionInfo,\n        range,\n    };\n    _highlights.push(highlight);\n\n    const div = createHighlightDom(win, highlight, bodyRect, bodyWidth);\n    return [highlight, div];\n}\n\nfunction createHighlightDom(\n    win: ReadiumElectronWebviewWindow,\n    highlight: IHighlight,\n    bodyRect: DOMRect,\n    bodyWidth: number): HTMLDivElement | null {\n\n    const documant = win.document;\n    const scrollElement = getScrollingElement(documant);\n\n    const range = highlight.selectionInfo ? convertRangeInfo(documant, highlight.selectionInfo.rangeInfo) : highlight.range;\n    if (!range) {\n        return null;\n    }\n\n    const opacity = DEFAULT_BACKGROUND_COLOR_OPACITY;\n\n    const paginated = isPaginated(documant);\n    const paginatedTwo = paginated && isTwoPageSpread();\n\n    const rtl = isRTL();\n    const vertical = isVerticalWritingMode();\n\n    // checkRangeFix(documant);\n\n    // const highlightsContainer = ensureHighlightsContainer(win);\n\n    const highlightParent = documant.createElement(\"div\") as IHTMLDivElementWithRect;\n    highlightParent.setAttribute(\"id\", highlight.id);\n    highlightParent.setAttribute(\"class\", `${CLASS_HIGHLIGHT_CONTAINER} ${CLASS_HIGHLIGHT_COMMON}`);\n    highlightParent.setAttribute(\"style\",\n        \"width: 1px !important; \" +\n        \"height: 1px !important; \");\n    // highlightParent.style.setProperty(\n    //     \"pointer-events\",\n    //     \"none\",\n    //     \"important\");\n    if (highlight.pointerInteraction) {\n        highlightParent.setAttribute(\"data-click\", \"1\");\n    }\n    if (USE_BLEND_MODE && (!_drawMarginMarkers || !highlight.pointerInteraction)) {\n\n        const styleAttr = win.document.documentElement.getAttribute(\"style\");\n        const isNight = styleAttr ? styleAttr.indexOf(\"readium-night-on\") > 0 : false;\n        // const isSepia = styleAttr ? styleAttr.indexOf(\"readium-sepia-on\") > 0 : false;\n\n        highlightParent.style.setProperty(\n            \"mix-blend-mode\",\n            isNight ? \"difference\" : \"multiply\",\n            \"important\");\n\n        highlightParent.style.setProperty(\"opacity\", `${opacity}`, \"important\");\n    }\n\n    // const docStyle = (documant.defaultView as Window).getComputedStyle(documant.documentElement);\n    // const bodyStyle = (documant.defaultView as Window).getComputedStyle(documant.body);\n    // const marginLeft = bodyStyle.getPropertyValue(\"margin-left\");\n    // console.log(\"marginLeft: \" + marginLeft);\n    // const marginTop = bodyStyle.getPropertyValue(\"margin-top\");\n    // console.log(\"marginTop: \" + marginTop);\n\n    // console.log(\"==== bodyRect:\");\n    // console.log(\"width: \" + bodyRect.width);\n    // console.log(\"height: \" + bodyRect.height);\n    // console.log(\"top: \" + bodyRect.top);\n    // console.log(\"bottom: \" + bodyRect.bottom);\n    // console.log(\"left: \" + bodyRect.left);\n    // console.log(\"right: \" + bodyRect.right);\n\n    // const xOffset = paginated ? (bodyRect.left - parseInt(marginLeft, 10)) : bodyRect.left;\n    // const yOffset = paginated ? (bodyRect.top - parseInt(marginTop, 10)) : bodyRect.top;\n\n    const xOffset = paginated ? (-scrollElement.scrollLeft) : bodyRect.left;\n    const yOffset = paginated ? (-scrollElement.scrollTop) : bodyRect.top;\n\n    const scale = 1 / ((win.READIUM2 && win.READIUM2.isFixedLayout) ? win.READIUM2.fxlViewportScale : 1);\n    // const scale = 1;\n\n    // console.log(\"scrollElement.scrollLeft: \" + scrollElement.scrollLeft);\n    // console.log(\"scrollElement.scrollTop: \" + scrollElement.scrollTop);\n\n    const useSVG = !(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS) && USE_SVG;\n    const drawUnderline = highlight.drawType === HighlightDrawTypeUnderline && !(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS);\n    const drawStrikeThrough = highlight.drawType === HighlightDrawTypeStrikethrough && !(DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS);\n\n    const doNotMergeHorizontallyAlignedRects = drawUnderline || drawStrikeThrough;\n\n    const ex = highlight.expand ? highlight.expand : 0;\n\n    const rangeClientRects = range.getClientRects();\n    // tslint:disable-next-line:max-line-length\n    const clientRects =\n        // (DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS) ?\n        // rangeClientRects :\n        getClientRectsNoOverlap_(rangeClientRects, doNotMergeHorizontallyAlignedRects, ex);\n\n    let highlightAreaSVGDocFrag: DocumentFragment | undefined;\n\n    const roundedCorner = 3;\n    const underlineThickness = 3;\n    const strikeThroughLineThickness = 3;\n\n    const rangeBoundingClientRect = range.getBoundingClientRect();\n\n    const highlightBounding = documant.createElement(\"div\") as IHTMLDivElementWithRect;\n    highlightBounding.setAttribute(\"class\", `${CLASS_HIGHLIGHT_BOUNDING_AREA} ${CLASS_HIGHLIGHT_COMMON}`);\n    if ((DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS)) {\n        // tslint:disable-next-line:max-line-length\n        highlightBounding.setAttribute(\"style\",\n            \"outline-color: magenta !important; \" +\n            \"outline-style: solid !important; \" +\n            \"outline-width: 1px !important; \" +\n            \"outline-offset: -1px !important;\");\n    }\n    // highlightBounding.style.setProperty(\n    //     \"pointer-events\",\n    //     \"none\",\n    //     \"important\");\n    highlightBounding.style.setProperty(\"position\", paginated ? \"fixed\" : \"absolute\", \"important\");\n    highlightBounding.scale = scale;\n    // highlightBounding.xOffset = xOffset;\n    // highlightBounding.yOffset = yOffset;\n    highlightBounding.rect = {\n        height: rangeBoundingClientRect.height,\n        left: rangeBoundingClientRect.left - xOffset,\n        top: rangeBoundingClientRect.top - yOffset,\n        width: rangeBoundingClientRect.width,\n    };\n    highlightBounding.style.setProperty(\"width\", `${highlightBounding.rect.width * scale}px`, \"important\");\n    highlightBounding.style.setProperty(\"height\", `${highlightBounding.rect.height * scale}px`, \"important\");\n    highlightBounding.style.setProperty(\"min-width\", highlightBounding.style.width, \"important\");\n    highlightBounding.style.setProperty(\"min-height\", highlightBounding.style.height, \"important\");\n    highlightBounding.style.setProperty(\"left\", `${highlightBounding.rect.left * scale}px`, \"important\");\n    highlightBounding.style.setProperty(\"top\", `${highlightBounding.rect.top * scale}px`, \"important\");\n    highlightParent.append(highlightBounding);\n\n    if (_drawMarginMarkers && highlight.pointerInteraction) {\n        const MARGIN_MARKER_THICKNESS = 8;\n        const MARGIN_MARKER_OFFSET = 2;\n\n        const highlightBoundingMargin = documant.createElement(\"div\") as IHTMLDivElementWithRect;\n        highlightBoundingMargin.setAttribute(\"class\", `${CLASS_HIGHLIGHT_BOUNDING_AREA_MARGIN} ${CLASS_HIGHLIGHT_COMMON}`);\n        highlightBoundingMargin.setAttribute(\"style\",\n            `border-radius: ${MARGIN_MARKER_THICKNESS / 2}px;` +\n            \"background-color: \" +\n                (USE_BLEND_MODE ?\n                    // tslint:disable-next-line: max-line-length\n                    `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important;` :\n                    `rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, ${opacity}) !important;`\n            ));\n\n        // highlightBoundingMargin.style.setProperty(\n        //     \"pointer-events\",\n        //     \"none\",\n        //     \"important\");\n        highlightBoundingMargin.style.setProperty(\"position\", paginated ? \"fixed\" : \"absolute\", \"important\");\n        highlightBoundingMargin.scale = scale;\n        // highlightBoundingMargin.xOffset = xOffset;\n        // highlightBoundingMargin.yOffset = yOffset;\n\n        const dim = scrollElement.clientWidth / (paginatedTwo ? 2 : 1);\n        const off = (dim - bodyWidth) / 2;\n\n        highlightBoundingMargin.rect = {\n            height: vertical ? MARGIN_MARKER_THICKNESS : rangeBoundingClientRect.height,\n            left: vertical ? (rangeBoundingClientRect.left - xOffset) : paginated ?\n            (\n                (rtl ? (dim - MARGIN_MARKER_THICKNESS - MARGIN_MARKER_OFFSET) : MARGIN_MARKER_OFFSET)\n                +\n                (rtl ? (-1 * off) : off)\n                +\n                Math.floor((rangeBoundingClientRect.left - xOffset) / dim) * dim\n            )\n            :\n            MARGIN_MARKER_OFFSET + (rtl ? bodyRect.width : 0),\n            top: vertical ? MARGIN_MARKER_OFFSET : (rangeBoundingClientRect.top - yOffset),\n            width: vertical ? rangeBoundingClientRect.width : MARGIN_MARKER_THICKNESS,\n        };\n        highlightBoundingMargin.style.setProperty(\"width\", `${highlightBoundingMargin.rect.width * scale}px`, \"important\");\n        highlightBoundingMargin.style.setProperty(\"height\", `${highlightBoundingMargin.rect.height * scale}px`, \"important\");\n        highlightBoundingMargin.style.setProperty(\"min-width\", highlightBoundingMargin.style.width, \"important\");\n        highlightBoundingMargin.style.setProperty(\"min-height\", highlightBoundingMargin.style.height, \"important\");\n        highlightBoundingMargin.style.setProperty(\"left\", `${highlightBoundingMargin.rect.left * scale}px`, \"important\");\n        highlightBoundingMargin.style.setProperty(\"top\", `${highlightBoundingMargin.rect.top * scale}px`, \"important\");\n        highlightParent.append(highlightBoundingMargin);\n    } else { // _drawMarginMarkers\n        for (const clientRect of clientRects) {\n\n            if (useSVG) {\n                const borderThickness = 0;\n\n                if (!highlightAreaSVGDocFrag) {\n                    highlightAreaSVGDocFrag = documant.createDocumentFragment();\n                }\n\n                if (drawUnderline) {\n                    // TODO isVerticalWritingMode()\n\n                    // tslint:disable-next-line:max-line-length\n                    const highlightAreaSVGLine = documant.createElementNS(SVG_XML_NAMESPACE, \"line\") as ISVGLineElementWithRect;\n                    highlightAreaSVGLine.setAttribute(\"class\", CLASS_HIGHLIGHT_AREA);\n\n                    highlightAreaSVGLine.setAttribute(\"style\",\n                        \"stroke-linecap: round !important; \" +\n                        `stroke-width: ${underlineThickness * scale} !important; ` +\n                        // tslint:disable-next-line:max-line-length\n                        `stroke: rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important;` +\n                        (USE_BLEND_MODE ? \"\" : ` stroke-opacity: ${opacity} !important`));\n                    highlightAreaSVGLine.scale = scale;\n                    // highlightAreaSVGLine.xOffset = xOffset;\n                    // highlightAreaSVGLine.yOffset = yOffset;\n                    highlightAreaSVGLine.rect = {\n                        height: clientRect.height,\n                        left: clientRect.left - xOffset,\n                        top: clientRect.top - yOffset,\n                        width: clientRect.width,\n                    };\n                    const lineOffset = (highlightAreaSVGLine.rect.width > roundedCorner) ? roundedCorner : 0;\n                    highlightAreaSVGLine.setAttribute(\"x1\", `${(highlightAreaSVGLine.rect.left + lineOffset) * scale}`);\n                    // tslint:disable-next-line:max-line-length\n                    highlightAreaSVGLine.setAttribute(\"x2\", `${(highlightAreaSVGLine.rect.left + highlightAreaSVGLine.rect.width - lineOffset) * scale}`);\n                    // tslint:disable-next-line:max-line-length\n                    const y = (highlightAreaSVGLine.rect.top + highlightAreaSVGLine.rect.height - (underlineThickness / 2)) * scale;\n                    highlightAreaSVGLine.setAttribute(\"y1\", `${y}`);\n                    highlightAreaSVGLine.setAttribute(\"y2\", `${y}`);\n\n                    highlightAreaSVGLine.setAttribute(\"height\", `${highlightAreaSVGLine.rect.height * scale}`);\n                    highlightAreaSVGLine.setAttribute(\"width\", `${highlightAreaSVGLine.rect.width * scale}`);\n\n                    // if (USE_BLEND_MODE) {\n                    //     highlightAreaSVGLine.style.setProperty(\"mix-blend-mode\", \"multiply\", \"important\");\n                    //     highlightAreaSVGLine.style.opacity = `${opacity}`;\n                    // }\n\n                    highlightAreaSVGDocFrag.appendChild(highlightAreaSVGLine);\n                } else if (drawStrikeThrough) {\n                    // tslint:disable-next-line:max-line-length\n                    const highlightAreaSVGLine = documant.createElementNS(SVG_XML_NAMESPACE, \"line\") as ISVGLineElementWithRect;\n                    highlightAreaSVGLine.setAttribute(\"class\", CLASS_HIGHLIGHT_AREA);\n\n                    highlightAreaSVGLine.setAttribute(\"style\",\n                        \"stroke-linecap: butt !important; \" +\n                        `stroke-width: ${strikeThroughLineThickness * scale} !important; ` +\n                        // tslint:disable-next-line:max-line-length\n                        `stroke: rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important;` +\n                        (USE_BLEND_MODE ? \"\" : ` stroke-opacity: ${opacity} !important`));\n                        // stroke-dasharray: ${lineThickness * 2},${lineThickness * 2};\n\n                    highlightAreaSVGLine.scale = scale;\n                    // highlightAreaSVGLine.xOffset = xOffset;\n                    // highlightAreaSVGLine.yOffset = yOffset;\n                    highlightAreaSVGLine.rect = {\n                        height: clientRect.height,\n                        left: clientRect.left - xOffset,\n                        top: clientRect.top - yOffset,\n                        width: clientRect.width,\n                    };\n                    highlightAreaSVGLine.setAttribute(\"x1\", `${highlightAreaSVGLine.rect.left * scale}`);\n                    // tslint:disable-next-line:max-line-length\n                    highlightAreaSVGLine.setAttribute(\"x2\", `${(highlightAreaSVGLine.rect.left + highlightAreaSVGLine.rect.width) * scale}`);\n\n                    const lineOffset = highlightAreaSVGLine.rect.height / 2;\n                    const y = (highlightAreaSVGLine.rect.top + lineOffset) * scale;\n                    highlightAreaSVGLine.setAttribute(\"y1\", `${y}`);\n                    highlightAreaSVGLine.setAttribute(\"y2\", `${y}`);\n\n                    highlightAreaSVGLine.setAttribute(\"height\", `${highlightAreaSVGLine.rect.height * scale}`);\n                    highlightAreaSVGLine.setAttribute(\"width\", `${highlightAreaSVGLine.rect.width * scale}`);\n\n                    // if (USE_BLEND_MODE) {\n                    //     highlightAreaSVGLine.style.setProperty(\"mix-blend-mode\", \"multiply\", \"important\");\n                    //     highlightAreaSVGLine.style.opacity = `${opacity}`;\n                    // }\n\n                    highlightAreaSVGDocFrag.appendChild(highlightAreaSVGLine);\n                } else {\n\n                    const highlightAreaSVGRect =\n                        documant.createElementNS(SVG_XML_NAMESPACE, \"rect\") as ISVGRectElementWithRect;\n                    highlightAreaSVGRect.setAttribute(\"class\", CLASS_HIGHLIGHT_AREA);\n\n                    highlightAreaSVGRect.setAttribute(\"style\",\n                        // tslint:disable-next-line:max-line-length\n                        `fill: rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important; ` +\n                        \"stroke-width: 0;\" +\n                        (USE_BLEND_MODE ? \"\" : ` fill-opacity: ${opacity} !important;`));\n\n                    // tslint:disable-next-line:max-line-length\n                    // stroke-width: ${borderThickness}; stroke: rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important; stroke-opacity: ${opacity} !important\n\n                    highlightAreaSVGRect.scale = scale;\n                    // highlightAreaSVGRect.xOffset = xOffset;\n                    // highlightAreaSVGRect.yOffset = yOffset;\n                    highlightAreaSVGRect.rect = {\n                        height: clientRect.height,\n                        left: clientRect.left - xOffset,\n                        top: clientRect.top - yOffset,\n                        width: clientRect.width,\n                    };\n                    highlightAreaSVGRect.setAttribute(\"rx\", `${roundedCorner * scale}`);\n                    highlightAreaSVGRect.setAttribute(\"ry\", `${roundedCorner * scale}`);\n                    highlightAreaSVGRect.setAttribute(\"x\", `${(highlightAreaSVGRect.rect.left - borderThickness) * scale}`);\n                    highlightAreaSVGRect.setAttribute(\"y\", `${(highlightAreaSVGRect.rect.top - borderThickness) * scale}`);\n                    // tslint:disable-next-line:max-line-length\n                    highlightAreaSVGRect.setAttribute(\"height\", `${(highlightAreaSVGRect.rect.height + (borderThickness * 2)) * scale}`);\n                    // tslint:disable-next-line:max-line-length\n                    highlightAreaSVGRect.setAttribute(\"width\", `${(highlightAreaSVGRect.rect.width + (borderThickness * 2)) * scale}`);\n\n                    // if (USE_BLEND_MODE) {\n                    //     highlightAreaSVGRect.style.setProperty(\"mix-blend-mode\", \"multiply\", \"important\");\n                    //     highlightAreaSVGRect.style.opacity = `${opacity}`;\n                    // }\n\n                    highlightAreaSVGDocFrag.appendChild(highlightAreaSVGRect);\n                }\n            } else {\n                if (drawStrikeThrough) {\n\n                    const highlightAreaLine = documant.createElement(\"div\") as IHTMLDivElementWithRect;\n                    highlightAreaLine.setAttribute(\"class\", `${CLASS_HIGHLIGHT_AREA} ${CLASS_HIGHLIGHT_COMMON}`);\n                    // tslint:disable-next-line:max-line-length\n                    highlightAreaLine.setAttribute(\"style\",\n                        (USE_BLEND_MODE ?\n                            `background-color: rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important;` :\n                            `background-color: rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, ${opacity}) !important;`),\n                    );\n                    // tslint:disable-next-line:max-line-length\n                    // highlightArea.setAttribute(\"style\", `outline-color: magenta; outline-style: solid; outline-width: 1px; outline-offset: -1px;`);\n                    // highlightAreaLine.style.setProperty(\n                    //     \"pointer-events\",\n                    //     \"none\",\n                    //     \"important\");\n                    highlightAreaLine.style.setProperty(\"transform\", \"translate3d(0px, 0px, 0px)\", \"important\");\n                    highlightAreaLine.style.setProperty(\"position\", paginated ? \"fixed\" : \"absolute\", \"important\");\n                    highlightAreaLine.scale = scale;\n                    // highlightAreaLine.xOffset = xOffset;\n                    // highlightAreaLine.yOffset = yOffset;\n                    highlightAreaLine.rect = {\n                        height: clientRect.height,\n                        left: clientRect.left - xOffset,\n                        top: clientRect.top - yOffset,\n                        width: clientRect.width,\n                    };\n                    highlightAreaLine.style.setProperty(\"width\", `${highlightAreaLine.rect.width * scale}px`, \"important\");\n                    highlightAreaLine.style.setProperty(\"height\", `${strikeThroughLineThickness * scale}px`, \"important\");\n                    highlightAreaLine.style.setProperty(\"min-width\", highlightAreaLine.style.width, \"important\");\n                    highlightAreaLine.style.setProperty(\"min-height\", highlightAreaLine.style.height, \"important\");\n                    highlightAreaLine.style.setProperty(\"left\", `${highlightAreaLine.rect.left * scale}px`, \"important\");\n                    // tslint:disable-next-line:max-line-length\n                    highlightAreaLine.style.setProperty(\"top\", `${(highlightAreaLine.rect.top + (highlightAreaLine.rect.height / 2) - (strikeThroughLineThickness / 2)) * scale}px`, \"important\");\n\n                    // if (USE_BLEND_MODE) {\n                    //     highlightAreaLine.style.setProperty(\"mix-blend-mode\", \"multiply\", \"important\");\n                    //     highlightAreaLine.style.opacity = `${opacity}`;\n                    // }\n\n                    highlightParent.append(highlightAreaLine);\n                } else {\n\n                    const highlightArea = documant.createElement(\"div\") as IHTMLDivElementWithRect;\n                    highlightArea.setAttribute(\"class\", `${CLASS_HIGHLIGHT_AREA} ${CLASS_HIGHLIGHT_COMMON}`);\n                    let extra = \"\";\n                    if ((DEBUG_VISUALS || win.READIUM2.DEBUG_VISUALS)) {\n                        const rgb = Math.round(0xffffff * Math.random());\n                        // tslint:disable-next-line:no-bitwise\n                        const r = rgb >> 16;\n                        // tslint:disable-next-line:no-bitwise\n                        const g = rgb >> 8 & 255;\n                        // tslint:disable-next-line:no-bitwise\n                        const b = rgb & 255;\n                        // tslint:disable-next-line:max-line-length\n                        extra = `outline-color: rgb(${r}, ${g}, ${b}); outline-style: solid; outline-width: 1px; outline-offset: -1px;`;\n                        // box-shadow: inset 0 0 0 1px #600;\n                    } else if (drawUnderline) {\n                        // tslint:disable-next-line:max-line-length\n                        const side = isVerticalWritingMode() ? \"left\" : \"bottom\"; // isRTL()?\n                        extra = `border-${side}: ${underlineThickness * scale}px solid ` +\n                            (USE_BLEND_MODE ?\n                            // tslint:disable-next-line: max-line-length\n                            `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important` :\n                            `rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, ${opacity}) !important`);\n                    }\n                    // tslint:disable-next-line:max-line-length\n                    highlightArea.setAttribute(\"style\",\n                        (drawUnderline ?\n                        \"\" : // background-color: transparent !important\n                        ( // `border-radius: ${roundedCorner}px !important; ` +\n                        \"background-color: \" +\n                            (USE_BLEND_MODE ?\n                                // tslint:disable-next-line: max-line-length\n                                `rgb(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}) !important;` :\n                                `rgba(${highlight.color.red}, ${highlight.color.green}, ${highlight.color.blue}, ${opacity}) !important;`\n                            )\n                        )\n                        ) + ` ${extra}`);\n                    // tslint:disable-next-line:max-line-length\n                    // highlightArea.setAttribute(\"style\", `outline-color: magenta; outline-style: solid; outline-width: 1px; outline-offset: -1px;`);\n                    // highlightArea.style.setProperty(\n                    //     \"pointer-events\",\n                    //     \"none\",\n                    //     \"important\");\n                    highlightArea.style.setProperty(\"transform\", \"translate3d(0px, 0px, 0px)\", \"important\");\n                    highlightArea.style.setProperty(\"position\", paginated ? \"fixed\" : \"absolute\", \"important\");\n                    highlightArea.scale = scale;\n                    // highlightArea.xOffset = xOffset;\n                    // highlightArea.yOffset = yOffset;\n                    highlightArea.rect = {\n                        height: clientRect.height,\n                        left: clientRect.left - xOffset,\n                        top: clientRect.top - yOffset,\n                        width: clientRect.width,\n                    };\n                    highlightArea.style.setProperty(\"width\", `${highlightArea.rect.width * scale}px`, \"important\");\n                    highlightArea.style.setProperty(\"height\", `${highlightArea.rect.height * scale}px`, \"important\");\n                    highlightArea.style.setProperty(\"min-width\", highlightArea.style.width, \"important\");\n                    highlightArea.style.setProperty(\"min-height\", highlightArea.style.height, \"important\");\n                    highlightArea.style.setProperty(\"left\", `${highlightArea.rect.left * scale}px`, \"important\");\n                    highlightArea.style.setProperty(\"top\", `${highlightArea.rect.top * scale}px`, \"important\");\n\n                    // if (highlight.pointerInteraction) {\n                    //     highlightArea.style.setProperty(\"pointer-events\", \"auto\", \"important\");\n                    // }\n\n                    // if (USE_BLEND_MODE) {\n                    //     highlightArea.style.setProperty(\"mix-blend-mode\", \"multiply\", \"important\");\n                    //     highlightArea.style.opacity = `${opacity}`;\n                    // }\n\n                    highlightParent.append(highlightArea);\n                }\n            }\n        }\n\n        if (useSVG && highlightAreaSVGDocFrag) {\n            // const highlightAreaSVGG = documant.createElementNS(SVG_XML_NAMESPACE, \"g\");\n            // highlightAreaSVGG.appendChild(highlightAreaSVGDocFrag);\n            const highlightAreaSVG = documant.createElementNS(SVG_XML_NAMESPACE, \"svg\");\n            highlightAreaSVG.setAttribute(\"class\", CLASS_HIGHLIGHT_COMMON);\n            // highlightAreaSVG.setAttribute(\"pointer-events\", \"none\");\n            highlightAreaSVG.style.setProperty(\"position\", paginated ? \"fixed\" : \"absolute\", \"important\");\n            highlightAreaSVG.append(highlightAreaSVGDocFrag);\n            highlightParent.append(highlightAreaSVG);\n        }\n    }\n\n\n    // highlightsContainer.append(highlightParent);\n    return highlightParent;\n}\n"]}