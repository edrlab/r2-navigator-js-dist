{"version":3,"file":"dom.js","sourceRoot":"","sources":["../../../../../src/electron/common/dom.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\nimport * as xmldom from \"xmldom\";\n\nexport function serializeDOM(documant: Document): string {\n\n    const serialized = new xmldom.XMLSerializer().serializeToString(documant);\n\n    // import * as parse5 from \"parse5\";\n    // const serialized = parse5.serialize(documant);\n\n    return serialized;\n}\n\nexport function parseDOM(htmlStrToParse: string, mediaType: string | undefined): Document {\n\n    // not application/xhtml+xml because:\n    // https://github.com/jindw/xmldom/pull/208\n    // https://github.com/jindw/xmldom/pull/242\n    // https://github.com/xmldom/xmldom/blob/3db6ccf3f7ecbde73608490d71f96c727abdd69a/lib/dom-parser.js#L12\n    if (mediaType === \"application/xhtml+xml\") {\n        mediaType = \"application/xhtml\";\n    }\n    const documant = mediaType ?\n        new xmldom.DOMParser().parseFromString(htmlStrToParse, mediaType) :\n        new xmldom.DOMParser().parseFromString(htmlStrToParse);\n\n    // import * as parse5 from \"parse5\";\n    // const documant = parse5.parse(htmlStrToParse);\n\n    // debug(documant.doctype);\n\n    if (!documant.head) {\n        definePropertyGetterSetter_DocHeadBody(documant, \"head\");\n    }\n    if (!documant.body) {\n        definePropertyGetterSetter_DocHeadBody(documant, \"body\");\n    }\n    if (!documant.documentElement.style) {\n        definePropertyGetterSetter_ElementStyle(documant.documentElement);\n    }\n    if (!documant.body.style) {\n        definePropertyGetterSetter_ElementStyle(documant.body);\n    }\n    if (!documant.documentElement.classList) {\n        definePropertyGetterSetter_ElementClassList(documant.documentElement);\n    }\n\n    return documant;\n}\n\nfunction definePropertyGetterSetter_ElementClassList(element: Element) {\n    const classListObj: any = {};\n    classListObj.element = element;\n\n    classListObj.contains = classListContains.bind(classListObj);\n    classListObj.add = classListAdd.bind(classListObj);\n    classListObj.remove = classListRemove.bind(classListObj);\n\n    (element as any).classList = classListObj;\n}\n\nfunction classListContains(this: any, className: string): boolean {\n    const style = this;\n    const elem = style.element;\n    // if (isDEBUG_VISUALS(documant)) {\n    //     debug(`XMLDOM - classListContains: ${className}`);\n    // }\n\n    const classAttr = elem.getAttribute(\"class\");\n    if (!classAttr) {\n        return false;\n    }\n    const classes = classAttr.split(\" \");\n    for (const clazz of classes) {\n        if (clazz === className) {\n            // if (isDEBUG_VISUALS(documant)) {\n            //     debug(`XMLDOM - classListContains TRUE: ${className}`);\n            // }\n            return true;\n        }\n    }\n    return false;\n}\nfunction classListAdd(this: any, className: string) {\n    const style = this;\n    const elem = style.element;\n\n    // if (isDEBUG_VISUALS(documant)) {\n    //     debug(`XMLDOM - classListAdd: ${className}`);\n    // }\n\n    const classAttr = elem.getAttribute(\"class\");\n    if (!classAttr) {\n        elem.setAttribute(\"class\", className);\n        return;\n    }\n    let needsAdding = true;\n    const classes = classAttr.split(\" \");\n    for (const clazz of classes) {\n        if (clazz === className) {\n            needsAdding = false;\n            break;\n        }\n    }\n    if (needsAdding) {\n        elem.setAttribute(\"class\", `${classAttr} ${className}`);\n    }\n}\nfunction classListRemove(this: any, className: string) {\n    const style = this;\n    const elem = style.element;\n\n    // if (isDEBUG_VISUALS(documant)) {\n    //     debug(`XMLDOM - classListRemove: ${className}`);\n    // }\n\n    const classAttr = elem.getAttribute(\"class\");\n    if (!classAttr) {\n        return;\n    }\n    const arr: string[] = [];\n    const classes = classAttr.split(\" \");\n    for (const clazz of classes) {\n        if (clazz !== className) {\n            arr.push(clazz);\n        }\n    }\n    elem.setAttribute(\"class\", arr.join(\" \"));\n}\n\nfunction definePropertyGetterSetter_DocHeadBody(documant: Document, elementName: string) {\n\n    Object.defineProperty(documant, elementName, {\n        get() {\n            const doc = this as Document;\n\n            const key = elementName + \"_\";\n            if ((doc as any)[key]) {\n                return (doc as any)[key]; // cached\n            }\n            if (doc.documentElement.childNodes && doc.documentElement.childNodes.length) {\n                // tslint:disable-next-line: prefer-for-of\n                for (let i = 0; i < doc.documentElement.childNodes.length; i++) {\n                    const child = doc.documentElement.childNodes[i];\n                    if (child.nodeType === 1) { // Node.ELEMENT_NODE\n                        const element = child as Element;\n                        if (element.localName && element.localName.toLowerCase() === elementName) {\n                            (doc as any)[key] = element; // cache\n                            // if (isDEBUG_VISUALS(documant)) {\n                            //     debug(`XMLDOM - cached documant.${elementName}`);\n                            // }\n                            return element;\n                        }\n                    }\n                }\n            }\n            return undefined;\n        },\n        set(_val) {\n            console.log(\"documant.\" + elementName + \" CANNOT BE SET!!\");\n        },\n    });\n}\n\nfunction definePropertyGetterSetter_ElementStyle(element: Element) {\n    const styleObj: any = {};\n    styleObj.element = element;\n\n    styleObj.setProperty = cssSetProperty.bind(styleObj);\n    styleObj.removeProperty = cssRemoveProperty.bind(styleObj);\n\n    styleObj.item = cssStyleItem.bind(styleObj);\n    Object.defineProperty(styleObj, \"length\", {\n        get() {\n            const style = this as any;\n            const elem = style.element;\n\n            // if (isDEBUG_VISUALS(documant)) {\n            //     debug(`XMLDOM - style.length`);\n            // }\n\n            const styleAttr = elem.getAttribute(\"style\");\n            if (!styleAttr) {\n                return 0;\n            }\n            let count = 0;\n            const cssProps = styleAttr.split(\";\");\n            for (const cssProp of cssProps) {\n                if (cssProp.trim().length) {\n                    count++;\n                }\n            }\n            // if (isDEBUG_VISUALS(documant)) {\n            //     debug(`XMLDOM - style.length: ${count}`);\n            // }\n            return count;\n        },\n        set(_val) {\n            console.log(\"style.length CANNOT BE SET!!\");\n        },\n    });\n\n    const cssProperties = [\"overflow\", \"width\", \"height\", \"margin\", \"transformOrigin\", \"transform\"];\n    cssProperties.forEach((cssProperty) => {\n\n        Object.defineProperty(styleObj, cssProperty, {\n            get() {\n                const style = this as any;\n                const elem = style.element;\n\n                return cssStyleGet(cssProperty, elem);\n            },\n            set(val) {\n                const style = this as any;\n                const elem = style.element;\n\n                cssStyleSet(cssProperty, val, elem);\n            },\n        });\n    });\n\n    (element as any).style = styleObj;\n}\n\nfunction cssSetProperty(this: any, cssProperty: string, val: string) {\n    const style = this;\n    const elem = style.element;\n\n    // debug(`XMLDOM - cssSetProperty: ${cssProperty}: ${val};`);\n    cssStyleSet(cssProperty, val, elem);\n}\nfunction cssRemoveProperty(this: any, cssProperty: string) {\n    const style = this;\n    const elem = style.element;\n\n    // debug(`XMLDOM - cssRemoveProperty: ${cssProperty}`);\n    cssStyleSet(cssProperty, undefined, elem);\n}\nfunction cssStyleItem(this: any, i: number): string | undefined {\n    const style = this;\n    const elem = style.element;\n    // if (isDEBUG_VISUALS(documant)) {\n    //     debug(`XMLDOM - cssStyleItem: ${i}`);\n    // }\n    const styleAttr = elem.getAttribute(\"style\");\n    if (!styleAttr) {\n        return undefined;\n    }\n    let count = -1;\n    const cssProps = styleAttr.split(\";\");\n    for (const cssProp of cssProps) {\n        const trimmed = cssProp.trim();\n        if (trimmed.length) {\n            count++;\n            if (count === i) {\n                const regExStr = `(.+)[\\s]*:[\\s]*(.+)`;\n                const regex = new RegExp(regExStr, \"g\");\n                const regexMatch = regex.exec(trimmed);\n                if (regexMatch) {\n                    // if (isDEBUG_VISUALS(documant)) {\n                    //     debug(`XMLDOM - cssStyleItem: ${i} => ${regexMatch[1]}`);\n                    // }\n                    return regexMatch[1];\n                }\n            }\n        }\n    }\n    return undefined;\n}\nfunction cssStyleGet(cssProperty: string, elem: Element): string | undefined {\n    // if (isDEBUG_VISUALS(documant)) {\n    //     debug(`XMLDOM - cssStyleGet: ${cssProperty}`);\n    // }\n\n    const styleAttr = elem.getAttribute(\"style\");\n    if (!styleAttr) {\n        return undefined;\n    }\n    const regExStr = `${cssProperty}[\\s]*:[\\s]*(.+)`;\n    const cssProps = styleAttr.split(\";\");\n    let cssPropertyValue: string | undefined;\n    for (const cssProp of cssProps) {\n        const regex = new RegExp(regExStr, \"g\");\n        const regexMatch = regex.exec(cssProp.trim());\n        if (regexMatch) {\n            cssPropertyValue = regexMatch[1];\n            // if (isDEBUG_VISUALS(documant)) {\n            //     debug(`XMLDOM - cssStyleGet: ${cssProperty} => ${cssPropertyValue}`);\n            // }\n            break;\n        }\n    }\n    return cssPropertyValue ? cssPropertyValue : undefined;\n}\nfunction cssStyleSet(cssProperty: string, val: string | undefined, elem: Element) {\n    // if (isDEBUG_VISUALS(documant)) {\n    //     debug(`XMLDOM - cssStyleSet: ${cssProperty}: ${val};`);\n    // }\n\n    const str = val ? `${cssProperty}: ${val}` : undefined;\n\n    const styleAttr = elem.getAttribute(\"style\");\n    if (!styleAttr) {\n        if (str) {\n            elem.setAttribute(\"style\", str);\n        }\n    } else {\n        const regExStr = `${cssProperty}[\\s]*:[\\s]*(.+)`;\n        const regex = new RegExp(regExStr, \"g\");\n        const regexMatch = regex.exec(styleAttr);\n        if (regexMatch) {\n            elem.setAttribute(\"style\", styleAttr.replace(regex, str ? `${str}` : \"\"));\n        } else {\n            if (str) {\n                elem.setAttribute(\"style\", `${styleAttr}; ${str}`);\n            }\n        }\n    }\n}\n"]}